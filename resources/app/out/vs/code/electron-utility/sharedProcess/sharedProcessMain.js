/*!--------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/var Ic=function(t,e){return Ic=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,i){s.__proto__=i}||function(s,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(s[n]=i[n])},Ic(t,e)};export function __extends(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Ic(t,e);function s(){this.constructor=t}t.prototype=e===null?Object.create(e):(s.prototype=e.prototype,new s)}export var __assign=function(){return __assign=Object.assign||function(e){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},__assign.apply(this,arguments)};export function __rest(t,e){var s={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(s[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(s[i[n]]=t[i[n]]);return s}export function __decorate(t,e,s,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,s):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(t,e,s,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(r=(n<3?o(r):n>3?o(e,s,r):o(e,s))||r);return n>3&&r&&Object.defineProperty(e,s,r),r}export function __param(t,e){return function(s,i){e(s,i,t)}}export function __esDecorate(t,e,s,i,n,r){function o(b){if(b!==void 0&&typeof b!="function")throw new TypeError("Function expected");return b}for(var a=i.kind,c=a==="getter"?"get":a==="setter"?"set":"value",l=!e&&t?i.static?t:t.prototype:null,h=e||(l?Object.getOwnPropertyDescriptor(l,i.name):{}),u,f=!1,p=s.length-1;p>=0;p--){var g={};for(var m in i)g[m]=m==="access"?{}:i[m];for(var m in i.access)g.access[m]=i.access[m];g.addInitializer=function(b){if(f)throw new TypeError("Cannot add initializers after decoration has completed");r.push(o(b||null))};var v=(0,s[p])(a==="accessor"?{get:h.get,set:h.set}:h[c],g);if(a==="accessor"){if(v===void 0)continue;if(v===null||typeof v!="object")throw new TypeError("Object expected");(u=o(v.get))&&(h.get=u),(u=o(v.set))&&(h.set=u),(u=o(v.init))&&n.unshift(u)}else(u=o(v))&&(a==="field"?n.unshift(u):h[c]=u)}l&&Object.defineProperty(l,i.name,h),f=!0}export function __runInitializers(t,e,s){for(var i=arguments.length>2,n=0;n<e.length;n++)s=i?e[n].call(t,s):e[n].call(t);return i?s:void 0}export function __propKey(t){return typeof t=="symbol"?t:"".concat(t)}export function __setFunctionName(t,e,s){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(t,"name",{configurable:!0,value:s?"".concat(s," ",e):e})}export function __metadata(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}export function __awaiter(t,e,s,i){function n(r){return r instanceof s?r:new s(function(o){o(r)})}return new(s||(s=Promise))(function(r,o){function a(h){try{l(i.next(h))}catch(u){o(u)}}function c(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){h.done?r(h.value):n(h.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}export function __generator(t,e){var s={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,n,r,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(h){return c([l,h])}}function c(l){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(s=0)),s;)try{if(i=1,n&&(r=l[0]&2?n.return:l[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,l[1])).done)return r;switch(n=0,r&&(l=[l[0]&2,r.value]),l[0]){case 0:case 1:r=l;break;case 4:return s.label++,{value:l[1],done:!1};case 5:s.label++,n=l[1],l=[0];continue;case 7:l=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(l[0]===6||l[0]===2)){s=0;continue}if(l[0]===3&&(!r||l[1]>r[0]&&l[1]<r[3])){s.label=l[1];break}if(l[0]===6&&s.label<r[1]){s.label=r[1],r=l;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(l);break}r[2]&&s.ops.pop(),s.trys.pop();continue}l=e.call(t,s)}catch(h){l=[6,h],n=0}finally{i=r=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}export var __createBinding=Object.create?function(t,e,s,i){i===void 0&&(i=s);var n=Object.getOwnPropertyDescriptor(e,s);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[s]}}),Object.defineProperty(t,i,n)}:function(t,e,s,i){i===void 0&&(i=s),t[i]=e[s]};export function __exportStar(t,e){for(var s in t)s!=="default"&&!Object.prototype.hasOwnProperty.call(e,s)&&__createBinding(e,t,s)}export function __values(t){var e=typeof Symbol=="function"&&Symbol.iterator,s=e&&t[e],i=0;if(s)return s.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}export function __read(t,e){var s=typeof Symbol=="function"&&t[Symbol.iterator];if(!s)return t;var i=s.call(t),n,r=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)r.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(s=i.return)&&s.call(i)}finally{if(o)throw o.error}}return r}export function __spread(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t}export function __spreadArrays(){for(var t=0,e=0,s=arguments.length;e<s;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<s;e++)for(var r=arguments[e],o=0,a=r.length;o<a;o++,n++)i[n]=r[o];return i}export function __spreadArray(t,e,s){if(s||arguments.length===2)for(var i=0,n=e.length,r;i<n;i++)(r||!(i in e))&&(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}export function __await(t){return this instanceof __await?(this.v=t,this):new __await(t)}export function __asyncGenerator(t,e,s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=s.apply(t,e||[]),n,r=[];return n={},a("next"),a("throw"),a("return",o),n[Symbol.asyncIterator]=function(){return this},n;function o(p){return function(g){return Promise.resolve(g).then(p,u)}}function a(p,g){i[p]&&(n[p]=function(m){return new Promise(function(v,b){r.push([p,m,v,b])>1||c(p,m)})},g&&(n[p]=g(n[p])))}function c(p,g){try{l(i[p](g))}catch(m){f(r[0][3],m)}}function l(p){p.value instanceof __await?Promise.resolve(p.value.v).then(h,u):f(r[0][2],p)}function h(p){c("next",p)}function u(p){c("throw",p)}function f(p,g){p(g),r.shift(),r.length&&c(r[0][0],r[0][1])}}export function __asyncDelegator(t){var e,s;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,r){e[n]=t[n]?function(o){return(s=!s)?{value:__await(t[n](o)),done:!1}:r?r(o):o}:r}}export function __asyncValues(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],s;return e?e.call(t):(t=typeof __values=="function"?__values(t):t[Symbol.iterator](),s={},i("next"),i("throw"),i("return"),s[Symbol.asyncIterator]=function(){return this},s);function i(r){s[r]=t[r]&&function(o){return new Promise(function(a,c){o=t[r](o),n(a,c,o.done,o.value)})}}function n(r,o,a,c){Promise.resolve(c).then(function(l){r({value:l,done:a})},o)}}export function __makeTemplateObject(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var Pw=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e};export function __importStar(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var s in t)s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)&&__createBinding(e,t,s);return Pw(e,t),e}export function __importDefault(t){return t&&t.__esModule?t:{default:t}}export function __classPrivateFieldGet(t,e,s,i){if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return s==="m"?i:s==="a"?i.call(t):i?i.value:e.get(t)}export function __classPrivateFieldSet(t,e,s,i,n){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?n.call(t,s):n?n.value=s:e.set(t,s),s}export function __classPrivateFieldIn(t,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof t=="function"?e===t:t.has(e)}export function __addDisposableResource(t,e,s){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var i,n;if(s){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");i=e[Symbol.asyncDispose]}if(i===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");i=e[Symbol.dispose],s&&(n=i)}if(typeof i!="function")throw new TypeError("Object not disposable.");n&&(i=function(){try{n.call(this)}catch(r){return Promise.reject(r)}}),t.stack.push({value:e,dispose:i,async:s})}else s&&t.stack.push({async:!0});return e}var Iw=typeof SuppressedError=="function"?SuppressedError:function(t,e,s){var i=new Error(s);return i.name="SuppressedError",i.error=t,i.suppressed=e,i};export function __disposeResources(t){function e(i){t.error=t.hasError?new Iw(i,t.error,"An error was suppressed during disposal."):i,t.hasError=!0}function s(){for(;t.stack.length;){var i=t.stack.pop();try{var n=i.dispose&&i.dispose.call(i.value);if(i.async)return Promise.resolve(n).then(s,function(r){return e(r),s()})}catch(r){e(r)}}if(t.hasError)throw t.error}return s()}export default{__extends,__assign,__rest,__decorate,__param,__metadata,__awaiter,__generator,__createBinding,__exportStar,__values,__read,__spread,__spreadArrays,__spreadArray,__await,__asyncGenerator,__asyncDelegator,__asyncValues,__makeTemplateObject,__importStar,__importDefault,__classPrivateFieldGet,__classPrivateFieldSet,__classPrivateFieldIn,__addDisposableResource,__disposeResources};var Aw=Object.create,yd=Object.defineProperty,Lw=Object.getOwnPropertyDescriptor,bd=Object.getOwnPropertyNames,Ow=Object.getPrototypeOf,Nw=Object.prototype.hasOwnProperty,Tw=(t,e)=>function(){return e||(0,t[bd(t)[0]])((e={exports:{}}).exports,e),e.exports},jw=(t,e,s,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of bd(e))!Nw.call(t,n)&&n!==s&&yd(t,n,{get:()=>e[n],enumerable:!(i=Lw(e,n))||i.enumerable});return t},Mw=(t,e,s)=>(s=t!=null?Aw(Ow(t)):{},jw(e||!t||!t.__esModule?yd(s,"default",{value:t,enumerable:!0}):s,t)),Uw=Tw({"node_modules/minimist/index.js"(t,e){"use strict";function s(r,o){var a=r;o.slice(0,-1).forEach(function(l){a=a[l]||{}});var c=o[o.length-1];return c in a}function i(r){return typeof r=="number"||/^0x[0-9a-f]+$/i.test(r)?!0:/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(r)}function n(r,o){return o==="constructor"&&typeof r[o]=="function"||o==="__proto__"}e.exports=function(r,o){o||(o={});var a={bools:{},strings:{},unknownFn:null};typeof o.unknown=="function"&&(a.unknownFn=o.unknown),typeof o.boolean=="boolean"&&o.boolean?a.allBools=!0:[].concat(o.boolean).filter(Boolean).forEach(function(C){a.bools[C]=!0});var c={};function l(C){return c[C].some(function(_){return a.bools[_]})}Object.keys(o.alias||{}).forEach(function(C){c[C]=[].concat(o.alias[C]),c[C].forEach(function(_){c[_]=[C].concat(c[C].filter(function(q){return _!==q}))})}),[].concat(o.string).filter(Boolean).forEach(function(C){a.strings[C]=!0,c[C]&&[].concat(c[C]).forEach(function(_){a.strings[_]=!0})});var h=o.default||{},u={_:[]};function f(C,_){return a.allBools&&/^--[^=]+$/.test(_)||a.strings[C]||a.bools[C]||c[C]}function p(C,_,q){for(var T=C,A=0;A<_.length-1;A++){var P=_[A];if(n(T,P))return;T[P]===void 0&&(T[P]={}),(T[P]===Object.prototype||T[P]===Number.prototype||T[P]===String.prototype)&&(T[P]={}),T[P]===Array.prototype&&(T[P]=[]),T=T[P]}var M=_[_.length-1];n(T,M)||((T===Object.prototype||T===Number.prototype||T===String.prototype)&&(T={}),T===Array.prototype&&(T=[]),T[M]===void 0||a.bools[M]||typeof T[M]=="boolean"?T[M]=q:Array.isArray(T[M])?T[M].push(q):T[M]=[T[M],q])}function g(C,_,q){if(!(q&&a.unknownFn&&!f(C,q)&&a.unknownFn(q)===!1)){var T=!a.strings[C]&&i(_)?Number(_):_;p(u,C.split("."),T),(c[C]||[]).forEach(function(A){p(u,A.split("."),T)})}}Object.keys(a.bools).forEach(function(C){g(C,h[C]===void 0?!1:h[C])});var m=[];r.indexOf("--")!==-1&&(m=r.slice(r.indexOf("--")+1),r=r.slice(0,r.indexOf("--")));for(var v=0;v<r.length;v++){var b=r[v],S,$;if(/^--.+=/.test(b)){var F=b.match(/^--([^=]+)=([\s\S]*)$/);S=F[1];var B=F[2];a.bools[S]&&(B=B!=="false"),g(S,B,b)}else if(/^--no-.+/.test(b))S=b.match(/^--no-(.+)/)[1],g(S,!1,b);else if(/^--.+/.test(b))S=b.match(/^--(.+)/)[1],$=r[v+1],$!==void 0&&!/^(-|--)[^-]/.test($)&&!a.bools[S]&&!a.allBools&&(!c[S]||!l(S))?(g(S,$,b),v+=1):/^(true|false)$/.test($)?(g(S,$==="true",b),v+=1):g(S,a.strings[S]?"":!0,b);else if(/^-[^-]+/.test(b)){for(var ve=b.slice(1,-1).split(""),N=!1,E=0;E<ve.length;E++){if($=b.slice(E+2),$==="-"){g(ve[E],$,b);continue}if(/[A-Za-z]/.test(ve[E])&&$[0]==="="){g(ve[E],$.slice(1),b),N=!0;break}if(/[A-Za-z]/.test(ve[E])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test($)){g(ve[E],$,b),N=!0;break}if(ve[E+1]&&ve[E+1].match(/\W/)){g(ve[E],b.slice(E+2),b),N=!0;break}else g(ve[E],a.strings[ve[E]]?"":!0,b)}S=b.slice(-1)[0],!N&&S!=="-"&&(r[v+1]&&!/^(-|--)[^-]/.test(r[v+1])&&!a.bools[S]&&(!c[S]||!l(S))?(g(S,r[v+1],b),v+=1):r[v+1]&&/^(true|false)$/.test(r[v+1])?(g(S,r[v+1]==="true",b),v+=1):g(S,a.strings[S]?"":!0,b))}else if((!a.unknownFn||a.unknownFn(b)!==!1)&&u._.push(a.strings._||!i(b)?b:Number(b)),o.stopEarly){u._.push.apply(u._,r.slice(v+1));break}}return Object.keys(h).forEach(function(C){s(u,C.split("."))||(p(u,C.split("."),h[C]),(c[C]||[]).forEach(function(_){p(u,_.split("."),h[C])}))}),o["--"]?u["--"]=m.slice():m.forEach(function(C){u._.push(C)}),u}}});import{hostname as Fw,release as qw}from"os";function _w(t,e,s=0,i=t.length){let n=s,r=i;for(;n<r;){const o=Math.floor((n+r)/2);e(t[o])?n=o+1:r=o}return n-1}var wS=class Qv{static{this.assertInvariants=!1}constructor(e){this.e=e,this.c=0}findLastMonotonous(e){if(Qv.assertInvariants){if(this.d){for(const i of this.e)if(this.d(i)&&!e(i))throw new Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this.d=e}const s=_w(this.e,e,this.c);return this.c=s+1,s===-1?void 0:this.e[s]}},zw=class{constructor(){this.b=[],this.a=function(t){setTimeout(()=>{throw t.stack?ki.isErrorNoTelemetry(t)?new ki(t.message+`

`+t.stack):new Error(t.message+`

`+t.stack):t},0)}}addListener(t){return this.b.push(t),()=>{this.d(t)}}c(t){this.b.forEach(e=>{e(t)})}d(t){this.b.splice(this.b.indexOf(t),1)}setUnexpectedErrorHandler(t){this.a=t}getUnexpectedErrorHandler(){return this.a}onUnexpectedError(t){this.a(t),this.c(t)}onUnexpectedExternalError(t){this.a(t)}},Sd=new zw;function Vw(t){Sd.setUnexpectedErrorHandler(t)}function it(t){Ms(t)||Sd.onUnexpectedError(t)}var ho="Canceled";function Ms(t){return t instanceof nt?!0:t instanceof Error&&t.name===ho&&t.message===ho}var nt=class extends Error{constructor(){super(ho),this.name=this.message}},yS=class vc extends Error{static{this.a="PendingMigrationError"}static is(e){return e instanceof vc||e instanceof Error&&e.name===vc.a}constructor(e){super(e),this.name=vc.a}};function uo(){const t=new Error(ho);return t.name=t.message,t}function Bw(t){return t?new Error(`Illegal argument: ${t}`):new Error("Illegal argument")}function Ed(t){return t?new Error(`Illegal state: ${t}`):new Error("Illegal state")}function se(t){return t?t.message?t.message:t.stack?t.stack.split(`
`)[0]:String(t):"Error"}var ki=class rd extends Error{constructor(e){super(e),this.name="CodeExpectedError"}static fromError(e){if(e instanceof rd)return e;const s=new rd;return s.message=e.message,s.stack=e.stack,s}static isErrorNoTelemetry(e){return e.name==="CodeExpectedError"}},Ac=class Xv extends Error{constructor(e){super(e||"An unexpected bug occurred."),Object.setPrototypeOf(this,Xv.prototype)}};function jt(t,e,s=(i,n)=>i===n){if(t===e)return!0;if(!t||!e||t.length!==e.length)return!1;for(let i=0,n=t.length;i<n;i++)if(!s(t[i],e[i]))return!1;return!0}function Lc(t,e,s){if(t=t|0,t>=e.length)throw new TypeError("invalid index");const i=e[Math.floor(e.length*Math.random())],n=[],r=[],o=[];for(const a of e){const c=s(a,i);c<0?n.push(a):c>0?r.push(a):o.push(a)}return t<n.length?Lc(t,n,s):t<n.length+o.length?o[0]:Lc(t-(n.length+o.length),r,s)}function rn(t){return t.filter(e=>!!e)}function Kn(t){return Array.isArray(t)&&t.length>0}function Dt(t,e=s=>s){const s=new Set;return t.filter(i=>{const n=e(i);return s.has(n)?!1:(s.add(n),!0)})}function $d(t,e){return t.push(e),()=>Ww(t,e)}function Ww(t,e){const s=t.indexOf(e);if(s>-1)return t.splice(s,1),e}function xd(t,e){let s;if(typeof e=="number"){let i=e;s=()=>{const n=Math.sin(i++)*179426549;return n-Math.floor(n)}}else s=Math.random;for(let i=t.length-1;i>0;i-=1){const n=Math.floor(s()*(i+1)),r=t[i];t[i]=t[n],t[n]=r}}function Hw(t){return t[Math.floor(Math.random()*t.length)]}var Oc;(function(t){function e(r){return r<0}t.isLessThan=e;function s(r){return r<=0}t.isLessThanOrEqual=s;function i(r){return r>0}t.isGreaterThan=i;function n(r){return r===0}t.isNeitherLessOrGreaterThan=n,t.greaterThan=1,t.lessThan=-1,t.neitherLessOrGreaterThan=0})(Oc||(Oc={}));function Gw(t,e){return(s,i)=>e(t(s),t(i))}var Jw=(t,e)=>t-e,bS=class wc{static{this.empty=new wc(e=>{})}constructor(e){this.iterate=e}forEach(e){this.iterate(s=>(e(s),!0))}toArray(){const e=[];return this.iterate(s=>(e.push(s),!0)),e}filter(e){return new wc(s=>this.iterate(i=>e(i)?s(i):!0))}map(e){return new wc(s=>this.iterate(i=>s(e(i))))}some(e){let s=!1;return this.iterate(i=>(s=e(i),!s)),s}findFirst(e){let s;return this.iterate(i=>e(i)?(s=i,!1):!0),s}findLast(e){let s;return this.iterate(i=>(e(i)&&(s=i),!0)),s}findLastMaxBy(e){let s,i=!0;return this.iterate(n=>((i||Oc.isGreaterThan(e(n,s)))&&(i=!1,s=n),!0)),s}};function Nc(t,e){if(!t)throw new Error(e?`Assertion failed (${e})`:"Assertion Failed")}function Kw(t,e="Unreachable"){throw new Error(e)}function Tc(t,e="unexpected state"){if(!t)throw typeof e=="string"?new Ac(`Assertion Failed: ${e}`):e}function de(t){return typeof t=="string"}function Te(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)&&!(t instanceof RegExp)&&!(t instanceof Date)}function Qw(t){const e=Object.getPrototypeOf(Uint8Array);return typeof t=="object"&&t instanceof e}function fo(t){return typeof t=="number"&&!isNaN(t)}function Xw(t){return!!t&&typeof t[Symbol.iterator]=="function"}function ls(t){return t===!0||t===!1}function ot(t){return typeof t>"u"}function kd(t){return!Et(t)}function Et(t){return ot(t)||t===null}function Zw(t,e){if(!t)throw new Error(e?`Unexpected type, expected '${e}'`:"Unexpected type")}function hs(t){return Tc(t!=null,"Argument is `undefined` or `null`."),t}var Yw=Object.prototype.hasOwnProperty;function Cd(t){if(!Te(t))return!1;for(const e in t)if(Yw.call(t,e))return!1;return!0}function jc(t){return typeof t=="function"}function ey(){return globalThis._VSCODE_NLS_MESSAGES}function Rd(){return globalThis._VSCODE_NLS_LANGUAGE}var ty=Rd()==="pseudo"||typeof document<"u"&&document.location&&typeof document.location.hash=="string"&&document.location.hash.indexOf("pseudo=true")>=0;function po(t,e){let s;return e.length===0?s=t:s=t.replace(/\{(\d+)\}/g,(i,n)=>{const r=n[0],o=e[r];let a=i;return typeof o=="string"?a=o:(typeof o=="number"||typeof o=="boolean"||o===void 0||o===null)&&(a=String(o)),a}),ty&&(s="\uFF3B"+s.replace(/[aouei]/g,"$&$&")+"\uFF3D"),s}function w(t,e,...s){return po(typeof t=="number"?Dd(t,e):e,s)}function Dd(t,e){const s=ey()?.[t];if(typeof s!="string"){if(typeof e=="string")return e;throw new Error(`!!! NLS MISSING: ${t} !!!`)}return s}function Pd(t,e,...s){let i;typeof t=="number"?i=Dd(t,e):i=e;const n=po(i,s);return{value:n,original:e===i?n:po(e,s)}}function Mc(t,e){return e&&(t.stack||t.stacktrace)?w(110,null,Ad(t),Id(t.stack)||Id(t.stacktrace)):Ad(t)}function Id(t){return Array.isArray(t)?t.join(`
`):t}function Ad(t){return t.code==="ERR_UNC_HOST_NOT_ALLOWED"?`${t.message}. Please update the 'security.allowedUNCHosts' setting if you want to allow this host.`:typeof t.code=="string"&&typeof t.errno=="number"&&typeof t.syscall=="string"?w(111,null,t.message):t.message||w(112,null)}function Xt(t=null,e=!1){if(!t)return w(113,null);if(Array.isArray(t)){const s=rn(t),i=Xt(s[0],e);return s.length>1?w(114,null,i,s.length):i}if(de(t))return t;if(t.detail){const s=t.detail;if(s.error)return Mc(s.error,e);if(s.exception)return Mc(s.exception,e)}return t.stack?Mc(t,e):t.message?t.message:w(115,null)}var Ld;function sy(t,e){const s=Object.create(null);for(const i of t){const n=e(i);let r=s[n];r||(r=s[n]=[]),r.push(i)}return s}var SS=class{static{Ld=Symbol.toStringTag}constructor(t,e){this.b=e,this.a=new Map,this[Ld]="SetWithKey";for(const s of t)this.add(s)}get size(){return this.a.size}add(t){const e=this.b(t);return this.a.set(e,t),this}delete(t){return this.a.delete(this.b(t))}has(t){return this.a.has(this.b(t))}*entries(){for(const t of this.a.values())yield[t,t]}keys(){return this.values()}*values(){for(const t of this.a.values())yield t}clear(){this.a.clear()}forEach(t,e){this.a.forEach(s=>t.call(e,s,s,this))}[Symbol.iterator](){return this.values()}},Od,Nd,Td,iy=class{constructor(t,e){this.uri=t,this.value=e}};function ny(t){return Array.isArray(t)}var ht=class Zr{static{this.c=e=>e.toString()}constructor(e,s){if(this[Od]="ResourceMap",e instanceof Zr)this.d=new Map(e.d),this.e=s??Zr.c;else if(ny(e)){this.d=new Map,this.e=s??Zr.c;for(const[i,n]of e)this.set(i,n)}else this.d=new Map,this.e=e??Zr.c}set(e,s){return this.d.set(this.e(e),new iy(e,s)),this}get(e){return this.d.get(this.e(e))?.value}has(e){return this.d.has(this.e(e))}get size(){return this.d.size}clear(){this.d.clear()}delete(e){return this.d.delete(this.e(e))}forEach(e,s){typeof s<"u"&&(e=e.bind(s));for(const[i,n]of this.d)e(n.value,n.uri,this)}*values(){for(const e of this.d.values())yield e.value}*keys(){for(const e of this.d.values())yield e.uri}*entries(){for(const e of this.d.values())yield[e.uri,e.value]}*[(Od=Symbol.toStringTag,Symbol.iterator)](){for(const[,e]of this.d)yield[e.uri,e.value]}},Uc=class{constructor(t,e){this[Nd]="ResourceSet",!t||typeof t=="function"?this.c=new ht(t):(this.c=new ht(e),t.forEach(this.add,this))}get size(){return this.c.size}add(t){return this.c.set(t,t),this}clear(){this.c.clear()}delete(t){return this.c.delete(t)}forEach(t,e){this.c.forEach((s,i)=>t.call(e,i,i,this))}has(t){return this.c.has(t)}entries(){return this.c.entries()}keys(){return this.c.keys()}values(){return this.c.keys()}[(Nd=Symbol.toStringTag,Symbol.iterator)](){return this.keys()}},jd;(function(t){t[t.None=0]="None",t[t.AsOld=1]="AsOld",t[t.AsNew=2]="AsNew"})(jd||(jd={}));var ry=class{constructor(){this[Td]="LinkedMap",this.c=new Map,this.d=void 0,this.e=void 0,this.f=0,this.g=0}clear(){this.c.clear(),this.d=void 0,this.e=void 0,this.f=0,this.g++}isEmpty(){return!this.d&&!this.e}get size(){return this.f}get first(){return this.d?.value}get last(){return this.e?.value}has(t){return this.c.has(t)}get(t,e=0){const s=this.c.get(t);if(s)return e!==0&&this.n(s,e),s.value}set(t,e,s=0){let i=this.c.get(t);if(i)i.value=e,s!==0&&this.n(i,s);else{switch(i={key:t,value:e,next:void 0,previous:void 0},s){case 0:this.l(i);break;case 1:this.k(i);break;case 2:this.l(i);break;default:this.l(i);break}this.c.set(t,i),this.f++}return this}delete(t){return!!this.remove(t)}remove(t){const e=this.c.get(t);if(e)return this.c.delete(t),this.m(e),this.f--,e.value}shift(){if(!this.d&&!this.e)return;if(!this.d||!this.e)throw new Error("Invalid list");const t=this.d;return this.c.delete(t.key),this.m(t),this.f--,t.value}forEach(t,e){const s=this.g;let i=this.d;for(;i;){if(e?t.bind(e)(i.value,i.key,this):t(i.value,i.key,this),this.g!==s)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){const t=this,e=this.g;let s=this.d;const i={[Symbol.iterator](){return i},next(){if(t.g!==e)throw new Error("LinkedMap got modified during iteration.");if(s){const n={value:s.key,done:!1};return s=s.next,n}else return{value:void 0,done:!0}}};return i}values(){const t=this,e=this.g;let s=this.d;const i={[Symbol.iterator](){return i},next(){if(t.g!==e)throw new Error("LinkedMap got modified during iteration.");if(s){const n={value:s.value,done:!1};return s=s.next,n}else return{value:void 0,done:!0}}};return i}entries(){const t=this,e=this.g;let s=this.d;const i={[Symbol.iterator](){return i},next(){if(t.g!==e)throw new Error("LinkedMap got modified during iteration.");if(s){const n={value:[s.key,s.value],done:!1};return s=s.next,n}else return{value:void 0,done:!0}}};return i}[(Td=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}h(t){if(t>=this.size)return;if(t===0){this.clear();return}let e=this.d,s=this.size;for(;e&&s>t;)this.c.delete(e.key),e=e.next,s--;this.d=e,this.f=s,e&&(e.previous=void 0),this.g++}j(t){if(t>=this.size)return;if(t===0){this.clear();return}let e=this.e,s=this.size;for(;e&&s>t;)this.c.delete(e.key),e=e.previous,s--;this.e=e,this.f=s,e&&(e.next=void 0),this.g++}k(t){if(!this.d&&!this.e)this.e=t;else if(this.d)t.next=this.d,this.d.previous=t;else throw new Error("Invalid list");this.d=t,this.g++}l(t){if(!this.d&&!this.e)this.d=t;else if(this.e)t.previous=this.e,this.e.next=t;else throw new Error("Invalid list");this.e=t,this.g++}m(t){if(t===this.d&&t===this.e)this.d=void 0,this.e=void 0;else if(t===this.d){if(!t.next)throw new Error("Invalid list");t.next.previous=void 0,this.d=t.next}else if(t===this.e){if(!t.previous)throw new Error("Invalid list");t.previous.next=void 0,this.e=t.previous}else{const e=t.next,s=t.previous;if(!e||!s)throw new Error("Invalid list");e.previous=s,s.next=e}t.next=void 0,t.previous=void 0,this.g++}n(t,e){if(!this.d||!this.e)throw new Error("Invalid list");if(!(e!==1&&e!==2)){if(e===1){if(t===this.d)return;const s=t.next,i=t.previous;t===this.e?(i.next=void 0,this.e=i):(s.previous=i,i.next=s),t.previous=void 0,t.next=this.d,this.d.previous=t,this.d=t,this.g++}else if(e===2){if(t===this.e)return;const s=t.next,i=t.previous;t===this.d?(s.previous=void 0,this.d=s):(s.previous=i,i.next=s),t.next=void 0,t.previous=this.e,this.e.next=t,this.e=t,this.g++}}}toJSON(){const t=[];return this.forEach((e,s)=>{t.push([s,e])}),t}fromJSON(t){this.clear();for(const[e,s]of t)this.set(e,s)}},oy=class extends ry{constructor(t,e=1){super(),this.o=t,this.p=Math.min(Math.max(0,e),1)}get limit(){return this.o}set limit(t){this.o=t,this.q()}get ratio(){return this.p}set ratio(t){this.p=Math.min(Math.max(0,t),1),this.q()}get(t,e=2){return super.get(t,e)}peek(t){return super.get(t,0)}set(t,e){return super.set(t,e,2),this}q(){this.size>this.o&&this.r(Math.round(this.o*this.p))}},Qn=class extends oy{constructor(t,e=1){super(t,e)}r(t){this.h(t)}set(t,e){return super.set(t,e),this.q(),this}},ay=class{constructor(){this.c=new Map}add(t,e){let s=this.c.get(t);s||(s=new Set,this.c.set(t,s)),s.add(e)}delete(t,e){const s=this.c.get(t);s&&(s.delete(e),s.size===0&&this.c.delete(t))}forEach(t,e){const s=this.c.get(t);s&&s.forEach(e)}get(t){const e=this.c.get(t);return e||new Set}};function Md(t,e){const s=this;let i=!1,n;return function(){if(i)return n;if(i=!0,e)try{n=t.apply(s,arguments)}finally{e()}else n=t.apply(s,arguments);return n}}var on;(function(t){function e(N){return!!N&&typeof N=="object"&&typeof N[Symbol.iterator]=="function"}t.is=e;const s=Object.freeze([]);function i(){return s}t.empty=i;function*n(N){yield N}t.single=n;function r(N){return e(N)?N:n(N)}t.wrap=r;function o(N){return N??s}t.from=o;function*a(N){for(let E=N.length-1;E>=0;E--)yield N[E]}t.reverse=a;function c(N){return!N||N[Symbol.iterator]().next().done===!0}t.isEmpty=c;function l(N){return N[Symbol.iterator]().next().value}t.first=l;function h(N,E){let C=0;for(const _ of N)if(E(_,C++))return!0;return!1}t.some=h;function u(N,E){let C=0;for(const _ of N)if(!E(_,C++))return!1;return!0}t.every=u;function f(N,E){for(const C of N)if(E(C))return C}t.find=f;function*p(N,E){for(const C of N)E(C)&&(yield C)}t.filter=p;function*g(N,E){let C=0;for(const _ of N)yield E(_,C++)}t.map=g;function*m(N,E){let C=0;for(const _ of N)yield*E(_,C++)}t.flatMap=m;function*v(...N){for(const E of N)Xw(E)?yield*E:yield E}t.concat=v;function b(N,E,C){let _=C;for(const q of N)_=E(_,q);return _}t.reduce=b;function S(N){let E=0;for(const C of N)E++;return E}t.length=S;function*$(N,E,C=N.length){for(E<-N.length&&(E=0),E<0&&(E+=N.length),C<0?C+=N.length:C>N.length&&(C=N.length);E<C;E++)yield N[E]}t.slice=$;function F(N,E=Number.POSITIVE_INFINITY){const C=[];if(E===0)return[C,N];const _=N[Symbol.iterator]();for(let q=0;q<E;q++){const T=_.next();if(T.done)return[C,t.empty()];C.push(T.value)}return[C,{[Symbol.iterator](){return _}}]}t.consume=F;async function B(N){const E=[];for await(const C of N)E.push(C);return E}t.asyncToArray=B;async function ve(N){let E=[];for await(const C of N)E=E.concat(C);return E}t.asyncToArrayFlat=ve})(on||(on={}));var cy=!1,an=null,ES=class Zv{constructor(){this.b=new Map}static{this.a=0}c(e){let s=this.b.get(e);return s||(s={parent:null,source:null,isSingleton:!1,value:e,idx:Zv.a++},this.b.set(e,s)),s}trackDisposable(e){const s=this.c(e);s.source||(s.source=new Error().stack)}setParent(e,s){const i=this.c(e);i.parent=s}markAsDisposed(e){this.b.delete(e)}markAsSingleton(e){this.c(e).isSingleton=!0}f(e,s){const i=s.get(e);if(i)return i;const n=e.parent?this.f(this.c(e.parent),s):e;return s.set(e,n),n}getTrackedDisposables(){const e=new Map;return[...this.b.entries()].filter(([,i])=>i.source!==null&&!this.f(i,e).isSingleton).flatMap(([i])=>i)}computeLeakingDisposables(e=10,s){let i;if(s)i=s;else{const c=new Map,l=[...this.b.values()].filter(u=>u.source!==null&&!this.f(u,c).isSingleton);if(l.length===0)return;const h=new Set(l.map(u=>u.value));if(i=l.filter(u=>!(u.parent&&h.has(u.parent))),i.length===0)throw new Error("There are cyclic diposable chains!")}if(!i)return;function n(c){function l(u,f){for(;u.length>0&&f.some(p=>typeof p=="string"?p===u[0]:u[0].match(p));)u.shift()}const h=c.source.split(`
`).map(u=>u.trim().replace("at ","")).filter(u=>u!=="");return l(h,["Error",/^trackDisposable \(.*\)$/,/^DisposableTracker.trackDisposable \(.*\)$/]),h.reverse()}const r=new ay;for(const c of i){const l=n(c);for(let h=0;h<=l.length;h++)r.add(l.slice(0,h).join(`
`),c)}i.sort(Gw(c=>c.idx,Jw));let o="",a=0;for(const c of i.slice(0,e)){a++;const l=n(c),h=[];for(let u=0;u<l.length;u++){let f=l[u];f=`(shared with ${r.get(l.slice(0,u+1).join(`
`)).size}/${i.length} leaks) at ${f}`;const g=r.get(l.slice(0,u).join(`
`)),m=sy([...g].map(v=>n(v)[u]),v=>v);delete m[l[u]];for(const[v,b]of Object.entries(m))b&&h.unshift(`    - stacktraces of ${b.length} other leaks continue with ${v}`);h.unshift(f)}o+=`


==================== Leaking disposable ${a}/${i.length}: ${c.value.constructor.name} ====================
${h.join(`
`)}
============================================================

`}return i.length>e&&(o+=`


... and ${i.length-e} more leaking disposables

`),{leaks:i,details:o}}};function ly(t){an=t}if(cy){const t="__is_disposable_tracked__";ly(new class{trackDisposable(e){const s=new Error("Potentially leaked disposable").stack;setTimeout(()=>{e[t]||console.log(s)},3e3)}setParent(e,s){if(e&&e!==j.None)try{e[t]=!0}catch{}}markAsDisposed(e){if(e&&e!==j.None)try{e[t]=!0}catch{}}markAsSingleton(e){}})}function Xn(t){return an?.trackDisposable(t),t}function Zn(t){an?.markAsDisposed(t)}function Ci(t,e){an?.setParent(t,e)}function hy(t,e){if(an)for(const s of t)an.setParent(s,e)}function Fc(t){return typeof t=="object"&&t!==null&&typeof t.dispose=="function"&&t.dispose.length===0}function Zt(t){if(on.is(t)){const e=[];for(const s of t)if(s)try{s.dispose()}catch(i){e.push(i)}if(e.length===1)throw e[0];if(e.length>1)throw new AggregateError(e,"Encountered errors while disposing of store");return Array.isArray(t)?[]:t}else if(t)return t.dispose(),t}function qc(...t){const e=pe(()=>Zt(t));return hy(t,e),e}var uy=class{constructor(t){this.a=!1,this.b=t,Xn(this)}dispose(){if(!this.a){if(!this.b)throw new Error("Unbound disposable context: Need to use an arrow function to preserve the value of this");this.a=!0,Zn(this),this.b()}}};function pe(t){return new uy(t)}var Pe=class Yv{static{this.DISABLE_DISPOSED_WARNING=!1}constructor(){this.f=new Set,this.g=!1,Xn(this)}dispose(){this.g||(Zn(this),this.g=!0,this.clear())}get isDisposed(){return this.g}clear(){if(this.f.size!==0)try{Zt(this.f)}finally{this.f.clear()}}add(e){if(!e||e===j.None)return e;if(e===this)throw new Error("Cannot register a disposable on itself!");return Ci(e,this),this.g?Yv.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this.f.add(e),e}delete(e){if(e){if(e===this)throw new Error("Cannot dispose a disposable on itself!");this.f.delete(e),e.dispose()}}deleteAndLeak(e){e&&this.f.delete(e)&&Ci(e,null)}assertNotDisposed(){this.g&&it(new Ac("Object disposed"))}},j=class{static{this.None=Object.freeze({dispose(){}})}constructor(){this.B=new Pe,Xn(this),Ci(this.B,this)}dispose(){Zn(this),this.B.dispose()}D(t){if(t===this)throw new Error("Cannot register a disposable on itself!");return this.B.add(t)}},us=class{constructor(){this.b=!1,Xn(this)}get value(){return this.b?void 0:this.a}set value(t){this.b||t===this.a||(this.a?.dispose(),t&&Ci(t,this),this.a=t)}clear(){this.value=void 0}dispose(){this.b=!0,Zn(this),this.a?.dispose(),this.a=void 0}clearAndLeak(){const t=this.a;return this.a=void 0,t&&Ci(t,null),t}},go=class{constructor(t=new Map){this.b=!1,this.a=t,Xn(this)}dispose(){Zn(this),this.b=!0,this.clearAndDisposeAll()}clearAndDisposeAll(){if(this.a.size)try{Zt(this.a.values())}finally{this.a.clear()}}has(t){return this.a.has(t)}get size(){return this.a.size}get(t){return this.a.get(t)}set(t,e,s=!1){this.b&&console.warn(new Error("Trying to add a disposable to a DisposableMap that has already been disposed of. The added object will be leaked!").stack),s||this.a.get(t)?.dispose(),this.a.set(t,e),Ci(e,this)}deleteAndDispose(t){this.a.get(t)?.dispose(),this.a.delete(t)}deleteAndLeak(t){const e=this.a.get(t);return e&&Ci(e,null),this.a.delete(t),e}keys(){return this.a.keys()}values(){return this.a.values()}[Symbol.iterator](){return this.a[Symbol.iterator]()}};function fy(t,e){return t.then(s=>(e.isDisposed?s.dispose():e.add(s),s))}var cn="en",Yn=!1,er=!1,tr=!1,Ud=!1,Fd=!1,_c=!1,dy=!1,qd=!1,py=!1,gy=!1,mo=void 0,vo=cn,_d=cn,zd=void 0,Us=void 0,Fs=globalThis,Mt=void 0;typeof Fs.vscode<"u"&&typeof Fs.vscode.process<"u"?Mt=Fs.vscode.process:typeof process<"u"&&typeof process?.versions?.node=="string"&&(Mt=process);var Vd=typeof Mt?.versions?.electron=="string",my=Vd&&Mt?.type==="renderer";if(typeof Mt=="object"){Yn=Mt.platform==="win32",er=Mt.platform==="darwin",tr=Mt.platform==="linux",Ud=tr&&!!Mt.env.SNAP&&!!Mt.env.SNAP_REVISION,dy=Vd,py=!!Mt.env.CI||!!Mt.env.BUILD_ARTIFACTSTAGINGDIRECTORY||!!Mt.env.GITHUB_WORKSPACE,mo=cn,vo=cn;const t=Mt.env.VSCODE_NLS_CONFIG;if(t)try{const e=JSON.parse(t);mo=e.userLocale,_d=e.osLocale,vo=e.resolvedLanguage||cn,zd=e.languagePack?.translationsConfigFile}catch{}Fd=!0}else typeof navigator=="object"&&!my?(Us=navigator.userAgent,Yn=Us.indexOf("Windows")>=0,er=Us.indexOf("Macintosh")>=0,qd=(Us.indexOf("Macintosh")>=0||Us.indexOf("iPad")>=0||Us.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,tr=Us.indexOf("Linux")>=0,gy=Us?.indexOf("Mobi")>=0,_c=!0,vo=Rd()||cn,mo=navigator.language.toLowerCase(),_d=mo):console.error("Unable to resolve platform.");var Bd;(function(t){t[t.Web=0]="Web",t[t.Mac=1]="Mac",t[t.Linux=2]="Linux",t[t.Windows=3]="Windows"})(Bd||(Bd={}));function Wd(t){switch(t){case 0:return"Web";case 1:return"Mac";case 2:return"Linux";case 3:return"Windows"}}var wo=0;er?wo=1:Yn?wo=3:tr&&(wo=2);var Le=Yn,bs=er,ut=tr,vy=Ud,wy=Fd,at=_c,yy=_c&&typeof Fs.importScripts=="function",by=yy?Fs.origin:void 0,sr=wo,Ss=Us,Es=vo,Hd;(function(t){function e(){return Es}t.value=e;function s(){return Es.length===2?Es==="en":Es.length>=3?Es[0]==="e"&&Es[1]==="n"&&Es[2]==="-":!1}t.isDefaultVariant=s;function i(){return Es==="en"}t.isDefault=i})(Hd||(Hd={}));var Gd=zd,Sy=typeof Fs.postMessage=="function"&&!Fs.importScripts,Ey=(()=>{if(Sy){const t=[];Fs.addEventListener("message",s=>{if(s.data&&s.data.vscodeScheduleAsyncWork)for(let i=0,n=t.length;i<n;i++){const r=t[i];if(r.id===s.data.vscodeScheduleAsyncWork){t.splice(i,1),r.callback();return}}});let e=0;return s=>{const i=++e;t.push({id:i,callback:s}),Fs.postMessage({vscodeScheduleAsyncWork:i},"*")}}return t=>setTimeout(t)})(),Jd;(function(t){t[t.Windows=1]="Windows",t[t.Macintosh=2]="Macintosh",t[t.Linux=3]="Linux"})(Jd||(Jd={}));var ln=er||qd?2:Yn?1:3,zc=!!(Ss&&Ss.indexOf("Chrome")>=0),Kd=!!(Ss&&Ss.indexOf("Firefox")>=0),Qd=!!(!zc&&Ss&&Ss.indexOf("Safari")>=0),Xd=!!(Ss&&Ss.indexOf("Edg/")>=0),$y=!!(Ss&&Ss.indexOf("Android")>=0),_e=class yc{static{this.Undefined=new yc(void 0)}constructor(e){this.element=e,this.next=yc.Undefined,this.prev=yc.Undefined}},Zd=class{constructor(){this.a=_e.Undefined,this.b=_e.Undefined,this.c=0}get size(){return this.c}isEmpty(){return this.a===_e.Undefined}clear(){let t=this.a;for(;t!==_e.Undefined;){const e=t.next;t.prev=_e.Undefined,t.next=_e.Undefined,t=e}this.a=_e.Undefined,this.b=_e.Undefined,this.c=0}unshift(t){return this.d(t,!1)}push(t){return this.d(t,!0)}d(t,e){const s=new _e(t);if(this.a===_e.Undefined)this.a=s,this.b=s;else if(e){const n=this.b;this.b=s,s.prev=n,n.next=s}else{const n=this.a;this.a=s,s.next=n,n.prev=s}this.c+=1;let i=!1;return()=>{i||(i=!0,this.e(s))}}shift(){if(this.a!==_e.Undefined){const t=this.a.element;return this.e(this.a),t}}pop(){if(this.b!==_e.Undefined){const t=this.b.element;return this.e(this.b),t}}peek(){if(this.b!==_e.Undefined)return this.b.element}e(t){if(t.prev!==_e.Undefined&&t.next!==_e.Undefined){const e=t.prev;e.next=t.next,t.next.prev=e}else t.prev===_e.Undefined&&t.next===_e.Undefined?(this.a=_e.Undefined,this.b=_e.Undefined):t.next===_e.Undefined?(this.b=this.b.prev,this.b.next=_e.Undefined):t.prev===_e.Undefined&&(this.a=this.a.next,this.a.prev=_e.Undefined);this.c-=1}*[Symbol.iterator](){let t=this.a;for(;t!==_e.Undefined;)yield t.element,t=t.next}},xy=globalThis.performance.now.bind(globalThis.performance),hn=class ew{static create(e){return new ew(e)}constructor(e){this.c=e===!1?Date.now:xy,this.a=this.c(),this.b=-1}stop(){this.b=this.c()}reset(){this.a=this.c(),this.b=-1}elapsed(){return this.b!==-1?this.b-this.a:this.c()-this.a}},Yd=!1,ky=!1,O;(function(t){t.None=()=>j.None;function e(A){if(ky){const{onDidAddListener:P}=A,M=Vc.create();let U=0;A.onDidAddListener=()=>{++U===2&&(console.warn("snapshotted emitter LIKELY used public and SHOULD HAVE BEEN created with DisposableStore. snapshotted here"),M.print()),P?.()}}}function s(A,P){return p(A,()=>{},0,void 0,!0,void 0,P)}t.defer=s;function i(A){return(P,M=null,U)=>{let z=!1,ee;return ee=A(ye=>{if(!z)return ee?ee.dispose():z=!0,P.call(M,ye)},null,U),z&&ee.dispose(),ee}}t.once=i;function n(A,P){return t.once(t.filter(A,P))}t.onceIf=n;function r(A,P,M){return u((U,z=null,ee)=>A(ye=>U.call(z,P(ye)),null,ee),M)}t.map=r;function o(A,P,M){return u((U,z=null,ee)=>A(ye=>{P(ye),U.call(z,ye)},null,ee),M)}t.forEach=o;function a(A,P,M){return u((U,z=null,ee)=>A(ye=>P(ye)&&U.call(z,ye),null,ee),M)}t.filter=a;function c(A){return A}t.signal=c;function l(...A){return(P,M=null,U)=>{const z=qc(...A.map(ee=>ee(ye=>P.call(M,ye))));return f(z,U)}}t.any=l;function h(A,P,M,U){let z=M;return r(A,ee=>(z=P(z,ee),z),U)}t.reduce=h;function u(A,P){let M;const U={onWillAddFirstListener(){M=A(z.fire,z)},onDidRemoveLastListener(){M?.dispose()}};P||e(U);const z=new R(U);return P?.add(z),z.event}function f(A,P){return P instanceof Array?P.push(A):P&&P.add(A),A}function p(A,P,M=100,U=!1,z=!1,ee,ye){let st,He,ts,Si=0,Zs;const sn={leakWarningThreshold:ee,onWillAddFirstListener(){st=A(Ei=>{Si++,He=P(He,Ei),U&&!ts&&(Ys.fire(He),He=void 0),Zs=()=>{const ro=He;He=void 0,ts=void 0,(!U||Si>1)&&Ys.fire(ro),Si=0},typeof M=="number"?(ts&&clearTimeout(ts),ts=setTimeout(Zs,M)):ts===void 0&&(ts=null,queueMicrotask(Zs))})},onWillRemoveListener(){z&&Si>0&&Zs?.()},onDidRemoveLastListener(){Zs=void 0,st.dispose()}};ye||e(sn);const Ys=new R(sn);return ye?.add(Ys),Ys.event}t.debounce=p;function g(A,P=0,M){return t.debounce(A,(U,z)=>U?(U.push(z),U):[z],P,void 0,!0,void 0,M)}t.accumulate=g;function m(A,P=(U,z)=>U===z,M){let U=!0,z;return a(A,ee=>{const ye=U||!P(ee,z);return U=!1,z=ee,ye},M)}t.latch=m;function v(A,P,M){return[t.filter(A,P,M),t.filter(A,U=>!P(U),M)]}t.split=v;function b(A,P=!1,M=[],U){let z=M.slice(),ee=A(He=>{z?z.push(He):st.fire(He)});U&&U.add(ee);const ye=()=>{z?.forEach(He=>st.fire(He)),z=null},st=new R({onWillAddFirstListener(){ee||(ee=A(He=>st.fire(He)),U&&U.add(ee))},onDidAddFirstListener(){z&&(P?setTimeout(ye):ye())},onDidRemoveLastListener(){ee&&ee.dispose(),ee=null}});return U&&U.add(st),st.event}t.buffer=b;function S(A,P){return(U,z,ee)=>{const ye=P(new F);return A(function(st){const He=ye.evaluate(st);He!==$&&U.call(z,He)},void 0,ee)}}t.chain=S;const $=Symbol("HaltChainable");class F{constructor(){this.f=[]}map(P){return this.f.push(P),this}forEach(P){return this.f.push(M=>(P(M),M)),this}filter(P){return this.f.push(M=>P(M)?M:$),this}reduce(P,M){let U=M;return this.f.push(z=>(U=P(U,z),U)),this}latch(P=(M,U)=>M===U){let M=!0,U;return this.f.push(z=>{const ee=M||!P(z,U);return M=!1,U=z,ee?z:$}),this}evaluate(P){for(const M of this.f)if(P=M(P),P===$)break;return P}}function B(A,P,M=U=>U){const U=(...st)=>ye.fire(M(...st)),z=()=>A.on(P,U),ee=()=>A.removeListener(P,U),ye=new R({onWillAddFirstListener:z,onDidRemoveLastListener:ee});return ye.event}t.fromNodeEventEmitter=B;function ve(A,P,M=U=>U){const U=(...st)=>ye.fire(M(...st)),z=()=>A.addEventListener(P,U),ee=()=>A.removeEventListener(P,U),ye=new R({onWillAddFirstListener:z,onDidRemoveLastListener:ee});return ye.event}t.fromDOMEventEmitter=ve;function N(A,P){let M,U;const z=new Promise(ee=>{U=i(A)(ee),Wc(U,P),M=()=>{s1(U,P)}});return z.cancel=M,P&&z.finally(()=>s1(U,P)),z}t.toPromise=N;function E(A,P){return A(M=>P.fire(M))}t.forward=E;function C(A,P,M){return P(M),A(U=>P(U))}t.runAndSubscribe=C;class _{constructor(P,M){this._observable=P,this.f=0,this.g=!1;const U={onWillAddFirstListener:()=>{P.addObserver(this),this._observable.reportChanges()},onDidRemoveLastListener:()=>{P.removeObserver(this)}};M||e(U),this.emitter=new R(U),M&&M.add(this.emitter)}beginUpdate(P){this.f++}handlePossibleChange(P){}handleChange(P,M){this.g=!0}endUpdate(P){this.f--,this.f===0&&(this._observable.reportChanges(),this.g&&(this.g=!1,this.emitter.fire(this._observable.get())))}}function q(A,P){return new _(A,P).emitter.event}t.fromObservable=q;function T(A){return(P,M,U)=>{let z=0,ee=!1;const ye={beginUpdate(){z++},endUpdate(){z--,z===0&&(A.reportChanges(),ee&&(ee=!1,P.call(M)))},handlePossibleChange(){},handleChange(){ee=!0}};A.addObserver(ye),A.reportChanges();const st={dispose(){A.removeObserver(ye)}};return Wc(st,U),st}}t.fromObservableLight=T})(O||(O={}));var Cy=class od{static{this.all=new Set}static{this.f=0}constructor(e){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${e}_${od.f++}`,od.all.add(this)}start(e){this.g=new hn,this.listenerCount=e}stop(){if(this.g){const e=this.g.elapsed();this.durations.push(e),this.elapsedOverall+=e,this.invocationCount+=1,this.g=void 0}}},e1=-1,Ry=class tw{static{this.f=1}constructor(e,s,i=(tw.f++).toString(16).padStart(3,"0")){this.j=e,this.threshold=s,this.name=i,this.h=0}dispose(){this.g?.clear()}check(e,s){const i=this.threshold;if(i<=0||s<i)return;this.g||(this.g=new Map);const n=this.g.get(e.value)||0;if(this.g.set(e.value,n+1),this.h-=1,this.h<=0){this.h=i*.5;const[r,o]=this.getMostFrequentStack(),a=`[${this.name}] potential listener LEAK detected, having ${s} listeners already. MOST frequent listener (${o}):`;console.warn(a),console.warn(r);const c=new Dy(a,r);this.j(c)}return()=>{const r=this.g.get(e.value)||0;this.g.set(e.value,r-1)}}getMostFrequentStack(){if(!this.g)return;let e,s=0;for(const[i,n]of this.g)(!e||s<n)&&(e=[i,n],s=n);return e}},Vc=class sw{static create(){const e=new Error;return new sw(e.stack??"")}constructor(e){this.value=e}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},Dy=class extends Error{constructor(t,e){super(t),this.name="ListenerLeakError",this.stack=e}},Py=class extends Error{constructor(t,e){super(t),this.name="ListenerRefusalError",this.stack=e}},Iy=0,yo=class{constructor(t){this.value=t,this.id=Iy++}},Ay=2,Ly=(t,e)=>{if(t instanceof yo)e(t);else for(let s=0;s<t.length;s++){const i=t[s];i&&e(i)}},R=class{constructor(t){this.A=0,this.g=t,this.j=e1>0||this.g?.leakWarningThreshold?new Ry(t?.onListenerError??it,this.g?.leakWarningThreshold??e1):void 0,this.m=this.g?._profName?new Cy(this.g._profName):void 0,this.z=this.g?.deliveryQueue}dispose(){if(!this.q){if(this.q=!0,this.z?.current===this&&this.z.reset(),this.w){if(Yd){const t=this.w;queueMicrotask(()=>{Ly(t,e=>e.stack?.print())})}this.w=void 0,this.A=0}this.g?.onDidRemoveLastListener?.(),this.j?.dispose()}}get event(){return this.u??=(t,e,s)=>{if(this.j&&this.A>this.j.threshold**2){const a=`[${this.j.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this.A} vs ${this.j.threshold})`;console.warn(a);const c=this.j.getMostFrequentStack()??["UNKNOWN stack",-1],l=new Py(`${a}. HINT: Stack shows most frequent listener (${c[1]}-times)`,c[0]);return(this.g?.onListenerError||it)(l),j.None}if(this.q)return j.None;e&&(t=t.bind(e));const i=new yo(t);let n,r;this.j&&this.A>=Math.ceil(this.j.threshold*.2)&&(i.stack=Vc.create(),n=this.j.check(i.stack,this.A+1)),Yd&&(i.stack=r??Vc.create()),this.w?this.w instanceof yo?(this.z??=new Oy,this.w=[this.w,i]):this.w.push(i):(this.g?.onWillAddFirstListener?.(this),this.w=i,this.g?.onDidAddFirstListener?.(this)),this.g?.onDidAddListener?.(this),this.A++;const o=pe(()=>{n?.(),this.B(i)});return Wc(o,s),o},this.u}B(t){if(this.g?.onWillRemoveListener?.(this),!this.w)return;if(this.A===1){this.w=void 0,this.g?.onDidRemoveLastListener?.(this),this.A=0;return}const e=this.w,s=e.indexOf(t);if(s===-1)throw console.log("disposed?",this.q),console.log("size?",this.A),console.log("arr?",JSON.stringify(this.w)),new Error("Attempted to dispose unknown listener");this.A--,e[s]=void 0;const i=this.z.current===this;if(this.A*Ay<=e.length){let n=0;for(let r=0;r<e.length;r++)e[r]?e[n++]=e[r]:i&&n<this.z.end&&(this.z.end--,n<this.z.i&&this.z.i--);e.length=n}}C(t,e){if(!t)return;const s=this.g?.onListenerError||it;if(!s){t.value(e);return}try{t.value(e)}catch(i){s(i)}}D(t){const e=t.current.w;for(;t.i<t.end;)this.C(e[t.i++],t.value);t.reset()}fire(t){if(this.z?.current&&(this.D(this.z),this.m?.stop()),this.m?.start(this.A),this.w)if(this.w instanceof yo)this.C(this.w,t);else{const e=this.z;e.enqueue(this,t,this.w.length),this.D(e)}this.m?.stop()}hasListeners(){return this.A>0}},Oy=class{constructor(){this.i=-1,this.end=0}enqueue(t,e,s){this.i=0,this.end=s,this.current=t,this.value=e}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},Bc=class extends R{get isPaused(){return this.f!==0}constructor(t){super(t),this.f=0,this.h=new Zd,this.s=t?.merge}pause(){this.f++}resume(){if(this.f!==0&&--this.f===0)if(this.s){if(this.h.size>0){const t=Array.from(this.h);this.h.clear(),super.fire(this.s(t))}}else for(;!this.f&&this.h.size!==0;)super.fire(this.h.shift())}fire(t){this.A&&(this.f!==0?this.h.push(t):super.fire(t))}},Ny=class{constructor(){this.g=!1,this.h=[],this.f=new R({onWillAddFirstListener:()=>this.j(),onDidRemoveLastListener:()=>this.k()})}get event(){return this.f.event}add(t){const e={event:t,listener:null};return this.h.push(e),this.g&&this.m(e),pe(Md(()=>{this.g&&this.o(e);const i=this.h.indexOf(e);this.h.splice(i,1)}))}j(){this.g=!0,this.h.forEach(t=>this.m(t))}k(){this.g=!1,this.h.forEach(t=>this.o(t))}m(t){t.listener=t.event(e=>this.f.fire(e))}o(t){t.listener?.dispose(),t.listener=null}dispose(){this.f.dispose();for(const t of this.h)t.listener?.dispose();this.h=[]}},t1=class{constructor(){this.f=!1,this.g=O.None,this.h=j.None,this.j=new R({onDidAddFirstListener:()=>{this.f=!0,this.h=this.g(this.j.fire,this.j)},onDidRemoveLastListener:()=>{this.f=!1,this.h.dispose()}}),this.event=this.j.event}set input(t){this.g=t,this.f&&(this.h.dispose(),this.h=t(this.j.fire,this.j))}dispose(){this.h.dispose(),this.j.dispose()}};function Wc(t,e){e instanceof Pe?e.add(t):Array.isArray(e)&&e.push(t)}function s1(t,e){if(e instanceof Pe)e.delete(t);else if(Array.isArray(e)){const s=e.indexOf(t);s!==-1&&e.splice(s,1)}t.dispose()}var i1=Object.freeze(function(t,e){const s=setTimeout(t.bind(e),0);return{dispose(){clearTimeout(s)}}}),Z;(function(t){function e(s){return s===t.None||s===t.Cancelled||s instanceof bo?!0:!s||typeof s!="object"?!1:typeof s.isCancellationRequested=="boolean"&&typeof s.onCancellationRequested=="function"}t.isCancellationToken=e,t.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:O.None}),t.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:i1})})(Z||(Z={}));var bo=class{constructor(){this.a=!1,this.b=null}cancel(){this.a||(this.a=!0,this.b&&(this.b.fire(void 0),this.dispose()))}get isCancellationRequested(){return this.a}get onCancellationRequested(){return this.a?i1:(this.b||(this.b=new R),this.b.event)}dispose(){this.b&&(this.b.dispose(),this.b=null)}},fs=class{constructor(t){this.f=void 0,this.g=void 0,this.g=t&&t.onCancellationRequested(this.cancel,this)}get token(){return this.f||(this.f=new bo),this.f}cancel(){this.f?this.f instanceof bo&&this.f.cancel():this.f=Z.Cancelled}dispose(t=!1){t&&this.cancel(),this.g?.dispose(),this.f?this.f instanceof bo&&this.f.dispose():this.f=Z.None}};function Ty(t){return t}var jy=class{constructor(t,e){this.a=void 0,this.b=void 0,typeof t=="function"?(this.c=t,this.d=Ty):(this.c=e,this.d=t.getCacheKey)}get(t){const e=this.d(t);return this.b!==e&&(this.b=e,this.a=this.c(t)),this.a}},ei;(function(t){t[t.Uninitialized=0]="Uninitialized",t[t.Running=1]="Running",t[t.Completed=2]="Completed"})(ei||(ei={}));var Ri=class{constructor(t){this.d=t,this.a=ei.Uninitialized}get hasValue(){return this.a===ei.Completed}get value(){if(this.a===ei.Uninitialized){this.a=ei.Running;try{this.b=this.d()}catch(t){this.c=t}finally{this.a=ei.Completed}}else if(this.a===ei.Running)throw new Error("Cannot read the value of a lazy that is being initialized");if(this.c)throw this.c;return this.b}get rawValue(){return this.b}};function My(t){return!t||typeof t!="string"?!0:t.trim().length===0}var Uy=/{([^}]+)}/g;function is(t,e){return Object.keys(e).length===0?t:t.replace(Uy,(s,i)=>e[i]??s)}function Di(t){return t.replace(/[\\\{\}\*\+\?\|\^\$\.\[\]\(\)]/g,"\\$&")}function Fy(t,e=" "){const s=n1(t,e);return So(s,e)}function n1(t,e){if(!t||!e)return t;const s=e.length;let i=0;if(s===1){const n=e.charCodeAt(0);for(;i<t.length&&t.charCodeAt(i)===n;)i++}else for(;t.startsWith(e,i);)i+=s;return t.substring(i)}function So(t,e){if(!t||!e)return t;const s=e.length,i=t.length;if(s===1){let r=i;const o=e.charCodeAt(0);for(;r>0&&t.charCodeAt(r-1)===o;)r--;return t.substring(0,r)}let n=i;for(;n>0&&t.endsWith(e,n);)n-=s;return t.substring(0,n)}function Eo(t,e){return t<e?-1:t>e?1:0}function Hc(t,e,s=0,i=t.length,n=0,r=e.length){for(;s<i&&n<r;s++,n++){const c=t.charCodeAt(s),l=e.charCodeAt(n);if(c<l)return-1;if(c>l)return 1}const o=i-s,a=r-n;return o<a?-1:o>a?1:0}function $o(t,e){return un(t,e,0,t.length,0,e.length)}function un(t,e,s=0,i=t.length,n=0,r=e.length){for(;s<i&&n<r;s++,n++){let c=t.charCodeAt(s),l=e.charCodeAt(n);if(c===l)continue;if(c>=128||l>=128)return Hc(t.toLowerCase(),e.toLowerCase(),s,i,n,r);r1(c)&&(c-=32),r1(l)&&(l-=32);const h=c-l;if(h!==0)return h}const o=i-s,a=r-n;return o<a?-1:o>a?1:0}function r1(t){return t>=97&&t<=122}function o1(t){return t>=65&&t<=90}function ti(t,e){return t.length===e.length&&un(t,e)===0}function Gc(t,e){const s=e.length;return s<=t.length&&un(t,e,0,s)===0}function qy(t,e){const s=t.length,i=s-e.length;return i>=0&&un(t,e,i,s)===0}function _y(t){return 55296<=t&&t<=56319}function a1(t){return 56320<=t&&t<=57343}function zy(t,e){return(t-55296<<10)+(e-56320)+65536}var Vy=/(?:\x1b\[|\x9b)[=?>!]?[\d;:]*["$#'* ]?[a-zA-Z@^`{}|~]/,By=/(?:\x1b\]|\x9d).*?(?:\x1b\\|\x07|\x9c)/,Wy=/\x1b(?:[ #%\(\)\*\+\-\.\/]?[a-zA-Z0-9\|}~@])/,$S=new RegExp("(?:"+[Vy.source,By.source,Wy.source].join("|")+")","g"),xS="\uFEFF";function Jc(t){return t.charAt(0).toUpperCase()+t.slice(1)}var c1;(function(t){t[t.Other=0]="Other",t[t.Prepend=1]="Prepend",t[t.CR=2]="CR",t[t.LF=3]="LF",t[t.Control=4]="Control",t[t.Extend=5]="Extend",t[t.Regional_Indicator=6]="Regional_Indicator",t[t.SpacingMark=7]="SpacingMark",t[t.L=8]="L",t[t.V=9]="V",t[t.T=10]="T",t[t.LV=11]="LV",t[t.LVT=12]="LVT",t[t.ZWJ=13]="ZWJ",t[t.Extended_Pictographic=14]="Extended_Pictographic"})(c1||(c1={}));var kS=class Yr{static{this.c=null}static getInstance(){return Yr.c||(Yr.c=new Yr),Yr.c}constructor(){this.d=Hy()}getGraphemeBreakType(e){if(e<32)return e===10?3:e===13?2:4;if(e<127)return 0;const s=this.d,i=s.length/3;let n=1;for(;n<=i;)if(e<s[3*n])n=2*n;else if(e>s[3*n+1])n=2*n+1;else return s[3*n+2];return 0}};function Hy(){return JSON.parse("[0,0,0,51229,51255,12,44061,44087,12,127462,127487,6,7083,7085,5,47645,47671,12,54813,54839,12,128678,128678,14,3270,3270,5,9919,9923,14,45853,45879,12,49437,49463,12,53021,53047,12,71216,71218,7,128398,128399,14,129360,129374,14,2519,2519,5,4448,4519,9,9742,9742,14,12336,12336,14,44957,44983,12,46749,46775,12,48541,48567,12,50333,50359,12,52125,52151,12,53917,53943,12,69888,69890,5,73018,73018,5,127990,127990,14,128558,128559,14,128759,128760,14,129653,129655,14,2027,2035,5,2891,2892,7,3761,3761,5,6683,6683,5,8293,8293,4,9825,9826,14,9999,9999,14,43452,43453,5,44509,44535,12,45405,45431,12,46301,46327,12,47197,47223,12,48093,48119,12,48989,49015,12,49885,49911,12,50781,50807,12,51677,51703,12,52573,52599,12,53469,53495,12,54365,54391,12,65279,65279,4,70471,70472,7,72145,72147,7,119173,119179,5,127799,127818,14,128240,128244,14,128512,128512,14,128652,128652,14,128721,128722,14,129292,129292,14,129445,129450,14,129734,129743,14,1476,1477,5,2366,2368,7,2750,2752,7,3076,3076,5,3415,3415,5,4141,4144,5,6109,6109,5,6964,6964,5,7394,7400,5,9197,9198,14,9770,9770,14,9877,9877,14,9968,9969,14,10084,10084,14,43052,43052,5,43713,43713,5,44285,44311,12,44733,44759,12,45181,45207,12,45629,45655,12,46077,46103,12,46525,46551,12,46973,46999,12,47421,47447,12,47869,47895,12,48317,48343,12,48765,48791,12,49213,49239,12,49661,49687,12,50109,50135,12,50557,50583,12,51005,51031,12,51453,51479,12,51901,51927,12,52349,52375,12,52797,52823,12,53245,53271,12,53693,53719,12,54141,54167,12,54589,54615,12,55037,55063,12,69506,69509,5,70191,70193,5,70841,70841,7,71463,71467,5,72330,72342,5,94031,94031,5,123628,123631,5,127763,127765,14,127941,127941,14,128043,128062,14,128302,128317,14,128465,128467,14,128539,128539,14,128640,128640,14,128662,128662,14,128703,128703,14,128745,128745,14,129004,129007,14,129329,129330,14,129402,129402,14,129483,129483,14,129686,129704,14,130048,131069,14,173,173,4,1757,1757,1,2200,2207,5,2434,2435,7,2631,2632,5,2817,2817,5,3008,3008,5,3201,3201,5,3387,3388,5,3542,3542,5,3902,3903,7,4190,4192,5,6002,6003,5,6439,6440,5,6765,6770,7,7019,7027,5,7154,7155,7,8205,8205,13,8505,8505,14,9654,9654,14,9757,9757,14,9792,9792,14,9852,9853,14,9890,9894,14,9937,9937,14,9981,9981,14,10035,10036,14,11035,11036,14,42654,42655,5,43346,43347,7,43587,43587,5,44006,44007,7,44173,44199,12,44397,44423,12,44621,44647,12,44845,44871,12,45069,45095,12,45293,45319,12,45517,45543,12,45741,45767,12,45965,45991,12,46189,46215,12,46413,46439,12,46637,46663,12,46861,46887,12,47085,47111,12,47309,47335,12,47533,47559,12,47757,47783,12,47981,48007,12,48205,48231,12,48429,48455,12,48653,48679,12,48877,48903,12,49101,49127,12,49325,49351,12,49549,49575,12,49773,49799,12,49997,50023,12,50221,50247,12,50445,50471,12,50669,50695,12,50893,50919,12,51117,51143,12,51341,51367,12,51565,51591,12,51789,51815,12,52013,52039,12,52237,52263,12,52461,52487,12,52685,52711,12,52909,52935,12,53133,53159,12,53357,53383,12,53581,53607,12,53805,53831,12,54029,54055,12,54253,54279,12,54477,54503,12,54701,54727,12,54925,54951,12,55149,55175,12,68101,68102,5,69762,69762,7,70067,70069,7,70371,70378,5,70720,70721,7,71087,71087,5,71341,71341,5,71995,71996,5,72249,72249,7,72850,72871,5,73109,73109,5,118576,118598,5,121505,121519,5,127245,127247,14,127568,127569,14,127777,127777,14,127872,127891,14,127956,127967,14,128015,128016,14,128110,128172,14,128259,128259,14,128367,128368,14,128424,128424,14,128488,128488,14,128530,128532,14,128550,128551,14,128566,128566,14,128647,128647,14,128656,128656,14,128667,128673,14,128691,128693,14,128715,128715,14,128728,128732,14,128752,128752,14,128765,128767,14,129096,129103,14,129311,129311,14,129344,129349,14,129394,129394,14,129413,129425,14,129466,129471,14,129511,129535,14,129664,129666,14,129719,129722,14,129760,129767,14,917536,917631,5,13,13,2,1160,1161,5,1564,1564,4,1807,1807,1,2085,2087,5,2307,2307,7,2382,2383,7,2497,2500,5,2563,2563,7,2677,2677,5,2763,2764,7,2879,2879,5,2914,2915,5,3021,3021,5,3142,3144,5,3263,3263,5,3285,3286,5,3398,3400,7,3530,3530,5,3633,3633,5,3864,3865,5,3974,3975,5,4155,4156,7,4229,4230,5,5909,5909,7,6078,6085,7,6277,6278,5,6451,6456,7,6744,6750,5,6846,6846,5,6972,6972,5,7074,7077,5,7146,7148,7,7222,7223,5,7416,7417,5,8234,8238,4,8417,8417,5,9000,9000,14,9203,9203,14,9730,9731,14,9748,9749,14,9762,9763,14,9776,9783,14,9800,9811,14,9831,9831,14,9872,9873,14,9882,9882,14,9900,9903,14,9929,9933,14,9941,9960,14,9974,9974,14,9989,9989,14,10006,10006,14,10062,10062,14,10160,10160,14,11647,11647,5,12953,12953,14,43019,43019,5,43232,43249,5,43443,43443,5,43567,43568,7,43696,43696,5,43765,43765,7,44013,44013,5,44117,44143,12,44229,44255,12,44341,44367,12,44453,44479,12,44565,44591,12,44677,44703,12,44789,44815,12,44901,44927,12,45013,45039,12,45125,45151,12,45237,45263,12,45349,45375,12,45461,45487,12,45573,45599,12,45685,45711,12,45797,45823,12,45909,45935,12,46021,46047,12,46133,46159,12,46245,46271,12,46357,46383,12,46469,46495,12,46581,46607,12,46693,46719,12,46805,46831,12,46917,46943,12,47029,47055,12,47141,47167,12,47253,47279,12,47365,47391,12,47477,47503,12,47589,47615,12,47701,47727,12,47813,47839,12,47925,47951,12,48037,48063,12,48149,48175,12,48261,48287,12,48373,48399,12,48485,48511,12,48597,48623,12,48709,48735,12,48821,48847,12,48933,48959,12,49045,49071,12,49157,49183,12,49269,49295,12,49381,49407,12,49493,49519,12,49605,49631,12,49717,49743,12,49829,49855,12,49941,49967,12,50053,50079,12,50165,50191,12,50277,50303,12,50389,50415,12,50501,50527,12,50613,50639,12,50725,50751,12,50837,50863,12,50949,50975,12,51061,51087,12,51173,51199,12,51285,51311,12,51397,51423,12,51509,51535,12,51621,51647,12,51733,51759,12,51845,51871,12,51957,51983,12,52069,52095,12,52181,52207,12,52293,52319,12,52405,52431,12,52517,52543,12,52629,52655,12,52741,52767,12,52853,52879,12,52965,52991,12,53077,53103,12,53189,53215,12,53301,53327,12,53413,53439,12,53525,53551,12,53637,53663,12,53749,53775,12,53861,53887,12,53973,53999,12,54085,54111,12,54197,54223,12,54309,54335,12,54421,54447,12,54533,54559,12,54645,54671,12,54757,54783,12,54869,54895,12,54981,55007,12,55093,55119,12,55243,55291,10,66045,66045,5,68325,68326,5,69688,69702,5,69817,69818,5,69957,69958,7,70089,70092,5,70198,70199,5,70462,70462,5,70502,70508,5,70750,70750,5,70846,70846,7,71100,71101,5,71230,71230,7,71351,71351,5,71737,71738,5,72000,72000,7,72160,72160,5,72273,72278,5,72752,72758,5,72882,72883,5,73031,73031,5,73461,73462,7,94192,94193,7,119149,119149,7,121403,121452,5,122915,122916,5,126980,126980,14,127358,127359,14,127535,127535,14,127759,127759,14,127771,127771,14,127792,127793,14,127825,127867,14,127897,127899,14,127945,127945,14,127985,127986,14,128000,128007,14,128021,128021,14,128066,128100,14,128184,128235,14,128249,128252,14,128266,128276,14,128335,128335,14,128379,128390,14,128407,128419,14,128444,128444,14,128481,128481,14,128499,128499,14,128526,128526,14,128536,128536,14,128543,128543,14,128556,128556,14,128564,128564,14,128577,128580,14,128643,128645,14,128649,128649,14,128654,128654,14,128660,128660,14,128664,128664,14,128675,128675,14,128686,128689,14,128695,128696,14,128705,128709,14,128717,128719,14,128725,128725,14,128736,128741,14,128747,128748,14,128755,128755,14,128762,128762,14,128981,128991,14,129009,129023,14,129160,129167,14,129296,129304,14,129320,129327,14,129340,129342,14,129356,129356,14,129388,129392,14,129399,129400,14,129404,129407,14,129432,129442,14,129454,129455,14,129473,129474,14,129485,129487,14,129648,129651,14,129659,129660,14,129671,129679,14,129709,129711,14,129728,129730,14,129751,129753,14,129776,129782,14,917505,917505,4,917760,917999,5,10,10,3,127,159,4,768,879,5,1471,1471,5,1536,1541,1,1648,1648,5,1767,1768,5,1840,1866,5,2070,2073,5,2137,2139,5,2274,2274,1,2363,2363,7,2377,2380,7,2402,2403,5,2494,2494,5,2507,2508,7,2558,2558,5,2622,2624,7,2641,2641,5,2691,2691,7,2759,2760,5,2786,2787,5,2876,2876,5,2881,2884,5,2901,2902,5,3006,3006,5,3014,3016,7,3072,3072,5,3134,3136,5,3157,3158,5,3260,3260,5,3266,3266,5,3274,3275,7,3328,3329,5,3391,3392,7,3405,3405,5,3457,3457,5,3536,3537,7,3551,3551,5,3636,3642,5,3764,3772,5,3895,3895,5,3967,3967,7,3993,4028,5,4146,4151,5,4182,4183,7,4226,4226,5,4253,4253,5,4957,4959,5,5940,5940,7,6070,6070,7,6087,6088,7,6158,6158,4,6432,6434,5,6448,6449,7,6679,6680,5,6742,6742,5,6754,6754,5,6783,6783,5,6912,6915,5,6966,6970,5,6978,6978,5,7042,7042,7,7080,7081,5,7143,7143,7,7150,7150,7,7212,7219,5,7380,7392,5,7412,7412,5,8203,8203,4,8232,8232,4,8265,8265,14,8400,8412,5,8421,8432,5,8617,8618,14,9167,9167,14,9200,9200,14,9410,9410,14,9723,9726,14,9733,9733,14,9745,9745,14,9752,9752,14,9760,9760,14,9766,9766,14,9774,9774,14,9786,9786,14,9794,9794,14,9823,9823,14,9828,9828,14,9833,9850,14,9855,9855,14,9875,9875,14,9880,9880,14,9885,9887,14,9896,9897,14,9906,9916,14,9926,9927,14,9935,9935,14,9939,9939,14,9962,9962,14,9972,9972,14,9978,9978,14,9986,9986,14,9997,9997,14,10002,10002,14,10017,10017,14,10055,10055,14,10071,10071,14,10133,10135,14,10548,10549,14,11093,11093,14,12330,12333,5,12441,12442,5,42608,42610,5,43010,43010,5,43045,43046,5,43188,43203,7,43302,43309,5,43392,43394,5,43446,43449,5,43493,43493,5,43571,43572,7,43597,43597,7,43703,43704,5,43756,43757,5,44003,44004,7,44009,44010,7,44033,44059,12,44089,44115,12,44145,44171,12,44201,44227,12,44257,44283,12,44313,44339,12,44369,44395,12,44425,44451,12,44481,44507,12,44537,44563,12,44593,44619,12,44649,44675,12,44705,44731,12,44761,44787,12,44817,44843,12,44873,44899,12,44929,44955,12,44985,45011,12,45041,45067,12,45097,45123,12,45153,45179,12,45209,45235,12,45265,45291,12,45321,45347,12,45377,45403,12,45433,45459,12,45489,45515,12,45545,45571,12,45601,45627,12,45657,45683,12,45713,45739,12,45769,45795,12,45825,45851,12,45881,45907,12,45937,45963,12,45993,46019,12,46049,46075,12,46105,46131,12,46161,46187,12,46217,46243,12,46273,46299,12,46329,46355,12,46385,46411,12,46441,46467,12,46497,46523,12,46553,46579,12,46609,46635,12,46665,46691,12,46721,46747,12,46777,46803,12,46833,46859,12,46889,46915,12,46945,46971,12,47001,47027,12,47057,47083,12,47113,47139,12,47169,47195,12,47225,47251,12,47281,47307,12,47337,47363,12,47393,47419,12,47449,47475,12,47505,47531,12,47561,47587,12,47617,47643,12,47673,47699,12,47729,47755,12,47785,47811,12,47841,47867,12,47897,47923,12,47953,47979,12,48009,48035,12,48065,48091,12,48121,48147,12,48177,48203,12,48233,48259,12,48289,48315,12,48345,48371,12,48401,48427,12,48457,48483,12,48513,48539,12,48569,48595,12,48625,48651,12,48681,48707,12,48737,48763,12,48793,48819,12,48849,48875,12,48905,48931,12,48961,48987,12,49017,49043,12,49073,49099,12,49129,49155,12,49185,49211,12,49241,49267,12,49297,49323,12,49353,49379,12,49409,49435,12,49465,49491,12,49521,49547,12,49577,49603,12,49633,49659,12,49689,49715,12,49745,49771,12,49801,49827,12,49857,49883,12,49913,49939,12,49969,49995,12,50025,50051,12,50081,50107,12,50137,50163,12,50193,50219,12,50249,50275,12,50305,50331,12,50361,50387,12,50417,50443,12,50473,50499,12,50529,50555,12,50585,50611,12,50641,50667,12,50697,50723,12,50753,50779,12,50809,50835,12,50865,50891,12,50921,50947,12,50977,51003,12,51033,51059,12,51089,51115,12,51145,51171,12,51201,51227,12,51257,51283,12,51313,51339,12,51369,51395,12,51425,51451,12,51481,51507,12,51537,51563,12,51593,51619,12,51649,51675,12,51705,51731,12,51761,51787,12,51817,51843,12,51873,51899,12,51929,51955,12,51985,52011,12,52041,52067,12,52097,52123,12,52153,52179,12,52209,52235,12,52265,52291,12,52321,52347,12,52377,52403,12,52433,52459,12,52489,52515,12,52545,52571,12,52601,52627,12,52657,52683,12,52713,52739,12,52769,52795,12,52825,52851,12,52881,52907,12,52937,52963,12,52993,53019,12,53049,53075,12,53105,53131,12,53161,53187,12,53217,53243,12,53273,53299,12,53329,53355,12,53385,53411,12,53441,53467,12,53497,53523,12,53553,53579,12,53609,53635,12,53665,53691,12,53721,53747,12,53777,53803,12,53833,53859,12,53889,53915,12,53945,53971,12,54001,54027,12,54057,54083,12,54113,54139,12,54169,54195,12,54225,54251,12,54281,54307,12,54337,54363,12,54393,54419,12,54449,54475,12,54505,54531,12,54561,54587,12,54617,54643,12,54673,54699,12,54729,54755,12,54785,54811,12,54841,54867,12,54897,54923,12,54953,54979,12,55009,55035,12,55065,55091,12,55121,55147,12,55177,55203,12,65024,65039,5,65520,65528,4,66422,66426,5,68152,68154,5,69291,69292,5,69633,69633,5,69747,69748,5,69811,69814,5,69826,69826,5,69932,69932,7,70016,70017,5,70079,70080,7,70095,70095,5,70196,70196,5,70367,70367,5,70402,70403,7,70464,70464,5,70487,70487,5,70709,70711,7,70725,70725,7,70833,70834,7,70843,70844,7,70849,70849,7,71090,71093,5,71103,71104,5,71227,71228,7,71339,71339,5,71344,71349,5,71458,71461,5,71727,71735,5,71985,71989,7,71998,71998,5,72002,72002,7,72154,72155,5,72193,72202,5,72251,72254,5,72281,72283,5,72344,72345,5,72766,72766,7,72874,72880,5,72885,72886,5,73023,73029,5,73104,73105,5,73111,73111,5,92912,92916,5,94095,94098,5,113824,113827,4,119142,119142,7,119155,119162,4,119362,119364,5,121476,121476,5,122888,122904,5,123184,123190,5,125252,125258,5,127183,127183,14,127340,127343,14,127377,127386,14,127491,127503,14,127548,127551,14,127744,127756,14,127761,127761,14,127769,127769,14,127773,127774,14,127780,127788,14,127796,127797,14,127820,127823,14,127869,127869,14,127894,127895,14,127902,127903,14,127943,127943,14,127947,127950,14,127972,127972,14,127988,127988,14,127992,127994,14,128009,128011,14,128019,128019,14,128023,128041,14,128064,128064,14,128102,128107,14,128174,128181,14,128238,128238,14,128246,128247,14,128254,128254,14,128264,128264,14,128278,128299,14,128329,128330,14,128348,128359,14,128371,128377,14,128392,128393,14,128401,128404,14,128421,128421,14,128433,128434,14,128450,128452,14,128476,128478,14,128483,128483,14,128495,128495,14,128506,128506,14,128519,128520,14,128528,128528,14,128534,128534,14,128538,128538,14,128540,128542,14,128544,128549,14,128552,128555,14,128557,128557,14,128560,128563,14,128565,128565,14,128567,128576,14,128581,128591,14,128641,128642,14,128646,128646,14,128648,128648,14,128650,128651,14,128653,128653,14,128655,128655,14,128657,128659,14,128661,128661,14,128663,128663,14,128665,128666,14,128674,128674,14,128676,128677,14,128679,128685,14,128690,128690,14,128694,128694,14,128697,128702,14,128704,128704,14,128710,128714,14,128716,128716,14,128720,128720,14,128723,128724,14,128726,128727,14,128733,128735,14,128742,128744,14,128746,128746,14,128749,128751,14,128753,128754,14,128756,128758,14,128761,128761,14,128763,128764,14,128884,128895,14,128992,129003,14,129008,129008,14,129036,129039,14,129114,129119,14,129198,129279,14,129293,129295,14,129305,129310,14,129312,129319,14,129328,129328,14,129331,129338,14,129343,129343,14,129351,129355,14,129357,129359,14,129375,129387,14,129393,129393,14,129395,129398,14,129401,129401,14,129403,129403,14,129408,129412,14,129426,129431,14,129443,129444,14,129451,129453,14,129456,129465,14,129472,129472,14,129475,129482,14,129484,129484,14,129488,129510,14,129536,129647,14,129652,129652,14,129656,129658,14,129661,129663,14,129667,129670,14,129680,129685,14,129705,129708,14,129712,129718,14,129723,129727,14,129731,129733,14,129744,129750,14,129754,129759,14,129768,129775,14,129783,129791,14,917504,917504,4,917506,917535,4,917632,917759,4,918000,921599,4,0,9,4,11,12,4,14,31,4,169,169,14,174,174,14,1155,1159,5,1425,1469,5,1473,1474,5,1479,1479,5,1552,1562,5,1611,1631,5,1750,1756,5,1759,1764,5,1770,1773,5,1809,1809,5,1958,1968,5,2045,2045,5,2075,2083,5,2089,2093,5,2192,2193,1,2250,2273,5,2275,2306,5,2362,2362,5,2364,2364,5,2369,2376,5,2381,2381,5,2385,2391,5,2433,2433,5,2492,2492,5,2495,2496,7,2503,2504,7,2509,2509,5,2530,2531,5,2561,2562,5,2620,2620,5,2625,2626,5,2635,2637,5,2672,2673,5,2689,2690,5,2748,2748,5,2753,2757,5,2761,2761,7,2765,2765,5,2810,2815,5,2818,2819,7,2878,2878,5,2880,2880,7,2887,2888,7,2893,2893,5,2903,2903,5,2946,2946,5,3007,3007,7,3009,3010,7,3018,3020,7,3031,3031,5,3073,3075,7,3132,3132,5,3137,3140,7,3146,3149,5,3170,3171,5,3202,3203,7,3262,3262,7,3264,3265,7,3267,3268,7,3271,3272,7,3276,3277,5,3298,3299,5,3330,3331,7,3390,3390,5,3393,3396,5,3402,3404,7,3406,3406,1,3426,3427,5,3458,3459,7,3535,3535,5,3538,3540,5,3544,3550,7,3570,3571,7,3635,3635,7,3655,3662,5,3763,3763,7,3784,3789,5,3893,3893,5,3897,3897,5,3953,3966,5,3968,3972,5,3981,3991,5,4038,4038,5,4145,4145,7,4153,4154,5,4157,4158,5,4184,4185,5,4209,4212,5,4228,4228,7,4237,4237,5,4352,4447,8,4520,4607,10,5906,5908,5,5938,5939,5,5970,5971,5,6068,6069,5,6071,6077,5,6086,6086,5,6089,6099,5,6155,6157,5,6159,6159,5,6313,6313,5,6435,6438,7,6441,6443,7,6450,6450,5,6457,6459,5,6681,6682,7,6741,6741,7,6743,6743,7,6752,6752,5,6757,6764,5,6771,6780,5,6832,6845,5,6847,6862,5,6916,6916,7,6965,6965,5,6971,6971,7,6973,6977,7,6979,6980,7,7040,7041,5,7073,7073,7,7078,7079,7,7082,7082,7,7142,7142,5,7144,7145,5,7149,7149,5,7151,7153,5,7204,7211,7,7220,7221,7,7376,7378,5,7393,7393,7,7405,7405,5,7415,7415,7,7616,7679,5,8204,8204,5,8206,8207,4,8233,8233,4,8252,8252,14,8288,8292,4,8294,8303,4,8413,8416,5,8418,8420,5,8482,8482,14,8596,8601,14,8986,8987,14,9096,9096,14,9193,9196,14,9199,9199,14,9201,9202,14,9208,9210,14,9642,9643,14,9664,9664,14,9728,9729,14,9732,9732,14,9735,9741,14,9743,9744,14,9746,9746,14,9750,9751,14,9753,9756,14,9758,9759,14,9761,9761,14,9764,9765,14,9767,9769,14,9771,9773,14,9775,9775,14,9784,9785,14,9787,9791,14,9793,9793,14,9795,9799,14,9812,9822,14,9824,9824,14,9827,9827,14,9829,9830,14,9832,9832,14,9851,9851,14,9854,9854,14,9856,9861,14,9874,9874,14,9876,9876,14,9878,9879,14,9881,9881,14,9883,9884,14,9888,9889,14,9895,9895,14,9898,9899,14,9904,9905,14,9917,9918,14,9924,9925,14,9928,9928,14,9934,9934,14,9936,9936,14,9938,9938,14,9940,9940,14,9961,9961,14,9963,9967,14,9970,9971,14,9973,9973,14,9975,9977,14,9979,9980,14,9982,9985,14,9987,9988,14,9992,9996,14,9998,9998,14,10000,10001,14,10004,10004,14,10013,10013,14,10024,10024,14,10052,10052,14,10060,10060,14,10067,10069,14,10083,10083,14,10085,10087,14,10145,10145,14,10175,10175,14,11013,11015,14,11088,11088,14,11503,11505,5,11744,11775,5,12334,12335,5,12349,12349,14,12951,12951,14,42607,42607,5,42612,42621,5,42736,42737,5,43014,43014,5,43043,43044,7,43047,43047,7,43136,43137,7,43204,43205,5,43263,43263,5,43335,43345,5,43360,43388,8,43395,43395,7,43444,43445,7,43450,43451,7,43454,43456,7,43561,43566,5,43569,43570,5,43573,43574,5,43596,43596,5,43644,43644,5,43698,43700,5,43710,43711,5,43755,43755,7,43758,43759,7,43766,43766,5,44005,44005,5,44008,44008,5,44012,44012,7,44032,44032,11,44060,44060,11,44088,44088,11,44116,44116,11,44144,44144,11,44172,44172,11,44200,44200,11,44228,44228,11,44256,44256,11,44284,44284,11,44312,44312,11,44340,44340,11,44368,44368,11,44396,44396,11,44424,44424,11,44452,44452,11,44480,44480,11,44508,44508,11,44536,44536,11,44564,44564,11,44592,44592,11,44620,44620,11,44648,44648,11,44676,44676,11,44704,44704,11,44732,44732,11,44760,44760,11,44788,44788,11,44816,44816,11,44844,44844,11,44872,44872,11,44900,44900,11,44928,44928,11,44956,44956,11,44984,44984,11,45012,45012,11,45040,45040,11,45068,45068,11,45096,45096,11,45124,45124,11,45152,45152,11,45180,45180,11,45208,45208,11,45236,45236,11,45264,45264,11,45292,45292,11,45320,45320,11,45348,45348,11,45376,45376,11,45404,45404,11,45432,45432,11,45460,45460,11,45488,45488,11,45516,45516,11,45544,45544,11,45572,45572,11,45600,45600,11,45628,45628,11,45656,45656,11,45684,45684,11,45712,45712,11,45740,45740,11,45768,45768,11,45796,45796,11,45824,45824,11,45852,45852,11,45880,45880,11,45908,45908,11,45936,45936,11,45964,45964,11,45992,45992,11,46020,46020,11,46048,46048,11,46076,46076,11,46104,46104,11,46132,46132,11,46160,46160,11,46188,46188,11,46216,46216,11,46244,46244,11,46272,46272,11,46300,46300,11,46328,46328,11,46356,46356,11,46384,46384,11,46412,46412,11,46440,46440,11,46468,46468,11,46496,46496,11,46524,46524,11,46552,46552,11,46580,46580,11,46608,46608,11,46636,46636,11,46664,46664,11,46692,46692,11,46720,46720,11,46748,46748,11,46776,46776,11,46804,46804,11,46832,46832,11,46860,46860,11,46888,46888,11,46916,46916,11,46944,46944,11,46972,46972,11,47000,47000,11,47028,47028,11,47056,47056,11,47084,47084,11,47112,47112,11,47140,47140,11,47168,47168,11,47196,47196,11,47224,47224,11,47252,47252,11,47280,47280,11,47308,47308,11,47336,47336,11,47364,47364,11,47392,47392,11,47420,47420,11,47448,47448,11,47476,47476,11,47504,47504,11,47532,47532,11,47560,47560,11,47588,47588,11,47616,47616,11,47644,47644,11,47672,47672,11,47700,47700,11,47728,47728,11,47756,47756,11,47784,47784,11,47812,47812,11,47840,47840,11,47868,47868,11,47896,47896,11,47924,47924,11,47952,47952,11,47980,47980,11,48008,48008,11,48036,48036,11,48064,48064,11,48092,48092,11,48120,48120,11,48148,48148,11,48176,48176,11,48204,48204,11,48232,48232,11,48260,48260,11,48288,48288,11,48316,48316,11,48344,48344,11,48372,48372,11,48400,48400,11,48428,48428,11,48456,48456,11,48484,48484,11,48512,48512,11,48540,48540,11,48568,48568,11,48596,48596,11,48624,48624,11,48652,48652,11,48680,48680,11,48708,48708,11,48736,48736,11,48764,48764,11,48792,48792,11,48820,48820,11,48848,48848,11,48876,48876,11,48904,48904,11,48932,48932,11,48960,48960,11,48988,48988,11,49016,49016,11,49044,49044,11,49072,49072,11,49100,49100,11,49128,49128,11,49156,49156,11,49184,49184,11,49212,49212,11,49240,49240,11,49268,49268,11,49296,49296,11,49324,49324,11,49352,49352,11,49380,49380,11,49408,49408,11,49436,49436,11,49464,49464,11,49492,49492,11,49520,49520,11,49548,49548,11,49576,49576,11,49604,49604,11,49632,49632,11,49660,49660,11,49688,49688,11,49716,49716,11,49744,49744,11,49772,49772,11,49800,49800,11,49828,49828,11,49856,49856,11,49884,49884,11,49912,49912,11,49940,49940,11,49968,49968,11,49996,49996,11,50024,50024,11,50052,50052,11,50080,50080,11,50108,50108,11,50136,50136,11,50164,50164,11,50192,50192,11,50220,50220,11,50248,50248,11,50276,50276,11,50304,50304,11,50332,50332,11,50360,50360,11,50388,50388,11,50416,50416,11,50444,50444,11,50472,50472,11,50500,50500,11,50528,50528,11,50556,50556,11,50584,50584,11,50612,50612,11,50640,50640,11,50668,50668,11,50696,50696,11,50724,50724,11,50752,50752,11,50780,50780,11,50808,50808,11,50836,50836,11,50864,50864,11,50892,50892,11,50920,50920,11,50948,50948,11,50976,50976,11,51004,51004,11,51032,51032,11,51060,51060,11,51088,51088,11,51116,51116,11,51144,51144,11,51172,51172,11,51200,51200,11,51228,51228,11,51256,51256,11,51284,51284,11,51312,51312,11,51340,51340,11,51368,51368,11,51396,51396,11,51424,51424,11,51452,51452,11,51480,51480,11,51508,51508,11,51536,51536,11,51564,51564,11,51592,51592,11,51620,51620,11,51648,51648,11,51676,51676,11,51704,51704,11,51732,51732,11,51760,51760,11,51788,51788,11,51816,51816,11,51844,51844,11,51872,51872,11,51900,51900,11,51928,51928,11,51956,51956,11,51984,51984,11,52012,52012,11,52040,52040,11,52068,52068,11,52096,52096,11,52124,52124,11,52152,52152,11,52180,52180,11,52208,52208,11,52236,52236,11,52264,52264,11,52292,52292,11,52320,52320,11,52348,52348,11,52376,52376,11,52404,52404,11,52432,52432,11,52460,52460,11,52488,52488,11,52516,52516,11,52544,52544,11,52572,52572,11,52600,52600,11,52628,52628,11,52656,52656,11,52684,52684,11,52712,52712,11,52740,52740,11,52768,52768,11,52796,52796,11,52824,52824,11,52852,52852,11,52880,52880,11,52908,52908,11,52936,52936,11,52964,52964,11,52992,52992,11,53020,53020,11,53048,53048,11,53076,53076,11,53104,53104,11,53132,53132,11,53160,53160,11,53188,53188,11,53216,53216,11,53244,53244,11,53272,53272,11,53300,53300,11,53328,53328,11,53356,53356,11,53384,53384,11,53412,53412,11,53440,53440,11,53468,53468,11,53496,53496,11,53524,53524,11,53552,53552,11,53580,53580,11,53608,53608,11,53636,53636,11,53664,53664,11,53692,53692,11,53720,53720,11,53748,53748,11,53776,53776,11,53804,53804,11,53832,53832,11,53860,53860,11,53888,53888,11,53916,53916,11,53944,53944,11,53972,53972,11,54000,54000,11,54028,54028,11,54056,54056,11,54084,54084,11,54112,54112,11,54140,54140,11,54168,54168,11,54196,54196,11,54224,54224,11,54252,54252,11,54280,54280,11,54308,54308,11,54336,54336,11,54364,54364,11,54392,54392,11,54420,54420,11,54448,54448,11,54476,54476,11,54504,54504,11,54532,54532,11,54560,54560,11,54588,54588,11,54616,54616,11,54644,54644,11,54672,54672,11,54700,54700,11,54728,54728,11,54756,54756,11,54784,54784,11,54812,54812,11,54840,54840,11,54868,54868,11,54896,54896,11,54924,54924,11,54952,54952,11,54980,54980,11,55008,55008,11,55036,55036,11,55064,55064,11,55092,55092,11,55120,55120,11,55148,55148,11,55176,55176,11,55216,55238,9,64286,64286,5,65056,65071,5,65438,65439,5,65529,65531,4,66272,66272,5,68097,68099,5,68108,68111,5,68159,68159,5,68900,68903,5,69446,69456,5,69632,69632,7,69634,69634,7,69744,69744,5,69759,69761,5,69808,69810,7,69815,69816,7,69821,69821,1,69837,69837,1,69927,69931,5,69933,69940,5,70003,70003,5,70018,70018,7,70070,70078,5,70082,70083,1,70094,70094,7,70188,70190,7,70194,70195,7,70197,70197,7,70206,70206,5,70368,70370,7,70400,70401,5,70459,70460,5,70463,70463,7,70465,70468,7,70475,70477,7,70498,70499,7,70512,70516,5,70712,70719,5,70722,70724,5,70726,70726,5,70832,70832,5,70835,70840,5,70842,70842,5,70845,70845,5,70847,70848,5,70850,70851,5,71088,71089,7,71096,71099,7,71102,71102,7,71132,71133,5,71219,71226,5,71229,71229,5,71231,71232,5,71340,71340,7,71342,71343,7,71350,71350,7,71453,71455,5,71462,71462,7,71724,71726,7,71736,71736,7,71984,71984,5,71991,71992,7,71997,71997,7,71999,71999,1,72001,72001,1,72003,72003,5,72148,72151,5,72156,72159,7,72164,72164,7,72243,72248,5,72250,72250,1,72263,72263,5,72279,72280,7,72324,72329,1,72343,72343,7,72751,72751,7,72760,72765,5,72767,72767,5,72873,72873,7,72881,72881,7,72884,72884,7,73009,73014,5,73020,73021,5,73030,73030,1,73098,73102,7,73107,73108,7,73110,73110,7,73459,73460,5,78896,78904,4,92976,92982,5,94033,94087,7,94180,94180,5,113821,113822,5,118528,118573,5,119141,119141,5,119143,119145,5,119150,119154,5,119163,119170,5,119210,119213,5,121344,121398,5,121461,121461,5,121499,121503,5,122880,122886,5,122907,122913,5,122918,122922,5,123566,123566,5,125136,125142,5,126976,126979,14,126981,127182,14,127184,127231,14,127279,127279,14,127344,127345,14,127374,127374,14,127405,127461,14,127489,127490,14,127514,127514,14,127538,127546,14,127561,127567,14,127570,127743,14,127757,127758,14,127760,127760,14,127762,127762,14,127766,127768,14,127770,127770,14,127772,127772,14,127775,127776,14,127778,127779,14,127789,127791,14,127794,127795,14,127798,127798,14,127819,127819,14,127824,127824,14,127868,127868,14,127870,127871,14,127892,127893,14,127896,127896,14,127900,127901,14,127904,127940,14,127942,127942,14,127944,127944,14,127946,127946,14,127951,127955,14,127968,127971,14,127973,127984,14,127987,127987,14,127989,127989,14,127991,127991,14,127995,127999,5,128008,128008,14,128012,128014,14,128017,128018,14,128020,128020,14,128022,128022,14,128042,128042,14,128063,128063,14,128065,128065,14,128101,128101,14,128108,128109,14,128173,128173,14,128182,128183,14,128236,128237,14,128239,128239,14,128245,128245,14,128248,128248,14,128253,128253,14,128255,128258,14,128260,128263,14,128265,128265,14,128277,128277,14,128300,128301,14,128326,128328,14,128331,128334,14,128336,128347,14,128360,128366,14,128369,128370,14,128378,128378,14,128391,128391,14,128394,128397,14,128400,128400,14,128405,128406,14,128420,128420,14,128422,128423,14,128425,128432,14,128435,128443,14,128445,128449,14,128453,128464,14,128468,128475,14,128479,128480,14,128482,128482,14,128484,128487,14,128489,128494,14,128496,128498,14,128500,128505,14,128507,128511,14,128513,128518,14,128521,128525,14,128527,128527,14,128529,128529,14,128533,128533,14,128535,128535,14,128537,128537,14]")}var l1;(function(t){t[t.zwj=8205]="zwj",t[t.emojiVariantSelector=65039]="emojiVariantSelector",t[t.enclosingKeyCap=8419]="enclosingKeyCap",t[t.space=32]="space"})(l1||(l1={}));var CS=class eo{static{this.c=new Ri(()=>JSON.parse('{"_common":[8232,32,8233,32,5760,32,8192,32,8193,32,8194,32,8195,32,8196,32,8197,32,8198,32,8200,32,8201,32,8202,32,8287,32,8199,32,8239,32,2042,95,65101,95,65102,95,65103,95,8208,45,8209,45,8210,45,65112,45,1748,45,8259,45,727,45,8722,45,10134,45,11450,45,1549,44,1643,44,184,44,42233,44,894,59,2307,58,2691,58,1417,58,1795,58,1796,58,5868,58,65072,58,6147,58,6153,58,8282,58,1475,58,760,58,42889,58,8758,58,720,58,42237,58,451,33,11601,33,660,63,577,63,2429,63,5038,63,42731,63,119149,46,8228,46,1793,46,1794,46,42510,46,68176,46,1632,46,1776,46,42232,46,1373,96,65287,96,8219,96,1523,96,8242,96,1370,96,8175,96,65344,96,900,96,8189,96,8125,96,8127,96,8190,96,697,96,884,96,712,96,714,96,715,96,756,96,699,96,701,96,700,96,702,96,42892,96,1497,96,2036,96,2037,96,5194,96,5836,96,94033,96,94034,96,65339,91,10088,40,10098,40,12308,40,64830,40,65341,93,10089,41,10099,41,12309,41,64831,41,10100,123,119060,123,10101,125,65342,94,8270,42,1645,42,8727,42,66335,42,5941,47,8257,47,8725,47,8260,47,9585,47,10187,47,10744,47,119354,47,12755,47,12339,47,11462,47,20031,47,12035,47,65340,92,65128,92,8726,92,10189,92,10741,92,10745,92,119311,92,119355,92,12756,92,20022,92,12034,92,42872,38,708,94,710,94,5869,43,10133,43,66203,43,8249,60,10094,60,706,60,119350,60,5176,60,5810,60,5120,61,11840,61,12448,61,42239,61,8250,62,10095,62,707,62,119351,62,5171,62,94015,62,8275,126,732,126,8128,126,8764,126,65372,124,65293,45,118002,50,120784,50,120794,50,120804,50,120814,50,120824,50,130034,50,42842,50,423,50,1000,50,42564,50,5311,50,42735,50,119302,51,118003,51,120785,51,120795,51,120805,51,120815,51,120825,51,130035,51,42923,51,540,51,439,51,42858,51,11468,51,1248,51,94011,51,71882,51,118004,52,120786,52,120796,52,120806,52,120816,52,120826,52,130036,52,5070,52,71855,52,118005,53,120787,53,120797,53,120807,53,120817,53,120827,53,130037,53,444,53,71867,53,118006,54,120788,54,120798,54,120808,54,120818,54,120828,54,130038,54,11474,54,5102,54,71893,54,119314,55,118007,55,120789,55,120799,55,120809,55,120819,55,120829,55,130039,55,66770,55,71878,55,2819,56,2538,56,2666,56,125131,56,118008,56,120790,56,120800,56,120810,56,120820,56,120830,56,130040,56,547,56,546,56,66330,56,2663,57,2920,57,2541,57,3437,57,118009,57,120791,57,120801,57,120811,57,120821,57,120831,57,130041,57,42862,57,11466,57,71884,57,71852,57,71894,57,9082,97,65345,97,119834,97,119886,97,119938,97,119990,97,120042,97,120094,97,120146,97,120198,97,120250,97,120302,97,120354,97,120406,97,120458,97,593,97,945,97,120514,97,120572,97,120630,97,120688,97,120746,97,65313,65,117974,65,119808,65,119860,65,119912,65,119964,65,120016,65,120068,65,120120,65,120172,65,120224,65,120276,65,120328,65,120380,65,120432,65,913,65,120488,65,120546,65,120604,65,120662,65,120720,65,5034,65,5573,65,42222,65,94016,65,66208,65,119835,98,119887,98,119939,98,119991,98,120043,98,120095,98,120147,98,120199,98,120251,98,120303,98,120355,98,120407,98,120459,98,388,98,5071,98,5234,98,5551,98,65314,66,8492,66,117975,66,119809,66,119861,66,119913,66,120017,66,120069,66,120121,66,120173,66,120225,66,120277,66,120329,66,120381,66,120433,66,42932,66,914,66,120489,66,120547,66,120605,66,120663,66,120721,66,5108,66,5623,66,42192,66,66178,66,66209,66,66305,66,65347,99,8573,99,119836,99,119888,99,119940,99,119992,99,120044,99,120096,99,120148,99,120200,99,120252,99,120304,99,120356,99,120408,99,120460,99,7428,99,1010,99,11429,99,43951,99,66621,99,128844,67,71913,67,71922,67,65315,67,8557,67,8450,67,8493,67,117976,67,119810,67,119862,67,119914,67,119966,67,120018,67,120174,67,120226,67,120278,67,120330,67,120382,67,120434,67,1017,67,11428,67,5087,67,42202,67,66210,67,66306,67,66581,67,66844,67,8574,100,8518,100,119837,100,119889,100,119941,100,119993,100,120045,100,120097,100,120149,100,120201,100,120253,100,120305,100,120357,100,120409,100,120461,100,1281,100,5095,100,5231,100,42194,100,8558,68,8517,68,117977,68,119811,68,119863,68,119915,68,119967,68,120019,68,120071,68,120123,68,120175,68,120227,68,120279,68,120331,68,120383,68,120435,68,5024,68,5598,68,5610,68,42195,68,8494,101,65349,101,8495,101,8519,101,119838,101,119890,101,119942,101,120046,101,120098,101,120150,101,120202,101,120254,101,120306,101,120358,101,120410,101,120462,101,43826,101,1213,101,8959,69,65317,69,8496,69,117978,69,119812,69,119864,69,119916,69,120020,69,120072,69,120124,69,120176,69,120228,69,120280,69,120332,69,120384,69,120436,69,917,69,120492,69,120550,69,120608,69,120666,69,120724,69,11577,69,5036,69,42224,69,71846,69,71854,69,66182,69,119839,102,119891,102,119943,102,119995,102,120047,102,120099,102,120151,102,120203,102,120255,102,120307,102,120359,102,120411,102,120463,102,43829,102,42905,102,383,102,7837,102,1412,102,119315,70,8497,70,117979,70,119813,70,119865,70,119917,70,120021,70,120073,70,120125,70,120177,70,120229,70,120281,70,120333,70,120385,70,120437,70,42904,70,988,70,120778,70,5556,70,42205,70,71874,70,71842,70,66183,70,66213,70,66853,70,65351,103,8458,103,119840,103,119892,103,119944,103,120048,103,120100,103,120152,103,120204,103,120256,103,120308,103,120360,103,120412,103,120464,103,609,103,7555,103,397,103,1409,103,117980,71,119814,71,119866,71,119918,71,119970,71,120022,71,120074,71,120126,71,120178,71,120230,71,120282,71,120334,71,120386,71,120438,71,1292,71,5056,71,5107,71,42198,71,65352,104,8462,104,119841,104,119945,104,119997,104,120049,104,120101,104,120153,104,120205,104,120257,104,120309,104,120361,104,120413,104,120465,104,1211,104,1392,104,5058,104,65320,72,8459,72,8460,72,8461,72,117981,72,119815,72,119867,72,119919,72,120023,72,120179,72,120231,72,120283,72,120335,72,120387,72,120439,72,919,72,120494,72,120552,72,120610,72,120668,72,120726,72,11406,72,5051,72,5500,72,42215,72,66255,72,731,105,9075,105,65353,105,8560,105,8505,105,8520,105,119842,105,119894,105,119946,105,119998,105,120050,105,120102,105,120154,105,120206,105,120258,105,120310,105,120362,105,120414,105,120466,105,120484,105,618,105,617,105,953,105,8126,105,890,105,120522,105,120580,105,120638,105,120696,105,120754,105,1110,105,42567,105,1231,105,43893,105,5029,105,71875,105,65354,106,8521,106,119843,106,119895,106,119947,106,119999,106,120051,106,120103,106,120155,106,120207,106,120259,106,120311,106,120363,106,120415,106,120467,106,1011,106,1112,106,65322,74,117983,74,119817,74,119869,74,119921,74,119973,74,120025,74,120077,74,120129,74,120181,74,120233,74,120285,74,120337,74,120389,74,120441,74,42930,74,895,74,1032,74,5035,74,5261,74,42201,74,119844,107,119896,107,119948,107,120000,107,120052,107,120104,107,120156,107,120208,107,120260,107,120312,107,120364,107,120416,107,120468,107,8490,75,65323,75,117984,75,119818,75,119870,75,119922,75,119974,75,120026,75,120078,75,120130,75,120182,75,120234,75,120286,75,120338,75,120390,75,120442,75,922,75,120497,75,120555,75,120613,75,120671,75,120729,75,11412,75,5094,75,5845,75,42199,75,66840,75,1472,108,8739,73,9213,73,65512,73,1633,108,1777,73,66336,108,125127,108,118001,108,120783,73,120793,73,120803,73,120813,73,120823,73,130033,73,65321,73,8544,73,8464,73,8465,73,117982,108,119816,73,119868,73,119920,73,120024,73,120128,73,120180,73,120232,73,120284,73,120336,73,120388,73,120440,73,65356,108,8572,73,8467,108,119845,108,119897,108,119949,108,120001,108,120053,108,120105,73,120157,73,120209,73,120261,73,120313,73,120365,73,120417,73,120469,73,448,73,120496,73,120554,73,120612,73,120670,73,120728,73,11410,73,1030,73,1216,73,1493,108,1503,108,1575,108,126464,108,126592,108,65166,108,65165,108,1994,108,11599,73,5825,73,42226,73,93992,73,66186,124,66313,124,119338,76,8556,76,8466,76,117985,76,119819,76,119871,76,119923,76,120027,76,120079,76,120131,76,120183,76,120235,76,120287,76,120339,76,120391,76,120443,76,11472,76,5086,76,5290,76,42209,76,93974,76,71843,76,71858,76,66587,76,66854,76,65325,77,8559,77,8499,77,117986,77,119820,77,119872,77,119924,77,120028,77,120080,77,120132,77,120184,77,120236,77,120288,77,120340,77,120392,77,120444,77,924,77,120499,77,120557,77,120615,77,120673,77,120731,77,1018,77,11416,77,5047,77,5616,77,5846,77,42207,77,66224,77,66321,77,119847,110,119899,110,119951,110,120003,110,120055,110,120107,110,120159,110,120211,110,120263,110,120315,110,120367,110,120419,110,120471,110,1400,110,1404,110,65326,78,8469,78,117987,78,119821,78,119873,78,119925,78,119977,78,120029,78,120081,78,120185,78,120237,78,120289,78,120341,78,120393,78,120445,78,925,78,120500,78,120558,78,120616,78,120674,78,120732,78,11418,78,42208,78,66835,78,3074,111,3202,111,3330,111,3458,111,2406,111,2662,111,2790,111,3046,111,3174,111,3302,111,3430,111,3664,111,3792,111,4160,111,1637,111,1781,111,65359,111,8500,111,119848,111,119900,111,119952,111,120056,111,120108,111,120160,111,120212,111,120264,111,120316,111,120368,111,120420,111,120472,111,7439,111,7441,111,43837,111,959,111,120528,111,120586,111,120644,111,120702,111,120760,111,963,111,120532,111,120590,111,120648,111,120706,111,120764,111,11423,111,4351,111,1413,111,1505,111,1607,111,126500,111,126564,111,126596,111,65259,111,65260,111,65258,111,65257,111,1726,111,64428,111,64429,111,64427,111,64426,111,1729,111,64424,111,64425,111,64423,111,64422,111,1749,111,3360,111,4125,111,66794,111,71880,111,71895,111,66604,111,1984,79,2534,79,2918,79,12295,79,70864,79,71904,79,118000,79,120782,79,120792,79,120802,79,120812,79,120822,79,130032,79,65327,79,117988,79,119822,79,119874,79,119926,79,119978,79,120030,79,120082,79,120134,79,120186,79,120238,79,120290,79,120342,79,120394,79,120446,79,927,79,120502,79,120560,79,120618,79,120676,79,120734,79,11422,79,1365,79,11604,79,4816,79,2848,79,66754,79,42227,79,71861,79,66194,79,66219,79,66564,79,66838,79,9076,112,65360,112,119849,112,119901,112,119953,112,120005,112,120057,112,120109,112,120161,112,120213,112,120265,112,120317,112,120369,112,120421,112,120473,112,961,112,120530,112,120544,112,120588,112,120602,112,120646,112,120660,112,120704,112,120718,112,120762,112,120776,112,11427,112,65328,80,8473,80,117989,80,119823,80,119875,80,119927,80,119979,80,120031,80,120083,80,120187,80,120239,80,120291,80,120343,80,120395,80,120447,80,929,80,120504,80,120562,80,120620,80,120678,80,120736,80,11426,80,5090,80,5229,80,42193,80,66197,80,119850,113,119902,113,119954,113,120006,113,120058,113,120110,113,120162,113,120214,113,120266,113,120318,113,120370,113,120422,113,120474,113,1307,113,1379,113,1382,113,8474,81,117990,81,119824,81,119876,81,119928,81,119980,81,120032,81,120084,81,120188,81,120240,81,120292,81,120344,81,120396,81,120448,81,11605,81,119851,114,119903,114,119955,114,120007,114,120059,114,120111,114,120163,114,120215,114,120267,114,120319,114,120371,114,120423,114,120475,114,43847,114,43848,114,7462,114,11397,114,43905,114,119318,82,8475,82,8476,82,8477,82,117991,82,119825,82,119877,82,119929,82,120033,82,120189,82,120241,82,120293,82,120345,82,120397,82,120449,82,422,82,5025,82,5074,82,66740,82,5511,82,42211,82,94005,82,65363,115,119852,115,119904,115,119956,115,120008,115,120060,115,120112,115,120164,115,120216,115,120268,115,120320,115,120372,115,120424,115,120476,115,42801,115,445,115,1109,115,43946,115,71873,115,66632,115,65331,83,117992,83,119826,83,119878,83,119930,83,119982,83,120034,83,120086,83,120138,83,120190,83,120242,83,120294,83,120346,83,120398,83,120450,83,1029,83,1359,83,5077,83,5082,83,42210,83,94010,83,66198,83,66592,83,119853,116,119905,116,119957,116,120009,116,120061,116,120113,116,120165,116,120217,116,120269,116,120321,116,120373,116,120425,116,120477,116,8868,84,10201,84,128872,84,65332,84,117993,84,119827,84,119879,84,119931,84,119983,84,120035,84,120087,84,120139,84,120191,84,120243,84,120295,84,120347,84,120399,84,120451,84,932,84,120507,84,120565,84,120623,84,120681,84,120739,84,11430,84,5026,84,42196,84,93962,84,71868,84,66199,84,66225,84,66325,84,119854,117,119906,117,119958,117,120010,117,120062,117,120114,117,120166,117,120218,117,120270,117,120322,117,120374,117,120426,117,120478,117,42911,117,7452,117,43854,117,43858,117,651,117,965,117,120534,117,120592,117,120650,117,120708,117,120766,117,1405,117,66806,117,71896,117,8746,85,8899,85,117994,85,119828,85,119880,85,119932,85,119984,85,120036,85,120088,85,120140,85,120192,85,120244,85,120296,85,120348,85,120400,85,120452,85,1357,85,4608,85,66766,85,5196,85,42228,85,94018,85,71864,85,8744,118,8897,118,65366,118,8564,118,119855,118,119907,118,119959,118,120011,118,120063,118,120115,118,120167,118,120219,118,120271,118,120323,118,120375,118,120427,118,120479,118,7456,118,957,118,120526,118,120584,118,120642,118,120700,118,120758,118,1141,118,1496,118,71430,118,43945,118,71872,118,119309,86,1639,86,1783,86,8548,86,117995,86,119829,86,119881,86,119933,86,119985,86,120037,86,120089,86,120141,86,120193,86,120245,86,120297,86,120349,86,120401,86,120453,86,1140,86,11576,86,5081,86,5167,86,42719,86,42214,86,93960,86,71840,86,66845,86,623,119,119856,119,119908,119,119960,119,120012,119,120064,119,120116,119,120168,119,120220,119,120272,119,120324,119,120376,119,120428,119,120480,119,7457,119,1121,119,1309,119,1377,119,71434,119,71438,119,71439,119,43907,119,71910,87,71919,87,117996,87,119830,87,119882,87,119934,87,119986,87,120038,87,120090,87,120142,87,120194,87,120246,87,120298,87,120350,87,120402,87,120454,87,1308,87,5043,87,5076,87,42218,87,5742,120,10539,120,10540,120,10799,120,65368,120,8569,120,119857,120,119909,120,119961,120,120013,120,120065,120,120117,120,120169,120,120221,120,120273,120,120325,120,120377,120,120429,120,120481,120,5441,120,5501,120,5741,88,9587,88,66338,88,71916,88,65336,88,8553,88,117997,88,119831,88,119883,88,119935,88,119987,88,120039,88,120091,88,120143,88,120195,88,120247,88,120299,88,120351,88,120403,88,120455,88,42931,88,935,88,120510,88,120568,88,120626,88,120684,88,120742,88,11436,88,11613,88,5815,88,42219,88,66192,88,66228,88,66327,88,66855,88,611,121,7564,121,65369,121,119858,121,119910,121,119962,121,120014,121,120066,121,120118,121,120170,121,120222,121,120274,121,120326,121,120378,121,120430,121,120482,121,655,121,7935,121,43866,121,947,121,8509,121,120516,121,120574,121,120632,121,120690,121,120748,121,1199,121,4327,121,71900,121,65337,89,117998,89,119832,89,119884,89,119936,89,119988,89,120040,89,120092,89,120144,89,120196,89,120248,89,120300,89,120352,89,120404,89,120456,89,933,89,978,89,120508,89,120566,89,120624,89,120682,89,120740,89,11432,89,1198,89,5033,89,5053,89,42220,89,94019,89,71844,89,66226,89,119859,122,119911,122,119963,122,120015,122,120067,122,120119,122,120171,122,120223,122,120275,122,120327,122,120379,122,120431,122,120483,122,7458,122,43923,122,71876,122,71909,90,66293,90,65338,90,8484,90,8488,90,117999,90,119833,90,119885,90,119937,90,119989,90,120041,90,120197,90,120249,90,120301,90,120353,90,120405,90,120457,90,918,90,120493,90,120551,90,120609,90,120667,90,120725,90,5059,90,42204,90,71849,90,65282,34,65283,35,65284,36,65285,37,65286,38,65290,42,65291,43,65294,46,65295,47,65296,48,65298,50,65299,51,65300,52,65301,53,65302,54,65303,55,65304,56,65305,57,65308,60,65309,61,65310,62,65312,64,65316,68,65318,70,65319,71,65324,76,65329,81,65330,82,65333,85,65334,86,65335,87,65343,95,65346,98,65348,100,65350,102,65355,107,65357,109,65358,110,65361,113,65362,114,65364,116,65365,117,65367,119,65370,122,65371,123,65373,125,119846,109],"_default":[160,32,8211,45,65374,126,8218,44,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"cs":[65374,126,8218,44,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"de":[65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"es":[8211,45,65374,126,8218,44,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"fr":[65374,126,8218,44,65306,58,65281,33,8216,96,8245,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"it":[160,32,8211,45,65374,126,8218,44,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"ja":[8211,45,8218,44,65281,33,8216,96,8245,96,180,96,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65292,44,65297,49,65307,59],"ko":[8211,45,65374,126,8218,44,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"pl":[65374,126,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"pt-BR":[65374,126,8218,44,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"qps-ploc":[160,32,8211,45,65374,126,8218,44,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"ru":[65374,126,8218,44,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,305,105,921,73,1009,112,215,120,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"tr":[160,32,8211,45,65374,126,8218,44,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"zh-hans":[160,32,65374,126,8218,44,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65297,49],"zh-hant":[8211,45,65374,126,8218,44,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89]}'))}static{this.d=new jy(e=>{const s=e.split(",");function i(u){const f=new Map;for(let p=0;p<u.length;p+=2)f.set(u[p],u[p+1]);return f}function n(u,f){const p=new Map(u);for(const[g,m]of f)p.set(g,m);return p}function r(u,f){if(!u)return f;const p=new Map;for(const[g,m]of u)f.has(g)&&p.set(g,m);return p}const o=this.c.value;let a=s.filter(u=>!u.startsWith("_")&&Object.hasOwn(o,u));a.length===0&&(a=["_default"]);let c;for(const u of a){const f=i(o[u]);c=r(c,f)}const l=i(o._common),h=n(l,c);return new eo(h)})}static getInstance(e){return eo.d.get(Array.from(e).join(","))}static{this.e=new Ri(()=>Object.keys(eo.c.value).filter(e=>!e.startsWith("_")))}static getLocales(){return eo.e.value}constructor(e){this.f=e}isAmbiguous(e){return this.f.has(e)}containsAmbiguousCharacter(e){for(let s=0;s<e.length;s++){const i=e.codePointAt(s);if(typeof i=="number"&&this.isAmbiguous(i))return!0}return!1}getPrimaryConfusable(e){return this.f.get(e)}getConfusableCodePoints(){return new Set(this.f.keys())}},RS=class to{static c(){return JSON.parse('{"_common":[11,12,13,127,847,1564,4447,4448,6068,6069,6155,6156,6157,6158,7355,7356,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8204,8205,8206,8207,8234,8235,8236,8237,8238,8239,8287,8288,8289,8290,8291,8292,8293,8294,8295,8296,8297,8298,8299,8300,8301,8302,8303,10240,12644,65024,65025,65026,65027,65028,65029,65030,65031,65032,65033,65034,65035,65036,65037,65038,65039,65279,65440,65520,65521,65522,65523,65524,65525,65526,65527,65528,65532,78844,119155,119156,119157,119158,119159,119160,119161,119162,917504,917505,917506,917507,917508,917509,917510,917511,917512,917513,917514,917515,917516,917517,917518,917519,917520,917521,917522,917523,917524,917525,917526,917527,917528,917529,917530,917531,917532,917533,917534,917535,917536,917537,917538,917539,917540,917541,917542,917543,917544,917545,917546,917547,917548,917549,917550,917551,917552,917553,917554,917555,917556,917557,917558,917559,917560,917561,917562,917563,917564,917565,917566,917567,917568,917569,917570,917571,917572,917573,917574,917575,917576,917577,917578,917579,917580,917581,917582,917583,917584,917585,917586,917587,917588,917589,917590,917591,917592,917593,917594,917595,917596,917597,917598,917599,917600,917601,917602,917603,917604,917605,917606,917607,917608,917609,917610,917611,917612,917613,917614,917615,917616,917617,917618,917619,917620,917621,917622,917623,917624,917625,917626,917627,917628,917629,917630,917631,917760,917761,917762,917763,917764,917765,917766,917767,917768,917769,917770,917771,917772,917773,917774,917775,917776,917777,917778,917779,917780,917781,917782,917783,917784,917785,917786,917787,917788,917789,917790,917791,917792,917793,917794,917795,917796,917797,917798,917799,917800,917801,917802,917803,917804,917805,917806,917807,917808,917809,917810,917811,917812,917813,917814,917815,917816,917817,917818,917819,917820,917821,917822,917823,917824,917825,917826,917827,917828,917829,917830,917831,917832,917833,917834,917835,917836,917837,917838,917839,917840,917841,917842,917843,917844,917845,917846,917847,917848,917849,917850,917851,917852,917853,917854,917855,917856,917857,917858,917859,917860,917861,917862,917863,917864,917865,917866,917867,917868,917869,917870,917871,917872,917873,917874,917875,917876,917877,917878,917879,917880,917881,917882,917883,917884,917885,917886,917887,917888,917889,917890,917891,917892,917893,917894,917895,917896,917897,917898,917899,917900,917901,917902,917903,917904,917905,917906,917907,917908,917909,917910,917911,917912,917913,917914,917915,917916,917917,917918,917919,917920,917921,917922,917923,917924,917925,917926,917927,917928,917929,917930,917931,917932,917933,917934,917935,917936,917937,917938,917939,917940,917941,917942,917943,917944,917945,917946,917947,917948,917949,917950,917951,917952,917953,917954,917955,917956,917957,917958,917959,917960,917961,917962,917963,917964,917965,917966,917967,917968,917969,917970,917971,917972,917973,917974,917975,917976,917977,917978,917979,917980,917981,917982,917983,917984,917985,917986,917987,917988,917989,917990,917991,917992,917993,917994,917995,917996,917997,917998,917999],"cs":[173,8203,12288],"de":[173,8203,12288],"es":[8203,12288],"fr":[173,8203,12288],"it":[160,173,12288],"ja":[173],"ko":[173,12288],"pl":[173,8203,12288],"pt-BR":[173,8203,12288],"qps-ploc":[160,173,8203,12288],"ru":[173,12288],"tr":[160,173,8203,12288],"zh-hans":[160,173,8203,12288],"zh-hant":[173,12288]}')}static{this.d=void 0}static e(){return this.d||(this.d=new Set([...Object.values(to.c())].flat())),this.d}static isInvisibleCharacter(e){return to.e().has(e)}static containsInvisibleCharacter(e){for(let s=0;s<e.length;s++){const i=e.codePointAt(s);if(typeof i=="number"&&(to.isInvisibleCharacter(i)||i===32))return!0}return!1}static get codePoints(){return to.e()}},Pi,Kc=globalThis.vscode;if(typeof Kc<"u"&&typeof Kc.process<"u"){const t=Kc.process;Pi={get platform(){return t.platform},get arch(){return t.arch},get env(){return t.env},cwd(){return t.cwd()}}}else typeof process<"u"&&typeof process?.versions?.node=="string"?Pi={get platform(){return process.platform},get arch(){return process.arch},get env(){return process.env},cwd(){return process.env.VSCODE_CWD||process.cwd()}}:Pi={get platform(){return Le?"win32":bs?"darwin":"linux"},get arch(){},get env(){return{}},cwd(){return"/"}};var xo=Pi.cwd,je=Pi.env,h1=Pi.platform,u1=Pi.arch,Gy=65,Jy=97,Ky=90,Qy=122,Ii=46,ft=47,Ut=92,qs=58,Xy=63,f1=class extends Error{constructor(t,e,s){let i;typeof e=="string"&&e.indexOf("not ")===0?(i="must not be",e=e.replace(/^not /,"")):i="must be";const n=t.indexOf(".")!==-1?"property":"argument";let r=`The "${t}" ${n} ${i} of type ${e}`;r+=`. Received type ${typeof s}`,super(r),this.code="ERR_INVALID_ARG_TYPE"}};function Zy(t,e){if(t===null||typeof t!="object")throw new f1(e,"Object",t)}function Ve(t,e){if(typeof t!="string")throw new f1(e,"string",t)}var Ft=h1==="win32";function oe(t){return t===ft||t===Ut}function Qc(t){return t===ft}function _s(t){return t>=Gy&&t<=Ky||t>=Jy&&t<=Qy}function ko(t,e,s,i){let n="",r=0,o=-1,a=0,c=0;for(let l=0;l<=t.length;++l){if(l<t.length)c=t.charCodeAt(l);else{if(i(c))break;c=ft}if(i(c)){if(!(o===l-1||a===1))if(a===2){if(n.length<2||r!==2||n.charCodeAt(n.length-1)!==Ii||n.charCodeAt(n.length-2)!==Ii){if(n.length>2){const h=n.lastIndexOf(s);h===-1?(n="",r=0):(n=n.slice(0,h),r=n.length-1-n.lastIndexOf(s)),o=l,a=0;continue}else if(n.length!==0){n="",r=0,o=l,a=0;continue}}e&&(n+=n.length>0?`${s}..`:"..",r=2)}else n.length>0?n+=`${s}${t.slice(o+1,l)}`:n=t.slice(o+1,l),r=l-o-1;o=l,a=0}else c===Ii&&a!==-1?++a:a=-1}return n}function Yy(t){return t?`${t[0]==="."?"":"."}${t}`:""}function d1(t,e){Zy(e,"pathObject");const s=e.dir||e.root,i=e.base||`${e.name||""}${Yy(e.ext)}`;return s?s===e.root?`${s}${i}`:`${s}${t}${i}`:i}var Ke={resolve(...t){let e="",s="",i=!1;for(let n=t.length-1;n>=-1;n--){let r;if(n>=0){if(r=t[n],Ve(r,`paths[${n}]`),r.length===0)continue}else e.length===0?r=xo():(r=je[`=${e}`]||xo(),(r===void 0||r.slice(0,2).toLowerCase()!==e.toLowerCase()&&r.charCodeAt(2)===Ut)&&(r=`${e}\\`));const o=r.length;let a=0,c="",l=!1;const h=r.charCodeAt(0);if(o===1)oe(h)&&(a=1,l=!0);else if(oe(h))if(l=!0,oe(r.charCodeAt(1))){let u=2,f=u;for(;u<o&&!oe(r.charCodeAt(u));)u++;if(u<o&&u!==f){const p=r.slice(f,u);for(f=u;u<o&&oe(r.charCodeAt(u));)u++;if(u<o&&u!==f){for(f=u;u<o&&!oe(r.charCodeAt(u));)u++;(u===o||u!==f)&&(c=`\\\\${p}\\${r.slice(f,u)}`,a=u)}}}else a=1;else _s(h)&&r.charCodeAt(1)===qs&&(c=r.slice(0,2),a=2,o>2&&oe(r.charCodeAt(2))&&(l=!0,a=3));if(c.length>0)if(e.length>0){if(c.toLowerCase()!==e.toLowerCase())continue}else e=c;if(i){if(e.length>0)break}else if(s=`${r.slice(a)}\\${s}`,i=l,l&&e.length>0)break}return s=ko(s,!i,"\\",oe),i?`${e}\\${s}`:`${e}${s}`||"."},normalize(t){Ve(t,"path");const e=t.length;if(e===0)return".";let s=0,i,n=!1;const r=t.charCodeAt(0);if(e===1)return Qc(r)?"\\":t;if(oe(r))if(n=!0,oe(t.charCodeAt(1))){let a=2,c=a;for(;a<e&&!oe(t.charCodeAt(a));)a++;if(a<e&&a!==c){const l=t.slice(c,a);for(c=a;a<e&&oe(t.charCodeAt(a));)a++;if(a<e&&a!==c){for(c=a;a<e&&!oe(t.charCodeAt(a));)a++;if(a===e)return`\\\\${l}\\${t.slice(c)}\\`;a!==c&&(i=`\\\\${l}\\${t.slice(c,a)}`,s=a)}}}else s=1;else _s(r)&&t.charCodeAt(1)===qs&&(i=t.slice(0,2),s=2,e>2&&oe(t.charCodeAt(2))&&(n=!0,s=3));let o=s<e?ko(t.slice(s),!n,"\\",oe):"";if(o.length===0&&!n&&(o="."),o.length>0&&oe(t.charCodeAt(e-1))&&(o+="\\"),!n&&i===void 0&&t.includes(":")){if(o.length>=2&&_s(o.charCodeAt(0))&&o.charCodeAt(1)===qs)return`.\\${o}`;let a=t.indexOf(":");do if(a===e-1||oe(t.charCodeAt(a+1)))return`.\\${o}`;while((a=t.indexOf(":",a+1))!==-1)}return i===void 0?n?`\\${o}`:o:n?`${i}\\${o}`:`${i}${o}`},isAbsolute(t){Ve(t,"path");const e=t.length;if(e===0)return!1;const s=t.charCodeAt(0);return oe(s)||e>2&&_s(s)&&t.charCodeAt(1)===qs&&oe(t.charCodeAt(2))},join(...t){if(t.length===0)return".";let e,s;for(let r=0;r<t.length;++r){const o=t[r];Ve(o,"path"),o.length>0&&(e===void 0?e=s=o:e+=`\\${o}`)}if(e===void 0)return".";let i=!0,n=0;if(typeof s=="string"&&oe(s.charCodeAt(0))){++n;const r=s.length;r>1&&oe(s.charCodeAt(1))&&(++n,r>2&&(oe(s.charCodeAt(2))?++n:i=!1))}if(i){for(;n<e.length&&oe(e.charCodeAt(n));)n++;n>=2&&(e=`\\${e.slice(n)}`)}return Ke.normalize(e)},relative(t,e){if(Ve(t,"from"),Ve(e,"to"),t===e)return"";const s=Ke.resolve(t),i=Ke.resolve(e);if(s===i||(t=s.toLowerCase(),e=i.toLowerCase(),t===e))return"";if(s.length!==t.length||i.length!==e.length){const g=s.split("\\"),m=i.split("\\");g[g.length-1]===""&&g.pop(),m[m.length-1]===""&&m.pop();const v=g.length,b=m.length,S=v<b?v:b;let $;for($=0;$<S&&g[$].toLowerCase()===m[$].toLowerCase();$++);return $===0?i:$===S?b>S?m.slice($).join("\\"):v>S?"..\\".repeat(v-1-$)+"..":"":"..\\".repeat(v-$)+m.slice($).join("\\")}let n=0;for(;n<t.length&&t.charCodeAt(n)===Ut;)n++;let r=t.length;for(;r-1>n&&t.charCodeAt(r-1)===Ut;)r--;const o=r-n;let a=0;for(;a<e.length&&e.charCodeAt(a)===Ut;)a++;let c=e.length;for(;c-1>a&&e.charCodeAt(c-1)===Ut;)c--;const l=c-a,h=o<l?o:l;let u=-1,f=0;for(;f<h;f++){const g=t.charCodeAt(n+f);if(g!==e.charCodeAt(a+f))break;g===Ut&&(u=f)}if(f!==h){if(u===-1)return i}else{if(l>h){if(e.charCodeAt(a+f)===Ut)return i.slice(a+f+1);if(f===2)return i.slice(a+f)}o>h&&(t.charCodeAt(n+f)===Ut?u=f:f===2&&(u=3)),u===-1&&(u=0)}let p="";for(f=n+u+1;f<=r;++f)(f===r||t.charCodeAt(f)===Ut)&&(p+=p.length===0?"..":"\\..");return a+=u,p.length>0?`${p}${i.slice(a,c)}`:(i.charCodeAt(a)===Ut&&++a,i.slice(a,c))},toNamespacedPath(t){if(typeof t!="string"||t.length===0)return t;const e=Ke.resolve(t);if(e.length<=2)return t;if(e.charCodeAt(0)===Ut){if(e.charCodeAt(1)===Ut){const s=e.charCodeAt(2);if(s!==Xy&&s!==Ii)return`\\\\?\\UNC\\${e.slice(2)}`}}else if(_s(e.charCodeAt(0))&&e.charCodeAt(1)===qs&&e.charCodeAt(2)===Ut)return`\\\\?\\${e}`;return e},dirname(t){Ve(t,"path");const e=t.length;if(e===0)return".";let s=-1,i=0;const n=t.charCodeAt(0);if(e===1)return oe(n)?t:".";if(oe(n)){if(s=i=1,oe(t.charCodeAt(1))){let a=2,c=a;for(;a<e&&!oe(t.charCodeAt(a));)a++;if(a<e&&a!==c){for(c=a;a<e&&oe(t.charCodeAt(a));)a++;if(a<e&&a!==c){for(c=a;a<e&&!oe(t.charCodeAt(a));)a++;if(a===e)return t;a!==c&&(s=i=a+1)}}}}else _s(n)&&t.charCodeAt(1)===qs&&(s=e>2&&oe(t.charCodeAt(2))?3:2,i=s);let r=-1,o=!0;for(let a=e-1;a>=i;--a)if(oe(t.charCodeAt(a))){if(!o){r=a;break}}else o=!1;if(r===-1){if(s===-1)return".";r=s}return t.slice(0,r)},basename(t,e){e!==void 0&&Ve(e,"suffix"),Ve(t,"path");let s=0,i=-1,n=!0,r;if(t.length>=2&&_s(t.charCodeAt(0))&&t.charCodeAt(1)===qs&&(s=2),e!==void 0&&e.length>0&&e.length<=t.length){if(e===t)return"";let o=e.length-1,a=-1;for(r=t.length-1;r>=s;--r){const c=t.charCodeAt(r);if(oe(c)){if(!n){s=r+1;break}}else a===-1&&(n=!1,a=r+1),o>=0&&(c===e.charCodeAt(o)?--o===-1&&(i=r):(o=-1,i=a))}return s===i?i=a:i===-1&&(i=t.length),t.slice(s,i)}for(r=t.length-1;r>=s;--r)if(oe(t.charCodeAt(r))){if(!n){s=r+1;break}}else i===-1&&(n=!1,i=r+1);return i===-1?"":t.slice(s,i)},extname(t){Ve(t,"path");let e=0,s=-1,i=0,n=-1,r=!0,o=0;t.length>=2&&t.charCodeAt(1)===qs&&_s(t.charCodeAt(0))&&(e=i=2);for(let a=t.length-1;a>=e;--a){const c=t.charCodeAt(a);if(oe(c)){if(!r){i=a+1;break}continue}n===-1&&(r=!1,n=a+1),c===Ii?s===-1?s=a:o!==1&&(o=1):s!==-1&&(o=-1)}return s===-1||n===-1||o===0||o===1&&s===n-1&&s===i+1?"":t.slice(s,n)},format:d1.bind(null,"\\"),parse(t){Ve(t,"path");const e={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return e;const s=t.length;let i=0,n=t.charCodeAt(0);if(s===1)return oe(n)?(e.root=e.dir=t,e):(e.base=e.name=t,e);if(oe(n)){if(i=1,oe(t.charCodeAt(1))){let u=2,f=u;for(;u<s&&!oe(t.charCodeAt(u));)u++;if(u<s&&u!==f){for(f=u;u<s&&oe(t.charCodeAt(u));)u++;if(u<s&&u!==f){for(f=u;u<s&&!oe(t.charCodeAt(u));)u++;u===s?i=u:u!==f&&(i=u+1)}}}}else if(_s(n)&&t.charCodeAt(1)===qs){if(s<=2)return e.root=e.dir=t,e;if(i=2,oe(t.charCodeAt(2))){if(s===3)return e.root=e.dir=t,e;i=3}}i>0&&(e.root=t.slice(0,i));let r=-1,o=i,a=-1,c=!0,l=t.length-1,h=0;for(;l>=i;--l){if(n=t.charCodeAt(l),oe(n)){if(!c){o=l+1;break}continue}a===-1&&(c=!1,a=l+1),n===Ii?r===-1?r=l:h!==1&&(h=1):r!==-1&&(h=-1)}return a!==-1&&(r===-1||h===0||h===1&&r===a-1&&r===o+1?e.base=e.name=t.slice(o,a):(e.name=t.slice(o,r),e.base=t.slice(o,a),e.ext=t.slice(r,a))),o>0&&o!==i?e.dir=t.slice(0,o-1):e.dir=e.root,e},sep:"\\",delimiter:";",win32:null,posix:null},e4=(()=>{if(Ft){const t=/\\/g;return()=>{const e=xo().replace(t,"/");return e.slice(e.indexOf("/"))}}return()=>xo()})(),be={resolve(...t){let e="",s=!1;for(let i=t.length-1;i>=0&&!s;i--){const n=t[i];Ve(n,`paths[${i}]`),n.length!==0&&(e=`${n}/${e}`,s=n.charCodeAt(0)===ft)}if(!s){const i=e4();e=`${i}/${e}`,s=i.charCodeAt(0)===ft}return e=ko(e,!s,"/",Qc),s?`/${e}`:e.length>0?e:"."},normalize(t){if(Ve(t,"path"),t.length===0)return".";const e=t.charCodeAt(0)===ft,s=t.charCodeAt(t.length-1)===ft;return t=ko(t,!e,"/",Qc),t.length===0?e?"/":s?"./":".":(s&&(t+="/"),e?`/${t}`:t)},isAbsolute(t){return Ve(t,"path"),t.length>0&&t.charCodeAt(0)===ft},join(...t){if(t.length===0)return".";const e=[];for(let s=0;s<t.length;++s){const i=t[s];Ve(i,"path"),i.length>0&&e.push(i)}return e.length===0?".":be.normalize(e.join("/"))},relative(t,e){if(Ve(t,"from"),Ve(e,"to"),t===e||(t=be.resolve(t),e=be.resolve(e),t===e))return"";const s=1,i=t.length,n=i-s,r=1,o=e.length-r,a=n<o?n:o;let c=-1,l=0;for(;l<a;l++){const u=t.charCodeAt(s+l);if(u!==e.charCodeAt(r+l))break;u===ft&&(c=l)}if(l===a)if(o>a){if(e.charCodeAt(r+l)===ft)return e.slice(r+l+1);if(l===0)return e.slice(r+l)}else n>a&&(t.charCodeAt(s+l)===ft?c=l:l===0&&(c=0));let h="";for(l=s+c+1;l<=i;++l)(l===i||t.charCodeAt(l)===ft)&&(h+=h.length===0?"..":"/..");return`${h}${e.slice(r+c)}`},toNamespacedPath(t){return t},dirname(t){if(Ve(t,"path"),t.length===0)return".";const e=t.charCodeAt(0)===ft;let s=-1,i=!0;for(let n=t.length-1;n>=1;--n)if(t.charCodeAt(n)===ft){if(!i){s=n;break}}else i=!1;return s===-1?e?"/":".":e&&s===1?"//":t.slice(0,s)},basename(t,e){e!==void 0&&Ve(e,"suffix"),Ve(t,"path");let s=0,i=-1,n=!0,r;if(e!==void 0&&e.length>0&&e.length<=t.length){if(e===t)return"";let o=e.length-1,a=-1;for(r=t.length-1;r>=0;--r){const c=t.charCodeAt(r);if(c===ft){if(!n){s=r+1;break}}else a===-1&&(n=!1,a=r+1),o>=0&&(c===e.charCodeAt(o)?--o===-1&&(i=r):(o=-1,i=a))}return s===i?i=a:i===-1&&(i=t.length),t.slice(s,i)}for(r=t.length-1;r>=0;--r)if(t.charCodeAt(r)===ft){if(!n){s=r+1;break}}else i===-1&&(n=!1,i=r+1);return i===-1?"":t.slice(s,i)},extname(t){Ve(t,"path");let e=-1,s=0,i=-1,n=!0,r=0;for(let o=t.length-1;o>=0;--o){const a=t[o];if(a==="/"){if(!n){s=o+1;break}continue}i===-1&&(n=!1,i=o+1),a==="."?e===-1?e=o:r!==1&&(r=1):e!==-1&&(r=-1)}return e===-1||i===-1||r===0||r===1&&e===i-1&&e===s+1?"":t.slice(e,i)},format:d1.bind(null,"/"),parse(t){Ve(t,"path");const e={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return e;const s=t.charCodeAt(0)===ft;let i;s?(e.root="/",i=1):i=0;let n=-1,r=0,o=-1,a=!0,c=t.length-1,l=0;for(;c>=i;--c){const h=t.charCodeAt(c);if(h===ft){if(!a){r=c+1;break}continue}o===-1&&(a=!1,o=c+1),h===Ii?n===-1?n=c:l!==1&&(l=1):n!==-1&&(l=-1)}if(o!==-1){const h=r===0&&s?1:r;n===-1||l===0||l===1&&n===o-1&&n===r+1?e.base=e.name=t.slice(h,o):(e.name=t.slice(h,n),e.base=t.slice(h,o),e.ext=t.slice(n,o))}return r>0?e.dir=t.slice(0,r-1):s&&(e.dir="/"),e},sep:"/",delimiter:":",win32:null,posix:null};be.win32=Ke.win32=Ke,be.posix=Ke.posix=be;var si=Ft?Ke.normalize:be.normalize,p1=Ft?Ke.isAbsolute:be.isAbsolute,J=Ft?Ke.join:be.join,Ai=Ft?Ke.resolve:be.resolve,g1=Ft?Ke.relative:be.relative,Qe=Ft?Ke.dirname:be.dirname,qt=Ft?Ke.basename:be.basename,t4=Ft?Ke.extname:be.extname,DS=Ft?Ke.format:be.format,PS=Ft?Ke.parse:be.parse,IS=Ft?Ke.toNamespacedPath:be.toNamespacedPath,Pt=Ft?Ke.sep:be.sep,AS=Ft?Ke.delimiter:be.delimiter,s4=/^\w[\w\d+.-]*$/,i4=/^\//,n4=/^\/\//;function r4(t,e){if(!t.scheme&&e)throw new Error(`[UriError]: Scheme is missing: {scheme: "", authority: "${t.authority}", path: "${t.path}", query: "${t.query}", fragment: "${t.fragment}"}`);if(t.scheme&&!s4.test(t.scheme))throw new Error("[UriError]: Scheme contains illegal characters.");if(t.path){if(t.authority){if(!i4.test(t.path))throw new Error('[UriError]: If a URI contains an authority component, then the path component must either be empty or begin with a slash ("/") character')}else if(n4.test(t.path))throw new Error('[UriError]: If a URI does not contain an authority component, then the path cannot begin with two slash characters ("//")')}}function o4(t,e){return!t&&!e?"file":t}function a4(t,e){switch(t){case"https":case"http":case"file":e?e[0]!==ds&&(e=ds+e):e=ds;break}return e}var Oe="",ds="/",c4=/^(([^:/?#]+?):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/,k=class bc{static isUri(e){return e instanceof bc?!0:!e||typeof e!="object"?!1:typeof e.authority=="string"&&typeof e.fragment=="string"&&typeof e.path=="string"&&typeof e.query=="string"&&typeof e.scheme=="string"&&typeof e.fsPath=="string"&&typeof e.with=="function"&&typeof e.toString=="function"}constructor(e,s,i,n,r,o=!1){typeof e=="object"?(this.scheme=e.scheme||Oe,this.authority=e.authority||Oe,this.path=e.path||Oe,this.query=e.query||Oe,this.fragment=e.fragment||Oe):(this.scheme=o4(e,o),this.authority=s||Oe,this.path=a4(this.scheme,i||Oe),this.query=n||Oe,this.fragment=r||Oe,r4(this,o))}get fsPath(){return Co(this,!1)}with(e){if(!e)return this;let{scheme:s,authority:i,path:n,query:r,fragment:o}=e;return s===void 0?s=this.scheme:s===null&&(s=Oe),i===void 0?i=this.authority:i===null&&(i=Oe),n===void 0?n=this.path:n===null&&(n=Oe),r===void 0?r=this.query:r===null&&(r=Oe),o===void 0?o=this.fragment:o===null&&(o=Oe),s===this.scheme&&i===this.authority&&n===this.path&&r===this.query&&o===this.fragment?this:new fn(s,i,n,r,o)}static parse(e,s=!1){const i=c4.exec(e);return i?new fn(i[2]||Oe,Ro(i[4]||Oe),Ro(i[5]||Oe),Ro(i[7]||Oe),Ro(i[9]||Oe),s):new fn(Oe,Oe,Oe,Oe,Oe)}static file(e){let s=Oe;if(Le&&(e=e.replace(/\\/g,ds)),e[0]===ds&&e[1]===ds){const i=e.indexOf(ds,2);i===-1?(s=e.substring(2),e=ds):(s=e.substring(2,i),e=e.substring(i)||ds)}return new fn("file",s,e,Oe,Oe)}static from(e,s){return new fn(e.scheme,e.authority,e.path,e.query,e.fragment,s)}static joinPath(e,...s){if(!e.path)throw new Error("[UriError]: cannot call joinPath on URI without path");let i;return Le&&e.scheme==="file"?i=bc.file(Ke.join(Co(e,!0),...s)).path:i=be.join(e.path,...s),e.with({path:i})}toString(e=!1){return Xc(this,e)}toJSON(){return this}static revive(e){if(e){if(e instanceof bc)return e;{const s=new fn(e);return s._formatted=e.external??null,s._fsPath=e._sep===m1?e.fsPath??null:null,s}}else return e}[Symbol.for("debug.description")](){return`URI(${this.toString()})`}},m1=Le?1:void 0,fn=class extends k{constructor(){super(...arguments),this._formatted=null,this._fsPath=null}get fsPath(){return this._fsPath||(this._fsPath=Co(this,!1)),this._fsPath}toString(t=!1){return t?Xc(this,!0):(this._formatted||(this._formatted=Xc(this,!1)),this._formatted)}toJSON(){const t={$mid:1};return this._fsPath&&(t.fsPath=this._fsPath,t._sep=m1),this._formatted&&(t.external=this._formatted),this.path&&(t.path=this.path),this.scheme&&(t.scheme=this.scheme),this.authority&&(t.authority=this.authority),this.query&&(t.query=this.query),this.fragment&&(t.fragment=this.fragment),t}},v1={58:"%3A",47:"%2F",63:"%3F",35:"%23",91:"%5B",93:"%5D",64:"%40",33:"%21",36:"%24",38:"%26",39:"%27",40:"%28",41:"%29",42:"%2A",43:"%2B",44:"%2C",59:"%3B",61:"%3D",32:"%20"};function w1(t,e,s){let i,n=-1;for(let r=0;r<t.length;r++){const o=t.charCodeAt(r);if(o>=97&&o<=122||o>=65&&o<=90||o>=48&&o<=57||o===45||o===46||o===95||o===126||e&&o===47||s&&o===91||s&&o===93||s&&o===58)n!==-1&&(i+=encodeURIComponent(t.substring(n,r)),n=-1),i!==void 0&&(i+=t.charAt(r));else{i===void 0&&(i=t.substr(0,r));const a=v1[o];a!==void 0?(n!==-1&&(i+=encodeURIComponent(t.substring(n,r)),n=-1),i+=a):n===-1&&(n=r)}}return n!==-1&&(i+=encodeURIComponent(t.substring(n))),i!==void 0?i:t}function l4(t){let e;for(let s=0;s<t.length;s++){const i=t.charCodeAt(s);i===35||i===63?(e===void 0&&(e=t.substr(0,s)),e+=v1[i]):e!==void 0&&(e+=t[s])}return e!==void 0?e:t}function Co(t,e){let s;return t.authority&&t.path.length>1&&t.scheme==="file"?s=`//${t.authority}${t.path}`:t.path.charCodeAt(0)===47&&(t.path.charCodeAt(1)>=65&&t.path.charCodeAt(1)<=90||t.path.charCodeAt(1)>=97&&t.path.charCodeAt(1)<=122)&&t.path.charCodeAt(2)===58?e?s=t.path.substr(1):s=t.path[1].toLowerCase()+t.path.substr(2):s=t.path,Le&&(s=s.replace(/\//g,"\\")),s}function Xc(t,e){const s=e?l4:w1;let i="",{scheme:n,authority:r,path:o,query:a,fragment:c}=t;if(n&&(i+=n,i+=":"),(r||n==="file")&&(i+=ds,i+=ds),r){let l=r.indexOf("@");if(l!==-1){const h=r.substr(0,l);r=r.substr(l+1),l=h.lastIndexOf(":"),l===-1?i+=s(h,!1,!1):(i+=s(h.substr(0,l),!1,!1),i+=":",i+=s(h.substr(l+1),!1,!0)),i+="@"}r=r.toLowerCase(),l=r.lastIndexOf(":"),l===-1?i+=s(r,!1,!0):(i+=s(r.substr(0,l),!1,!0),i+=r.substr(l))}if(o){if(o.length>=3&&o.charCodeAt(0)===47&&o.charCodeAt(2)===58){const l=o.charCodeAt(1);l>=65&&l<=90&&(o=`/${String.fromCharCode(l+32)}:${o.substr(3)}`)}else if(o.length>=2&&o.charCodeAt(1)===58){const l=o.charCodeAt(0);l>=65&&l<=90&&(o=`${String.fromCharCode(l+32)}:${o.substr(2)}`)}i+=s(o,!0,!1)}return a&&(i+="?",i+=s(a,!1,!1)),c&&(i+="#",i+=e?c:w1(c,!1,!1)),i}function y1(t){try{return decodeURIComponent(t)}catch{return t.length>3?t.substr(0,3)+y1(t.substr(3)):t}}var b1=/(%[0-9A-Za-z][0-9A-Za-z])+/g;function Ro(t){return t.match(b1)?t.replace(b1,e=>y1(e)):t}var ne;(function(t){t.inMemory="inmemory",t.vscode="vscode",t.internal="private",t.walkThrough="walkThrough",t.walkThroughSnippet="walkThroughSnippet",t.http="http",t.https="https",t.file="file",t.mailto="mailto",t.untitled="untitled",t.data="data",t.command="command",t.vscodeRemote="vscode-remote",t.vscodeRemoteResource="vscode-remote-resource",t.vscodeManagedRemoteResource="vscode-managed-remote-resource",t.vscodeUserData="vscode-userdata",t.vscodeCustomEditor="vscode-custom-editor",t.vscodeNotebookCell="vscode-notebook-cell",t.vscodeNotebookCellMetadata="vscode-notebook-cell-metadata",t.vscodeNotebookCellMetadataDiff="vscode-notebook-cell-metadata-diff",t.vscodeNotebookCellOutput="vscode-notebook-cell-output",t.vscodeNotebookCellOutputDiff="vscode-notebook-cell-output-diff",t.vscodeNotebookMetadata="vscode-notebook-metadata",t.vscodeInteractiveInput="vscode-interactive-input",t.vscodeSettings="vscode-settings",t.vscodeWorkspaceTrust="vscode-workspace-trust",t.vscodeTerminal="vscode-terminal",t.vscodeChatCodeBlock="vscode-chat-code-block",t.vscodeChatCodeCompareBlock="vscode-chat-code-compare-block",t.vscodeChatEditor="vscode-chat-editor",t.vscodeChatInput="chatSessionInput",t.vscodeLocalChatSession="vscode-chat-session",t.webviewPanel="webview-panel",t.vscodeWebview="vscode-webview",t.extension="extension",t.vscodeFileResource="vscode-file",t.tmp="tmp",t.vsls="vsls",t.vscodeSourceControl="vscode-scm",t.commentsInput="comment",t.codeSetting="code-setting",t.outputChannel="output",t.accessibleView="accessible-view",t.chatEditingSnapshotScheme="chat-editing-snapshot-text-model",t.chatEditingModel="chat-editing-text-model",t.copilotPr="copilot-pr"})(ne||(ne={}));var h4="tkn",u4=class{constructor(){this.a=Object.create(null),this.b=Object.create(null),this.c=Object.create(null),this.d="http",this.e=null,this.f="/"}setPreferredWebSchema(t){this.d=t}setDelegate(t){this.e=t}setServerRootPath(t,e){this.f=be.join(e??"/",f4(t))}getServerRootPath(){return this.f}get g(){return be.join(this.f,ne.vscodeRemoteResource)}set(t,e,s){this.a[t]=e,this.b[t]=s}setConnectionToken(t,e){this.c[t]=e}getPreferredWebSchema(){return this.d}rewrite(t){if(this.e)try{return this.e(t)}catch(o){return it(o),t}const e=t.authority;let s=this.a[e];s&&s.indexOf(":")!==-1&&s.indexOf("[")===-1&&(s=`[${s}]`);const i=this.b[e],n=this.c[e];let r=`path=${encodeURIComponent(t.path)}`;return typeof n=="string"&&(r+=`&${h4}=${encodeURIComponent(n)}`),k.from({scheme:at?this.d:ne.vscodeRemoteResource,authority:`${s}:${i}`,path:this.g,query:r})}},S1=new u4;function f4(t){return`${t.quality??"oss"}-${t.commit??"dev"}`}var d4="vs/../../node_modules",p4="vs/../../node_modules.asar",E1="vscode-app",g4=class Sc{static{this.a=E1}asBrowserUri(e){const s=this.b(e);return this.uriToBrowserUri(s)}uriToBrowserUri(e){return e.scheme===ne.vscodeRemote?S1.rewrite(e):e.scheme===ne.file&&(wy||by===`${ne.vscodeFileResource}://${Sc.a}`)?e.with({scheme:ne.vscodeFileResource,authority:e.authority||Sc.a,query:null,fragment:null}):e}asFileUri(e){const s=this.b(e);return this.uriToFileUri(s)}uriToFileUri(e){return e.scheme===ne.vscodeFileResource?e.with({scheme:ne.file,authority:e.authority!==Sc.a?e.authority:null,query:null,fragment:null}):e}b(e){if(k.isUri(e))return e;if(globalThis._VSCODE_FILE_ROOT){const s=globalThis._VSCODE_FILE_ROOT;if(/^\w[\w\d+.-]*:\/\//.test(s))return k.joinPath(k.parse(s,!0),e);const i=J(s,e);return k.file(i)}throw new Error("Cannot determine URI for module id!")}},ii=new g4,LS=Object.freeze({"Cache-Control":"no-cache, no-store"}),OS=Object.freeze({"Document-Policy":"include-js-call-stacks-in-crash-reports"}),$1;(function(t){const e=new Map([["1",{"Cross-Origin-Opener-Policy":"same-origin"}],["2",{"Cross-Origin-Embedder-Policy":"require-corp"}],["3",{"Cross-Origin-Opener-Policy":"same-origin","Cross-Origin-Embedder-Policy":"require-corp"}]]);t.CoopAndCoep=Object.freeze(e.get("3"));const s="vscode-coi";function i(r){let o;typeof r=="string"?o=new URL(r).searchParams:r instanceof URL?o=r.searchParams:k.isUri(r)&&(o=new URL(r.toString(!0)).searchParams);const a=o?.get(s);if(a)return e.get(a)}t.getHeadersFromQuery=i;function n(r,o,a){if(!globalThis.crossOriginIsolated)return;const c=o&&a?"3":a?"2":"1";r instanceof URLSearchParams?r.set(s,c):r[s]=c}t.addSearchParam=n})($1||($1={}));function ni(t){return t===47||t===92}function x1(t){return t.replace(/[\\/]/g,be.sep)}function m4(t){return t.indexOf("/")===-1&&(t=x1(t)),/^[a-zA-Z]:(\/|$)/.test(t)&&(t="/"+t),t}function k1(t,e=be.sep){if(!t)return"";const s=t.length,i=t.charCodeAt(0);if(ni(i)){if(ni(t.charCodeAt(1))&&!ni(t.charCodeAt(2))){let r=3;const o=r;for(;r<s&&!ni(t.charCodeAt(r));r++);if(o!==r&&!ni(t.charCodeAt(r+1))){for(r+=1;r<s;r++)if(ni(t.charCodeAt(r)))return t.slice(0,r+1).replace(/[\\/]/g,e)}}return e}else if(C1(i)&&t.charCodeAt(1)===58)return ni(t.charCodeAt(2))?t.slice(0,2)+e:t.slice(0,2);let n=t.indexOf("://");if(n!==-1){for(n+=3;n<s;n++)if(ni(t.charCodeAt(n)))return t.slice(0,n+1)}return""}function Do(t,e,s){const i=t===e;return!s||i?i:!t||!e?!1:ti(t,e)}function ir(t,e,s,i=Pt){if(t===e)return!0;if(!t||!e||e.length>t.length)return!1;if(s){if(!Gc(t,e))return!1;if(e.length===t.length)return!0;let r=e.length;return e.charAt(e.length-1)===i&&r--,t.charAt(r)===i}return e.charAt(e.length-1)!==i&&(e+=i),t.indexOf(e)===0}function C1(t){return t>=65&&t<=90||t>=97&&t<=122}function v4(t){return Le?(t=So(t,Pt),t.endsWith(":")&&(t+=Pt)):(t=So(t,Pt),t||(t=Pt)),t}function R1(t){const e=si(t);return Le?t.length>3?!1:w4(e)&&(t.length===2||e.charCodeAt(2)===92):e===be.sep}function w4(t,e=Le){return e?C1(t.charCodeAt(0))&&t.charCodeAt(1)===58:!1}var y4="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",b4="BDEFGHIJKMOQRSTUVWXYZbdefghijkmoqrstuvwxyz0123456789";function S4(t,e,s=8){let i="";for(let r=0;r<s;r++){let o;r===0&&Le&&!e&&(s===3||s===4)?o=b4:o=y4,i+=o.charAt(Math.floor(Math.random()*o.length))}let n;return e?n=`${e}-${i}`:n=i,t?J(t,n):n}function zs(t){return Co(t,!0)}var Po=class{constructor(t){this.a=t}compare(t,e,s=!1){return t===e?0:Eo(this.getComparisonKey(t,s),this.getComparisonKey(e,s))}isEqual(t,e,s=!1){return t===e?!0:!t||!e?!1:this.getComparisonKey(t,s)===this.getComparisonKey(e,s)}getComparisonKey(t,e=!1){return t.with({path:this.a(t)?t.path.toLowerCase():void 0,fragment:e?null:void 0}).toString()}ignorePathCasing(t){return this.a(t)}isEqualOrParent(t,e,s=!1){if(t.scheme===e.scheme){if(t.scheme===ne.file)return ir(zs(t),zs(e),this.a(t))&&t.query===e.query&&(s||t.fragment===e.fragment);if(I1(t.authority,e.authority))return ir(t.path,e.path,this.a(t),"/")&&t.query===e.query&&(s||t.fragment===e.fragment)}return!1}joinPath(t,...e){return k.joinPath(t,...e)}basenameOrAuthority(t){return nr(t)||t.authority}basename(t){return be.basename(t.path)}extname(t){return be.extname(t.path)}dirname(t){if(t.path.length===0)return t;let e;return t.scheme===ne.file?e=k.file(Qe(zs(t))).path:(e=be.dirname(t.path),t.authority&&e.length&&e.charCodeAt(0)!==47&&(console.error(`dirname("${t.toString})) resulted in a relative path`),e="/")),t.with({path:e})}normalizePath(t){if(!t.path.length)return t;let e;return t.scheme===ne.file?e=k.file(si(zs(t))).path:e=be.normalize(t.path),t.with({path:e})}relativePath(t,e){if(t.scheme!==e.scheme||!I1(t.authority,e.authority))return;if(t.scheme===ne.file){const n=g1(zs(t),zs(e));return Le?x1(n):n}let s=t.path||"/";const i=e.path||"/";if(this.a(t)){let n=0;for(const r=Math.min(s.length,i.length);n<r&&!(s.charCodeAt(n)!==i.charCodeAt(n)&&s.charAt(n).toLowerCase()!==i.charAt(n).toLowerCase());n++);s=i.substr(0,n)+s.substr(n)}return be.relative(s,i)}resolvePath(t,e){if(t.scheme===ne.file){const s=k.file(Ai(zs(t),e));return t.with({authority:s.authority,path:s.path})}return e=m4(e),t.with({path:be.resolve(t.path,e)})}isAbsolutePath(t){return!!t.path&&t.path[0]==="/"}isEqualAuthority(t,e){return t===e||t!==void 0&&e!==void 0&&ti(t,e)}hasTrailingPathSeparator(t,e=Pt){if(t.scheme===ne.file){const s=zs(t);return s.length>k1(s).length&&s[s.length-1]===e}else{const s=t.path;return s.length>1&&s.charCodeAt(s.length-1)===47&&!/^[a-zA-Z]:(\/$|\\$)/.test(t.fsPath)}}removeTrailingPathSeparator(t,e=Pt){return A1(t,e)?t.with({path:t.path.substr(0,t.path.length-1)}):t}addTrailingPathSeparator(t,e=Pt){let s=!1;if(t.scheme===ne.file){const i=zs(t);s=i!==void 0&&i.length===k1(i).length&&i[i.length-1]===e}else{e="/";const i=t.path;s=i.length===1&&i.charCodeAt(i.length-1)===47}return!s&&!A1(t,e)?t.with({path:t.path+"/"}):t}},we=new Po(()=>!1),Zc=new Po(t=>t.scheme===ne.file?!ut:!0),E4=new Po(t=>!0),Vs=we.isEqual.bind(we),D1=we.isEqualOrParent.bind(we),NS=we.getComparisonKey.bind(we),TS=we.basenameOrAuthority.bind(we),nr=we.basename.bind(we),jS=we.extname.bind(we),P1=we.dirname.bind(we),V=we.joinPath.bind(we),$4=we.normalizePath.bind(we),x4=we.relativePath.bind(we),MS=we.resolvePath.bind(we),k4=we.isAbsolutePath.bind(we),I1=we.isEqualAuthority.bind(we),A1=we.hasTrailingPathSeparator.bind(we),US=we.removeTrailingPathSeparator.bind(we),FS=we.addTrailingPathSeparator.bind(we),L1;(function(t){t.META_DATA_LABEL="label",t.META_DATA_DESCRIPTION="description",t.META_DATA_SIZE="size",t.META_DATA_MIME="mime";function e(s){const i=new Map;s.path.substring(s.path.indexOf(";")+1,s.path.lastIndexOf(";")).split(";").forEach(o=>{const[a,c]=o.split(":");a&&c&&i.set(a,c)});const r=s.path.substring(0,s.path.indexOf(";"));return r&&i.set(t.META_DATA_MIME,r),i}t.parseMetaData=e})(L1||(L1={}));var C4=Symbol("MicrotaskDelay");function Yc(t){return!!t&&typeof t.then=="function"}function yt(t){const e=new fs,s=t(e.token);let i=!1;const n=new Promise((r,o)=>{const a=e.token.onCancellationRequested(()=>{i=!0,a.dispose(),o(new nt)});Promise.resolve(s).then(c=>{a.dispose(),e.dispose(),i?Fc(c)&&c.dispose():r(c)},c=>{a.dispose(),e.dispose(),o(c)})});return new class{cancel(){e.cancel(),e.dispose()}then(r,o){return n.then(r,o)}catch(r){return this.then(void 0,r)}finally(r){return n.finally(r)}}}function R4(){let t,e;return{promise:new Promise((i,n)=>{t=i,e=n}),resolve:t,reject:e}}var D4=class{constructor(){this.a=null,this.b=null,this.d=null,this.f=new fs}queue(t){if(this.f.token.isCancellationRequested)return Promise.reject(new Error("Throttler is disposed"));if(this.a){if(this.d=t,!this.b){const e=()=>{if(this.b=null,this.f.token.isCancellationRequested)return;const s=this.queue(this.d);return this.d=null,s};this.b=new Promise(s=>{this.a.then(e,e).then(s)})}return new Promise((e,s)=>{this.b.then(e,s)})}return this.a=t(this.f.token),new Promise((e,s)=>{this.a.then(i=>{this.a=null,e(i)},i=>{this.a=null,s(i)})})}dispose(){this.f.cancel()}},P4=class{constructor(){this.a=Promise.resolve(null)}queue(t){return this.a=this.a.then(()=>t(),()=>t())}},I4=(t,e)=>{let s=!0;const i=setTimeout(()=>{s=!1,e()},t);return{isTriggered:()=>s,dispose:()=>{clearTimeout(i),s=!1}}},A4=t=>{let e=!0;return queueMicrotask(()=>{e&&(e=!1,t())}),{isTriggered:()=>e,dispose:()=>{e=!1}}},el=class{constructor(t){this.defaultDelay=t,this.a=null,this.b=null,this.d=null,this.f=null,this.g=null}trigger(t,e=this.defaultDelay){this.g=t,this.h(),this.b||(this.b=new Promise((i,n)=>{this.d=i,this.f=n}).then(()=>{if(this.b=null,this.d=null,this.g){const i=this.g;return this.g=null,i()}}));const s=()=>{this.a=null,this.d?.(null)};return this.a=e===C4?A4(s):I4(e,s),this.b}isTriggered(){return!!this.a?.isTriggered()}cancel(){this.h(),this.b&&(this.f?.(new nt),this.b=null)}h(){this.a?.dispose(),this.a=null}dispose(){this.cancel()}},Li=class{constructor(t){this.a=new el(t),this.b=new D4}trigger(t,e){return this.a.trigger(()=>this.b.queue(t),e)}isTriggered(){return this.a.isTriggered()}cancel(){this.a.cancel()}dispose(){this.a.dispose(),this.b.dispose()}},rr=class{constructor(){this.a=!1,this.b=new Promise((t,e)=>{this.d=t})}isOpen(){return this.a}open(){this.a=!0,this.d(!0)}wait(){return this.b}};function Oi(t,e){return e?new Promise((s,i)=>{const n=setTimeout(()=>{r.dispose(),s()},t),r=e.onCancellationRequested(()=>{clearTimeout(n),r.dispose(),i(new nt)})}):yt(s=>Oi(t,s))}function dn(t,e=0,s){const i=setTimeout(()=>{t(),s&&n.dispose()},e),n=pe(()=>{clearTimeout(i),s?.delete(n)});return s?.add(n),n}var O1=class{constructor(t){this.a=0,this.b=!1,this.f=t,this.g=[],this.d=0,this.h=new R}whenIdle(){return this.size>0?O.toPromise(this.onDrained):Promise.resolve()}get onDrained(){return this.h.event}get size(){return this.a}queue(t){if(this.b)throw new Error("Object has been disposed");return this.a++,new Promise((e,s)=>{this.g.push({factory:t,c:e,e:s}),this.j()})}j(){for(;this.g.length&&this.d<this.f;){const t=this.g.shift();this.d++;const e=t.factory();e.then(t.c,t.e),e.then(()=>this.k(),()=>this.k())}}k(){this.b||(this.d--,--this.a===0&&this.h.fire(),this.g.length>0&&this.j())}clear(){if(this.b)throw new Error("Object has been disposed");this.g.length=0,this.a=this.d}dispose(){this.b=!0,this.g.length=0,this.a=0,this.h.dispose()}},pn=class extends O1{constructor(){super(1)}},N1=class{constructor(){this.a=new Map,this.b=new Set,this.d=void 0,this.f=0}async whenDrained(){if(this.g())return;const t=new gn;return this.b.add(t),t.p}g(){for(const[,t]of this.a)if(t.size>0)return!1;return!0}queueSize(t,e=we){const s=e.getComparisonKey(t);return this.a.get(s)?.size??0}queueFor(t,e,s=we){const i=s.getComparisonKey(t);let n=this.a.get(i);if(!n){n=new pn;const r=this.f++,o=O.once(n.onDrained)(()=>{n?.dispose(),this.a.delete(i),this.h(),this.d?.deleteAndDispose(r),this.d?.size===0&&(this.d.dispose(),this.d=void 0)});this.d||(this.d=new go),this.d.set(r,o),this.a.set(i,n)}return n.queue(e)}h(){this.g()&&this.j()}j(){for(const t of this.b)t.complete();this.b.clear()}dispose(){for(const[,t]of this.a)t.dispose();this.a.clear(),this.j(),this.d?.dispose()}},ps=class{constructor(t,e){this.b=void 0,this.a=t,this.d=e,this.f=this.g.bind(this)}dispose(){this.cancel(),this.a=null}cancel(){this.isScheduled()&&(clearTimeout(this.b),this.b=void 0)}schedule(t=this.d){this.cancel(),this.b=setTimeout(this.f,t)}get delay(){return this.d}set delay(t){this.d=t}isScheduled(){return this.b!==void 0}flush(){this.isScheduled()&&(this.cancel(),this.h())}g(){this.b=void 0,this.a&&this.h()}h(){this.a?.()}},L4=class extends ps{constructor(t,e){super(t,e),this.j=[]}work(t){this.j.push(t),this.isScheduled()||this.schedule()}h(){const t=this.j;this.j=[],this.a?.(t)}dispose(){this.j=[],super.dispose()}},T1=class extends j{constructor(t,e){super(),this.h=t,this.j=e,this.a=[],this.b=this.D(new us),this.f=!1,this.g=0}get pending(){return this.a.length}work(t){if(this.f)return!1;if(typeof this.h.maxBufferedWork=="number"){if(this.b.value){if(this.pending+t.length>this.h.maxBufferedWork)return!1}else if(this.pending+t.length-this.h.maxWorkChunkSize>this.h.maxBufferedWork)return!1}for(const s of t)this.a.push(s);const e=Date.now()-this.g;return!this.b.value&&(!this.h.waitThrottleDelayBetweenWorkUnits||e>=this.h.throttleDelay)?this.m():!this.b.value&&this.h.waitThrottleDelayBetweenWorkUnits&&this.q(Math.max(this.h.throttleDelay-e,0)),!0}m(){this.g=Date.now(),this.j(this.a.splice(0,this.h.maxWorkChunkSize)),this.a.length>0&&this.q()}q(t=this.h.throttleDelay){this.b.value=new ps(()=>{this.b.clear(),this.m()},t),this.b.value.schedule()}dispose(){super.dispose(),this.a.length=0,this.f=!0}},j1,Io;(function(){const t=globalThis;typeof t.requestIdleCallback!="function"||typeof t.cancelIdleCallback!="function"?Io=(e,s,i)=>{Ey(()=>{if(n)return;const r=Date.now()+15;s(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,r-Date.now())}}))});let n=!1;return{dispose(){n||(n=!0)}}}:Io=(e,s,i)=>{const n=e.requestIdleCallback(s,typeof i=="number"?{timeout:i}:void 0);let r=!1;return{dispose(){r||(r=!0,e.cancelIdleCallback(n))}}},j1=(e,s)=>Io(globalThis,e,s)})();var O4=class{constructor(t,e){this.l=!1,this.g=()=>{try{this.m=e()}catch(s){this.o=s}finally{this.l=!0}},this.j=Io(t,()=>this.g())}dispose(){this.j.dispose()}get value(){if(this.l||(this.j.dispose(),this.g()),this.o)throw this.o;return this.m}get isInitialized(){return this.l}},N4=class extends O4{constructor(t){super(globalThis,t)}};async function T4(t,e,s){let i;for(let n=0;n<s;n++)try{return await t()}catch(r){i=r,await Oi(e)}throw i}var M1;(function(t){t[t.Resolved=0]="Resolved",t[t.Rejected=1]="Rejected"})(M1||(M1={}));var gn=class iw{static fromPromise(e){const s=new iw;return s.settleWith(e),s}get isRejected(){return this.d?.outcome===1}get isResolved(){return this.d?.outcome===0}get isSettled(){return!!this.d}get value(){return this.d?.outcome===0?this.d?.value:void 0}constructor(){this.p=new Promise((e,s)=>{this.a=e,this.b=s})}complete(e){return this.isSettled?Promise.resolve():new Promise(s=>{this.a(e),this.d={outcome:0,value:e},s()})}error(e){return this.isSettled?Promise.resolve():new Promise(s=>{this.b(e),this.d={outcome:1,value:e},s()})}settleWith(e){return e.then(s=>this.complete(s),s=>this.error(s))}cancel(){return this.error(new nt)}},Xe;(function(t){async function e(i){let n;const r=await Promise.all(i.map(o=>o.then(a=>a,a=>{n||(n=a)})));if(typeof n<"u")throw n;return r}t.settled=e;function s(i){return new Promise(async(n,r)=>{try{await i(n,r)}catch(o){r(o)}})}t.withAsyncBody=s})(Xe||(Xe={}));var U1;(function(t){t[t.Initial=0]="Initial",t[t.DoneOK=1]="DoneOK",t[t.DoneError=2]="DoneError"})(U1||(U1={}));var qS=class es{static fromArray(e){return new es(s=>{s.emitMany(e)})}static fromPromise(e){return new es(async s=>{s.emitMany(await e)})}static fromPromisesResolveOrder(e){return new es(async s=>{await Promise.all(e.map(async i=>s.emitOne(await i)))})}static merge(e){return new es(async s=>{await Promise.all(e.map(async i=>{for await(const n of i)s.emitOne(n)}))})}static{this.EMPTY=es.fromArray([])}constructor(e,s){this.a=0,this.b=[],this.d=null,this.f=s,this.g=new R,queueMicrotask(async()=>{const i={emitOne:n=>this.h(n),emitMany:n=>this.j(n),reject:n=>this.l(n)};try{await Promise.resolve(e(i)),this.k()}catch(n){this.l(n)}finally{i.emitOne=void 0,i.emitMany=void 0,i.reject=void 0}})}[Symbol.asyncIterator](){let e=0;return{next:async()=>{do{if(this.a===2)throw this.d;if(e<this.b.length)return{done:!1,value:this.b[e++]};if(this.a===1)return{done:!0,value:void 0};await O.toPromise(this.g.event)}while(!0)},return:async()=>(this.f?.(),{done:!0,value:void 0})}}static map(e,s){return new es(async i=>{for await(const n of e)i.emitOne(s(n))})}map(e){return es.map(this,e)}static filter(e,s){return new es(async i=>{for await(const n of e)s(n)&&i.emitOne(n)})}filter(e){return es.filter(this,e)}static coalesce(e){return es.filter(e,s=>!!s)}coalesce(){return es.coalesce(this)}static async toPromise(e){const s=[];for await(const i of e)s.push(i);return s}toPromise(){return es.toPromise(this)}h(e){this.a===0&&(this.b.push(e),this.g.fire())}j(e){this.a===0&&(this.b=this.b.concat(e),this.g.fire())}k(){this.a===0&&(this.a=1,this.g.fire())}l(e){this.a===0&&(this.a=2,this.d=e,this.g.fire())}},j4=class{constructor(){this.a=[],this.b=[]}get hasFinalValue(){return!!this.d}produce(t){if(this.f(),this.a.length>0){const e=this.a.shift();this.g(e,t)}else this.b.push(t)}produceFinal(t){this.f(),this.d=t;for(const e of this.a)this.g(e,t);this.a.length=0}f(){if(this.d)throw new Ac("ProducerConsumer: cannot produce after final value has been set")}g(t,e){e.ok?t.complete(e.value):t.error(e.error)}consume(){if(this.b.length>0||this.d){const t=this.b.length>0?this.b.shift():this.d;return t.ok?Promise.resolve(t.value):Promise.reject(t.error)}else{const t=new gn;return this.a.push(t),t.p}}},_S=class Qt{constructor(e,s){this.b=s,this.a=new j4,this.g={next:()=>this.a.consume(),return:()=>(this.b?.(),Promise.resolve({done:!0,value:void 0})),throw:async i=>(this.f(i),{done:!0,value:void 0})},queueMicrotask(async()=>{const i=e({emitOne:n=>this.a.produce({ok:!0,value:{done:!1,value:n}}),emitMany:n=>{for(const r of n)this.a.produce({ok:!0,value:{done:!1,value:r}})},reject:n=>this.f(n)});if(!this.a.hasFinalValue)try{await i,this.d()}catch(n){this.f(n)}})}static fromArray(e){return new Qt(s=>{s.emitMany(e)})}static fromPromise(e){return new Qt(async s=>{s.emitMany(await e)})}static fromPromisesResolveOrder(e){return new Qt(async s=>{await Promise.all(e.map(async i=>s.emitOne(await i)))})}static merge(e){return new Qt(async s=>{await Promise.all(e.map(async i=>{for await(const n of i)s.emitOne(n)}))})}static{this.EMPTY=Qt.fromArray([])}static map(e,s){return new Qt(async i=>{for await(const n of e)i.emitOne(s(n))})}static tee(e){let s,i;const n=new gn,r=async()=>{if(!(!s||!i))try{for await(const c of e)s.emitOne(c),i.emitOne(c)}catch(c){s.reject(c),i.reject(c)}finally{n.complete()}},o=new Qt(async c=>(s=c,r(),n.p)),a=new Qt(async c=>(i=c,r(),n.p));return[o,a]}map(e){return Qt.map(this,e)}static coalesce(e){return Qt.filter(e,s=>!!s)}coalesce(){return Qt.coalesce(this)}static filter(e,s){return new Qt(async i=>{for await(const n of e)s(n)&&i.emitOne(n)})}filter(e){return Qt.filter(this,e)}d(){this.a.hasFinalValue||this.a.produceFinal({ok:!0,value:{done:!0,value:void 0}})}f(e){this.a.hasFinalValue||this.a.produceFinal({ok:!1,error:e})}[Symbol.asyncIterator](){return this.g}},zS=Symbol("AsyncReaderEndOfStream");function Ao(t){const e=t;return e?[e.on,e.pause,e.resume,e.destroy].every(s=>typeof s=="function"):!1}function tl(t){const e=t;return e?Ao(e.stream)&&Array.isArray(e.buffer)&&typeof e.ended=="boolean":!1}function or(t,e){return new M4(t,e)}var M4=class{constructor(t,e){this.e=t,this.f=e,this.a={flowing:!1,ended:!1,destroyed:!1},this.b={data:[],error:[]},this.c={data:[],error:[],end:[]},this.d=[]}pause(){this.a.destroyed||(this.a.flowing=!1)}resume(){this.a.destroyed||this.a.flowing||(this.a.flowing=!0,this.j(),this.k(),this.l())}write(t){if(!this.a.destroyed){if(this.a.flowing)this.g(t);else if(this.b.data.push(t),typeof this.f?.highWaterMark=="number"&&this.b.data.length>this.f.highWaterMark)return new Promise(e=>this.d.push(e))}}error(t){this.a.destroyed||(this.a.flowing?this.h(t):this.b.error.push(t))}end(t){this.a.destroyed||(typeof t<"u"&&this.write(t),this.a.flowing?(this.i(),this.destroy()):this.a.ended=!0)}g(t){this.c.data.slice(0).forEach(e=>e(t))}h(t){this.c.error.length===0?it(t):this.c.error.slice(0).forEach(e=>e(t))}i(){this.c.end.slice(0).forEach(t=>t())}on(t,e){if(!this.a.destroyed)switch(t){case"data":this.c.data.push(e),this.resume();break;case"end":this.c.end.push(e),this.a.flowing&&this.l()&&this.destroy();break;case"error":this.c.error.push(e),this.a.flowing&&this.k();break}}removeListener(t,e){if(this.a.destroyed)return;let s;switch(t){case"data":s=this.c.data;break;case"end":s=this.c.end;break;case"error":s=this.c.error;break}if(s){const i=s.indexOf(e);i>=0&&s.splice(i,1)}}j(){if(this.b.data.length===0)return;if(typeof this.e=="function"){const e=this.e(this.b.data);this.g(e)}else for(const e of this.b.data)this.g(e);this.b.data.length=0;const t=[...this.d];this.d.length=0,t.forEach(e=>e())}k(){if(this.c.error.length>0){for(const t of this.b.error)this.h(t);this.b.error.length=0}}l(){return this.a.ended?(this.i(),this.c.end.length>0):!1}destroy(){this.a.destroyed||(this.a.destroyed=!0,this.a.ended=!0,this.b.data.length=0,this.b.error.length=0,this.c.data.length=0,this.c.error.length=0,this.c.end.length=0,this.d.length=0)}};function U4(t,e){const s=[];let i;for(;(i=t.read())!==null;)s.push(i);return e(s)}function F4(t,e,s){const i=[];let n;for(;(n=t.read())!==null&&i.length<s;)i.push(n);return n===null&&i.length>0?e(i):{read:()=>{if(i.length>0)return i.shift();if(typeof n<"u"){const r=n;return n=void 0,r}return t.read()}}}function F1(t,e){return new Promise((s,i)=>{const n=[];Lo(t,{onData:r=>{e&&n.push(r)},onError:r=>{e?i(r):s(void 0)},onEnd:()=>{s(e?e(n):void 0)}})})}function Lo(t,e,s){t.on("error",i=>{s?.isCancellationRequested||e.onError(i)}),t.on("end",()=>{s?.isCancellationRequested||e.onEnd()}),t.on("data",i=>{s?.isCancellationRequested||e.onData(i)})}function q4(t,e){return new Promise((s,i)=>{const n=new Pe,r=[],o=l=>{if(r.push(l),r.length>e)return n.dispose(),t.pause(),s({stream:t,buffer:r,ended:!1})},a=l=>(n.dispose(),i(l)),c=()=>(n.dispose(),s({stream:t,buffer:r,ended:!0}));n.add(pe(()=>t.removeListener("error",a))),t.on("error",a),n.add(pe(()=>t.removeListener("end",c))),t.on("end",c),n.add(pe(()=>t.removeListener("data",o))),t.on("data",o)})}function _4(t){let e=!1;return{read:()=>e?null:(e=!0,t)}}function q1(t,e,s){const i=or(s);return Lo(t,{onData:n=>i.write(e.data(n)),onError:n=>i.error(e.error?e.error(n):n),onEnd:()=>i.end()}),i}var ar=typeof Buffer<"u",z4=new Ri(()=>new Uint8Array(256)),sl,il,L=class as{static alloc(e){return ar?new as(Buffer.allocUnsafe(e)):new as(new Uint8Array(e))}static wrap(e){return ar&&!Buffer.isBuffer(e)&&(e=Buffer.from(e.buffer,e.byteOffset,e.byteLength)),new as(e)}static fromString(e,s){return!(s?.dontUseNodeBuffer||!1)&&ar?new as(Buffer.from(e)):(sl||(sl=new TextEncoder),new as(sl.encode(e)))}static fromByteArray(e){const s=as.alloc(e.length);for(let i=0,n=e.length;i<n;i++)s.buffer[i]=e[i];return s}static concat(e,s){if(typeof s>"u"){s=0;for(let r=0,o=e.length;r<o;r++)s+=e[r].byteLength}const i=as.alloc(s);let n=0;for(let r=0,o=e.length;r<o;r++){const a=e[r];i.set(a,n),n+=a.byteLength}return i}static isNativeBuffer(e){return ar&&Buffer.isBuffer(e)}constructor(e){this.buffer=e,this.byteLength=this.buffer.byteLength}clone(){const e=as.alloc(this.byteLength);return e.set(this),e}toString(){return ar?this.buffer.toString():(il||(il=new TextDecoder(void 0,{ignoreBOM:!0})),il.decode(this.buffer))}slice(e,s){return new as(this.buffer.subarray(e,s))}set(e,s){if(e instanceof as)this.buffer.set(e.buffer,s);else if(e instanceof Uint8Array)this.buffer.set(e,s);else if(e instanceof ArrayBuffer)this.buffer.set(new Uint8Array(e),s);else if(ArrayBuffer.isView(e))this.buffer.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),s);else throw new Error("Unknown argument 'array'")}readUInt32BE(e){return V4(this.buffer,e)}writeUInt32BE(e,s){B4(this.buffer,e,s)}readUInt32LE(e){return W4(this.buffer,e)}writeUInt32LE(e,s){H4(this.buffer,e,s)}readUInt8(e){return G4(this.buffer,e)}writeUInt8(e,s){J4(this.buffer,e,s)}indexOf(e,s=0){return _1(this.buffer,e instanceof as?e.buffer:e,s)}equals(e){return this===e?!0:this.byteLength!==e.byteLength?!1:this.buffer.every((s,i)=>s===e.buffer[i])}};function _1(t,e,s=0){const i=e.byteLength,n=t.byteLength;if(i===0)return 0;if(i===1)return t.indexOf(e[0]);if(i>n-s)return-1;const r=z4.value;r.fill(e.length);for(let l=0;l<e.length;l++)r[e[l]]=e.length-l-1;let o=s+e.length-1,a=o,c=-1;for(;o<n;)if(t[o]===e[a]){if(a===0){c=o;break}o--,a--}else o+=Math.max(e.length-a,r[t[o]]),a=e.length-1;return c}function V4(t,e){return t[e]*2**24+t[e+1]*2**16+t[e+2]*2**8+t[e+3]}function B4(t,e,s){t[s+3]=e,e=e>>>8,t[s+2]=e,e=e>>>8,t[s+1]=e,e=e>>>8,t[s]=e}function W4(t,e){return t[e+0]<<0>>>0|t[e+1]<<8>>>0|t[e+2]<<16>>>0|t[e+3]<<24>>>0}function H4(t,e,s){t[s+0]=e&255,e=e>>>8,t[s+1]=e&255,e=e>>>8,t[s+2]=e&255,e=e>>>8,t[s+3]=e&255}function G4(t,e){return t[e]}function J4(t,e,s){t[s]=e}function K4(t){return U4(t,e=>L.concat(e))}function Q4(t){return _4(t)}function Ni(t){return F1(t,e=>L.concat(e))}async function X4(t){return t.ended?L.concat(t.buffer):L.concat([...t.buffer,await Ni(t.stream)])}function Z4(t){return q1(t,{data:e=>typeof e=="string"?L.fromString(e):L.wrap(e)},e=>L.concat(e))}function Y4(t){return or(e=>L.concat(e),t)}var eb="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",tb="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";function sb({buffer:t},e=!0,s=!1){const i=s?tb:eb;let n="";const r=t.byteLength%3;let o=0;for(;o<t.byteLength-r;o+=3){const a=t[o+0],c=t[o+1],l=t[o+2];n+=i[a>>>2],n+=i[(a<<4|c>>>4)&63],n+=i[(c<<2|l>>>6)&63],n+=i[l&63]}if(r===1){const a=t[o+0];n+=i[a>>>2],n+=i[a<<4&63],e&&(n+="==")}else if(r===2){const a=t[o+0],c=t[o+1];n+=i[a>>>2],n+=i[(a<<4|c>>>4)&63],n+=i[c<<2&63],e&&(n+="=")}return n}var z1="0123456789abcdef";function ib({buffer:t}){let e="";for(let s=0;s<t.length;s++){const i=t[s];e+=z1[i>>>4],e+=z1[i&15]}return e}function xe(t,e,s){let i=null,n=null;if(typeof s.value=="function"?(i="value",n=s.value,n.length!==0&&console.warn("Memoize should only be used in functions with zero parameters")):typeof s.get=="function"&&(i="get",n=s.get),!n)throw new Error("not supported");const r=`$memoize$${e}`;s[i]=function(...o){return this.hasOwnProperty(r)||Object.defineProperty(this,r,{configurable:!1,enumerable:!1,writable:!1,value:n.apply(this,o)}),this[r]}}function nb(t){return JSON.stringify(t,ob)}function rb(t){let e=JSON.parse(t);return e=mn(e),e}function ob(t,e){return e instanceof RegExp?{$mid:2,source:e.source,flags:e.flags}:e}function mn(t,e=0){if(!t||e>200)return t;if(typeof t=="object"){switch(t.$mid){case 1:return k.revive(t);case 2:return new RegExp(t.source,t.flags);case 17:return new Date(t.source)}if(t instanceof L||t instanceof Uint8Array)return t;if(Array.isArray(t))for(let s=0;s<t.length;++s)t[s]=mn(t[s],e+1);else for(const s in t)Object.hasOwnProperty.call(t,s)&&(t[s]=mn(t[s],e+1))}return t}var V1;(function(t){t[t.Promise=100]="Promise",t[t.PromiseCancel=101]="PromiseCancel",t[t.EventListen=102]="EventListen",t[t.EventDispose=103]="EventDispose"})(V1||(V1={}));function vn(t){switch(t){case 100:return"req";case 101:return"cancel";case 102:return"subscribe";case 103:return"unsubscribe"}}var B1;(function(t){t[t.Initialize=200]="Initialize",t[t.PromiseSuccess=201]="PromiseSuccess",t[t.PromiseError=202]="PromiseError",t[t.PromiseErrorObj=203]="PromiseErrorObj",t[t.EventFire=204]="EventFire"})(B1||(B1={}));function Oo(t){switch(t){case 200:return"init";case 201:return"reply:";case 202:case 203:return"replyErr:";case 204:return"event:"}}var Ti;(function(t){t[t.Uninitialized=0]="Uninitialized",t[t.Idle=1]="Idle"})(Ti||(Ti={}));function wn(t){let e=0;for(let s=0;;s+=7){const i=t.read(1);if(e|=(i.buffer[0]&127)<<s,!(i.buffer[0]&128))return e}}var ab=ri(0);function yn(t,e){if(e===0){t.write(ab);return}let s=0;for(let n=e;n!==0;n=n>>>7)s++;const i=L.alloc(s);for(let n=0;e!==0;n++)i.buffer[n]=e&127,e=e>>>7,e>0&&(i.buffer[n]|=128);t.write(i)}var nl=class{constructor(t){this.b=t,this.a=0}read(t){const e=this.b.slice(this.a,this.a+t);return this.a+=e.byteLength,e}},W1=class{constructor(){this.a=[]}get buffer(){return L.concat(this.a)}write(t){this.a.push(t)}},$t;(function(t){t[t.Undefined=0]="Undefined",t[t.String=1]="String",t[t.Buffer=2]="Buffer",t[t.VSBuffer=3]="VSBuffer",t[t.Array=4]="Array",t[t.Object=5]="Object",t[t.Int=6]="Int"})($t||($t={}));function ri(t){const e=L.alloc(1);return e.writeUInt8(t,0),e}var ji={Undefined:ri($t.Undefined),String:ri($t.String),Buffer:ri($t.Buffer),VSBuffer:ri($t.VSBuffer),Array:ri($t.Array),Object:ri($t.Object),Uint:ri($t.Int)};function cr(t,e){if(typeof e>"u")t.write(ji.Undefined);else if(typeof e=="string"){const s=L.fromString(e);t.write(ji.String),yn(t,s.byteLength),t.write(s)}else if(L.isNativeBuffer(e)){const s=L.wrap(e);t.write(ji.Buffer),yn(t,s.byteLength),t.write(s)}else if(e instanceof L)t.write(ji.VSBuffer),yn(t,e.byteLength),t.write(e);else if(Array.isArray(e)){t.write(ji.Array),yn(t,e.length);for(const s of e)cr(t,s)}else if(typeof e=="number"&&(e|0)===e)t.write(ji.Uint),yn(t,e);else{const s=L.fromString(JSON.stringify(e));t.write(ji.Object),yn(t,s.byteLength),t.write(s)}}function bn(t){switch(t.read(1).readUInt8(0)){case $t.Undefined:return;case $t.String:return t.read(wn(t)).toString();case $t.Buffer:return t.read(wn(t)).buffer;case $t.VSBuffer:return t.read(wn(t));case $t.Array:{const s=wn(t),i=[];for(let n=0;n<s;n++)i.push(bn(t));return i}case $t.Object:return JSON.parse(t.read(wn(t)).toString());case $t.Int:return wn(t)}}var cb=class{constructor(t,e,s=null,i=1e3){this.h=t,this.j=e,this.k=s,this.l=i,this.b=new Map,this.d=new Map,this.g=new Map,this.f=this.h.onMessage(n=>this.q(n)),this.m({type:200})}registerChannel(t,e){this.b.set(t,e),setTimeout(()=>this.w(t),0)}m(t){switch(t.type){case 200:{const e=this.o([t.type]);this.k?.logOutgoing(e,0,1,Oo(t.type));return}case 201:case 202:case 204:case 203:{const e=this.o([t.type,t.id],t.data);this.k?.logOutgoing(e,t.id,1,Oo(t.type),t.data);return}}}o(t,e=void 0){const s=new W1;return cr(s,t),cr(s,e),this.p(s.buffer)}p(t){try{return this.h.send(t),t.byteLength}catch{return 0}}q(t){const e=new nl(t),s=bn(e),i=bn(e),n=s[0];switch(n){case 100:return this.k?.logIncoming(t.byteLength,s[1],1,`${vn(n)}: ${s[2]}.${s[3]}`,i),this.s({type:n,id:s[1],channelName:s[2],name:s[3],arg:i});case 102:return this.k?.logIncoming(t.byteLength,s[1],1,`${vn(n)}: ${s[2]}.${s[3]}`,i),this.t({type:n,id:s[1],channelName:s[2],name:s[3],arg:i});case 101:return this.k?.logIncoming(t.byteLength,s[1],1,`${vn(n)}`),this.u({type:n,id:s[1]});case 103:return this.k?.logIncoming(t.byteLength,s[1],1,`${vn(n)}`),this.u({type:n,id:s[1]})}}s(t){const e=this.b.get(t.channelName);if(!e){this.v(t);return}const s=new fs;let i;try{i=e.call(this.j,t.name,t.arg,s.token)}catch(o){i=Promise.reject(o)}const n=t.id;i.then(o=>{this.m({id:n,data:o,type:201})},o=>{o instanceof Error?this.m({id:n,data:{message:o.message,name:o.name,stack:o.stack?o.stack.split(`
`):void 0},type:202}):this.m({id:n,data:o,type:203})}).finally(()=>{r.dispose(),this.d.delete(t.id)});const r=pe(()=>s.cancel());this.d.set(t.id,r)}t(t){const e=this.b.get(t.channelName);if(!e){this.v(t);return}const s=t.id,n=e.listen(this.j,t.name,t.arg)(r=>this.m({id:s,data:r,type:204}));this.d.set(t.id,n)}u(t){const e=this.d.get(t.id);e&&(e.dispose(),this.d.delete(t.id))}v(t){let e=this.g.get(t.channelName);e||(e=[],this.g.set(t.channelName,e));const s=setTimeout(()=>{console.error(`Unknown channel: ${t.channelName}`),t.type===100&&this.m({id:t.id,data:{name:"Unknown channel",message:`Channel name '${t.channelName}' timed out after ${this.l}ms`,stack:void 0},type:202})},this.l);e.push({request:t,timeoutTimer:s})}w(t){const e=this.g.get(t);if(e){for(const s of e)switch(clearTimeout(s.timeoutTimer),s.request.type){case 100:this.s(s.request);break;case 102:this.t(s.request);break}this.g.delete(t)}}dispose(){this.f&&(this.f.dispose(),this.f=null),Zt(this.d.values()),this.d.clear()}},H1;(function(t){t[t.LocalSide=0]="LocalSide",t[t.OtherSide=1]="OtherSide"})(H1||(H1={}));var rl=class{constructor(t,e=null){this.l=t,this.a=!1,this.b=Ti.Uninitialized,this.d=new Set,this.f=new Map,this.g=0,this.k=new R,this.onDidInitialize=this.k.event,this.h=this.l.onMessage(s=>this.s(s)),this.j=e}getChannel(t){const e=this;return{call(s,i,n){return e.a?Promise.reject(new nt):e.m(t,s,i,n)},listen(s,i){return e.a?O.None:e.o(t,s,i)}}}m(t,e,s,i=Z.None){const n=this.g++,o={id:n,type:100,channelName:t,name:e,arg:s};if(i.isCancellationRequested)return Promise.reject(new nt);let a,c;return new Promise((h,u)=>{if(i.isCancellationRequested)return u(new nt);const f=()=>{const m=v=>{switch(v.type){case 201:this.f.delete(n),h(v.data);break;case 202:{this.f.delete(n);const b=new Error(v.data.message);b.stack=Array.isArray(v.data.stack)?v.data.stack.join(`
`):v.data.stack,b.name=v.data.name,u(b);break}case 203:this.f.delete(n),u(v.data);break}};this.f.set(n,m),this.p(o)};let p=null;this.b===Ti.Idle?f():(p=yt(m=>this.u()),p.then(()=>{p=null,f()}));const g=()=>{p?(p.cancel(),p=null):this.p({id:n,type:101}),u(new nt)};a=i.onCancellationRequested(g),c={dispose:Md(()=>{g(),a.dispose()})},this.d.add(c)}).finally(()=>{a?.dispose(),this.d.delete(c)})}o(t,e,s){const i=this.g++,r={id:i,type:102,channelName:t,name:e,arg:s};let o=null;const a=new R({onWillAddFirstListener:()=>{const l=()=>{this.d.add(a),this.p(r)};this.b===Ti.Idle?l():(o=yt(h=>this.u()),o.then(()=>{o=null,l()}))},onDidRemoveLastListener:()=>{o?(o.cancel(),o=null):(this.d.delete(a),this.p({id:i,type:103}))}}),c=l=>a.fire(l.data);return this.f.set(i,c),a.event}p(t){switch(t.type){case 100:case 102:{const e=this.q([t.type,t.id,t.channelName,t.name],t.arg);this.j?.logOutgoing(e,t.id,0,`${vn(t.type)}: ${t.channelName}.${t.name}`,t.arg);return}case 101:case 103:{const e=this.q([t.type,t.id]);this.j?.logOutgoing(e,t.id,0,vn(t.type));return}}}q(t,e=void 0){const s=new W1;return cr(s,t),cr(s,e),this.r(s.buffer)}r(t){try{return this.l.send(t),t.byteLength}catch{return 0}}s(t){const e=new nl(t),s=bn(e),i=bn(e),n=s[0];switch(n){case 200:return this.j?.logIncoming(t.byteLength,0,0,Oo(n)),this.t({type:s[0]});case 201:case 202:case 204:case 203:return this.j?.logIncoming(t.byteLength,s[1],0,Oo(n),i),this.t({type:s[0],id:s[1],data:i})}}t(t){if(t.type===200){this.b=Ti.Idle,this.k.fire();return}this.f.get(t.id)?.(t)}get onDidInitializePromise(){return O.toPromise(this.onDidInitialize)}u(){return this.b===Ti.Idle?Promise.resolve():this.onDidInitializePromise}dispose(){this.a=!0,this.h&&(this.h.dispose(),this.h=null),Zt(this.d.values()),this.d.clear()}};__decorate([xe],rl.prototype,"onDidInitializePromise",null);var lb=class{get connections(){const t=[];return this.f.forEach(e=>t.push(e)),t}constructor(t,e,s){this.a=new Map,this.f=new Set,this.g=new R,this.onDidAddConnection=this.g.event,this.h=new R,this.onDidRemoveConnection=this.h.event,this.j=new Pe,this.j.add(t(({protocol:i,onDidClientDisconnect:n})=>{const r=O.once(i.onMessage);this.j.add(r(o=>{const a=new nl(o),c=bn(a),l=new cb(i,c,e,s),h=new rl(i,e);this.a.forEach((f,p)=>l.registerChannel(p,f));const u={channelServer:l,channelClient:h,ctx:c};this.f.add(u),this.g.fire(u),this.j.add(n(()=>{l.dispose(),h.dispose(),this.f.delete(u),this.h.fire(u)}))}))}))}getChannel(t,e){const s=this;return{call(i,n,r){let o;if(jc(e)){const c=Hw(s.connections.filter(e));o=c?Promise.resolve(c):O.toPromise(O.filter(s.onDidAddConnection,e))}else o=e.routeCall(s,i,n);const a=o.then(c=>c.channelClient.getChannel(t));return G1(a).call(i,n,r)},listen(i,n){if(jc(e))return s.k(t,e,i,n);const r=e.routeEvent(s,i,n).then(o=>o.channelClient.getChannel(t));return G1(r).listen(i,n)}}}k(t,e,s,i){const n=this;let r;const o=new R({onWillAddFirstListener:()=>{r=new Pe;const a=new Ny,c=new Map,l=u=>{const p=u.channelClient.getChannel(t).listen(s,i),g=a.add(p);c.set(u,g)},h=u=>{const f=c.get(u);f&&(f.dispose(),c.delete(u))};n.connections.filter(e).forEach(l),O.filter(n.onDidAddConnection,e)(l,void 0,r),n.onDidRemoveConnection(h,void 0,r),a.event(o.fire,o,r),r.add(a)},onDidRemoveLastListener:()=>{r?.dispose(),r=void 0}});return n.j.add(o),o.event}registerChannel(t,e){this.a.set(t,e);for(const s of this.f)s.channelServer.registerChannel(t,e)}dispose(){this.j.dispose();for(const t of this.f)t.channelClient.dispose(),t.channelServer.dispose();this.f.clear(),this.a.clear(),this.g.dispose(),this.h.dispose()}};function G1(t){return{call(e,s,i){return t.then(n=>n.call(e,s,i))},listen(e,s){const i=new t1;return t.then(n=>i.input=n.listen(e,s)),i.event}}}function hb(t){let e=!1;return{call(s,i,n){return e?t.call(s,i,n):Oi(0).then(()=>e=!0).then(()=>t.call(s,i,n))},listen(s,i){if(e)return t.listen(s,i);const n=new t1;return Oi(0).then(()=>e=!0).then(()=>n.input=t.listen(s,i)),n.event}}}var J1=class{constructor(t){this.a=t}routeCall(t){return this.b(t)}routeEvent(t){return this.b(t)}async b(t){for(const e of t.connections)if(await Promise.resolve(this.a(e.ctx)))return Promise.resolve(e);return await O.toPromise(t.onDidAddConnection),await this.b(t)}},xt;(function(t){function e(r,o,a){const c=r,l=a?.disableMarshalling,h=new Map;for(const u in c)i(u)&&h.set(u,O.buffer(c[u],!0,void 0,o));return new class{listen(u,f,p){const g=h.get(f);if(g)return g;const m=c[f];if(typeof m=="function"){if(n(f))return m.call(c,p);if(i(f))return h.set(f,O.buffer(c[f],!0,void 0,o)),h.get(f)}throw new ki(`Event not found: ${f}`)}call(u,f,p){const g=c[f];if(typeof g=="function"){if(!l&&Array.isArray(p))for(let v=0;v<p.length;v++)p[v]=mn(p[v]);let m=g.apply(c,p);return m instanceof Promise||(m=Promise.resolve(m)),m}throw new ki(`Method not found: ${f}`)}}}t.fromService=e;function s(r,o){const a=o?.disableMarshalling;return new Proxy({},{get(c,l){if(typeof l=="string")return o?.properties?.has(l)?o.properties.get(l):n(l)?function(h){return r.listen(l,h)}:i(l)?r.listen(l):async function(...h){let u;o&&!Et(o.context)?u=[o.context,...h]:u=h;const f=await r.call(l,u);return a?f:mn(f)};throw new ki(`Property not found: ${String(l)}`)}})}t.toService=s;function i(r){return r[0]==="o"&&r[1]==="n"&&o1(r.charCodeAt(2))}function n(r){return/^onDynamic/.test(r)&&o1(r.charCodeAt(9))}})(xt||(xt={}));function ub(t){return!!t.parentPort}var fb=class{constructor(t){this.a=t,this.onMessage=O.fromNodeEventEmitter(this.a,"message",e=>e.data?L.wrap(e.data):L.alloc(0)),t.start()}send(t){this.a.postMessage(t.buffer)}disconnect(){this.a.close()}},db=class nw extends lb{static b(e){Zw(ub(process),"Electron Utility Process");const s=new R;return process.parentPort.on("message",i=>{if(e?.handledClientConnection(i))return;const n=i.ports.at(0);n&&s.fire(n)}),O.map(s.event,i=>({protocol:new fb(i),onDidClientDisconnect:O.fromNodeEventEmitter(i,"close")}))}constructor(e){super(nw.b(e))}};function pb(t,e,s){const i=n=>{n.data===e&&(t.removeListener("message",i),s())};t.on("message",i)}import{promises as gb}from"fs";import*as $e from"fs";import{tmpdir as mb}from"os";import{promisify as lr}from"util";var vb=new Qn(1e4);function ol(t){return K1(t,"NFC",vb)}var wb=new Qn(1e4);function yb(t){return K1(t,"NFD",wb)}var bb=/[^\u0000-\u0080]/;function K1(t,e,s){if(!t)return t;const i=s.get(t);if(i)return i;let n;return bb.test(t)?n=t.normalize(e):n=t,s.set(t,n),n}var HS=function(){const t=new Qn(1e4),e=/[\u0300-\u036f]/g;return function(s){const i=t.get(s);if(i)return i;const n=yb(s).replace(e,""),r=(n.length===s.length?n:s).toLowerCase();return t.set(s,r),r}}(),Sn;(function(t){t[t.UNLINK=0]="UNLINK",t[t.MOVE=1]="MOVE"})(Sn||(Sn={}));async function Q1(t,e=Sn.UNLINK,s){if(R1(t))throw new Error("rimraf - will refuse to recursively delete root");return e===Sn.UNLINK?al(t):Sb(t,s)}async function Sb(t,e=S4(mb())){try{try{await $e.promises.rename(t,e)}catch(s){return s.code==="ENOENT"?void 0:al(t)}al(e).catch(()=>{})}catch(s){if(s.code!=="ENOENT")throw s}}async function al(t){return $e.promises.rm(t,{recursive:!0,force:!0,maxRetries:3})}async function No(t,e){try{return await X1(t,e)}catch(s){if(s.code==="ENOENT"&&Le&&R1(t))try{return await X1(`${t}.`,e)}catch{}throw s}}async function X1(t,e){return $b(await(e?Eb(t):$e.promises.readdir(t)))}async function Eb(t){try{return await $e.promises.readdir(t,{withFileTypes:!0})}catch(i){console.warn("[node.js fs] readdir with filetypes failed with error: ",i)}const e=[],s=await No(t);for(const i of s){let n=!1,r=!1,o=!1;try{const a=await $e.promises.lstat(J(t,i));n=a.isFile(),r=a.isDirectory(),o=a.isSymbolicLink()}catch(a){console.warn("[node.js fs] unexpected error from lstat after readdir: ",a)}e.push({name:i,isFile:()=>n,isDirectory:()=>r,isSymbolicLink:()=>o})}return e}function $b(t){return t.map(e=>typeof e=="string"?bs?ol(e):e:(e.name=bs?ol(e.name):e.name,e))}async function xb(t){const e=await No(t),s=[];for(const i of e)await _t.existsDirectory(J(t,i))&&s.push(i);return s}var _t;(function(t){async function e(n){let r;try{if(r=await $e.promises.lstat(n),!r.isSymbolicLink())return{stat:r}}catch{}try{return{stat:await $e.promises.stat(n),symbolicLink:r?.isSymbolicLink()?{dangling:!1}:void 0}}catch(o){if(o.code==="ENOENT"&&r)return{stat:r,symbolicLink:{dangling:!0}};if(Le&&o.code==="EACCES")try{return{stat:await $e.promises.stat(await $e.promises.readlink(n)),symbolicLink:{dangling:!1}}}catch(a){if(a.code==="ENOENT"&&r)return{stat:r,symbolicLink:{dangling:!0}};throw a}throw o}}t.stat=e;async function s(n){try{const{stat:r,symbolicLink:o}=await t.stat(n);return r.isFile()&&o?.dangling!==!0}catch{}return!1}t.existsFile=s;async function i(n){try{const{stat:r,symbolicLink:o}=await t.stat(n);return r.isDirectory()&&o?.dangling!==!0}catch{}return!1}t.existsDirectory=i})(_t||(_t={}));var kb=new N1;function Cb(t,e,s){return kb.queueFor(k.file(t),()=>{const i=Pb(s);return new Promise((n,r)=>Db(t,e,i,o=>o?r(o):n()))},Zc)}var Z1=!0;function Rb(t){Z1=t}function Db(t,e,s,i){if(!Z1)return $e.writeFile(t,e,{mode:s.mode,flag:s.flag},i);$e.open(t,s.flag,s.mode,(n,r)=>{if(n)return i(n);$e.writeFile(r,e,o=>{if(o)return $e.close(r,()=>i(o));$e.fdatasync(r,a=>(a&&(console.warn("[node.js fs] fdatasync is now disabled for this session because it failed: ",a),Rb(!1)),$e.close(r,c=>i(c))))})})}function Pb(t){return t?{mode:typeof t.mode=="number"?t.mode:438,flag:typeof t.flag=="string"?t.flag:"w"}:{mode:438,flag:"w"}}async function Ib(t,e,s=6e4){if(t!==e)try{Le&&typeof s=="number"?await Y1(t,e,Date.now(),s):await $e.promises.rename(t,e)}catch(i){if(t.toLowerCase()!==e.toLowerCase()&&i.code==="EXDEV"||t.endsWith("."))await ep(t,e,{preserveSymlinks:!1}),await Q1(t,Sn.MOVE);else throw i}}async function Y1(t,e,s,i,n=0){try{return await $e.promises.rename(t,e)}catch(r){if(r.code!=="EACCES"&&r.code!=="EPERM"&&r.code!=="EBUSY")throw r;if(Date.now()-s>=i)throw console.error(`[node.js fs] rename failed after ${n} retries with error: ${r}`),r;if(n===0){let o=!1;try{const{stat:a}=await _t.stat(e);a.isFile()||(o=!0)}catch{}if(o)throw r}return await Oi(Math.min(100,n*10)),Y1(t,e,s,i,n+1)}}async function ep(t,e,s){return sp(t,e,{root:{source:t,target:e},options:s,handledSourcePaths:new Set})}var tp=511;async function sp(t,e,s){if(s.handledSourcePaths.has(t))return;s.handledSourcePaths.add(t);const{stat:i,symbolicLink:n}=await _t.stat(t);if(n){if(s.options.preserveSymlinks)try{return await Ob(t,e,s)}catch{}if(n.dangling)return}return i.isDirectory()?Ab(t,e,i.mode&tp,s):Lb(t,e,i.mode&tp)}async function Ab(t,e,s,i){await $e.promises.mkdir(e,{recursive:!0,mode:s});const n=await No(t);for(const r of n)await sp(J(t,r),J(e,r),i)}async function Lb(t,e,s){await $e.promises.copyFile(t,e),await $e.promises.chmod(e,s)}async function Ob(t,e,s){let i=await $e.promises.readlink(t);ir(i,s.root.source,!ut)&&(i=J(s.root.target,i.substr(s.root.source.length+1))),await $e.promises.symlink(i,e)}async function Nb(t){try{return await lr($e.realpath)(t)}catch{const e=Tb(t);return await $e.promises.access(e,$e.constants.R_OK),e}}function Tb(t){return So(si(t),Pt)}var le=new class{get read(){return(t,e,s,i,n)=>new Promise((r,o)=>{$e.read(t,e,s,i,n,(a,c,l)=>a?o(a):r({bytesRead:c,buffer:l}))})}get write(){return(t,e,s,i,n)=>new Promise((r,o)=>{$e.write(t,e,s,i,n,(a,c,l)=>a?o(a):r({bytesWritten:c,buffer:l}))})}get fdatasync(){return lr($e.fdatasync)}get open(){return lr($e.open)}get close(){return lr($e.close)}get ftruncate(){return lr($e.ftruncate)}async exists(t){try{return await $e.promises.access(t),!0}catch{return!1}}get readdir(){return No}get readDirsInDir(){return xb}get writeFile(){return Cb}get rm(){return Q1}get rename(){return Ib}get copy(){return ep}get realpath(){return Nb}};function En(t){return cl(t,0)}function cl(t,e){switch(typeof t){case"object":return t===null?Bs(349,e):Array.isArray(t)?Mb(t,e):Ub(t,e);case"string":return ip(t,e);case"boolean":return jb(t,e);case"number":return Bs(t,e);case"undefined":return Bs(937,e);default:return Bs(617,e)}}function Bs(t,e){return(e<<5)-e+t|0}function jb(t,e){return Bs(t?433:863,e)}function ip(t,e){e=Bs(149417,e);for(let s=0,i=t.length;s<i;s++)e=Bs(t.charCodeAt(s),e);return e}function Mb(t,e){return e=Bs(104579,e),t.reduce((s,i)=>cl(i,s),e)}function Ub(t,e){return e=Bs(181387,e),Object.keys(t).sort().reduce((s,i)=>(s=ip(i,s),cl(t[i],s)),e)}var np;(function(t){t[t.BLOCK_SIZE=64]="BLOCK_SIZE",t[t.UNICODE_REPLACEMENT=65533]="UNICODE_REPLACEMENT"})(np||(np={}));function ll(t,e,s=32){const i=s-e,n=~((1<<i)-1);return(t<<e|(n&t)>>>i)>>>0}function hr(t,e=32){return t instanceof ArrayBuffer?ib(L.wrap(new Uint8Array(t))):(t>>>0).toString(16).padStart(e/4,"0")}var GS=class rw{static{this.g=new DataView(new ArrayBuffer(320))}constructor(){this.h=1732584193,this.l=4023233417,this.m=2562383102,this.n=271733878,this.o=3285377520,this.p=new Uint8Array(67),this.q=new DataView(this.p.buffer),this.r=0,this.t=0,this.u=0,this.v=!1}update(e){const s=e.length;if(s===0)return;const i=this.p;let n=this.r,r=this.u,o,a;for(r!==0?(o=r,a=-1,r=0):(o=e.charCodeAt(0),a=0);;){let c=o;if(_y(o))if(a+1<s){const l=e.charCodeAt(a+1);a1(l)?(a++,c=zy(o,l)):c=65533}else{r=o;break}else a1(o)&&(c=65533);if(n=this.w(i,n,c),a++,a<s)o=e.charCodeAt(a);else break}this.r=n,this.u=r}w(e,s,i){return i<128?e[s++]=i:i<2048?(e[s++]=192|(i&1984)>>>6,e[s++]=128|(i&63)>>>0):i<65536?(e[s++]=224|(i&61440)>>>12,e[s++]=128|(i&4032)>>>6,e[s++]=128|(i&63)>>>0):(e[s++]=240|(i&1835008)>>>18,e[s++]=128|(i&258048)>>>12,e[s++]=128|(i&4032)>>>6,e[s++]=128|(i&63)>>>0),s>=64&&(this.y(),s-=64,this.t+=64,e[0]=e[64],e[1]=e[65],e[2]=e[66]),s}digest(){return this.v||(this.v=!0,this.u&&(this.u=0,this.r=this.w(this.p,this.r,65533)),this.t+=this.r,this.x()),hr(this.h)+hr(this.l)+hr(this.m)+hr(this.n)+hr(this.o)}x(){this.p[this.r++]=128,this.p.subarray(this.r).fill(0),this.r>56&&(this.y(),this.p.fill(0));const e=8*this.t;this.q.setUint32(56,Math.floor(e/4294967296),!1),this.q.setUint32(60,e%4294967296,!1),this.y()}y(){const e=rw.g,s=this.q;for(let u=0;u<64;u+=4)e.setUint32(u,s.getUint32(u,!1),!1);for(let u=64;u<320;u+=4)e.setUint32(u,ll(e.getUint32(u-12,!1)^e.getUint32(u-32,!1)^e.getUint32(u-56,!1)^e.getUint32(u-64,!1),1),!1);let i=this.h,n=this.l,r=this.m,o=this.n,a=this.o,c,l,h;for(let u=0;u<80;u++)u<20?(c=n&r|~n&o,l=1518500249):u<40?(c=n^r^o,l=1859775393):u<60?(c=n&r|n&o|r&o,l=2400959708):(c=n^r^o,l=3395469782),h=ll(i,5)+c+a+l+e.getUint32(u*4,!1)&4294967295,a=o,o=r,r=ll(n,30),n=i,i=h;this.h=this.h+i&4294967295,this.l=this.l+n&4294967295,this.m=this.m+r&4294967295,this.n=this.n+o&4294967295,this.o=this.o+a&4294967295}},rp;(function(t){t[t.LParen=0]="LParen",t[t.RParen=1]="RParen",t[t.Neg=2]="Neg",t[t.Eq=3]="Eq",t[t.NotEq=4]="NotEq",t[t.Lt=5]="Lt",t[t.LtEq=6]="LtEq",t[t.Gt=7]="Gt",t[t.GtEq=8]="GtEq",t[t.RegexOp=9]="RegexOp",t[t.RegexStr=10]="RegexStr",t[t.True=11]="True",t[t.False=12]="False",t[t.In=13]="In",t[t.Not=14]="Not",t[t.And=15]="And",t[t.Or=16]="Or",t[t.Str=17]="Str",t[t.QuotedStr=18]="QuotedStr",t[t.Error=19]="Error",t[t.EOF=20]="EOF"})(rp||(rp={}));function hl(...t){switch(t.length){case 1:return w(1870,null,t[0]);case 2:return w(1871,null,t[0],t[1]);case 3:return w(1872,null,t[0],t[1],t[2]);default:return}}var Fb=w(1873,null),qb=w(1874,null),ur=class ad{constructor(){this.c="",this.d=0,this.e=0,this.f=[],this.g=[],this.m=/[a-zA-Z0-9_<>\-\./\\:\*\?\+\[\]\^,#@;"%\$\p{L}-]+/uy}static getLexeme(e){switch(e.type){case 0:return"(";case 1:return")";case 2:return"!";case 3:return e.isTripleEq?"===":"==";case 4:return e.isTripleEq?"!==":"!=";case 5:return"<";case 6:return"<=";case 7:return">=";case 8:return">=";case 9:return"=~";case 10:return e.lexeme;case 11:return"true";case 12:return"false";case 13:return"in";case 14:return"not";case 15:return"&&";case 16:return"||";case 17:return e.lexeme;case 18:return e.lexeme;case 19:return e.lexeme;case 20:return"EOF";default:throw Ed(`unhandled token type: ${JSON.stringify(e)}; have you forgotten to add a case?`)}}static{this.a=new Set(["i","g","s","m","y","u"].map(e=>e.charCodeAt(0)))}static{this.b=new Map([["not",14],["in",13],["false",12],["true",11]])}get errors(){return this.g}reset(e){return this.c=e,this.d=0,this.e=0,this.f=[],this.g=[],this}scan(){for(;!this.r();)switch(this.d=this.e,this.i()){case 40:this.k(0);break;case 41:this.k(1);break;case 33:if(this.h(61)){const s=this.h(61);this.f.push({type:4,offset:this.d,isTripleEq:s})}else this.k(2);break;case 39:this.o();break;case 47:this.q();break;case 61:if(this.h(61)){const s=this.h(61);this.f.push({type:3,offset:this.d,isTripleEq:s})}else this.h(126)?this.k(9):this.l(hl("==","=~"));break;case 60:this.k(this.h(61)?6:5);break;case 62:this.k(this.h(61)?8:7);break;case 38:this.h(38)?this.k(15):this.l(hl("&&"));break;case 124:this.h(124)?this.k(16):this.l(hl("||"));break;case 32:case 13:case 9:case 10:case 160:break;default:this.n()}return this.d=this.e,this.k(20),Array.from(this.f)}h(e){return this.r()||this.c.charCodeAt(this.e)!==e?!1:(this.e++,!0)}i(){return this.c.charCodeAt(this.e++)}j(){return this.r()?0:this.c.charCodeAt(this.e)}k(e){this.f.push({type:e,offset:this.d})}l(e){const s=this.d,i=this.c.substring(this.d,this.e),n={type:19,offset:this.d,lexeme:i};this.g.push({offset:s,lexeme:i,additionalInfo:e}),this.f.push(n)}n(){this.m.lastIndex=this.d;const e=this.m.exec(this.c);if(e){this.e=this.d+e[0].length;const s=this.c.substring(this.d,this.e),i=ad.b.get(s);i?this.k(i):this.f.push({type:17,lexeme:s,offset:this.d})}}o(){for(;this.j()!==39&&!this.r();)this.i();if(this.r()){this.l(Fb);return}this.i(),this.f.push({type:18,lexeme:this.c.substring(this.d+1,this.e-1),offset:this.d+1})}q(){let e=this.e,s=!1,i=!1;for(;;){if(e>=this.c.length){this.e=e,this.l(qb);return}const r=this.c.charCodeAt(e);if(s)s=!1;else if(r===47&&!i){e++;break}else r===91?i=!0:r===92?s=!0:r===93&&(i=!1);e++}for(;e<this.c.length&&ad.a.has(this.c.charCodeAt(e));)e++;this.e=e;const n=this.c.substring(this.d,this.e);this.f.push({type:10,lexeme:n,offset:this.d})}r(){return this.e>=this.c.length}},gs;(function(t){t.serviceIds=new Map,t.DI_TARGET="$di$target",t.DI_DEPENDENCIES="$di$dependencies";function e(s){return s[t.DI_DEPENDENCIES]||[]}t.getServiceDependencies=e})(gs||(gs={}));var ns=W("instantiationService");function _b(t,e,s){e[gs.DI_TARGET]===e?e[gs.DI_DEPENDENCIES].push({id:t,index:s}):(e[gs.DI_DEPENDENCIES]=[{id:t,index:s}],e[gs.DI_TARGET]=e)}function W(t){if(gs.serviceIds.has(t))return gs.serviceIds.get(t);const e=function(s,i,n){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");_b(e,s,n)};return e.toString=()=>t,gs.serviceIds.set(t,e),e}function JS(t){return t}var ct=new Map;ct.set("false",!1),ct.set("true",!0),ct.set("isMac",bs),ct.set("isLinux",ut),ct.set("isWindows",Le),ct.set("isWeb",at),ct.set("isMacNative",bs&&!at),ct.set("isEdge",Xd),ct.set("isFirefox",Kd),ct.set("isChrome",zc),ct.set("isSafari",Qd);var zb=Object.prototype.hasOwnProperty,op;(function(t){t[t.False=0]="False",t[t.True=1]="True",t[t.Defined=2]="Defined",t[t.Not=3]="Not",t[t.Equals=4]="Equals",t[t.NotEquals=5]="NotEquals",t[t.And=6]="And",t[t.Regex=7]="Regex",t[t.NotRegex=8]="NotRegex",t[t.Or=9]="Or",t[t.In=10]="In",t[t.NotIn=11]="NotIn",t[t.Greater=12]="Greater",t[t.GreaterEquals=13]="GreaterEquals",t[t.Smaller=14]="Smaller",t[t.SmallerEquals=15]="SmallerEquals"})(op||(op={}));var Vb={regexParsingWithErrorRecovery:!0},Bb=w(1850,null),Wb=w(1851,null),Hb=w(1852,null),ap=w(1853,null),Gb=w(1854,null),Jb=w(1855,null),Kb=w(1856,null),Qb=w(1857,null),Xb=class so{static{this.c=new Error}get lexingErrors(){return this.d.errors}get parsingErrors(){return this.h}constructor(e=Vb){this.k=e,this.d=new ur,this.f=[],this.g=0,this.h=[],this.v=/g|y/g}parse(e){if(e===""){this.h.push({message:Bb,offset:0,lexeme:"",additionalInfo:Wb});return}this.f=this.d.reset(e).scan(),this.g=0,this.h=[];try{const s=this.l();if(!this.E()){const i=this.D(),n=i.type===17?Jb:void 0;throw this.h.push({message:Gb,offset:i.offset,lexeme:ur.getLexeme(i),additionalInfo:n}),so.c}return s}catch(s){if(s!==so.c)throw s;return}}l(){return this.m()}m(){const e=[this.o()];for(;this.y(16);){const s=this.o();e.push(s)}return e.length===1?e[0]:dt.or(...e)}o(){const e=[this.s()];for(;this.y(15);){const s=this.s();e.push(s)}return e.length===1?e[0]:dt.and(...e)}s(){if(this.y(2)){const e=this.D();switch(e.type){case 11:return this.z(),It.INSTANCE;case 12:return this.z(),zt.INSTANCE;case 0:{this.z();const s=this.l();return this.A(1,ap),s?.negate()}case 17:return this.z(),pr.create(e.lexeme);default:throw this.B("KEY | true | false | '(' expression ')'",e)}}return this.t()}t(){const e=this.D();switch(e.type){case 11:return this.z(),dt.true();case 12:return this.z(),dt.false();case 0:{this.z();const s=this.l();return this.A(1,ap),s}case 17:{const s=e.lexeme;if(this.z(),this.y(9)){const n=this.D();if(!this.k.regexParsingWithErrorRecovery){if(this.z(),n.type!==10)throw this.B("REGEX",n);const r=n.lexeme,o=r.lastIndexOf("/"),a=o===r.length-1?void 0:this.w(r.substring(o+1));let c;try{c=new RegExp(r.substring(1,o),a)}catch{throw this.B("REGEX",n)}return ml.create(s,c)}switch(n.type){case 10:case 19:{const r=[n.lexeme];this.z();let o=this.D(),a=0;for(let f=0;f<n.lexeme.length;f++)n.lexeme.charCodeAt(f)===40?a++:n.lexeme.charCodeAt(f)===41&&a--;for(;!this.E()&&o.type!==15&&o.type!==16;){switch(o.type){case 0:a++;break;case 1:a--;break;case 10:case 18:for(let f=0;f<o.lexeme.length;f++)o.lexeme.charCodeAt(f)===40?a++:n.lexeme.charCodeAt(f)===41&&a--}if(a<0)break;r.push(ur.getLexeme(o)),this.z(),o=this.D()}const c=r.join(""),l=c.lastIndexOf("/"),h=l===c.length-1?void 0:this.w(c.substring(l+1));let u;try{u=new RegExp(c.substring(1,l),h)}catch{throw this.B("REGEX",n)}return dt.regex(s,u)}case 18:{const r=n.lexeme;this.z();let o=null;if(!My(r)){const a=r.indexOf("/"),c=r.lastIndexOf("/");if(a!==c&&a>=0){const l=r.slice(a+1,c),h=r[c+1]==="i"?"i":"";try{o=new RegExp(l,h)}catch{throw this.B("REGEX",n)}}}if(o===null)throw this.B("REGEX",n);return ml.create(s,o)}default:throw this.B("REGEX",this.D())}}if(this.y(14)){this.A(13,Hb);const n=this.u();return dt.notIn(s,n)}switch(this.D().type){case 3:{this.z();const n=this.u();if(this.x().type===18)return dt.equals(s,n);switch(n){case"true":return dt.has(s);case"false":return dt.not(s);default:return dt.equals(s,n)}}case 4:{this.z();const n=this.u();if(this.x().type===18)return dt.notEquals(s,n);switch(n){case"true":return dt.not(s);case"false":return dt.has(s);default:return dt.notEquals(s,n)}}case 5:return this.z(),pl.create(s,this.u());case 6:return this.z(),gl.create(s,this.u());case 7:return this.z(),jo.create(s,this.u());case 8:return this.z(),dl.create(s,this.u());case 13:return this.z(),dt.in(s,this.u());default:return dt.has(s)}}case 20:throw this.h.push({message:Kb,offset:e.offset,lexeme:"",additionalInfo:Qb}),so.c;default:throw this.B(`true | false | KEY 
	| KEY '=~' REGEX 
	| KEY ('==' | '!=' | '<' | '<=' | '>' | '>=' | 'in' | 'not' 'in') value`,this.D())}}u(){const e=this.D();switch(e.type){case 17:case 18:return this.z(),e.lexeme;case 11:return this.z(),"true";case 12:return this.z(),"false";case 13:return this.z(),"in";default:return""}}w(e){return e.replaceAll(this.v,"")}x(){return this.f[this.g-1]}y(e){return this.C(e)?(this.z(),!0):!1}z(){return this.E()||this.g++,this.x()}A(e,s){if(this.C(e))return this.z();throw this.B(s,this.D())}B(e,s,i){const n=w(1858,null,e,ur.getLexeme(s)),r=s.offset,o=ur.getLexeme(s);return this.h.push({message:n,offset:r,lexeme:o,additionalInfo:i}),so.c}C(e){return this.D().type===e}D(){return this.f[this.g]}E(){return this.D().type===20}},dt=class{static false(){return It.INSTANCE}static true(){return zt.INSTANCE}static has(t){return dr.create(t)}static equals(t,e){return ul.create(t,e)}static notEquals(t,e){return fl.create(t,e)}static regex(t,e){return ml.create(t,e)}static in(t,e){return cp.create(t,e)}static notIn(t,e){return lp.create(t,e)}static not(t){return pr.create(t)}static and(...t){return up.create(t,null,!0)}static or(...t){return vl.create(t,null,!0)}static greater(t,e){return jo.create(t,e)}static greaterEquals(t,e){return dl.create(t,e)}static smaller(t,e){return pl.create(t,e)}static smallerEquals(t,e){return gl.create(t,e)}static{this.c=new Xb({regexParsingWithErrorRecovery:!1})}static deserialize(t){return t==null?void 0:this.c.parse(t)}};function fr(t,e){return t.cmp(e)}var It=class ow{static{this.INSTANCE=new ow}constructor(){this.type=0}cmp(e){return this.type-e.type}equals(e){return e.type===this.type}substituteConstants(){return this}evaluate(e){return!1}serialize(){return"false"}keys(){return[]}map(e){return this}negate(){return zt.INSTANCE}},zt=class aw{static{this.INSTANCE=new aw}constructor(){this.type=1}cmp(e){return this.type-e.type}equals(e){return e.type===this.type}substituteConstants(){return this}evaluate(e){return!0}serialize(){return"true"}keys(){return[]}map(e){return this}negate(){return It.INSTANCE}},dr=class cw{static create(e,s=null){const i=ct.get(e);return typeof i=="boolean"?i?zt.INSTANCE:It.INSTANCE:new cw(e,s)}constructor(e,s){this.key=e,this.c=s,this.type=2}cmp(e){return e.type!==this.type?this.type-e.type:fp(this.key,e.key)}equals(e){return e.type===this.type?this.key===e.key:!1}substituteConstants(){const e=ct.get(this.key);return typeof e=="boolean"?e?zt.INSTANCE:It.INSTANCE:this}evaluate(e){return!!e.getValue(this.key)}serialize(){return this.key}keys(){return[this.key]}map(e){return e.mapDefined(this.key)}negate(){return this.c||(this.c=pr.create(this.key,this)),this.c}},ul=class lw{static create(e,s,i=null){if(typeof s=="boolean")return s?dr.create(e,i):pr.create(e,i);const n=ct.get(e);return typeof n=="boolean"?s===(n?"true":"false")?zt.INSTANCE:It.INSTANCE:new lw(e,s,i)}constructor(e,s,i){this.c=e,this.d=s,this.f=i,this.type=4}cmp(e){return e.type!==this.type?this.type-e.type:Mi(this.c,this.d,e.c,e.d)}equals(e){return e.type===this.type?this.c===e.c&&this.d===e.d:!1}substituteConstants(){const e=ct.get(this.c);if(typeof e=="boolean"){const s=e?"true":"false";return this.d===s?zt.INSTANCE:It.INSTANCE}return this}evaluate(e){return e.getValue(this.c)==this.d}serialize(){return`${this.c} == '${this.d}'`}keys(){return[this.c]}map(e){return e.mapEquals(this.c,this.d)}negate(){return this.f||(this.f=fl.create(this.c,this.d,this)),this.f}},cp=class hw{static create(e,s){return new hw(e,s)}constructor(e,s){this.d=e,this.f=s,this.type=10,this.c=null}cmp(e){return e.type!==this.type?this.type-e.type:Mi(this.d,this.f,e.d,e.f)}equals(e){return e.type===this.type?this.d===e.d&&this.f===e.f:!1}substituteConstants(){return this}evaluate(e){const s=e.getValue(this.f),i=e.getValue(this.d);return Array.isArray(s)?s.includes(i):typeof i=="string"&&typeof s=="object"&&s!==null?zb.call(s,i):!1}serialize(){return`${this.d} in '${this.f}'`}keys(){return[this.d,this.f]}map(e){return e.mapIn(this.d,this.f)}negate(){return this.c||(this.c=lp.create(this.d,this.f)),this.c}},lp=class uw{static create(e,s){return new uw(e,s)}constructor(e,s){this.d=e,this.f=s,this.type=11,this.c=cp.create(e,s)}cmp(e){return e.type!==this.type?this.type-e.type:this.c.cmp(e.c)}equals(e){return e.type===this.type?this.c.equals(e.c):!1}substituteConstants(){return this}evaluate(e){return!this.c.evaluate(e)}serialize(){return`${this.d} not in '${this.f}'`}keys(){return this.c.keys()}map(e){return e.mapNotIn(this.d,this.f)}negate(){return this.c}},fl=class fw{static create(e,s,i=null){if(typeof s=="boolean")return s?pr.create(e,i):dr.create(e,i);const n=ct.get(e);return typeof n=="boolean"?s===(n?"true":"false")?It.INSTANCE:zt.INSTANCE:new fw(e,s,i)}constructor(e,s,i){this.c=e,this.d=s,this.f=i,this.type=5}cmp(e){return e.type!==this.type?this.type-e.type:Mi(this.c,this.d,e.c,e.d)}equals(e){return e.type===this.type?this.c===e.c&&this.d===e.d:!1}substituteConstants(){const e=ct.get(this.c);if(typeof e=="boolean"){const s=e?"true":"false";return this.d===s?It.INSTANCE:zt.INSTANCE}return this}evaluate(e){return e.getValue(this.c)!=this.d}serialize(){return`${this.c} != '${this.d}'`}keys(){return[this.c]}map(e){return e.mapNotEquals(this.c,this.d)}negate(){return this.f||(this.f=ul.create(this.c,this.d,this)),this.f}},pr=class dw{static create(e,s=null){const i=ct.get(e);return typeof i=="boolean"?i?It.INSTANCE:zt.INSTANCE:new dw(e,s)}constructor(e,s){this.c=e,this.d=s,this.type=3}cmp(e){return e.type!==this.type?this.type-e.type:fp(this.c,e.c)}equals(e){return e.type===this.type?this.c===e.c:!1}substituteConstants(){const e=ct.get(this.c);return typeof e=="boolean"?e?It.INSTANCE:zt.INSTANCE:this}evaluate(e){return!e.getValue(this.c)}serialize(){return`!${this.c}`}keys(){return[this.c]}map(e){return e.mapNot(this.c)}negate(){return this.d||(this.d=dr.create(this.c,this)),this.d}};function To(t,e){if(typeof t=="string"){const s=parseFloat(t);isNaN(s)||(t=s)}return typeof t=="string"||typeof t=="number"?e(t):It.INSTANCE}var jo=class pw{static create(e,s,i=null){return To(s,n=>new pw(e,n,i))}constructor(e,s,i){this.c=e,this.d=s,this.f=i,this.type=12}cmp(e){return e.type!==this.type?this.type-e.type:Mi(this.c,this.d,e.c,e.d)}equals(e){return e.type===this.type?this.c===e.c&&this.d===e.d:!1}substituteConstants(){return this}evaluate(e){return typeof this.d=="string"?!1:parseFloat(e.getValue(this.c))>this.d}serialize(){return`${this.c} > ${this.d}`}keys(){return[this.c]}map(e){return e.mapGreater(this.c,this.d)}negate(){return this.f||(this.f=gl.create(this.c,this.d,this)),this.f}},dl=class gw{static create(e,s,i=null){return To(s,n=>new gw(e,n,i))}constructor(e,s,i){this.c=e,this.d=s,this.f=i,this.type=13}cmp(e){return e.type!==this.type?this.type-e.type:Mi(this.c,this.d,e.c,e.d)}equals(e){return e.type===this.type?this.c===e.c&&this.d===e.d:!1}substituteConstants(){return this}evaluate(e){return typeof this.d=="string"?!1:parseFloat(e.getValue(this.c))>=this.d}serialize(){return`${this.c} >= ${this.d}`}keys(){return[this.c]}map(e){return e.mapGreaterEquals(this.c,this.d)}negate(){return this.f||(this.f=pl.create(this.c,this.d,this)),this.f}},pl=class mw{static create(e,s,i=null){return To(s,n=>new mw(e,n,i))}constructor(e,s,i){this.c=e,this.d=s,this.f=i,this.type=14}cmp(e){return e.type!==this.type?this.type-e.type:Mi(this.c,this.d,e.c,e.d)}equals(e){return e.type===this.type?this.c===e.c&&this.d===e.d:!1}substituteConstants(){return this}evaluate(e){return typeof this.d=="string"?!1:parseFloat(e.getValue(this.c))<this.d}serialize(){return`${this.c} < ${this.d}`}keys(){return[this.c]}map(e){return e.mapSmaller(this.c,this.d)}negate(){return this.f||(this.f=dl.create(this.c,this.d,this)),this.f}},gl=class vw{static create(e,s,i=null){return To(s,n=>new vw(e,n,i))}constructor(e,s,i){this.c=e,this.d=s,this.f=i,this.type=15}cmp(e){return e.type!==this.type?this.type-e.type:Mi(this.c,this.d,e.c,e.d)}equals(e){return e.type===this.type?this.c===e.c&&this.d===e.d:!1}substituteConstants(){return this}evaluate(e){return typeof this.d=="string"?!1:parseFloat(e.getValue(this.c))<=this.d}serialize(){return`${this.c} <= ${this.d}`}keys(){return[this.c]}map(e){return e.mapSmallerEquals(this.c,this.d)}negate(){return this.f||(this.f=jo.create(this.c,this.d,this)),this.f}},ml=class ww{static create(e,s){return new ww(e,s)}constructor(e,s){this.d=e,this.f=s,this.type=7,this.c=null}cmp(e){if(e.type!==this.type)return this.type-e.type;if(this.d<e.d)return-1;if(this.d>e.d)return 1;const s=this.f?this.f.source:"",i=e.f?e.f.source:"";return s<i?-1:s>i?1:0}equals(e){if(e.type===this.type){const s=this.f?this.f.source:"",i=e.f?e.f.source:"";return this.d===e.d&&s===i}return!1}substituteConstants(){return this}evaluate(e){const s=e.getValue(this.d);return this.f?this.f.test(s):!1}serialize(){const e=this.f?`/${this.f.source}/${this.f.flags}`:"/invalid/";return`${this.d} =~ ${e}`}keys(){return[this.d]}map(e){return e.mapRegex(this.d,this.f)}negate(){return this.c||(this.c=Zb.create(this)),this.c}},Zb=class cd{static create(e){return new cd(e)}constructor(e){this.c=e,this.type=8}cmp(e){return e.type!==this.type?this.type-e.type:this.c.cmp(e.c)}equals(e){return e.type===this.type?this.c.equals(e.c):!1}substituteConstants(){return this}evaluate(e){return!this.c.evaluate(e)}serialize(){return`!(${this.c.serialize()})`}keys(){return this.c.keys()}map(e){return new cd(this.c.map(e))}negate(){return this.c}};function hp(t){let e=null;for(let s=0,i=t.length;s<i;s++){const n=t[s].substituteConstants();if(t[s]!==n&&e===null){e=[];for(let r=0;r<s;r++)e[r]=t[r]}e!==null&&(e[s]=n)}return e===null?t:e}var up=class Wn{static create(e,s,i){return Wn.d(e,s,i)}constructor(e,s){this.expr=e,this.c=s,this.type=6}cmp(e){if(e.type!==this.type)return this.type-e.type;if(this.expr.length<e.expr.length)return-1;if(this.expr.length>e.expr.length)return 1;for(let s=0,i=this.expr.length;s<i;s++){const n=fr(this.expr[s],e.expr[s]);if(n!==0)return n}return 0}equals(e){if(e.type===this.type){if(this.expr.length!==e.expr.length)return!1;for(let s=0,i=this.expr.length;s<i;s++)if(!this.expr[s].equals(e.expr[s]))return!1;return!0}return!1}substituteConstants(){const e=hp(this.expr);return e===this.expr?this:Wn.create(e,this.c,!1)}evaluate(e){for(let s=0,i=this.expr.length;s<i;s++)if(!this.expr[s].evaluate(e))return!1;return!0}static d(e,s,i){const n=[];let r=!1;for(const o of e)if(o){if(o.type===1){r=!0;continue}if(o.type===0)return It.INSTANCE;if(o.type===6){n.push(...o.expr);continue}n.push(o)}if(n.length===0&&r)return zt.INSTANCE;if(n.length!==0){if(n.length===1)return n[0];n.sort(fr);for(let o=1;o<n.length;o++)n[o-1].equals(n[o])&&(n.splice(o,1),o--);if(n.length===1)return n[0];for(;n.length>1;){const o=n[n.length-1];if(o.type!==9)break;n.pop();const a=n.pop(),c=n.length===0,l=vl.create(o.expr.map(h=>Wn.create([h,a],null,i)),null,c);l&&(n.push(l),n.sort(fr))}if(n.length===1)return n[0];if(i){for(let o=0;o<n.length;o++)for(let a=o+1;a<n.length;a++)if(n[o].negate().equals(n[a]))return It.INSTANCE;if(n.length===1)return n[0]}return new Wn(n,s)}}serialize(){return this.expr.map(e=>e.serialize()).join(" && ")}keys(){const e=[];for(const s of this.expr)e.push(...s.keys());return e}map(e){return new Wn(this.expr.map(s=>s.map(e)),null)}negate(){if(!this.c){const e=[];for(const s of this.expr)e.push(s.negate());this.c=vl.create(e,this,!0)}return this.c}},vl=class en{static create(e,s,i){return en.d(e,s,i)}constructor(e,s){this.expr=e,this.c=s,this.type=9}cmp(e){if(e.type!==this.type)return this.type-e.type;if(this.expr.length<e.expr.length)return-1;if(this.expr.length>e.expr.length)return 1;for(let s=0,i=this.expr.length;s<i;s++){const n=fr(this.expr[s],e.expr[s]);if(n!==0)return n}return 0}equals(e){if(e.type===this.type){if(this.expr.length!==e.expr.length)return!1;for(let s=0,i=this.expr.length;s<i;s++)if(!this.expr[s].equals(e.expr[s]))return!1;return!0}return!1}substituteConstants(){const e=hp(this.expr);return e===this.expr?this:en.create(e,this.c,!1)}evaluate(e){for(let s=0,i=this.expr.length;s<i;s++)if(this.expr[s].evaluate(e))return!0;return!1}static d(e,s,i){let n=[],r=!1;if(e){for(let o=0,a=e.length;o<a;o++){const c=e[o];if(c){if(c.type===0){r=!0;continue}if(c.type===1)return zt.INSTANCE;if(c.type===9){n=n.concat(c.expr);continue}n.push(c)}}if(n.length===0&&r)return It.INSTANCE;n.sort(fr)}if(n.length!==0){if(n.length===1)return n[0];for(let o=1;o<n.length;o++)n[o-1].equals(n[o])&&(n.splice(o,1),o--);if(n.length===1)return n[0];if(i){for(let o=0;o<n.length;o++)for(let a=o+1;a<n.length;a++)if(n[o].negate().equals(n[a]))return zt.INSTANCE;if(n.length===1)return n[0]}return new en(n,s)}}serialize(){return this.expr.map(e=>e.serialize()).join(" || ")}keys(){const e=[];for(const s of this.expr)e.push(...s.keys());return e}map(e){return new en(this.expr.map(s=>s.map(e)),null)}negate(){if(!this.c){const e=[];for(const s of this.expr)e.push(s.negate());for(;e.length>1;){const s=e.shift(),i=e.shift(),n=[];for(const r of dp(s))for(const o of dp(i))n.push(up.create([r,o],null,!1));e.unshift(en.create(n,null,!1))}this.c=en.create(e,this,!0)}return this.c}},Yb=class Ec extends dr{static{this.d=[]}static all(){return Ec.d.values()}constructor(e,s,i){super(e,null),this.f=s,typeof i=="object"?Ec.d.push({...i,key:e}):i!==!0&&Ec.d.push({key:e,description:i,type:s!=null?typeof s:void 0})}bindTo(e){return e.createKey(this.key,this.f)}getValue(e){return e.getContextKeyValue(this.key)}toNegated(){return this.negate()}isEqualTo(e){return ul.create(this.key,e)}notEqualsTo(e){return fl.create(this.key,e)}greater(e){return jo.create(this.key,e)}},KS=W("contextKeyService");function fp(t,e){return t<e?-1:t>e?1:0}function Mi(t,e,s,i){return t<s?-1:t>s?1:e<i?-1:e>i?1:0}function dp(t){return t.type===9?t.expr:[t]}var Q=W("logService"),gr=W("loggerService");function e2(t){return fo(t)}var ie;(function(t){t[t.Off=0]="Off",t[t.Trace=1]="Trace",t[t.Debug=2]="Debug",t[t.Info=3]="Info",t[t.Warning=4]="Warning",t[t.Error=5]="Error"})(ie||(ie={}));var wl=ie.Info;function t2(t,e){return t!==ie.Off&&t<=e}function $n(t,e=!1){let s="";for(let i=0;i<t.length;i++){let n=t[i];if(n instanceof Error&&(n=Xt(n,e)),typeof n=="object")try{n=JSON.stringify(n)}catch{}s+=(i>0?" ":"")+n}return s}var mr=class extends j{constructor(){super(...arguments),this.b=wl,this.c=this.D(new R)}get onDidChangeLogLevel(){return this.c.event}setLevel(t){this.b!==t&&(this.b=t,this.c.fire(this.b))}getLevel(){return this.b}f(t){return t2(this.b,t)}g(t){return this.B.isDisposed?!1:this.f(t)}},s2=class extends mr{constructor(t){super(),this.h=t}f(t){return this.h||super.f(t)}trace(t,...e){this.g(ie.Trace)&&this.m(ie.Trace,$n([t,...e],!0))}debug(t,...e){this.g(ie.Debug)&&this.m(ie.Debug,$n([t,...e]))}info(t,...e){this.g(ie.Info)&&this.m(ie.Info,$n([t,...e]))}warn(t,...e){this.g(ie.Warning)&&this.m(ie.Warning,$n([t,...e]))}error(t,...e){if(this.g(ie.Error))if(t instanceof Error){const s=Array.prototype.slice.call(arguments);s[0]=t.stack,this.m(ie.Error,$n(s))}else this.m(ie.Error,$n([t,...e]))}flush(){}},i2=class extends mr{constructor(t=wl,e=!0){super(),this.h=e,this.setLevel(t)}trace(t,...e){this.g(ie.Trace)&&(this.h?console.log("%cTRACE","color: #888",t,...e):console.log(t,...e))}debug(t,...e){this.g(ie.Debug)&&(this.h?console.log("%cDEBUG","background: #eee; color: #888",t,...e):console.log(t,...e))}info(t,...e){this.g(ie.Info)&&(this.h?console.log("%c INFO","color: #33f",t,...e):console.log(t,...e))}warn(t,...e){this.g(ie.Warning)&&(this.h?console.warn("%c WARN","color: #993",t,...e):console.log(t,...e))}error(t,...e){this.g(ie.Error)&&(this.h?console.error("%c  ERR","color: #f33",t,...e):console.error(t,...e))}flush(){}},n2=class extends mr{constructor(t,e=wl){super(),this.h=t,this.setLevel(e)}trace(t,...e){this.g(ie.Trace)&&this.h.log(ie.Trace,[this.j(t),...e])}debug(t,...e){this.g(ie.Debug)&&this.h.log(ie.Debug,[this.j(t),...e])}info(t,...e){this.g(ie.Info)&&this.h.log(ie.Info,[this.j(t),...e])}warn(t,...e){this.g(ie.Warning)&&this.h.log(ie.Warning,[this.j(t),...e])}error(t,...e){this.g(ie.Error)&&this.h.log(ie.Error,[this.j(t),...e])}j(t){return typeof t=="string"?t:Xt(t,this.g(ie.Trace))}flush(){}},r2=class extends mr{constructor(t){super(),this.h=t,t.length&&this.setLevel(t[0].getLevel())}setLevel(t){for(const e of this.h)e.setLevel(t);super.setLevel(t)}trace(t,...e){for(const s of this.h)s.trace(t,...e)}debug(t,...e){for(const s of this.h)s.debug(t,...e)}info(t,...e){for(const s of this.h)s.info(t,...e)}warn(t,...e){for(const s of this.h)s.warn(t,...e)}error(t,...e){for(const s of this.h)s.error(t,...e)}flush(){for(const t of this.h)t.flush()}dispose(){for(const t of this.h)t.dispose();super.dispose()}},o2=class extends j{constructor(t,e,s){if(super(),this.j=t,this.m=e,this.b=new ht,this.f=this.D(new R),this.onDidChangeLoggers=this.f.event,this.g=this.D(new R),this.onDidChangeLogLevel=this.g.event,this.h=this.D(new R),this.onDidChangeVisibility=this.h.event,s)for(const i of s)this.b.set(i.resource,{logger:void 0,info:i})}n(t){return de(t)?[...this.b.values()].find(e=>e.info.id===t):this.b.get(t)}getLogger(t){return this.n(t)?.logger}createLogger(t,e){const s=this.q(t),i=de(t)?t:e?.id??En(s.toString()).toString(16);let n=this.b.get(s)?.logger;const r=e?.logLevel==="always"?ie.Trace:e?.logLevel;n||(n=this.s(s,r??this.getLogLevel(s)??this.j,{...e,id:i}));const o={logger:n,info:{resource:s,id:i,logLevel:r,name:e?.name,hidden:e?.hidden,group:e?.group,extensionId:e?.extensionId,when:e?.when}};return this.registerLogger(o.info),this.b.set(s,o),n}q(t){return de(t)?V(this.m,`${t.replace(/[\\/:\*\?"<>\|]/g,"")}.log`):t}setLogLevel(t,e){if(k.isUri(t)){const s=t,i=e,n=this.b.get(s);n&&i!==n.info.logLevel&&(n.info.logLevel=i===this.j?void 0:i,n.logger?.setLevel(i),this.b.set(n.info.resource,n),this.g.fire([s,i]))}else{this.j=t;for(const[s,i]of this.b.entries())this.b.get(s)?.info.logLevel===void 0&&i.logger?.setLevel(this.j);this.g.fire(this.j)}}setVisibility(t,e){const s=this.n(t);s&&e!==!s.info.hidden&&(s.info.hidden=!e,this.b.set(s.info.resource,s),this.h.fire([s.info.resource,e]))}getLogLevel(t){let e;return t&&(e=this.b.get(t)?.info.logLevel),e??this.j}registerLogger(t){const e=this.b.get(t.resource);e?e.info.hidden!==t.hidden&&this.setVisibility(t.resource,!t.hidden):(this.b.set(t.resource,{info:t,logger:void 0}),this.f.fire({added:[t],removed:[]}))}deregisterLogger(t){const e=this.q(t),s=this.b.get(e);s&&(s.logger&&s.logger.dispose(),this.b.delete(e),this.f.fire({added:[],removed:[s.info]}))}*getRegisteredLoggers(){for(const t of this.b.values())yield t.info}getRegisteredLogger(t){return this.b.get(t)?.info}dispose(){this.b.forEach(t=>t.logger?.dispose()),this.b.clear(),super.dispose()}},a2=class{constructor(){this.onDidChangeLogLevel=new R().event}setLevel(t){}getLevel(){return ie.Info}trace(t,...e){}debug(t,...e){}info(t,...e){}warn(t,...e){}error(t,...e){}critical(t,...e){}dispose(){}flush(){}},c2=class extends a2{};function Mo(t){switch(t){case ie.Trace:return"trace";case ie.Debug:return"debug";case ie.Info:return"info";case ie.Warning:return"warn";case ie.Error:return"error";case ie.Off:return"off"}}var QS=new Yb("logLevel",Mo(ie.Info)),ge=W("productService"),yl=class extends j{constructor(e,s,i){super(),this.b=i,this.a=s.quality!=="stable"?1e3*60*60*24*7:1e3*60*60*24*30*3,e&&this.D(new ps(()=>{this.c(e)},3e4)).schedule()}async c(e){this.b.trace("[code cache cleanup]: Starting to clean up old code cache folders.");try{const s=Date.now(),i=Qe(e),n=qt(e),r=await le.readdir(i);await Promise.all(r.map(async o=>{if(o===n)return;const a=J(i,o),c=await gb.stat(a);if(c.isDirectory()&&s-c.mtime.getTime()>this.a)return this.b.trace(`[code cache cleanup]: Removing code cache folder ${o}.`),le.rm(a)}))}catch(s){it(s)}}};yl=__decorate([__param(1,ge),__param(2,Q)],yl);import{promises as pp}from"fs";var ae=W("environmentService"),Vt=ae,bl=class extends j{constructor(e,s,i){super(),this.b=e,this.c=s,this.a=i.quality!=="stable"?1e3*60*60*24*7:1e3*60*60*24*30*3,this.b.isBuilt&&this.D(new ps(()=>{this.f()},4e4)).schedule()}async f(){this.c.trace("[language pack cache cleanup]: Starting to clean up unused language packs.");try{const e=Object.create(null),s=JSON.parse(await pp.readFile(J(this.b.userDataPath,"languagepacks.json"),"utf8"));for(const a of Object.keys(s)){const c=s[a];e[`${c.hash}.${a}`]=!0}const i=J(this.b.userDataPath,"clp");if(!await le.exists(i))return;const r=await le.readdir(i);for(const a of r){if(e[a]){this.c.trace(`[language pack cache cleanup]: Skipping folder ${a}. Language pack still in use.`);continue}this.c.trace(`[language pack cache cleanup]: Removing unused language pack: ${a}`),await le.rm(J(i,a))}const o=Date.now();for(const a of Object.keys(e)){const c=J(i,a),l=await le.readdir(c);for(const h of l){if(h==="tcf.json")continue;const u=J(c,h),f=await pp.stat(u);f.isDirectory()&&o-f.mtime.getTime()>this.a&&(this.c.trace(`[language pack cache cleanup]: Removing language pack cache folder: ${J(a,h)}`),await le.rm(u))}}}catch(e){it(e)}}};bl=__decorate([__param(0,Vt),__param(1,Q),__param(2,ge)],bl);var $s;(function(t){t.Extensions="Extensions",t.IntegratedTerminal="IntegratedTerminal",t.InteractiveSession="InteractiveSession",t.Telemetry="Telemetry",t.Update="Update"})($s||($s={}));var eE={[$s.Extensions]:{name:{key:"extensionsConfigurationTitle",value:w(145,null)}},[$s.IntegratedTerminal]:{name:{key:"terminalIntegratedConfigurationTitle",value:w(146,null)}},[$s.InteractiveSession]:{name:{key:"interactiveSessionConfigurationTitle",value:w(147,null)}},[$s.Telemetry]:{name:{key:"telemetryConfigurationTitle",value:w(148,null)}},[$s.Update]:{name:{key:"updateConfigurationTitle",value:w(149,null)}}},me=W("configurationService");function Sl(t){const e=t;return e&&typeof e=="object"&&(!e.overrideIdentifier||typeof e.overrideIdentifier=="string")&&(!e.resource||e.resource instanceof k)}function l2(t){const e=t;return e&&typeof e=="object"&&(!e.overrideIdentifiers||Array.isArray(e.overrideIdentifiers))&&!e.overrideIdentifier&&(!e.resource||e.resource instanceof k)}var gp;(function(t){t[t.APPLICATION=1]="APPLICATION",t[t.USER=2]="USER",t[t.USER_LOCAL=3]="USER_LOCAL",t[t.USER_REMOTE=4]="USER_REMOTE",t[t.WORKSPACE=5]="WORKSPACE",t[t.WORKSPACE_FOLDER=6]="WORKSPACE_FOLDER",t[t.DEFAULT=7]="DEFAULT",t[t.MEMORY=8]="MEMORY"})(gp||(gp={}));function h2(t){switch(t){case 1:return"APPLICATION";case 2:return"USER";case 3:return"USER_LOCAL";case 4:return"USER_REMOTE";case 5:return"WORKSPACE";case 6:return"WORKSPACE_FOLDER";case 7:return"DEFAULT";case 8:return"MEMORY"}}function El(t,e){const s=Object.create(null);for(const i in t)mp(s,i,t[i],e);return s}function mp(t,e,s,i){const n=e.split("."),r=n.pop();let o=t;for(let a=0;a<n.length;a++){const c=n[a];let l=o[c];switch(typeof l){case"undefined":l=o[c]=Object.create(null);break;case"object":if(l===null){i(`Ignoring ${e} as ${n.slice(0,a+1).join(".")} is null`);return}break;default:i(`Ignoring ${e} as ${n.slice(0,a+1).join(".")} is ${JSON.stringify(l)}`);return}o=l}if(typeof o=="object"&&o!==null)try{o[r]=s}catch{i(`Ignoring ${e} as ${n.join(".")} is ${JSON.stringify(o)}`)}else i(`Ignoring ${e} as ${n.join(".")} is ${JSON.stringify(o)}`)}function u2(t,e){const s=e.split(".");vp(t,s)}function vp(t,e){if(!t)return;const s=t,i=e.shift();if(e.length===0){delete s[i];return}if(Object.keys(s).indexOf(i)!==-1){const n=s[i];typeof n=="object"&&!Array.isArray(n)&&(vp(n,e),Object.keys(n).length===0&&delete s[i])}}function Uo(t,e,s){function i(o,a){let c=o;for(const l of a){if(typeof c!="object"||c===null)return;c=c[l]}return c}const n=e.split("."),r=i(t,n);return typeof r>"u"?s:r}function f2(t){return t.replace(/^\[/,"").replace(/]$/g,"").replace(/\]\[/g,", ")}function d2(t){let e=!1;const s=new Map,i=new Map;if(p2(t,h=>{if(t===h)return!0;const u=JSON.stringify(h);if(u.length<30)return!0;const f=s.get(u);if(!f){const p={schemas:[h]};return s.set(u,p),i.set(h,p),!0}return f.schemas.push(h),i.set(h,f),e=!0,!1}),s.clear(),!e)return JSON.stringify(t);let r="$defs";for(;t.hasOwnProperty(r);)r+="_";const o=[];function a(h){return JSON.stringify(h,(u,f)=>{if(f!==h){const p=i.get(f);if(p&&p.schemas.length>1)return p.id||(p.id=`_${o.length}`,o.push(p.schemas[0])),{$ref:`#/${r}/${p.id}`}}return f})}const c=a(t),l=[];for(let h=0;h<o.length;h++)l.push(`"_${h}":${a(o[h])}`);return l.length?`${c.substring(0,c.length-1)},"${r}":{${l.join(",")}}}`:c}function xn(t){return typeof t=="object"&&t!==null}function p2(t,e){if(!t||typeof t!="object")return;const s=(...c)=>{for(const l of c)xn(l)&&o.push(l)},i=(...c)=>{for(const l of c)if(xn(l))for(const h in l){const u=l[h];xn(u)&&o.push(u)}},n=(...c)=>{for(const l of c)if(Array.isArray(l))for(const h of l)xn(h)&&o.push(h)},r=c=>{if(Array.isArray(c))for(const l of c)xn(l)&&o.push(l);else xn(c)&&o.push(c)},o=[t];let a=o.pop();for(;a;)e(a)&&(s(a.additionalItems,a.additionalProperties,a.not,a.contains,a.propertyNames,a.if,a.then,a.else,a.unevaluatedItems,a.unevaluatedProperties),i(a.definitions,a.$defs,a.properties,a.patternProperties,a.dependencies,a.dependentSchemas),n(a.anyOf,a.allOf,a.oneOf,a.prefixItems),r(a.items)),a=o.pop()}var g2=class{constructor(){this.a=new Map}add(t,e){Nc(de(t)),Nc(Te(e)),Nc(!this.a.has(t),"There is already an extension with this id"),this.a.set(t,e)}knows(t){return this.a.has(t)}as(t){return this.a.get(t)||null}dispose(){this.a.forEach(t=>{jc(t.dispose)&&t.dispose()}),this.a.clear()}},At=new g2,$l={JSONContribution:"base.contributions.json"};function wp(t){return t.length>0&&t.charAt(t.length-1)==="#"?t.substring(0,t.length-1):t}var m2=class extends j{constructor(){super(...arguments),this.a={},this.b={},this.c=this.D(new R),this.onDidChangeSchema=this.c.event,this.f=this.D(new R),this.onDidChangeSchemaAssociations=this.f.event}registerSchema(t,e,s){const i=wp(t);this.a[i]=e,this.c.fire(t),s&&s.add(pe(()=>{delete this.a[i],this.c.fire(t)}))}registerSchemaAssociation(t,e){const s=wp(t);return this.b[s]||(this.b[s]=[]),this.b[s].includes(e)||(this.b[s].push(e),this.f.fire()),pe(()=>{const i=this.b[s];if(i){const n=i.indexOf(e);n!==-1&&(i.splice(n,1),i.length===0&&delete this.b[s],this.f.fire())}})}notifySchemaChanged(t){this.c.fire(t)}getSchemaContributions(){return{schemas:this.a}}getSchemaContent(t){const e=this.a[t];return e?d2(e):void 0}hasSchemaContent(t){return!!this.a[t]}getSchemaAssociations(){return this.b}},v2=new m2;At.add($l.JSONContribution,v2);var Bt,xl=globalThis.vscode;if(typeof xl<"u"&&typeof xl.context<"u"){const t=xl.context.configuration();if(t)Bt=t.product;else throw new Error("Sandbox: unable to resolve product configuration from preload script.")}else if(globalThis._VSCODE_PRODUCT_JSON&&globalThis._VSCODE_PACKAGE_JSON){if(Bt=globalThis._VSCODE_PRODUCT_JSON,je.VSCODE_DEV&&Object.assign(Bt,{nameShort:`${Bt.nameShort} Dev`,nameLong:`${Bt.nameLong} Dev`,dataFolderName:`${Bt.dataFolderName}-dev`,serverDataFolderName:Bt.serverDataFolderName?`${Bt.serverDataFolderName}-dev`:void 0}),!Bt.version){const t=globalThis._VSCODE_PACKAGE_JSON;Object.assign(Bt,{version:t.version})}}else Bt={},Object.keys(Bt).length===0&&Object.assign(Bt,{version:"1.104.0-dev",nameShort:"Code - OSS Dev",nameLong:"Code - OSS Dev",applicationName:"code-oss",dataFolderName:".vscode-oss",urlProtocol:"code-oss",reportIssueUrl:"https://github.com/microsoft/vscode/issues/new",licenseName:"MIT",licenseUrl:"https://github.com/microsoft/vscode/blob/main/LICENSE.txt",serverLicenseUrl:"https://github.com/microsoft/vscode/blob/main/LICENSE.txt"});var ms=Bt,yp;(function(t){t.Multiline="multilineText",t.Singleline="singlelineText"})(yp||(yp={}));var rs={Configuration:"base.contributions.configuration"},bp;(function(t){t[t.APPLICATION=1]="APPLICATION",t[t.MACHINE=2]="MACHINE",t[t.APPLICATION_MACHINE=3]="APPLICATION_MACHINE",t[t.WINDOW=4]="WINDOW",t[t.RESOURCE=5]="RESOURCE",t[t.LANGUAGE_OVERRIDABLE=6]="LANGUAGE_OVERRIDABLE",t[t.MACHINE_OVERRIDABLE=7]="MACHINE_OVERRIDABLE"})(bp||(bp={}));var vr={properties:{},patternProperties:{}},Fo={properties:{},patternProperties:{}},qo={properties:{},patternProperties:{}},_o={properties:{},patternProperties:{}},zo={properties:{},patternProperties:{}},Vo={properties:{},patternProperties:{}},wr={properties:{},patternProperties:{}},Ui="vscode://schemas/settings/resourceLanguage",Bo=At.as($l.JSONContribution),w2=class extends j{constructor(){super(),this.a=[],this.n=new Set,this.q=this.D(new R),this.onDidSchemaChange=this.q.event,this.r=this.D(new R),this.onDidUpdateConfiguration=this.r.event,this.b=new Map,this.c={id:"defaultOverrides",title:w(1839,null),properties:{}},this.f=[this.c],this.m={properties:{},patternProperties:{},additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0},this.g={},this.h=new Map,this.j={},Bo.registerSchema(Ui,this.m),this.N()}registerConfiguration(t,e=!0){return this.registerConfigurations([t],e),t}registerConfigurations(t,e=!0){const s=new Set;this.F(t,e,s),Bo.registerSchema(Ui,this.m),this.q.fire(),this.r.fire({properties:s})}deregisterConfigurations(t){const e=new Set;this.G(t,e),Bo.registerSchema(Ui,this.m),this.q.fire(),this.r.fire({properties:e})}updateConfigurations({add:t,remove:e}){const s=new Set;this.G(e,s),this.F(t,!1,s),Bo.registerSchema(Ui,this.m),this.q.fire(),this.r.fire({properties:s})}registerDefaultConfigurations(t){const e=new Set;this.s(t,e),this.q.fire(),this.r.fire({properties:e,defaultsOverrides:!0})}s(t,e){this.a.push(...t);const s=[];for(const{overrides:i,source:n}of t)for(const r in i){e.add(r);const o=this.b.get(r)??this.b.set(r,{configurationDefaultOverrides:[]}).get(r),a=i[r];if(o.configurationDefaultOverrides.push({value:a,source:n}),Ws.test(r)){const c=this.y(r,a,n,o.configurationDefaultOverrideValue);if(!c)continue;o.configurationDefaultOverrideValue=c,this.w(r,c,n),s.push(...yr(r))}else{const c=this.z(r,a,n,o.configurationDefaultOverrideValue);if(!c)continue;o.configurationDefaultOverrideValue=c;const l=this.g[r];l&&(this.O(r,l),this.J(r,l))}}this.C(s)}deregisterDefaultConfigurations(t){const e=new Set;this.u(t,e),this.q.fire(),this.r.fire({properties:e,defaultsOverrides:!0})}u(t,e){for(const s of t){const i=this.a.indexOf(s);i!==-1&&this.a.splice(i,1)}for(const{overrides:s,source:i}of t)for(const n in s){const r=this.b.get(n);if(!r)continue;const o=r.configurationDefaultOverrides.findIndex(a=>i?a.source?.id===i.id:a.value===s[n]);if(o!==-1){if(r.configurationDefaultOverrides.splice(o,1),r.configurationDefaultOverrides.length===0&&this.b.delete(n),Ws.test(n)){let a;for(const c of r.configurationDefaultOverrides)a=this.y(n,c.value,c.source,a);a&&!Cd(a.value)?(r.configurationDefaultOverrideValue=a,this.w(n,a,i)):(this.b.delete(n),delete this.g[n],delete this.c.properties[n])}else{let a;for(const l of r.configurationDefaultOverrides)a=this.z(n,l.value,l.source,a);r.configurationDefaultOverrideValue=a;const c=this.g[n];c&&(this.O(n,c),this.J(n,c))}e.add(n)}}this.M()}w(t,e,s){const i={section:{id:this.c.id,title:this.c.title,order:this.c.order,extensionInfo:this.c.extensionInfo},type:"object",default:e.value,description:w(1840,null,f2(t)),$ref:Ui,defaultDefaultValue:e.value,source:s,defaultValueSource:s};this.g[t]=i,this.c.properties[t]=i}y(t,e,s,i){const n=i?.value||{},r=i?.source??new Map;if(!(r instanceof Map)){console.error("objectConfigurationSources is not a Map");return}for(const o of Object.keys(e)){const a=e[o];if(Te(a)&&(ot(n[o])||Te(n[o]))){if(n[o]={...n[o]??{},...a},s)for(const l in a)r.set(`${o}.${l}`,s)}else n[o]=a,s?r.set(o,s):r.delete(o)}return{value:n,source:r}}z(t,e,s,i){const n=this.g[t],r=i?.value??n?.defaultDefaultValue;let o=s;if(Te(e)&&(n!==void 0&&n.type==="object"||n===void 0&&(ot(r)||Te(r)))){if(o=i?.source??new Map,!(o instanceof Map)){console.error("defaultValueSource is not a Map");return}for(const c in e)s&&o.set(`${t}.${c}`,s);e={...Te(r)?r:{},...e}}return{value:e,source:o}}deltaConfiguration(t){let e=!1;const s=new Set;t.removedDefaults&&(this.u(t.removedDefaults,s),e=!0),t.addedDefaults&&(this.s(t.addedDefaults,s),e=!0),t.removedConfigurations&&this.G(t.removedConfigurations,s),t.addedConfigurations&&this.F(t.addedConfigurations,!1,s),this.q.fire(),this.r.fire({properties:s,defaultsOverrides:e})}notifyConfigurationSchemaUpdated(...t){this.q.fire()}registerOverrideIdentifiers(t){this.C(t),this.q.fire()}C(t){for(const e of t)this.n.add(e);this.M()}F(t,e,s){t.forEach(i=>{this.H(i,e,i.extensionInfo,i.restrictedProperties,void 0,s),this.f.push(i),this.I(i)})}G(t,e){const s=i=>{if(i.properties)for(const n in i.properties){e.add(n);const r=this.g[n];r?.policy?.name&&this.h.delete(r.policy.name),delete this.g[n],this.L(n,i.properties[n])}i.allOf?.forEach(n=>s(n))};for(const i of t){s(i);const n=this.f.indexOf(i);n!==-1&&this.f.splice(n,1)}}H(t,e=!0,s,i,n=4,r){n=Et(t.scope)?n:t.scope;const o=t.properties;if(o)for(const c in o){const l=o[c];if(l.section={id:t.id,title:t.title,order:t.order,extensionInfo:t.extensionInfo},e&&S2(c,l,s?.id)){delete o[c];continue}l.source=s,l.defaultDefaultValue=o[c].default,this.O(c,l),Ws.test(c)?l.scope=void 0:(l.scope=Et(l.scope)?n:l.scope,l.restricted=Et(l.restricted)?!!i?.includes(c):l.restricted),l.experiment?l.tags?.some(f=>f.toLowerCase()==="onexp")||(l.tags=l.tags??[],l.tags.push("onExP")):l.tags?.some(f=>f.toLowerCase()==="onexp")&&(console.error(`Invalid tag 'onExP' found for property '${c}'. Please use 'experiment' property instead.`),l.experiment={mode:"startup"});const h=o[c].hasOwnProperty("included")&&!o[c].included,u=o[c].policy?.name;h?(this.j[c]=o[c],u&&(this.h.set(u,c),r.add(c)),delete o[c]):(r.add(c),u&&this.h.set(u,c),this.g[c]=o[c],!o[c].deprecationMessage&&o[c].markdownDeprecationMessage&&(o[c].deprecationMessage=o[c].markdownDeprecationMessage))}const a=t.allOf;if(a)for(const c of a)this.H(c,e,s,i,n,r)}getConfigurations(){return this.f}getConfigurationProperties(){return this.g}getPolicyConfigurations(){return this.h}getExcludedConfigurationProperties(){return this.j}getRegisteredDefaultConfigurations(){return[...this.a]}getConfigurationDefaultsOverrides(){const t=new Map;for(const[e,s]of this.b)s.configurationDefaultOverrideValue&&t.set(e,s.configurationDefaultOverrideValue);return t}I(t){const e=s=>{const i=s.properties;if(i)for(const r in i)this.J(r,i[r]);s.allOf?.forEach(e)};e(t)}J(t,e){switch(vr.properties[t]=e,e.scope){case 1:Fo.properties[t]=e;break;case 2:_o.properties[t]=e;break;case 3:qo.properties[t]=e;break;case 7:zo.properties[t]=e;break;case 4:Vo.properties[t]=e;break;case 5:wr.properties[t]=e;break;case 6:wr.properties[t]=e,this.m.properties[t]=e;break}}L(t,e){switch(delete vr.properties[t],e.scope){case 1:delete Fo.properties[t];break;case 2:delete _o.properties[t];break;case 3:delete qo.properties[t];break;case 7:delete zo.properties[t];break;case 4:delete Vo.properties[t];break;case 5:case 6:delete wr.properties[t],delete this.m.properties[t];break}}M(){for(const t of this.n.values()){const e=`[${t}]`,s={type:"object",description:w(1841,null),errorMessage:w(1842,null),$ref:Ui};this.O(e,s),vr.properties[e]=s,Fo.properties[e]=s,qo.properties[e]=s,_o.properties[e]=s,zo.properties[e]=s,Vo.properties[e]=s,wr.properties[e]=s}}N(){const t={type:"object",description:w(1843,null),errorMessage:w(1844,null),$ref:Ui};vr.patternProperties[oi]=t,Fo.patternProperties[oi]=t,qo.patternProperties[oi]=t,_o.patternProperties[oi]=t,zo.patternProperties[oi]=t,Vo.patternProperties[oi]=t,wr.patternProperties[oi]=t,this.q.fire()}O(t,e){const s=this.b.get(t)?.configurationDefaultOverrideValue;let i,n;s&&(!e.disallowConfigurationDefault||!s.source)&&(i=s.value,n=s.source),ot(i)&&(i=e.defaultDefaultValue,n=void 0),ot(i)&&(i=b2(e.type)),e.default=i,e.defaultValueSource=n}},Sp="\\[([^\\]]+)\\]",Ep=new RegExp(Sp,"g"),oi=`^(${Sp})+$`,Ws=new RegExp(oi);function yr(t){const e=[];if(Ws.test(t)){let s=Ep.exec(t);for(;s?.length;){const i=s[1].trim();i&&e.push(i),s=Ep.exec(t)}}return Dt(e)}function y2(t){return t.reduce((e,s)=>`${e}[${s}]`,"")}function b2(t){switch(Array.isArray(t)?t[0]:t){case"boolean":return!1;case"integer":case"number":return 0;case"string":return"";case"array":return[];case"object":return{};default:return null}}var Wo=new w2;At.add(rs.Configuration,Wo);function S2(t,e,s){return t.trim()?Ws.test(t)?w(1846,null,t):Wo.getConfigurationProperties()[t]!==void 0&&(!s||!$2.has(s.toLowerCase()))?w(1847,null,t):e.policy?.name&&Wo.getPolicyConfigurations().get(e.policy?.name)!==void 0?w(1848,null,t,e.policy?.name,Wo.getPolicyConfigurations().get(e.policy?.name)):null:w(1845,null)}function $p(t){const e={};for(const s of t){const i=s.properties;if(Te(i))for(const n in i)e[n]=i[n];s.allOf&&Object.assign(e,$p(s.allOf))}return e}function E2(t){switch(t){case"application":return 1;case"machine":return 2;case"resource":return 5;case"machine-overridable":return 7;case"language-overridable":return 6;default:return 4}}var $2=new Set(ms.defaultChatAgent?[ms.defaultChatAgent.extensionId,ms.defaultChatAgent.chatExtensionId].map(t=>t.toLowerCase()):[]),xp="^([a-z0-9A-Z][a-z0-9-A-Z]*)\\.([a-z0-9A-Z][a-z0-9-A-Z]*)$",kp=new RegExp(xp),x2="__web_extension",k2="skipWalkthrough",kl="skipPublisherTrust",Cl="extensionInstallSource",C2="dependecyOrPackExtensionInstall",R2="clientTargetPlatform",Cp;(function(t){t.COMMAND="command",t.SETTINGS_SYNC="settingsSync"})(Cp||(Cp={}));function Rp(t){switch(t){case"win32-x64":return"Windows 64 bit";case"win32-arm64":return"Windows ARM";case"linux-x64":return"Linux 64 bit";case"linux-arm64":return"Linux ARM 64";case"linux-armhf":return"Linux ARM";case"alpine-x64":return"Alpine Linux 64 bit";case"alpine-arm64":return"Alpine ARM 64";case"darwin-x64":return"Mac";case"darwin-arm64":return"Mac Silicon";case"web":return"Web";case"universal":return"universal";case"unknown":return"unknown";case"undefined":return"undefined"}}function D2(t){switch(t){case"win32-x64":return"win32-x64";case"win32-arm64":return"win32-arm64";case"linux-x64":return"linux-x64";case"linux-arm64":return"linux-arm64";case"linux-armhf":return"linux-armhf";case"alpine-x64":return"alpine-x64";case"alpine-arm64":return"alpine-arm64";case"darwin-x64":return"darwin-x64";case"darwin-arm64":return"darwin-arm64";case"web":return"web";case"universal":return"universal";default:return"unknown"}}function Dp(t,e){switch(t){case 3:return e==="x64"?"win32-x64":e==="arm64"?"win32-arm64":"unknown";case 2:return e==="x64"?"linux-x64":e==="arm64"?"linux-arm64":e==="arm"?"linux-armhf":"unknown";case"alpine":return e==="x64"?"alpine-x64":e==="arm64"?"alpine-arm64":"unknown";case 1:return e==="x64"?"darwin-x64":e==="arm64"?"darwin-arm64":"unknown";case 0:return"web"}}function br(t,e){return e==="web"&&!t.includes("web")}function Rl(t,e,s){return br(e,s)?!1:t==="undefined"||t==="universal"?!0:t==="unknown"?!1:t===s}function P2(t){const e=t;return!!e&&typeof e=="object"&&typeof e.id=="string"&&(!e.uuid||typeof e.uuid=="string")}var Pp;(function(t){t.NoneOrRelevance="NoneOrRelevance",t.LastUpdatedDate="LastUpdatedDate",t.Title="Title",t.PublisherName="PublisherName",t.InstallCount="InstallCount",t.PublishedDate="PublishedDate",t.AverageRating="AverageRating",t.WeightedRating="WeightedRating"})(Pp||(Pp={}));var Ip;(function(t){t[t.Default=0]="Default",t[t.Ascending=1]="Ascending",t[t.Descending=2]="Descending"})(Ip||(Ip={}));var Ap;(function(t){t.Category="Category",t.ExtensionId="ExtensionId",t.ExtensionName="ExtensionName",t.ExcludeWithFlags="ExcludeWithFlags",t.Featured="Featured",t.SearchText="SearchText",t.Tag="Tag",t.Target="Target"})(Ap||(Ap={}));var Lp;(function(t){t.Install="install",t.Uninstall="uninstall"})(Lp||(Lp={}));var Op;(function(t){t[t.None=1]="None",t[t.Install=2]="Install",t[t.Update=3]="Update",t[t.Migrate=4]="Migrate"})(Op||(Op={}));var xs=W("extensionGalleryService"),Np;(function(t){t.Timeout="Timeout",t.Cancelled="Cancelled",t.ClientError="ClientError",t.ServerError="ServerError",t.Failed="Failed",t.DownloadFailedWriting="DownloadFailedWriting",t.Offline="Offline"})(Np||(Np={}));var Hs=class extends Error{constructor(t,e){super(t),this.code=e,this.name=e}},Tp;(function(t){t.NotFound="NotFound",t.Unsupported="Unsupported",t.Deprecated="Deprecated",t.Malicious="Malicious",t.Incompatible="Incompatible",t.IncompatibleApi="IncompatibleApi",t.IncompatibleTargetPlatform="IncompatibleTargetPlatform",t.ReleaseVersionNotFound="ReleaseVersionNotFound",t.Invalid="Invalid",t.Download="Download",t.DownloadSignature="DownloadSignature",t.DownloadFailedWriting="DownloadFailedWriting",t.UpdateMetadata="UpdateMetadata",t.Extract="Extract",t.Scanning="Scanning",t.ScanningExtension="ScanningExtension",t.ReadRemoved="ReadRemoved",t.UnsetRemoved="UnsetRemoved",t.Delete="Delete",t.Rename="Rename",t.IntializeDefaultProfile="IntializeDefaultProfile",t.AddToProfile="AddToProfile",t.InstalledExtensionNotFound="InstalledExtensionNotFound",t.PostInstall="PostInstall",t.CorruptZip="CorruptZip",t.IncompleteZip="IncompleteZip",t.PackageNotSigned="PackageNotSigned",t.SignatureVerificationInternal="SignatureVerificationInternal",t.SignatureVerificationFailed="SignatureVerificationFailed",t.NotAllowed="NotAllowed",t.Gallery="Gallery",t.Cancelled="Cancelled",t.Unknown="Unknown",t.Internal="Internal"})(Tp||(Tp={}));var Ze;(function(t){t.NotSigned="NotSigned",t.Success="Success",t.RequiredArgumentMissing="RequiredArgumentMissing",t.InvalidArgument="InvalidArgument",t.PackageIsUnreadable="PackageIsUnreadable",t.UnhandledException="UnhandledException",t.SignatureManifestIsMissing="SignatureManifestIsMissing",t.SignatureManifestIsUnreadable="SignatureManifestIsUnreadable",t.SignatureIsMissing="SignatureIsMissing",t.SignatureIsUnreadable="SignatureIsUnreadable",t.CertificateIsUnreadable="CertificateIsUnreadable",t.SignatureArchiveIsUnreadable="SignatureArchiveIsUnreadable",t.FileAlreadyExists="FileAlreadyExists",t.SignatureArchiveIsInvalidZip="SignatureArchiveIsInvalidZip",t.SignatureArchiveHasSameSignatureFile="SignatureArchiveHasSameSignatureFile",t.PackageIntegrityCheckFailed="PackageIntegrityCheckFailed",t.SignatureIsInvalid="SignatureIsInvalid",t.SignatureManifestIsInvalid="SignatureManifestIsInvalid",t.SignatureIntegrityCheckFailed="SignatureIntegrityCheckFailed",t.EntryIsMissing="EntryIsMissing",t.EntryIsTampered="EntryIsTampered",t.Untrusted="Untrusted",t.CertificateRevoked="CertificateRevoked",t.SignatureIsNotValid="SignatureIsNotValid",t.UnknownError="UnknownError",t.PackageIsInvalidZip="PackageIsInvalidZip",t.SignatureArchiveHasTooManyEntries="SignatureArchiveHasTooManyEntries"})(Ze||(Ze={}));var Me=class extends Error{constructor(t,e){super(t),this.code=e,this.name=e}},Gs=W("extensionManagementService"),Dl="extensionsIdentifiers/disabled",jp=W("IGlobalExtensionEnablementService"),Mp=W("IExtensionTipsService"),Fi=W("IAllowedExtensionsService");async function Pl(t,e){let s;try{s=await e.resolve(t)}catch(i){if(i.fileOperationResult===1)return 0;throw i}return s.children?(await Promise.all(s.children.map(n=>Pl(n.resource,e)))).reduce((n,r)=>n+r,0):s.size??0}var tE=Pd(1998,"Extensions"),sE=Pd(1999,"Preferences"),Ho="extensions.allowed",I2="extensions.verifySignature",A2="extensions.requestTimeout";At.as(rs.Configuration).registerConfiguration({id:"extensions",order:30,title:w(1981,null),type:"object",properties:{[Ho]:{type:"object",markdownDescription:w(1982,null),default:"*",defaultSnippets:[{body:{},description:w(1983,null)},{body:{"*":!0},description:w(1984,null)}],scope:1,policy:{name:"AllowedExtensions",category:$s.Extensions,minimumVersion:"1.96",localization:{description:{key:"extensions.allowed.policy",value:w(1985,null)}}},additionalProperties:!1,patternProperties:{"([a-z0-9A-Z][a-z0-9-A-Z]*)\\.([a-z0-9A-Z][a-z0-9-A-Z]*)$":{anyOf:[{type:["boolean","string"],enum:[!0,!1,"stable"],description:w(1986,null),enumDescriptions:[w(1987,null),w(1988,null),w(1989,null)]},{type:"array",items:{type:"string"},description:w(1990,null)}]},"([a-z0-9A-Z][a-z0-9-A-Z]*)$":{type:["boolean","string"],enum:[!0,!1,"stable"],description:w(1991,null),enumDescriptions:[w(1992,null),w(1993,null),w(1994,null)]},"\\*":{type:"boolean",enum:[!0,!1],description:w(1995,null),enumDescriptions:[w(1996,null),w(1997,null)]}}}}});function L2(t,e){return t?e?.capabilities.signing?.allPrivateRepositorySigned===!0:e?.capabilities.signing?.allPublicRepositorySigned===!0}function O2(t){return t.tags.find(e=>e.startsWith("lp-"))?.split("lp-")[1]}var Il=W("languagePackService"),Al=class extends j{constructor(e){super(),this.c=e}async getAvailableLanguages(){const e=new fs;setTimeout(()=>e.cancel(),1e3);let s;try{s=await this.c.query({text:'category:"language packs"',pageSize:20},e.token)}catch{return[]}const n=s.firstPage.filter(r=>r.properties.localizedLanguages?.length&&r.tags.some(o=>o.startsWith("lp-"))).map(r=>{const o=r.properties.localizedLanguages?.[0],a=O2(r);return{...this.f(a,o,r),extensionId:r.identifier.id,galleryExtension:r}});return n.push(this.f("en","English")),n}f(e,s,i){const n=s??e;let r;if(n!==e&&(r=`(${e})`),e.toLowerCase()===Es.toLowerCase()&&(r??="",r+=w(2138,null)),i?.installCount){r??="";const o=i.installCount;let a;o>1e6?a=`${Math.floor(o/1e5)/10}M`:o>1e3?a=`${Math.floor(o/1e3)}K`:a=String(o),r+=` $(cloud-download) ${a}`}return{id:e,label:n,description:r}}};Al=__decorate([__param(0,xs)],Al);var Ll=class extends j{constructor(e){super(),this.a=e,this.b()}b(){this.a.update()}};Ll=__decorate([__param(0,Il)],Ll);var Ol=class extends j{constructor(e,s){super(),this.a=e,this.b=s,this.D(new ps(()=>{this.c()},10*1e3)).schedule()}async c(){this.b.trace("[logs cleanup]: Starting to clean up old logs.");try{const e=nr(this.a.logsHome),s=P1(this.a.logsHome.with({scheme:ne.file})).fsPath,r=(await le.readdir(s)).filter(a=>/^\d{8}T\d{6}$/.test(a)).sort().filter(a=>a!==e),o=r.slice(0,Math.max(0,r.length-9));o.length>0&&(this.b.trace(`[logs cleanup]: Removing log folders '${o.join(", ")}'`),await Promise.all(o.map(a=>le.rm(J(s,a)))))}catch(e){it(e)}}};Ol=__decorate([__param(0,ae),__param(1,Q)],Ol);var Up=class extends j{constructor(t,e,s){super(),this.a=t,this.b=e,this.c=s}async getItems(){const t={profile:this.b,workspace:this.c},e=await this.a.call("getItems",t);return new Map(e)}updateItems(t){const e={profile:this.b,workspace:this.c};return t.insert&&(e.insert=Array.from(t.insert.entries())),t.delete&&(e.delete=Array.from(t.delete.values())),this.a.call("updateItems",e)}optimize(){const t={profile:this.b,workspace:this.c};return this.a.call("optimize",t)}},Fp=class extends Up{constructor(t,e){super(t,e,void 0),this.f=this.D(new R),this.onDidChangeItemsExternal=this.f.event,this.g()}g(){this.D(this.a.listen("onDidChangeStorage",{profile:this.b})(t=>this.h(t)))}h(t){(Array.isArray(t.changed)||Array.isArray(t.deleted))&&this.f.fire({changed:t.changed?new Map(t.changed):void 0,deleted:t.deleted?new Set(t.deleted):void 0})}},qp=class extends Fp{constructor(t){super(t,void 0)}async close(){this.dispose()}},_p=class extends Fp{async close(){this.dispose()}},N2=class extends Up{constructor(t,e){super(t,void 0,e),this.onDidChangeItemsExternal=O.None}async close(){this.dispose()}},T2=class{constructor(t){this.a=t}isUsed(t){const e={payload:t,profile:void 0,workspace:void 0};return this.a.call("isUsed",e)}},j2=class{constructor(){this.b="",this.c=0}reset(t){return this.b=t,this.c=0,this}next(){return this.c+=1,this}hasNext(){return this.c<this.b.length-1}cmp(t){const e=t.charCodeAt(0),s=this.b.charCodeAt(this.c);return e-s}value(){return this.b[this.c]}},M2=class{constructor(t=!0){this.e=t}reset(t){return this.b=t,this.c=0,this.d=0,this.next()}hasNext(){return this.d<this.b.length}next(){this.c=this.d;let t=!0;for(;this.d<this.b.length;this.d++)if(this.b.charCodeAt(this.d)===46)if(t)this.c++;else break;else t=!1;return this}cmp(t){return this.e?Hc(t,this.b,0,t.length,this.c,this.d):un(t,this.b,0,t.length,this.c,this.d)}value(){return this.b.substring(this.c,this.d)}},zp=class{constructor(t=!0,e=!0){this.f=t,this.g=e}reset(t){this.d=0,this.e=0,this.b=t,this.c=t.length;for(let e=t.length-1;e>=0;e--,this.c--){const s=this.b.charCodeAt(e);if(!(s===47||this.f&&s===92))break}return this.next()}hasNext(){return this.e<this.c}next(){this.d=this.e;let t=!0;for(;this.e<this.c;this.e++){const e=this.b.charCodeAt(this.e);if(e===47||this.f&&e===92)if(t)this.d++;else break;else t=!1}return this}cmp(t){return this.g?Hc(t,this.b,0,t.length,this.d,this.e):un(t,this.b,0,t.length,this.d,this.e)}value(){return this.b.substring(this.d,this.e)}},Vp;(function(t){t[t.Scheme=1]="Scheme",t[t.Authority=2]="Authority",t[t.Path=3]="Path",t[t.Query=4]="Query",t[t.Fragment=5]="Fragment"})(Vp||(Vp={}));var U2=class{constructor(t,e){this.f=t,this.g=e,this.d=[],this.e=0}reset(t){return this.c=t,this.d=[],this.c.scheme&&this.d.push(1),this.c.authority&&this.d.push(2),this.c.path&&(this.b=new zp(!1,!this.f(t)),this.b.reset(t.path),this.b.value()&&this.d.push(3)),this.g(t)||(this.c.query&&this.d.push(4),this.c.fragment&&this.d.push(5)),this.e=0,this}next(){return this.d[this.e]===3&&this.b.hasNext()?this.b.next():this.e+=1,this}hasNext(){return this.d[this.e]===3&&this.b.hasNext()||this.e<this.d.length-1}cmp(t){if(this.d[this.e]===1)return $o(t,this.c.scheme);if(this.d[this.e]===2)return $o(t,this.c.authority);if(this.d[this.e]===3)return this.b.cmp(t);if(this.d[this.e]===4)return Eo(t,this.c.query);if(this.d[this.e]===5)return Eo(t,this.c.fragment);throw new Error}value(){if(this.d[this.e]===1)return this.c.scheme;if(this.d[this.e]===2)return this.c.authority;if(this.d[this.e]===3)return this.b.value();if(this.d[this.e]===4)return this.c.query;if(this.d[this.e]===5)return this.c.fragment;throw new Error}},qi=class ld{static{this.Val=Symbol("undefined_placeholder")}static wrap(e){return e===void 0?ld.Val:e}static unwrap(e){return e===ld.Val?void 0:e}},Go=class{constructor(){this.height=1,this.value=void 0,this.key=void 0,this.left=void 0,this.mid=void 0,this.right=void 0}isEmpty(){return!this.left&&!this.mid&&!this.right&&this.value===void 0}rotateLeft(){const t=this.right;return this.right=t.left,t.left=this,this.updateHeight(),t.updateHeight(),t}rotateRight(){const t=this.left;return this.left=t.right,t.right=this,this.updateHeight(),t.updateHeight(),t}updateHeight(){this.height=1+Math.max(this.heightLeft,this.heightRight)}balanceFactor(){return this.heightRight-this.heightLeft}get heightLeft(){return this.left?.height??0}get heightRight(){return this.right?.height??0}},Bp;(function(t){t[t.Left=-1]="Left",t[t.Mid=0]="Mid",t[t.Right=1]="Right"})(Bp||(Bp={}));var kn=class io{static forUris(e=()=>!1,s=()=>!1){return new io(new U2(e,s))}static forPaths(e=!1){return new io(new zp(void 0,!e))}static forStrings(){return new io(new j2)}static forConfigKeys(){return new io(new M2)}constructor(e){this.b=e}clear(){this.c=void 0}fill(e,s){if(s){const i=s.slice(0);xd(i);for(const n of i)this.set(n,e)}else{const i=e.slice(0);xd(i);for(const n of i)this.set(n[0],n[1])}}set(e,s){const i=this.b.reset(e);let n;this.c||(this.c=new Go,this.c.segment=i.value());const r=[];for(n=this.c;;){const a=i.cmp(n.segment);if(a>0)n.left||(n.left=new Go,n.left.segment=i.value()),r.push([-1,n]),n=n.left;else if(a<0)n.right||(n.right=new Go,n.right.segment=i.value()),r.push([1,n]),n=n.right;else if(i.hasNext())i.next(),n.mid||(n.mid=new Go,n.mid.segment=i.value()),r.push([0,n]),n=n.mid;else break}const o=qi.unwrap(n.value);n.value=qi.wrap(s),n.key=e;for(let a=r.length-1;a>=0;a--){const c=r[a][1];c.updateHeight();const l=c.balanceFactor();if(l<-1||l>1){const h=r[a][0],u=r[a+1][0];if(h===1&&u===1)r[a][1]=c.rotateLeft();else if(h===-1&&u===-1)r[a][1]=c.rotateRight();else if(h===1&&u===-1)c.right=r[a+1][1]=r[a+1][1].rotateRight(),r[a][1]=c.rotateLeft();else if(h===-1&&u===1)c.left=r[a+1][1]=r[a+1][1].rotateLeft(),r[a][1]=c.rotateRight();else throw new Error;if(a>0)switch(r[a-1][0]){case-1:r[a-1][1].left=r[a][1];break;case 1:r[a-1][1].right=r[a][1];break;case 0:r[a-1][1].mid=r[a][1];break}else this.c=r[0][1]}}return o}get(e){return qi.unwrap(this.d(e)?.value)}d(e){const s=this.b.reset(e);let i=this.c;for(;i;){const n=s.cmp(i.segment);if(n>0)i=i.left;else if(n<0)i=i.right;else if(s.hasNext())s.next(),i=i.mid;else break}return i}has(e){const s=this.d(e);return!(s?.value===void 0&&s?.mid===void 0)}delete(e){return this.e(e,!1)}deleteSuperstr(e){return this.e(e,!0)}e(e,s){const i=this.b.reset(e),n=[];let r=this.c;for(;r;){const o=i.cmp(r.segment);if(o>0)n.push([-1,r]),r=r.left;else if(o<0)n.push([1,r]),r=r.right;else if(i.hasNext())i.next(),n.push([0,r]),r=r.mid;else break}if(r){if(s?(r.left=void 0,r.mid=void 0,r.right=void 0,r.height=1):(r.key=void 0,r.value=void 0),!r.mid&&!r.value)if(r.left&&r.right){const o=[[1,r]],a=this.f(r.right,o);if(a.key){r.key=a.key,r.value=a.value,r.segment=a.segment;const c=a.right;if(o.length>1){const[h,u]=o[o.length-1];switch(h){case-1:u.left=c;break;case 0:Tc(!1);case 1:Tc(!1)}}else r.right=c;const l=this.g(o);if(n.length>0){const[h,u]=n[n.length-1];switch(h){case-1:u.left=l;break;case 0:u.mid=l;break;case 1:u.right=l;break}}else this.c=l}}else{const o=r.left??r.right;if(n.length>0){const[a,c]=n[n.length-1];switch(a){case-1:c.left=o;break;case 0:c.mid=o;break;case 1:c.right=o;break}}else this.c=o}this.c=this.g(n)??this.c}}f(e,s){for(;e.left;)s.push([-1,e]),e=e.left;return e}g(e){for(let s=e.length-1;s>=0;s--){const i=e[s][1];i.updateHeight();const n=i.balanceFactor();if(n>1?(i.right.balanceFactor()>=0||(i.right=i.right.rotateRight()),e[s][1]=i.rotateLeft()):n<-1&&(i.left.balanceFactor()<=0||(i.left=i.left.rotateLeft()),e[s][1]=i.rotateRight()),s>0)switch(e[s-1][0]){case-1:e[s-1][1].left=e[s][1];break;case 1:e[s-1][1].right=e[s][1];break;case 0:e[s-1][1].mid=e[s][1];break}else return e[0][1]}}findSubstr(e){const s=this.b.reset(e);let i=this.c,n;for(;i;){const r=s.cmp(i.segment);if(r>0)i=i.left;else if(r<0)i=i.right;else if(s.hasNext())s.next(),n=qi.unwrap(i.value)||n,i=i.mid;else break}return i&&qi.unwrap(i.value)||n}findSuperstr(e){return this.h(e,!1)}h(e,s){const i=this.b.reset(e);let n=this.c;for(;n;){const r=i.cmp(n.segment);if(r>0)n=n.left;else if(r<0)n=n.right;else if(i.hasNext())i.next(),n=n.mid;else return n.mid?this.j(n.mid):s?qi.unwrap(n.value):void 0}}hasElementOrSubtree(e){return this.h(e,!0)!==void 0}forEach(e){for(const[s,i]of this)e(i,s)}*[Symbol.iterator](){yield*this.j(this.c)}j(e){const s=[];return this.l(e,s),s[Symbol.iterator]()}l(e,s){e&&(e.left&&this.l(e.left,s),e.value!==void 0&&s.push([e.key,qi.unwrap(e.value)]),e.mid&&this.l(e.mid,s),e.right&&this.l(e.right,s))}_isBalanced(){const e=s=>{if(!s)return!0;const i=s.balanceFactor();return i<-1||i>1?!1:e(s.left)&&e(s.right)};return e(this.c)}},oE=W("contextService");function F2(t){const e=t;return typeof e?.id=="string"&&k.isUri(e.uri)}var q2={id:"ext-dev"};function _2(t){const e=t;return typeof e?.id=="string"&&k.isUri(e.configPath)}var Wp;(function(t){t[t.EMPTY=1]="EMPTY",t[t.FOLDER=2]="FOLDER",t[t.WORKSPACE=3]="WORKSPACE"})(Wp||(Wp={}));var Hp="code-workspace",aE=`.${Hp}`,cE=[{name:w(2760,null),extensions:[Hp]}];import"crypto";var z2=128/4,Gp;(function(t){t[t.Transfer=0]="Transfer",t[t.Notify=1]="Notify",t[t.Force=2]="Force"})(Gp||(Gp={}));var Jo=W("nativeHostService"),Ko=W("mainProcessService"),V2=class{constructor(t,e){this.a=t,this.b=e}getChannel(t){return this.a.getChannel(t,this.b)}registerChannel(t,e){this.a.registerChannel(t,e)}},Nl=class extends j{constructor(e,s,i,n){super(),this.a=e,this.b=s,this.c=i,this.f=n,this.D(new ps(()=>{this.g()},30*1e3)).schedule()}async g(){this.b.trace("[storage cleanup]: Starting to clean up workspace storage folders for unused empty workspaces.");try{const e=this.a.workspaceStorageHome.with({scheme:ne.file}).fsPath,s=await le.readdir(e),i=new T2(this.f.getChannel("storage"));await Promise.all(s.map(async n=>{const r=J(e,n);n.length===z2||n===q2.id||(await this.c.getWindows({includeAuxiliaryWindows:!1})).some(c=>c.workspace?.id===n)||await i.isUsed(r)||(this.b.trace(`[storage cleanup]: Deleting workspace storage folder ${n} as it seems to be an unused empty workspace.`),await le.rm(r))}))}catch(e){it(e)}}};Nl=__decorate([__param(0,Vt),__param(1,Q),__param(2,Jo),__param(3,Ko)],Nl);var Jp=W("checksumService");import{createHash as B2}from"crypto";var K=W("fileService");function Cn(t){return t.create===!0}var Wt;(function(t){t[t.Unknown=0]="Unknown",t[t.File=1]="File",t[t.Directory=2]="Directory",t[t.SymbolicLink=64]="SymbolicLink"})(Wt||(Wt={}));var Rn;(function(t){t[t.Readonly=1]="Readonly",t[t.Locked=2]="Locked"})(Rn||(Rn={}));var Kp;(function(t){t[t.UPDATED=2]="UPDATED",t[t.ADDED=4]="ADDED",t[t.DELETED=8]="DELETED"})(Kp||(Kp={}));var Qp;(function(t){t[t.None=0]="None",t[t.FileReadWrite=2]="FileReadWrite",t[t.FileOpenReadWriteClose=4]="FileOpenReadWriteClose",t[t.FileReadStream=16]="FileReadStream",t[t.FileFolderCopy=8]="FileFolderCopy",t[t.PathCaseSensitive=1024]="PathCaseSensitive",t[t.Readonly=2048]="Readonly",t[t.Trash=4096]="Trash",t[t.FileWriteUnlock=8192]="FileWriteUnlock",t[t.FileAtomicRead=16384]="FileAtomicRead",t[t.FileAtomicWrite=32768]="FileAtomicWrite",t[t.FileAtomicDelete=65536]="FileAtomicDelete",t[t.FileClone=131072]="FileClone",t[t.FileRealpath=262144]="FileRealpath"})(Qp||(Qp={}));function os(t){return!!(t.capabilities&2)}function Tl(t){return!!(t.capabilities&8)}function Xp(t){return!!(t.capabilities&131072)}function W2(t){return!!(t.capabilities&262144)}function ai(t){return!!(t.capabilities&4)}function jl(t){return!!(t.capabilities&16)}function Ml(t){return os(t)?!!(t.capabilities&16384):!1}function Zp(t){return os(t)?!!(t.capabilities&32768):!1}function H2(t){return!!(t.capabilities&65536)}var Y;(function(t){t.FileExists="EntryExists",t.FileNotFound="EntryNotFound",t.FileNotADirectory="EntryNotADirectory",t.FileIsADirectory="EntryIsADirectory",t.FileExceedsStorageQuota="EntryExceedsStorageQuota",t.FileTooLarge="EntryTooLarge",t.FileWriteLocked="EntryWriteLocked",t.NoPermissions="NoPermissions",t.Unavailable="Unavailable",t.Unknown="Unknown"})(Y||(Y={}));var Ul=class yw extends Error{static create(e,s){const i=new yw(e.toString(),s);return G2(i,s),i}constructor(e,s){super(e),this.code=s}};function ks(t,e){return Ul.create(t,e)}function _i(t){return t||ks(w(2085,null),Y.Unknown)}function G2(t,e){return t.name=e?`${e} (FileSystemError)`:"FileSystemError",t}function Qo(t){if(!t)return Y.Unknown;if(t instanceof Ul)return t.code;const e=/^(.+) \(FileSystemError\)$/.exec(t.name);if(!e)return Y.Unknown;switch(e[1]){case Y.FileExists:return Y.FileExists;case Y.FileIsADirectory:return Y.FileIsADirectory;case Y.FileNotADirectory:return Y.FileNotADirectory;case Y.FileNotFound:return Y.FileNotFound;case Y.FileTooLarge:return Y.FileTooLarge;case Y.FileWriteLocked:return Y.FileWriteLocked;case Y.NoPermissions:return Y.NoPermissions;case Y.Unavailable:return Y.Unavailable}return Y.Unknown}function Ue(t){if(t instanceof Ye)return t.fileOperationResult;switch(Qo(t)){case Y.FileNotFound:return 1;case Y.FileIsADirectory:return 0;case Y.FileNotADirectory:return 9;case Y.FileWriteLocked:return 5;case Y.NoPermissions:return 6;case Y.FileExists:return 4;case Y.FileTooLarge:return 7;default:return 10}}var Yp;(function(t){t[t.CREATE=0]="CREATE",t[t.DELETE=1]="DELETE",t[t.MOVE=2]="MOVE",t[t.COPY=3]="COPY",t[t.WRITE=4]="WRITE"})(Yp||(Yp={}));var Dn=class{constructor(t,e,s){this.resource=t,this.operation=e,this.target=s}isOperation(t){return this.operation===t}},eg;(function(t){t[t.UPDATED=0]="UPDATED",t[t.ADDED=1]="ADDED",t[t.DELETED=2]="DELETED"})(eg||(eg={}));var J2=class $c{static{this.a=null}constructor(e,s){this.c=s,this.b=void 0,this.d=new Ri(()=>{const i=kn.forUris(()=>this.c);return i.fill(this.rawAdded.map(n=>[n,!0])),i}),this.f=new Ri(()=>{const i=kn.forUris(()=>this.c);return i.fill(this.rawUpdated.map(n=>[n,!0])),i}),this.g=new Ri(()=>{const i=kn.forUris(()=>this.c);return i.fill(this.rawDeleted.map(n=>[n,!0])),i}),this.rawAdded=[],this.rawUpdated=[],this.rawDeleted=[];for(const i of e){switch(i.type){case 1:this.rawAdded.push(i.resource);break;case 0:this.rawUpdated.push(i.resource);break;case 2:this.rawDeleted.push(i.resource);break}this.b!==$c.a&&(typeof i.cId=="number"?this.b===void 0?this.b=i.cId:this.b!==i.cId&&(this.b=$c.a):this.b!==void 0&&(this.b=$c.a))}}contains(e,...s){return this.h(e,{includeChildren:!1},...s)}affects(e,...s){return this.h(e,{includeChildren:!0},...s)}h(e,s,...i){if(!e)return!1;const n=i.length>0;return!!((!n||i.includes(1))&&(this.d.value.get(e)||s.includeChildren&&this.d.value.findSuperstr(e))||(!n||i.includes(0))&&(this.f.value.get(e)||s.includeChildren&&this.f.value.findSuperstr(e))||(!n||i.includes(2))&&(this.g.value.findSubstr(e)||s.includeChildren&&this.g.value.findSuperstr(e)))}gotAdded(){return this.rawAdded.length>0}gotDeleted(){return this.rawDeleted.length>0}gotUpdated(){return this.rawUpdated.length>0}correlates(e){return this.b===e}hasCorrelation(){return typeof this.b=="number"}};function K2(t,e,s){return!t||!e||t===e||e.length>t.length?!1:(e.charAt(e.length-1)!==Pt&&(e+=Pt),s?Gc(t,e):t.indexOf(e)===0)}var Ye=class extends Error{constructor(t,e,s){super(t),this.fileOperationResult=e,this.options=s}},Fl=class extends Ye{constructor(t,e,s,i){super(t,e,i),this.fileOperationResult=e,this.size=s}},ql=class extends Ye{constructor(t,e,s){super(t,2,s),this.stat=e}},tg;(function(t){t[t.FILE_IS_DIRECTORY=0]="FILE_IS_DIRECTORY",t[t.FILE_NOT_FOUND=1]="FILE_NOT_FOUND",t[t.FILE_NOT_MODIFIED_SINCE=2]="FILE_NOT_MODIFIED_SINCE",t[t.FILE_MODIFIED_SINCE=3]="FILE_MODIFIED_SINCE",t[t.FILE_MOVE_CONFLICT=4]="FILE_MOVE_CONFLICT",t[t.FILE_WRITE_LOCKED=5]="FILE_WRITE_LOCKED",t[t.FILE_PERMISSION_DENIED=6]="FILE_PERMISSION_DENIED",t[t.FILE_TOO_LARGE=7]="FILE_TOO_LARGE",t[t.FILE_INVALID_PATH=8]="FILE_INVALID_PATH",t[t.FILE_NOT_DIRECTORY=9]="FILE_NOT_DIRECTORY",t[t.FILE_OTHER_ERROR=10]="FILE_OTHER_ERROR"})(tg||(tg={}));var sg;(function(t){t[t.FILE=0]="FILE",t[t.FOLDER=1]="FOLDER",t[t.ROOT_FOLDER=2]="ROOT_FOLDER"})(sg||(sg={}));var _l="";function ig(t){if(!(typeof t.size!="number"||typeof t.mtime!="number"))return t.mtime.toString(29)+t.size.toString(31)}var Sr=class Ot{static{this.KB=1024}static{this.MB=Ot.KB*Ot.KB}static{this.GB=Ot.MB*Ot.KB}static{this.TB=Ot.GB*Ot.KB}static formatSize(e){return fo(e)||(e=0),e<Ot.KB?w(2086,null,e.toFixed(0)):e<Ot.MB?w(2087,null,(e/Ot.KB).toFixed(2)):e<Ot.GB?w(2088,null,(e/Ot.MB).toFixed(2)):e<Ot.TB?w(2089,null,(e/Ot.GB).toFixed(2)):w(2090,null,(e/Ot.TB).toFixed(2))}},zl=class{constructor(e){this.a=e}async checksum(e){const s=(await this.a.readFileStream(e)).value;return new Promise((i,n)=>{const r=B2("sha256");Lo(s,{onData:o=>r.update(o.buffer),onError:o=>n(o),onEnd:()=>i(r.digest("base64").replace(/=+$/,""))})})}};zl=__decorate([__param(0,K)],zl);var ng;(function(t){t[t.None=0]="None",t[t.UnexpectedEndOfComment=1]="UnexpectedEndOfComment",t[t.UnexpectedEndOfString=2]="UnexpectedEndOfString",t[t.UnexpectedEndOfNumber=3]="UnexpectedEndOfNumber",t[t.InvalidUnicode=4]="InvalidUnicode",t[t.InvalidEscapeCharacter=5]="InvalidEscapeCharacter",t[t.InvalidCharacter=6]="InvalidCharacter"})(ng||(ng={}));var rg;(function(t){t[t.OpenBraceToken=1]="OpenBraceToken",t[t.CloseBraceToken=2]="CloseBraceToken",t[t.OpenBracketToken=3]="OpenBracketToken",t[t.CloseBracketToken=4]="CloseBracketToken",t[t.CommaToken=5]="CommaToken",t[t.ColonToken=6]="ColonToken",t[t.NullKeyword=7]="NullKeyword",t[t.TrueKeyword=8]="TrueKeyword",t[t.FalseKeyword=9]="FalseKeyword",t[t.StringLiteral=10]="StringLiteral",t[t.NumericLiteral=11]="NumericLiteral",t[t.LineCommentTrivia=12]="LineCommentTrivia",t[t.BlockCommentTrivia=13]="BlockCommentTrivia",t[t.LineBreakTrivia=14]="LineBreakTrivia",t[t.Trivia=15]="Trivia",t[t.Unknown=16]="Unknown",t[t.EOF=17]="EOF"})(rg||(rg={}));var og;(function(t){t[t.InvalidSymbol=1]="InvalidSymbol",t[t.InvalidNumberFormat=2]="InvalidNumberFormat",t[t.PropertyNameExpected=3]="PropertyNameExpected",t[t.ValueExpected=4]="ValueExpected",t[t.ColonExpected=5]="ColonExpected",t[t.CommaExpected=6]="CommaExpected",t[t.CloseBraceExpected=7]="CloseBraceExpected",t[t.CloseBracketExpected=8]="CloseBracketExpected",t[t.EndOfFileExpected=9]="EndOfFileExpected",t[t.InvalidCommentToken=10]="InvalidCommentToken",t[t.UnexpectedEndOfComment=11]="UnexpectedEndOfComment",t[t.UnexpectedEndOfString=12]="UnexpectedEndOfString",t[t.UnexpectedEndOfNumber=13]="UnexpectedEndOfNumber",t[t.InvalidUnicode=14]="InvalidUnicode",t[t.InvalidEscapeCharacter=15]="InvalidEscapeCharacter",t[t.InvalidCharacter=16]="InvalidCharacter"})(og||(og={}));var Er;(function(t){t.DEFAULT={allowTrailingComma:!0}})(Er||(Er={}));function ag(t,e=!1){let s=0;const i=t.length;let n="",r=0,o=16,a=0;function c(m){let v=0,b=0;for(;v<m;){const S=t.charCodeAt(s);if(S>=48&&S<=57)b=b*16+S-48;else if(S>=65&&S<=70)b=b*16+S-65+10;else if(S>=97&&S<=102)b=b*16+S-97+10;else break;s++,v++}return v<m&&(b=-1),b}function l(m){s=m,n="",r=0,o=16,a=0}function h(){const m=s;if(t.charCodeAt(s)===48)s++;else for(s++;s<t.length&&Pn(t.charCodeAt(s));)s++;if(s<t.length&&t.charCodeAt(s)===46)if(s++,s<t.length&&Pn(t.charCodeAt(s)))for(s++;s<t.length&&Pn(t.charCodeAt(s));)s++;else return a=3,t.substring(m,s);let v=s;if(s<t.length&&(t.charCodeAt(s)===69||t.charCodeAt(s)===101))if(s++,(s<t.length&&t.charCodeAt(s)===43||t.charCodeAt(s)===45)&&s++,s<t.length&&Pn(t.charCodeAt(s))){for(s++;s<t.length&&Pn(t.charCodeAt(s));)s++;v=s}else a=3;return t.substring(m,v)}function u(){let m="",v=s;for(;;){if(s>=i){m+=t.substring(v,s),a=2;break}const b=t.charCodeAt(s);if(b===34){m+=t.substring(v,s),s++;break}if(b===92){if(m+=t.substring(v,s),s++,s>=i){a=2;break}switch(t.charCodeAt(s++)){case 34:m+='"';break;case 92:m+="\\";break;case 47:m+="/";break;case 98:m+="\b";break;case 102:m+="\f";break;case 110:m+=`
`;break;case 114:m+="\r";break;case 116:m+="	";break;case 117:{const $=c(4);$>=0?m+=String.fromCharCode($):a=4;break}default:a=5}v=s;continue}if(b>=0&&b<=31)if(Xo(b)){m+=t.substring(v,s),a=2;break}else a=6;s++}return m}function f(){if(n="",a=0,r=s,s>=i)return r=i,o=17;let m=t.charCodeAt(s);if(Vl(m)){do s++,n+=String.fromCharCode(m),m=t.charCodeAt(s);while(Vl(m));return o=15}if(Xo(m))return s++,n+=String.fromCharCode(m),m===13&&t.charCodeAt(s)===10&&(s++,n+=`
`),o=14;switch(m){case 123:return s++,o=1;case 125:return s++,o=2;case 91:return s++,o=3;case 93:return s++,o=4;case 58:return s++,o=6;case 44:return s++,o=5;case 34:return s++,n=u(),o=10;case 47:{const v=s-1;if(t.charCodeAt(s+1)===47){for(s+=2;s<i&&!Xo(t.charCodeAt(s));)s++;return n=t.substring(v,s),o=12}if(t.charCodeAt(s+1)===42){s+=2;const b=i-1;let S=!1;for(;s<b;){if(t.charCodeAt(s)===42&&t.charCodeAt(s+1)===47){s+=2,S=!0;break}s++}return S||(s++,a=1),n=t.substring(v,s),o=13}return n+=String.fromCharCode(m),s++,o=16}case 45:if(n+=String.fromCharCode(m),s++,s===i||!Pn(t.charCodeAt(s)))return o=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return n+=h(),o=11;default:for(;s<i&&p(m);)s++,m=t.charCodeAt(s);if(r!==s){switch(n=t.substring(r,s),n){case"true":return o=8;case"false":return o=9;case"null":return o=7}return o=16}return n+=String.fromCharCode(m),s++,o=16}}function p(m){if(Vl(m)||Xo(m))return!1;switch(m){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function g(){let m;do m=f();while(m>=12&&m<=15);return m}return{setPosition:l,getPosition:()=>s,scan:e?g:f,getToken:()=>o,getTokenValue:()=>n,getTokenOffset:()=>r,getTokenLength:()=>s-r,getTokenError:()=>a}}function Vl(t){return t===32||t===9||t===11||t===12||t===160||t===5760||t>=8192&&t<=8203||t===8239||t===8287||t===12288||t===65279}function Xo(t){return t===10||t===13||t===8232||t===8233}function Pn(t){return t>=48&&t<=57}var cg;(function(t){t[t.nullCharacter=0]="nullCharacter",t[t.maxAsciiCharacter=127]="maxAsciiCharacter",t[t.lineFeed=10]="lineFeed",t[t.carriageReturn=13]="carriageReturn",t[t.lineSeparator=8232]="lineSeparator",t[t.paragraphSeparator=8233]="paragraphSeparator",t[t.nextLine=133]="nextLine",t[t.space=32]="space",t[t.nonBreakingSpace=160]="nonBreakingSpace",t[t.enQuad=8192]="enQuad",t[t.emQuad=8193]="emQuad",t[t.enSpace=8194]="enSpace",t[t.emSpace=8195]="emSpace",t[t.threePerEmSpace=8196]="threePerEmSpace",t[t.fourPerEmSpace=8197]="fourPerEmSpace",t[t.sixPerEmSpace=8198]="sixPerEmSpace",t[t.figureSpace=8199]="figureSpace",t[t.punctuationSpace=8200]="punctuationSpace",t[t.thinSpace=8201]="thinSpace",t[t.hairSpace=8202]="hairSpace",t[t.zeroWidthSpace=8203]="zeroWidthSpace",t[t.narrowNoBreakSpace=8239]="narrowNoBreakSpace",t[t.ideographicSpace=12288]="ideographicSpace",t[t.mathematicalSpace=8287]="mathematicalSpace",t[t.ogham=5760]="ogham",t[t._=95]="_",t[t.$=36]="$",t[t._0=48]="_0",t[t._1=49]="_1",t[t._2=50]="_2",t[t._3=51]="_3",t[t._4=52]="_4",t[t._5=53]="_5",t[t._6=54]="_6",t[t._7=55]="_7",t[t._8=56]="_8",t[t._9=57]="_9",t[t.a=97]="a",t[t.b=98]="b",t[t.c=99]="c",t[t.d=100]="d",t[t.e=101]="e",t[t.f=102]="f",t[t.g=103]="g",t[t.h=104]="h",t[t.i=105]="i",t[t.j=106]="j",t[t.k=107]="k",t[t.l=108]="l",t[t.m=109]="m",t[t.n=110]="n",t[t.o=111]="o",t[t.p=112]="p",t[t.q=113]="q",t[t.r=114]="r",t[t.s=115]="s",t[t.t=116]="t",t[t.u=117]="u",t[t.v=118]="v",t[t.w=119]="w",t[t.x=120]="x",t[t.y=121]="y",t[t.z=122]="z",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z",t[t.ampersand=38]="ampersand",t[t.asterisk=42]="asterisk",t[t.at=64]="at",t[t.backslash=92]="backslash",t[t.bar=124]="bar",t[t.caret=94]="caret",t[t.closeBrace=125]="closeBrace",t[t.closeBracket=93]="closeBracket",t[t.closeParen=41]="closeParen",t[t.colon=58]="colon",t[t.comma=44]="comma",t[t.dot=46]="dot",t[t.doubleQuote=34]="doubleQuote",t[t.equals=61]="equals",t[t.exclamation=33]="exclamation",t[t.greaterThan=62]="greaterThan",t[t.lessThan=60]="lessThan",t[t.minus=45]="minus",t[t.openBrace=123]="openBrace",t[t.openBracket=91]="openBracket",t[t.openParen=40]="openParen",t[t.percent=37]="percent",t[t.plus=43]="plus",t[t.question=63]="question",t[t.semicolon=59]="semicolon",t[t.singleQuote=39]="singleQuote",t[t.slash=47]="slash",t[t.tilde=126]="tilde",t[t.backspace=8]="backspace",t[t.formFeed=12]="formFeed",t[t.byteOrderMark=65279]="byteOrderMark",t[t.tab=9]="tab",t[t.verticalTab=11]="verticalTab"})(cg||(cg={}));function Be(t,e=[],s=Er.DEFAULT){let i=null,n=[];const r=[];function o(c){Array.isArray(n)?n.push(c):i!==null&&(n[i]=c)}return $r(t,{onObjectBegin:()=>{const c={};o(c),r.push(n),n=c,i=null},onObjectProperty:c=>{i=c},onObjectEnd:()=>{n=r.pop()},onArrayBegin:()=>{const c=[];o(c),r.push(n),n=c,i=null},onArrayEnd:()=>{n=r.pop()},onLiteralValue:o,onError:(c,l,h)=>{e.push({error:c,offset:l,length:h})}},s),n[0]}function Q2(t,e=[],s=Er.DEFAULT){let i={type:"array",offset:-1,length:-1,children:[],parent:void 0};function n(c){i.type==="property"&&(i.length=c-i.offset,i=i.parent)}function r(c){return i.children.push(c),c}$r(t,{onObjectBegin:c=>{i=r({type:"object",offset:c,length:-1,parent:i,children:[]})},onObjectProperty:(c,l,h)=>{i=r({type:"property",offset:l,length:-1,parent:i,children:[]}),i.children.push({type:"string",value:c,offset:l,length:h,parent:i})},onObjectEnd:(c,l)=>{i.length=c+l-i.offset,i=i.parent,n(c+l)},onArrayBegin:(c,l)=>{i=r({type:"array",offset:c,length:-1,parent:i,children:[]})},onArrayEnd:(c,l)=>{i.length=c+l-i.offset,i=i.parent,n(c+l)},onLiteralValue:(c,l,h)=>{r({type:In(c),offset:l,length:h,parent:i,value:c}),n(l+h)},onSeparator:(c,l,h)=>{i.type==="property"&&(c===":"?i.colonOffset=l:c===","&&n(l))},onError:(c,l,h)=>{e.push({error:c,offset:l,length:h})}},s);const a=i.children[0];return a&&delete a.parent,a}function lg(t,e){if(!t)return;let s=t;for(const i of e)if(typeof i=="string"){if(s.type!=="object"||!Array.isArray(s.children))return;let n=!1;for(const r of s.children)if(Array.isArray(r.children)&&r.children[0].value===i){s=r.children[1],n=!0;break}if(!n)return}else{const n=i;if(s.type!=="array"||n<0||!Array.isArray(s.children)||n>=s.children.length)return;s=s.children[n]}return s}function $r(t,e,s=Er.DEFAULT){const i=ag(t,!1);function n(C){return C?()=>C(i.getTokenOffset(),i.getTokenLength()):()=>!0}function r(C){return C?_=>C(_,i.getTokenOffset(),i.getTokenLength()):()=>!0}const o=n(e.onObjectBegin),a=r(e.onObjectProperty),c=n(e.onObjectEnd),l=n(e.onArrayBegin),h=n(e.onArrayEnd),u=r(e.onLiteralValue),f=r(e.onSeparator),p=n(e.onComment),g=r(e.onError),m=s&&s.disallowComments,v=s&&s.allowTrailingComma;function b(){for(;;){const C=i.scan();switch(i.getTokenError()){case 4:S(14);break;case 5:S(15);break;case 3:S(13);break;case 1:m||S(11);break;case 2:S(12);break;case 6:S(16);break}switch(C){case 12:case 13:m?S(10):p();break;case 16:S(1);break;case 15:case 14:break;default:return C}}}function S(C,_=[],q=[]){if(g(C),_.length+q.length>0){let T=i.getToken();for(;T!==17;){if(_.indexOf(T)!==-1){b();break}else if(q.indexOf(T)!==-1)break;T=b()}}}function $(C){const _=i.getTokenValue();return C?u(_):a(_),b(),!0}function F(){switch(i.getToken()){case 11:{let C=0;try{C=JSON.parse(i.getTokenValue()),typeof C!="number"&&(S(2),C=0)}catch{S(2)}u(C);break}case 7:u(null);break;case 8:u(!0);break;case 9:u(!1);break;default:return!1}return b(),!0}function B(){return i.getToken()!==10?(S(3,[],[2,5]),!1):($(!1),i.getToken()===6?(f(":"),b(),E()||S(4,[],[2,5])):S(5,[],[2,5]),!0)}function ve(){o(),b();let C=!1;for(;i.getToken()!==2&&i.getToken()!==17;){if(i.getToken()===5){if(C||S(4,[],[]),f(","),b(),i.getToken()===2&&v)break}else C&&S(6,[],[]);B()||S(4,[],[2,5]),C=!0}return c(),i.getToken()!==2?S(7,[2],[]):b(),!0}function N(){l(),b();let C=!1;for(;i.getToken()!==4&&i.getToken()!==17;){if(i.getToken()===5){if(C||S(4,[],[]),f(","),b(),i.getToken()===4&&v)break}else C&&S(6,[],[]);E()||S(4,[],[4,5]),C=!0}return h(),i.getToken()!==4?S(8,[4],[]):b(),!0}function E(){switch(i.getToken()){case 3:return N();case 1:return ve();case 10:return $(!0);default:return F()}}return b(),i.getToken()===17?s.allowEmptyContent?!0:(S(4,[],[]),!1):E()?(i.getToken()!==17&&S(9,[],[]),!0):(S(4,[],[]),!1)}function In(t){switch(typeof t){case"boolean":return"boolean";case"number":return"number";case"string":return"string";case"object":{if(t){if(Array.isArray(t))return"array"}else return"null";return"object"}default:return"null"}}function X2(t,e,s){let i,n,r,o,a;if(e){for(o=e.offset,a=o+e.length,r=o;r>0&&!Zo(t,r-1);)r--;let $=a;for(;$<t.length&&!Zo(t,$);)$++;n=t.substring(r,$),i=Z2(n,s)}else n=t,i=0,r=0,o=0,a=t.length;const c=hg(s,t);let l=!1,h=0,u;s.insertSpaces?u=Bl(" ",s.tabSize||4):u="	";const f=ag(n,!1);let p=!1;function g(){return c+Bl(u,i+h)}function m(){let $=f.scan();for(l=!1;$===15||$===14;)l=l||$===14,$=f.scan();return p=$===16||f.getTokenError()!==0,$}const v=[];function b($,F,B){!p&&F<a&&B>o&&t.substring(F,B)!==$&&v.push({offset:F,length:B-F,content:$})}let S=m();if(S!==17){const $=f.getTokenOffset()+r,F=Bl(u,i);b(F,r,$)}for(;S!==17;){let $=f.getTokenOffset()+f.getTokenLength()+r,F=m(),B="";for(;!l&&(F===12||F===13);){const N=f.getTokenOffset()+r;b(" ",$,N),$=f.getTokenOffset()+f.getTokenLength()+r,B=F===12?g():"",F=m()}if(F===2)S!==1&&(h--,B=g());else if(F===4)S!==3&&(h--,B=g());else{switch(S){case 3:case 1:h++,B=g();break;case 5:case 12:B=g();break;case 13:l?B=g():B=" ";break;case 6:B=" ";break;case 10:if(F===6){B="";break}case 7:case 8:case 9:case 11:case 2:case 4:F===12||F===13?B=" ":F!==5&&F!==17&&(p=!0);break;case 16:p=!0;break}l&&(F===12||F===13)&&(B=g())}const ve=f.getTokenOffset()+r;b(B,$,ve),S=F}return v}function xr(t,e){const s=JSON.stringify(t,void 0,e.insertSpaces?e.tabSize||4:"	");return e.eol!==void 0?s.replace(/\r\n|\r|\n/g,e.eol):s}function Bl(t,e){let s="";for(let i=0;i<e;i++)s+=t;return s}function Z2(t,e){let s=0,i=0;const n=e.tabSize||4;for(;s<t.length;){const r=t.charAt(s);if(r===" ")i++;else if(r==="	")i+=n;else break;s++}return Math.floor(i/n)}function hg(t,e){for(let s=0;s<e.length;s++){const i=e.charAt(s);if(i==="\r")return s+1<e.length&&e.charAt(s+1)===`
`?`\r
`:"\r";if(i===`
`)return`
`}return t&&t.eol||`
`}function Zo(t,e){return`\r
`.indexOf(t.charAt(e))!==-1}function Wl(t,e,s,i,n){const r=e.slice(),a=Q2(t,[]);let c,l;for(;r.length>0&&(l=r.pop(),c=lg(a,r),c===void 0&&s!==void 0);)typeof l=="string"?s={[l]:s}:s=[s];if(c)if(c.type==="object"&&typeof l=="string"&&Array.isArray(c.children)){const h=lg(c,[l]);if(h!==void 0)if(s===void 0){if(!h.parent)throw new Error("Malformed AST");const u=c.children.indexOf(h.parent);let f,p=h.parent.offset+h.parent.length;if(u>0){const g=c.children[u-1];f=g.offset+g.length}else f=c.offset+1,c.children.length>1&&(p=c.children[1].offset);return zi(t,{offset:f,length:p-f,content:""},i)}else return zi(t,{offset:h.offset,length:h.length,content:JSON.stringify(s)},i);else{if(s===void 0)return[];const u=`${JSON.stringify(l)}: ${JSON.stringify(s)}`,f=n?n(c.children.map(g=>g.children[0].value)):c.children.length;let p;if(f>0){const g=c.children[f-1];p={offset:g.offset+g.length,length:0,content:","+u}}else c.children.length===0?p={offset:c.offset+1,length:0,content:u}:p={offset:c.offset+1,length:0,content:u+","};return zi(t,p,i)}}else if(c.type==="array"&&typeof l=="number"&&Array.isArray(c.children))if(s!==void 0){const h=`${JSON.stringify(s)}`;let u;if(c.children.length===0||l===0)u={offset:c.offset+1,length:0,content:c.children.length===0?h:h+","};else{const f=l===-1||l>c.children.length?c.children.length:l,p=c.children[f-1];u={offset:p.offset+p.length,length:0,content:","+h}}return zi(t,u,i)}else{const h=l,u=c.children[h];let f;if(c.children.length===1)f={offset:c.offset+1,length:c.length-2,content:""};else if(c.children.length-1===h){const p=c.children[h-1],g=p.offset+p.length,m=c.offset+c.length;f={offset:g,length:m-2-g,content:""}}else f={offset:u.offset,length:c.children[h+1].offset-u.offset,content:""};return zi(t,f,i)}else throw new Error(`Can not add ${typeof l!="number"?"index":"property"} to parent of type ${c.type}`);else return s===void 0?[]:zi(t,{offset:a?a.offset:0,length:a?a.length:0,content:JSON.stringify(s)},i)}function zi(t,e,s){let i=Hl(t,e),n=e.offset,r=e.offset+e.content.length;if(e.length===0||e.content.length===0){for(;n>0&&!Zo(i,n-1);)n--;for(;r<i.length&&!Zo(i,r);)r++}const o=X2(i,{offset:n,length:r-n},s);for(let c=o.length-1;c>=0;c--){const l=o[c];i=Hl(i,l),n=Math.min(n,l.offset),r=Math.max(r,l.offset+l.length),r+=l.content.length-l.length}const a=t.length-(i.length-r)-n;return[{offset:n,length:a,content:i.substring(n,r)}]}function Hl(t,e){return t.substring(0,e.offset)+e.content+t.substring(e.offset+e.length)}function ug(t,e){const s=e.slice(0).sort((n,r)=>{const o=n.offset-r.offset;return o===0?n.length-r.length:o});let i=t.length;for(let n=s.length-1;n>=0;n--){const r=s[n];if(r.offset+r.length<=i)t=Hl(t,r);else throw new Error("Overlapping edit");i=r.offset}return t}function Ht(t){if(!t||typeof t!="object"||t instanceof RegExp)return t;const e=Array.isArray(t)?[]:{};return Object.entries(t).forEach(([s,i])=>{e[s]=i&&typeof i=="object"?Ht(i):i}),e}function Y2(t){if(!t||typeof t!="object")return t;const e=[t];for(;e.length>0;){const s=e.shift();Object.freeze(s);for(const i in s)if(fg.call(s,i)){const n=s[i];typeof n=="object"&&!Object.isFrozen(n)&&!Qw(n)&&e.push(n)}}return t}var fg=Object.prototype.hasOwnProperty;function Gl(t,e){return Jl(t,e,new Set)}function Jl(t,e,s){if(Et(t))return t;const i=e(t);if(typeof i<"u")return i;if(Array.isArray(t)){const n=[];for(const r of t)n.push(Jl(r,e,s));return n}if(Te(t)){if(s.has(t))throw new Error("Cannot clone recursive data-structure");s.add(t);const n={};for(const r in t)fg.call(t,r)&&(n[r]=Jl(t[r],e,s));return s.delete(t),n}return t}function Yo(t,e,s=!0){return Te(t)?(Te(e)&&Object.keys(e).forEach(i=>{i in t?s&&(Te(t[i])&&Te(e[i])?Yo(t[i],e[i],s):t[i]=e[i]):t[i]=e[i]}),t):e}function bt(t,e){if(t===e)return!0;if(t==null||e===null||e===void 0||typeof t!=typeof e||typeof t!="object"||Array.isArray(t)!==Array.isArray(e))return!1;let s,i;if(Array.isArray(t)){if(t.length!==e.length)return!1;for(s=0;s<t.length;s++)if(!bt(t[s],e[s]))return!1}else{const n=[];for(i in t)n.push(i);n.sort();const r=[];for(i in e)r.push(i);if(r.sort(),!bt(n,r))return!1;for(s=0;s<n.length;s++)if(!bt(t[n[s]],e[n[s]]))return!1}return!0}function dg(t){const e=new Set;return JSON.stringify(t,(s,i)=>{if(Te(i)||Array.isArray(i)){if(e.has(i))return"[Circular]";e.add(i)}return typeof i=="bigint"?`[BigInt ${i.toString()}]`:i})}function kr(t){return Object.isFrozen(t)?t:Y2(t)}var et=class yi{static createEmptyModel(e){return new yi({},[],[],void 0,e)}constructor(e,s,i,n,r){this.b=e,this.c=s,this.d=i,this.f=n,this.g=r,this.a=new Map}get rawConfiguration(){if(!this.h)if(this.f){const e=(Array.isArray(this.f)?this.f:[this.f]).map(s=>{if(s instanceof yi)return s;const i=new Kl("",this.g);return i.parseRaw(s),i.configurationModel});this.h=e.reduce((s,i)=>i===s?i:s.merge(i),e[0])}else this.h=this;return this.h}get contents(){return this.b}get overrides(){return this.d}get keys(){return this.c}get raw(){if(this.f&&!(Array.isArray(this.f)&&this.f.every(e=>e instanceof yi)))return this.f}isEmpty(){return this.c.length===0&&Object.keys(this.b).length===0&&this.d.length===0}getValue(e){return e?Uo(this.contents,e):this.contents}inspect(e,s){const i=this;return{get value(){return kr(i.rawConfiguration.getValue(e))},get override(){return s?kr(i.rawConfiguration.getOverrideValue(e,s)):void 0},get merged(){return kr(s?i.rawConfiguration.override(s).getValue(e):i.rawConfiguration.getValue(e))},get overrides(){const n=[];for(const{contents:r,identifiers:o,keys:a}of i.rawConfiguration.overrides){const c=new yi(r,a,[],void 0,i.g).getValue(e);c!==void 0&&n.push({identifiers:o,value:c})}return n.length?kr(n):void 0}}}getOverrideValue(e,s){const i=this.k(s);return i?e?Uo(i,e):i:void 0}getKeysForOverrideIdentifier(e){const s=[];for(const i of this.overrides)i.identifiers.includes(e)&&s.push(...i.keys);return Dt(s)}getAllOverrideIdentifiers(){const e=[];for(const s of this.overrides)e.push(...s.identifiers);return Dt(e)}override(e){let s=this.a.get(e);return s||(s=this.i(e),this.a.set(e,s)),s}merge(...e){const s=Ht(this.contents),i=Ht(this.overrides),n=[...this.keys],r=this.f?Array.isArray(this.f)?[...this.f]:[this.f]:[this];for(const o of e)if(r.push(...o.f?Array.isArray(o.f)?o.f:[o.f]:[o]),!o.isEmpty()){this.j(s,o.contents);for(const a of o.overrides){const[c]=i.filter(l=>jt(l.identifiers,a.identifiers));c?(this.j(c.contents,a.contents),c.keys.push(...a.keys),c.keys=Dt(c.keys)):i.push(Ht(a))}for(const a of o.keys)n.indexOf(a)===-1&&n.push(a)}return new yi(s,n,i,!r.length||r.every(o=>o instanceof yi)?void 0:r,this.g)}i(e){const s=this.k(e);if(!s||typeof s!="object"||!Object.keys(s).length)return this;const i={};for(const n of Dt([...Object.keys(this.contents),...Object.keys(s)])){let r=this.contents[n];const o=s[n];o&&(typeof r=="object"&&typeof o=="object"?(r=Ht(r),this.j(r,o)):r=o),i[n]=r}return new yi(i,this.keys,this.overrides,void 0,this.g)}j(e,s){for(const i of Object.keys(s)){if(i in e&&Te(e[i])&&Te(s[i])){this.j(e[i],s[i]);continue}e[i]=Ht(s[i])}}k(e){let s=null,i=null;const n=r=>{r&&(i?this.j(i,r):i=Ht(r))};for(const r of this.overrides)r.identifiers.length===1&&r.identifiers[0]===e?s=r.contents:r.identifiers.includes(e)&&n(r.contents);return n(s),i}toJSON(){return{contents:this.contents,overrides:this.overrides,keys:this.keys}}addValue(e,s){this.l(e,s,!0)}setValue(e,s){this.l(e,s,!1)}removeValue(e){const s=this.keys.indexOf(e);s!==-1&&(this.keys.splice(s,1),u2(this.contents,e),Ws.test(e)&&this.overrides.splice(this.overrides.findIndex(i=>jt(i.identifiers,yr(e))),1))}l(e,s,i){if(mp(this.contents,e,s,n=>this.g.error(n)),i=i||this.keys.indexOf(e)===-1,i&&this.keys.push(e),Ws.test(e)){const n=this.contents[e],r=yr(e),o={identifiers:r,keys:Object.keys(n),contents:El(n,c=>this.g.error(c))},a=this.overrides.findIndex(c=>jt(c.identifiers,r));a!==-1?this.overrides[a]=o:this.overrides.push(o)}}},Kl=class{constructor(t,e){this.f=t,this.g=e,this.a=null,this.b=null,this.c=[],this.d=[]}get configurationModel(){return this.b||et.createEmptyModel(this.g)}get restrictedConfigurations(){return this.c}get errors(){return this.d}parse(t,e){if(!Et(t)){const s=this.h(t);this.parseRaw(s,e)}}reparse(t){this.a&&this.parseRaw(this.a,t)}parseRaw(t,e){this.a=t;const{contents:s,keys:i,overrides:n,restricted:r,hasExcludedProperties:o}=this.i(t,e);this.b=new et(s,i,n,o?[t]:void 0,this.g),this.c=r||[]}h(t){let e={},s=null,i=[];const n=[],r=[];function o(c){Array.isArray(i)?i.push(c):s!==null&&(i[s]=c)}const a={onObjectBegin:()=>{const c={};o(c),n.push(i),i=c,s=null},onObjectProperty:c=>{s=c},onObjectEnd:()=>{i=n.pop()},onArrayBegin:()=>{const c=[];o(c),n.push(i),i=c,s=null},onArrayEnd:()=>{i=n.pop()},onLiteralValue:o,onError:(c,l,h)=>{r.push({error:c,offset:l,length:h})}};if(t)try{$r(t,a),e=i[0]||{}}catch(c){this.g.error(`Error while parsing settings file ${this.f}: ${c}`),this.d=[c]}return e}i(t,e){const s=At.as(rs.Configuration),i=s.getConfigurationProperties(),n=s.getExcludedConfigurationProperties(),r=this.j(t,i,n,!0,e);t=r.raw;const o=El(t,l=>this.g.error(`Conflict in settings file ${this.f}: ${l}`)),a=Object.keys(t),c=this.m(t,l=>this.g.error(`Conflict in settings file ${this.f}: ${l}`));return{contents:o,keys:a,overrides:c,restricted:r.restricted,hasExcludedProperties:r.hasExcludedProperties}}j(t,e,s,i,n){let r=!1;if(!n?.scopes&&!n?.skipRestricted&&!n?.skipUnregistered&&!n?.exclude?.length)return{raw:t,restricted:[],hasExcludedProperties:r};const o={},a=[];for(const c in t)if(Ws.test(c)&&i){const l=this.j(t[c],e,s,!1,n);o[c]=l.raw,r=r||l.hasExcludedProperties,a.push(...l.restricted)}else{const l=e[c];l?.restricted&&a.push(c),this.l(c,l,s,n)?o[c]=t[c]:r=!0}return{raw:o,restricted:a,hasExcludedProperties:r}}l(t,e,s,i){if(i.exclude?.includes(t))return!1;if(i.include?.includes(t))return!0;if(i.skipRestricted&&e?.restricted||i.skipUnregistered&&!e)return!1;const n=e??s[t],r=n?typeof n.scope<"u"?n.scope:4:void 0;return r===void 0||i.scopes===void 0?!0:i.scopes.includes(r)}m(t,e){const s=[];for(const i of Object.keys(t))if(Ws.test(i)){const n={},r=t[i];for(const o in r)n[o]=r[o];s.push({identifiers:yr(i),keys:Object.keys(n),contents:El(n,e)})}return s}},e5=class extends j{constructor(t,e,s,i,n){super(),this.c=t,this.f=e,this.g=i,this.h=n,this.b=this.D(new R),this.onDidChange=this.b.event,this.a=new Kl(this.c.toString(),n),this.D(this.g.watch(s.dirname(this.c))),this.D(this.g.watch(this.c)),this.D(O.any(O.filter(this.g.onDidFilesChange,r=>r.contains(this.c)),O.filter(this.g.onDidRunOperation,r=>(r.isOperation(0)||r.isOperation(3)||r.isOperation(1)||r.isOperation(4))&&s.isEqual(r.resource,t)))(()=>this.b.fire()))}async loadConfiguration(){try{const t=await this.g.readFile(this.c);return this.a.parse(t.value.toString()||"{}",this.f),this.a.configurationModel}catch{return et.createEmptyModel(this.h)}}reparse(t){return t&&(this.f=t),this.a.reparse(this.f),this.a.configurationModel}getRestrictedSettings(){return this.a.restrictedConfigurations}},t5=class{constructor(t,e,s,i,n,r,o,a,c,l,h,u,f){this.a=t,this.b=e,this.c=s,this.overrideIdentifiers=i,this.d=n,this.f=r,this.g=o,this.h=a,this.i=c,this.j=l,this.k=h,this.l=u,this.m=f}get value(){return kr(this.c)}n(t){return t?.value!==void 0||t?.override!==void 0||t?.overrides!==void 0?t:void 0}get q(){return this.p||(this.p=this.d.inspect(this.a,this.b.overrideIdentifier)),this.p}get defaultValue(){return this.q.merged}get default(){return this.n(this.q)}get s(){return this.r===void 0&&(this.r=this.f?this.f.inspect(this.a):null),this.r}get policyValue(){return this.s?.merged}get policy(){return this.s?.value!==void 0?{value:this.s.value}:void 0}get u(){return this.t===void 0&&(this.t=this.g?this.g.inspect(this.a):null),this.t}get applicationValue(){return this.u?.merged}get application(){return this.n(this.u)}get w(){return this.v||(this.v=this.h.inspect(this.a,this.b.overrideIdentifier)),this.v}get userValue(){return this.w.merged}get user(){return this.n(this.w)}get y(){return this.x||(this.x=this.i.inspect(this.a,this.b.overrideIdentifier)),this.x}get userLocalValue(){return this.y.merged}get userLocal(){return this.n(this.y)}get A(){return this.z||(this.z=this.j.inspect(this.a,this.b.overrideIdentifier)),this.z}get userRemoteValue(){return this.A.merged}get userRemote(){return this.n(this.A)}get D(){return this.B===void 0&&(this.B=this.k?this.k.inspect(this.a,this.b.overrideIdentifier):null),this.B}get workspaceValue(){return this.D?.merged}get workspace(){return this.n(this.D)}get F(){return this.E===void 0&&(this.E=this.l?this.l.inspect(this.a,this.b.overrideIdentifier):null),this.E}get workspaceFolderValue(){return this.F?.merged}get workspaceFolder(){return this.n(this.F)}get H(){return this.G===void 0&&(this.G=this.m.inspect(this.a,this.b.overrideIdentifier)),this.G}get memoryValue(){return this.H.merged}get memory(){return this.n(this.H)}},Ql=class bw{constructor(e,s,i,n,r,o,a,c,l,h){this.j=e,this.l=s,this.m=i,this.n=n,this.p=r,this.q=o,this.r=a,this.s=c,this.t=l,this.u=h,this.h=null,this.i=new ht,this.v=null}getValue(e,s,i){return this.w(e,s,i).getValue(e)}updateValue(e,s,i={}){let n;i.resource?(n=this.t.get(i.resource),n||(n=et.createEmptyModel(this.u),this.t.set(i.resource,n))):n=this.s,s===void 0?n.removeValue(e):n.setValue(e,s),i.resource||(this.h=null)}inspect(e,s,i){const n=this.w(e,s,i),r=this.A(s.resource,i),o=s.resource?this.t.get(s.resource)||this.s:this.s,a=new Set;for(const c of n.overrides)for(const l of c.identifiers)n.getOverrideValue(e,l)!==void 0&&a.add(l);return new t5(e,s,n.getValue(e),a.size?[...a]:void 0,this.j,this.l.isEmpty()?void 0:this.l,this.applicationConfiguration.isEmpty()?void 0:this.applicationConfiguration,this.userConfiguration,this.localUserConfiguration,this.remoteUserConfiguration,i?this.q:void 0,r||void 0,o)}keys(e){const s=this.A(void 0,e);return{default:this.j.keys.slice(0),policy:this.l.keys.slice(0),user:this.userConfiguration.keys.slice(0),workspace:this.q.keys.slice(0),workspaceFolder:s?s.keys.slice(0):[]}}updateDefaultConfiguration(e){this.j=e,this.h=null,this.i.clear()}updatePolicyConfiguration(e){this.l=e}updateApplicationConfiguration(e){this.m=e,this.h=null,this.i.clear()}updateLocalUserConfiguration(e){this.n=e,this.v=null,this.h=null,this.i.clear()}updateRemoteUserConfiguration(e){this.p=e,this.v=null,this.h=null,this.i.clear()}updateWorkspaceConfiguration(e){this.q=e,this.h=null,this.i.clear()}updateFolderConfiguration(e,s){this.r.set(e,s),this.i.delete(e)}deleteFolderConfiguration(e){this.folderConfigurations.delete(e),this.i.delete(e)}compareAndUpdateDefaultConfiguration(e,s){const i=[];if(!s){const{added:n,updated:r,removed:o}=ci(this.j,e);s=[...n,...r,...o]}for(const n of s)for(const r of yr(n)){const o=this.j.getKeysForOverrideIdentifier(r),a=e.getKeysForOverrideIdentifier(r),c=[...a.filter(l=>o.indexOf(l)===-1),...o.filter(l=>a.indexOf(l)===-1),...o.filter(l=>!bt(this.j.override(r).getValue(l),e.override(r).getValue(l)))];i.push([r,c])}return this.updateDefaultConfiguration(e),{keys:s,overrides:i}}compareAndUpdatePolicyConfiguration(e){const{added:s,updated:i,removed:n}=ci(this.l,e),r=[...s,...i,...n];return r.length&&this.updatePolicyConfiguration(e),{keys:r,overrides:[]}}compareAndUpdateApplicationConfiguration(e){const{added:s,updated:i,removed:n,overrides:r}=ci(this.applicationConfiguration,e),o=[...s,...i,...n];return o.length&&this.updateApplicationConfiguration(e),{keys:o,overrides:r}}compareAndUpdateLocalUserConfiguration(e){const{added:s,updated:i,removed:n,overrides:r}=ci(this.localUserConfiguration,e),o=[...s,...i,...n];return o.length&&this.updateLocalUserConfiguration(e),{keys:o,overrides:r}}compareAndUpdateRemoteUserConfiguration(e){const{added:s,updated:i,removed:n,overrides:r}=ci(this.remoteUserConfiguration,e),o=[...s,...i,...n];return o.length&&this.updateRemoteUserConfiguration(e),{keys:o,overrides:r}}compareAndUpdateWorkspaceConfiguration(e){const{added:s,updated:i,removed:n,overrides:r}=ci(this.workspaceConfiguration,e),o=[...s,...i,...n];return o.length&&this.updateWorkspaceConfiguration(e),{keys:o,overrides:r}}compareAndUpdateFolderConfiguration(e,s){const i=this.folderConfigurations.get(e),{added:n,updated:r,removed:o,overrides:a}=ci(i,s),c=[...n,...r,...o];return(c.length||!i)&&this.updateFolderConfiguration(e,s),{keys:c,overrides:a}}compareAndDeleteFolderConfiguration(e){const s=this.folderConfigurations.get(e);if(!s)throw new Error("Unknown folder");this.deleteFolderConfiguration(e);const{added:i,updated:n,removed:r,overrides:o}=ci(s,void 0);return{keys:[...i,...n,...r],overrides:o}}get defaults(){return this.j}get applicationConfiguration(){return this.m}get userConfiguration(){if(!this.v)if(this.p.isEmpty())this.v=this.n;else{const e=this.n.merge(this.p);this.v=new et(e.contents,e.keys,e.overrides,void 0,this.u)}return this.v}get localUserConfiguration(){return this.n}get remoteUserConfiguration(){return this.p}get workspaceConfiguration(){return this.q}get folderConfigurations(){return this.r}w(e,s,i){let n=this.x(s,i);if(s.overrideIdentifier&&(n=n.override(s.overrideIdentifier)),!this.l.isEmpty()&&this.l.getValue(e)!==void 0){n=n.merge();for(const r of this.l.keys)n.setValue(r,this.l.getValue(r))}return n}x({resource:e},s){let i=this.y();if(s&&e){const n=s.getFolder(e);n&&(i=this.z(n.uri)||i);const r=this.t.get(e);r&&(i=i.merge(r))}return i}y(){return this.h||(this.h=this.j.merge(this.applicationConfiguration,this.userConfiguration,this.q,this.s)),this.h}z(e){let s=this.i.get(e);if(!s){const i=this.y(),n=this.r.get(e);n?(s=i.merge(n),this.i.set(e,s)):s=i}return s}A(e,s){if(s&&e){const i=s.getFolder(e);if(i)return this.r.get(i.uri)}}toData(){return{defaults:{contents:this.j.contents,overrides:this.j.overrides,keys:this.j.keys},policy:{contents:this.l.contents,overrides:this.l.overrides,keys:this.l.keys},application:{contents:this.applicationConfiguration.contents,overrides:this.applicationConfiguration.overrides,keys:this.applicationConfiguration.keys,raw:Array.isArray(this.applicationConfiguration.raw)?void 0:this.applicationConfiguration.raw},userLocal:{contents:this.localUserConfiguration.contents,overrides:this.localUserConfiguration.overrides,keys:this.localUserConfiguration.keys,raw:Array.isArray(this.localUserConfiguration.raw)?void 0:this.localUserConfiguration.raw},userRemote:{contents:this.remoteUserConfiguration.contents,overrides:this.remoteUserConfiguration.overrides,keys:this.remoteUserConfiguration.keys,raw:Array.isArray(this.remoteUserConfiguration.raw)?void 0:this.remoteUserConfiguration.raw},workspace:{contents:this.q.contents,overrides:this.q.overrides,keys:this.q.keys},folders:[...this.r.keys()].reduce((e,s)=>{const{contents:i,overrides:n,keys:r}=this.r.get(s);return e.push([s,{contents:i,overrides:n,keys:r}]),e},[])}}allKeys(){const e=new Set;return this.j.keys.forEach(s=>e.add(s)),this.userConfiguration.keys.forEach(s=>e.add(s)),this.q.keys.forEach(s=>e.add(s)),this.r.forEach(s=>s.keys.forEach(i=>e.add(i))),[...e.values()]}B(){const e=new Set;return this.j.getAllOverrideIdentifiers().forEach(s=>e.add(s)),this.userConfiguration.getAllOverrideIdentifiers().forEach(s=>e.add(s)),this.q.getAllOverrideIdentifiers().forEach(s=>e.add(s)),this.r.forEach(s=>s.getAllOverrideIdentifiers().forEach(i=>e.add(i))),[...e.values()]}D(e){const s=new Set;return this.j.getKeysForOverrideIdentifier(e).forEach(i=>s.add(i)),this.userConfiguration.getKeysForOverrideIdentifier(e).forEach(i=>s.add(i)),this.q.getKeysForOverrideIdentifier(e).forEach(i=>s.add(i)),this.r.forEach(i=>i.getKeysForOverrideIdentifier(e).forEach(n=>s.add(n))),[...s.values()]}static parse(e,s){const i=this.E(e.defaults,s),n=this.E(e.policy,s),r=this.E(e.application,s),o=this.E(e.userLocal,s),a=this.E(e.userRemote,s),c=this.E(e.workspace,s),l=e.folders.reduce((h,u)=>(h.set(k.revive(u[0]),this.E(u[1],s)),h),new ht);return new bw(i,n,r,o,a,c,l,et.createEmptyModel(s),new ht,s)}static E(e,s){return new et(e.contents,e.keys,e.overrides,e.raw,s)}},s5=class{constructor(t,e,s,i,n){this.change=t,this.f=e,this.g=s,this.h=i,this.i=n,this.a=`
`,this.b=this.a.charCodeAt(0),this.c=46,this.affectedKeys=new Set,this.j=void 0;for(const r of t.keys)this.affectedKeys.add(r);for(const[,r]of t.overrides)for(const o of r)this.affectedKeys.add(o);this.d=this.a;for(const r of this.affectedKeys)this.d+=r+this.a}get previousConfiguration(){return!this.j&&this.f&&(this.j=Ql.parse(this.f.data,this.i)),this.j}affectsConfiguration(t,e){const s=this.a+t,i=this.d.indexOf(s);if(i<0)return!1;const n=i+s.length;if(n>=this.d.length)return!1;const r=this.d.charCodeAt(n);if(r!==this.b&&r!==this.c)return!1;if(e){const o=this.previousConfiguration?this.previousConfiguration.getValue(t,e,this.f?.workspace):void 0,a=this.g.getValue(t,e,this.h);return!bt(o,a)}return!0}};function ci(t,e){const{added:s,removed:i,updated:n}=pg(e?.rawConfiguration,t?.rawConfiguration),r=[],o=t?.getAllOverrideIdentifiers()||[],a=e?.getAllOverrideIdentifiers()||[];if(e){const c=a.filter(l=>!o.includes(l));for(const l of c)r.push([l,e.getKeysForOverrideIdentifier(l)])}if(t){const c=o.filter(l=>!a.includes(l));for(const l of c)r.push([l,t.getKeysForOverrideIdentifier(l)])}if(e&&t){for(const c of o)if(a.includes(c)){const l=pg({contents:t.getOverrideValue(void 0,c)||{},keys:t.getKeysForOverrideIdentifier(c)},{contents:e.getOverrideValue(void 0,c)||{},keys:e.getKeysForOverrideIdentifier(c)});r.push([c,[...l.added,...l.removed,...l.updated]])}}return{added:s,removed:i,updated:n,overrides:r}}function pg(t,e){const s=t?e?t.keys.filter(r=>e.keys.indexOf(r)===-1):[...t.keys]:[],i=e?t?e.keys.filter(r=>t.keys.indexOf(r)===-1):[...e.keys]:[],n=[];if(t&&e){for(const r of e.keys)if(t.keys.indexOf(r)!==-1){const o=Uo(e.contents,r),a=Uo(t.contents,r);bt(o,a)||n.push(r)}}return{added:s,removed:i,updated:n}}var gg=W("policy"),i5=class extends j{constructor(){super(...arguments),this.policyDefinitions={},this.f=new Map,this.g=this.D(new R),this.onDidChange=this.g.event}async updatePolicyDefinitions(t){const e=Object.keys(this.policyDefinitions).length;return this.policyDefinitions={...t,...this.policyDefinitions},e!==Object.keys(this.policyDefinitions).length&&await this.h(this.policyDefinitions),on.reduce(this.f.entries(),(s,[i,n])=>({...s,[i]:n}),{})}getPolicyValue(t){return this.f.get(t)}serialize(){return on.reduce(Object.entries(this.policyDefinitions),(t,[e,s])=>({...t,[e]:{definition:s,value:this.f.get(e)}}),{})}},mg=class{constructor(){this.onDidChange=O.None,this.policyDefinitions={}}async updatePolicyDefinitions(){return{}}getPolicyValue(){}serialize(){}},n5=class extends j{get configurationModel(){return this.b}constructor(t){super(),this.c=t,this.a=this.D(new R),this.onDidChangeConfiguration=this.a.event,this.b=et.createEmptyModel(t)}async initialize(){return this.h(),this.D(At.as(rs.Configuration).onDidUpdateConfiguration(({properties:t,defaultsOverrides:e})=>this.f(Array.from(t),e))),this.configurationModel}reload(){return this.h(),this.configurationModel}f(t,e){this.j(t,At.as(rs.Configuration).getConfigurationProperties()),this.a.fire({defaults:this.configurationModel,properties:t})}g(){return{}}h(){this.b=et.createEmptyModel(this.c);const t=At.as(rs.Configuration).getConfigurationProperties();this.j(Object.keys(t),t)}j(t,e){const s=this.g();for(const i of t){const n=s[i],r=e[i];n!==void 0?this.b.setValue(i,n):r?this.b.setValue(i,Ht(r.default)):this.b.removeValue(i)}}},r5=class{constructor(){this.onDidChangeConfiguration=O.None,this.configurationModel=et.createEmptyModel(new c2)}async initialize(){return this.configurationModel}},Xl=class extends j{get configurationModel(){return this.c}constructor(e,s,i){super(),this.f=e,this.g=s,this.h=i,this.a=this.D(new R),this.onDidChangeConfiguration=this.a.event,this.c=et.createEmptyModel(this.h),this.b=At.as(rs.Configuration)}async initialize(){return this.h.trace("PolicyConfiguration#initialize"),this.n(await this.j(this.f.configurationModel.keys),!1),this.n(await this.j(Object.keys(this.b.getExcludedConfigurationProperties())),!1),this.D(this.g.onDidChange(e=>this.m(e))),this.D(this.f.onDidChangeConfiguration(async({properties:e})=>this.n(await this.j(e),!0))),this.c}async j(e){this.h.trace("PolicyConfiguration#updatePolicyDefinitions",e);const s={},i=[],n=this.b.getConfigurationProperties(),r=this.b.getExcludedConfigurationProperties();for(const o of e){const a=n[o]??r[o];if(!a){i.push(o);continue}if(a.policy){if(a.type!=="string"&&a.type!=="number"&&a.type!=="array"&&a.type!=="object"&&a.type!=="boolean"){this.h.warn(`Policy ${a.policy.name} has unsupported type ${a.type}`);continue}const{value:c}=a.policy;i.push(o),s[a.policy.name]={type:a.type==="number"?"number":a.type==="boolean"?"boolean":"string",value:c}}}return Cd(s)||await this.g.updatePolicyDefinitions(s),i}m(e){this.h.trace("PolicyConfiguration#onDidChangePolicies",e);const s=this.b.getPolicyConfigurations(),i=rn(e.map(n=>s.get(n)));this.n(i,!0)}n(e,s){this.h.trace("PolicyConfiguration#update",e);const i=this.b.getConfigurationProperties(),n=this.b.getExcludedConfigurationProperties(),r=[],o=this.c.isEmpty();for(const a of e){const c=i[a]??n[a],l=c?.policy?.name;if(l){let h=this.g.getPolicyValue(l);if(de(h)&&c.type!=="string")try{h=this.q(h)}catch(u){this.h.error(`Error parsing policy value ${l}:`,se(u));continue}(o?h!==void 0:!bt(this.c.getValue(a),h))&&r.push([a,h])}else this.c.getValue(a)!==void 0&&r.push([a,void 0])}if(r.length){this.h.trace("PolicyConfiguration#changed",r);const a=this.c;this.c=et.createEmptyModel(this.h);for(const c of a.keys)this.c.setValue(c,a.getValue(c));for(const[c,l]of r)l===void 0?this.c.removeValue(c):this.c.setValue(c,l);s&&this.a.fire(this.c)}}q(e){let s={},i=null,n=[];const r=[],o=[];function a(l){if(Array.isArray(n))n.push(l);else if(i!==null){if(n[i]!==void 0)throw new Error(`Duplicate property found: ${i}`);n[i]=l}}if(e&&($r(e,{onObjectBegin:()=>{const l={};a(l),r.push(n),n=l,i=null},onObjectProperty:l=>{i=l},onObjectEnd:()=>{n=r.pop()},onArrayBegin:()=>{const l=[];a(l),r.push(n),n=l,i=null},onArrayEnd:()=>{n=r.pop()},onLiteralValue:a,onError:(l,h,u)=>{o.push({error:l,offset:h,length:u})}}),s=n[0]||s),o.length>0)throw new Error(o.map(l=>se(l.error)).join(`
`));return s}};Xl=__decorate([__param(1,gg),__param(2,Q)],Xl);var o5=class extends j{constructor(t,e,s,i){super(),this.m=t,this.n=i,this.h=this.D(new R),this.onDidChangeConfiguration=this.h.event,this.b=this.D(new n5(i)),this.c=s instanceof mg?new r5:this.D(new Xl(this.b,s,i)),this.f=this.D(new e5(this.m,{},Zc,e,i)),this.a=new Ql(this.b.configurationModel,this.c.configurationModel,et.createEmptyModel(i),et.createEmptyModel(i),et.createEmptyModel(i),et.createEmptyModel(i),new ht,et.createEmptyModel(i),new ht,i),this.j=new a5(t,e,this),this.g=this.D(new ps(()=>this.reloadConfiguration(),50)),this.D(this.b.onDidChangeConfiguration(({defaults:n,properties:r})=>this.r(n,r))),this.D(this.c.onDidChangeConfiguration(n=>this.s(n))),this.D(this.f.onDidChange(()=>this.g.schedule()))}async initialize(){const[t,e,s]=await Promise.all([this.b.initialize(),this.c.initialize(),this.f.loadConfiguration()]);this.a=new Ql(t,e,et.createEmptyModel(this.n),s,et.createEmptyModel(this.n),et.createEmptyModel(this.n),new ht,et.createEmptyModel(this.n),new ht,this.n)}getConfigurationData(){return this.a.toData()}getValue(t,e){const s=typeof t=="string"?t:void 0,i=Sl(t)?t:Sl(e)?e:{};return this.a.getValue(s,i,void 0)}async updateValue(t,e,s,i,n){const r=l2(s)?s:Sl(s)?{resource:s.resource,overrideIdentifiers:s.overrideIdentifier?[s.overrideIdentifier]:void 0}:void 0,o=r?i:s;if(o!==void 0&&o!==3&&o!==2)throw new Error(`Unable to write ${t} to target ${o}.`);r?.overrideIdentifiers&&(r.overrideIdentifiers=Dt(r.overrideIdentifiers),r.overrideIdentifiers=r.overrideIdentifiers.length?r.overrideIdentifiers:void 0);const a=this.inspect(t,{resource:r?.resource,overrideIdentifier:r?.overrideIdentifiers?r.overrideIdentifiers[0]:void 0});if(a.policyValue!==void 0)throw new Error(`Unable to write ${t} because it is configured in system policy.`);if(bt(e,a.defaultValue)&&(e=void 0),r?.overrideIdentifiers?.length&&r.overrideIdentifiers.length>1){const l=r.overrideIdentifiers.sort(),h=this.a.localUserConfiguration.overrides.find(u=>jt([...u.identifiers].sort(),l));h&&(r.overrideIdentifiers=h.identifiers)}const c=r?.overrideIdentifiers?.length?[y2(r.overrideIdentifiers),t]:[t];await this.j.write(c,e),await this.reloadConfiguration()}inspect(t,e={}){return this.a.inspect(t,e,void 0)}keys(){return this.a.keys(void 0)}async reloadConfiguration(){const t=await this.f.loadConfiguration();this.q(t)}q(t){const e=this.a.toData(),s=this.a.compareAndUpdateLocalUserConfiguration(t);this.t(s,e,2)}r(t,e){const s=this.a.toData(),i=this.a.compareAndUpdateDefaultConfiguration(t,e);this.t(i,s,7)}s(t){const e=this.a.toData(),s=this.a.compareAndUpdatePolicyConfiguration(t);this.t(s,e,7)}t(t,e,s){const i=new s5(t,{data:e},this.a,void 0,this.n);i.source=s,this.h.fire(i)}},a5=class{constructor(t,e,s){this.b=t,this.c=e,this.d=s,this.a=new pn}write(t,e){return this.a.queue(()=>this.e(t,e))}async e(t,e){let s;try{s=(await this.c.readFile(this.b)).value.toString()}catch(r){if(r.fileOperationResult===1)s="{}";else throw r}const i=[];if(Be(s,i,{allowTrailingComma:!0,allowEmptyContent:!0}),i.length>0)throw new Error("Unable to write into the settings file. Please open the file to correct errors/warnings in the file and try again.");const n=this.f(s,t,e);s=ug(s,n),await this.c.writeFile(this.b,L.fromString(s))}f(t,e,s){const{tabSize:i,insertSpaces:n,eol:r}=this.h;if(!e.length){const o=JSON.stringify(s,null,n?" ".repeat(i):"	");return[{content:o,length:o.length,offset:0}]}return Wl(t,e,s,{tabSize:i,insertSpaces:n,eol:r})}get h(){if(!this.g){let t=ln===3||ln===2?`
`:`\r
`;const e=this.d.getValue("files.eol",{overrideIdentifier:"jsonc"});e&&typeof e=="string"&&e!=="auto"&&(t=e),this.g={eol:t,insertSpaces:!!this.d.getValue("editor.insertSpaces",{overrideIdentifier:"jsonc"}),tabSize:this.d.getValue("editor.tabSize",{overrideIdentifier:"jsonc"})}}return this.g}},c5="diagnosticsService",vg=W(c5);function wg(t){const e=t;return!!e?.hostName&&!!e?.errorMessage}import*as l5 from"fs";import*as Lt from"os";import{networkInterfaces as h5}from"os";var u5=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function f5(t){return u5.test(t)}var tt=function(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID.bind(crypto);const t=new Uint8Array(16),e=[];for(let s=0;s<256;s++)e.push(s.toString(16).padStart(2,"0"));return function(){crypto.getRandomValues(t),t[6]=t[6]&15|64,t[8]=t[8]&63|128;let i=0,n="";return n+=e[t[i++]],n+=e[t[i++]],n+=e[t[i++]],n+=e[t[i++]],n+="-",n+=e[t[i++]],n+=e[t[i++]],n+="-",n+=e[t[i++]],n+=e[t[i++]],n+="-",n+=e[t[i++]],n+=e[t[i++]],n+="-",n+=e[t[i++]],n+=e[t[i++]],n+=e[t[i++]],n+=e[t[i++]],n+=e[t[i++]],n+=e[t[i++]],n}}();import"os";var yg=new class{c(t){return this.a||(this.a=kn.forStrings(),this.a.set("00-50-56",!0),this.a.set("00-0C-29",!0),this.a.set("00-05-69",!0),this.a.set("00-03-FF",!0),this.a.set("00-1C-42",!0),this.a.set("00-16-3E",!0),this.a.set("08-00-27",!0),this.a.set("00:50:56",!0),this.a.set("00:0C:29",!0),this.a.set("00:05:69",!0),this.a.set("00:03:FF",!0),this.a.set("00:1C:42",!0),this.a.set("00:16:3E",!0),this.a.set("08:00:27",!0)),!!this.a.findSubstr(t)}value(){if(this.b===void 0){let t=0,e=0;const s=h5();for(const i in s){const n=s[i];if(n)for(const{mac:r,internal:o}of n)o||(e+=1,this.c(r.toUpperCase())&&(t+=1))}this.b=e>0?t/e:0}return this.b}};import{exec as ea}from"child_process";import{totalmem as d5}from"os";var p5=/[a-zA-Z-]+\.js\b/g;function bg(t){return new Promise((e,s)=>{let i;const n=new Map,r=d5();function o(l,h,u,f,p){const g=n.get(h);if(l===t||g){const m={name:a(u),cmd:u,pid:l,ppid:h,load:f,mem:Le?p:r*(p/100)};n.set(l,m),l===t&&(i=m),g&&(g.children||(g.children=[]),g.children.push(m),g.children.length>1&&(g.children=g.children.sort((v,b)=>v.pid-b.pid)))}}function a(l){const h=/--utility-sub-type=network/i,u=/--crashes-directory/i,f=/\\pipe\\winpty-control/i,p=/conhost\.exe.+--headless/i,g=/--type=([a-zA-Z-]+)/;if(u.exec(l))return"electron-crash-reporter";if(f.exec(l))return"winpty-agent";if(p.exec(l))return"conpty-agent";let m=g.exec(l);if(m&&m.length===2)return m[1]==="renderer"?"window":m[1]==="utility"?h.exec(l)?"utility-network-service":"utility-process":m[1]==="extensionHost"?"extension-host":m[1];if(l.indexOf("node ")<0&&l.indexOf("node.exe")<0){let v="";do m=p5.exec(l),m&&(v+=m+" ");while(m);if(v)return`electron-nodejs (${v.trim()})`}return l}if(process.platform==="win32"){const l=h=>h.indexOf("\\\\?\\")===0||h.indexOf("\\??\\")===0?h.substring(4):h.indexOf('"\\\\?\\')===0||h.indexOf('"\\??\\')===0?'"'+h.substring(5):h;import("@vscode/windows-process-tree").then(h=>{h.getProcessList(t,u=>{if(!u){s(new Error(`Root process ${t} not found`));return}h.getProcessCpuUsage(u,f=>{const p=new Map;f.forEach(g=>{const m=l(g.commandLine||"");p.set(g.pid,{name:a(m),cmd:m,pid:g.pid,ppid:g.ppid,load:g.cpu||0,mem:g.memory||0})}),i=p.get(t),i?(p.forEach(g=>{const m=p.get(g.ppid);m&&(m.children||(m.children=[]),m.children.push(g))}),p.forEach(g=>{g.children&&(g.children=g.children.sort((m,v)=>m.pid-v.pid))}),e(i)):s(new Error(`Root process ${t} not found`))})},h.ProcessDataFlag.CommandLine|h.ProcessDataFlag.Memory)})}else{let l=function(){let h=[i];const u=[];for(;h.length;){const p=h.shift();p&&(u.push(p.pid),p.children&&(h=h.concat(p.children)))}let f=JSON.stringify(ii.asFileUri("vs/base/node/cpuUsage.sh").fsPath);f+=" "+u.join(" "),ea(f,{},(p,g,m)=>{if(p||m)s(p||new Error(m.toString()));else{const v=g.toString().split(`
`);for(let b=0;b<u.length;b++){const S=n.get(u[b]);S.load=parseFloat(v[b])}if(!i){s(new Error(`Root process ${t} not found`));return}e(i)}})};var c=l;ea("which ps",{},(h,u,f)=>{if(h||f)if(process.platform!=="linux")s(h||new Error(f.toString()));else{const p=JSON.stringify(ii.asFileUri("vs/base/node/ps.sh").fsPath);ea(p,{},(g,m,v)=>{g||v?s(g||new Error(v.toString())):(Sg(m,o),l())})}else{const p=u.toString().trim();ea(`${p} -ax -o pid=,ppid=,pcpu=,pmem=,command=`,{maxBuffer:1e3*1024,env:{LC_NUMERIC:"en_US.UTF-8"}},(m,v,b)=>{m||b&&!b.includes("screen size is bogus")?s(m||new Error(b.toString())):(Sg(v,o),process.platform==="linux"?l():i?e(i):s(new Error(`Root process ${t} not found`)))})}})}})}function Sg(t,e){const s=/^\s*([0-9]+)\s+([0-9]+)\s+([0-9]+\.[0-9]+)\s+([0-9]+\.[0-9]+)\s+(.+)$/,i=t.toString().split(`
`);for(const n of i){const r=s.exec(n.trim());r&&r.length===6&&e(parseInt(r[1]),parseInt(r[2]),r[5],parseFloat(r[3]),parseFloat(r[4]))}}var ke=W("telemetryService"),Eg=W("customEndpointTelemetryService"),g5="telemetry",ta="telemetry.telemetryLevel",$g="telemetry.enableCrashReporter",Zl="telemetry.enableTelemetry",xg;(function(t){t[t.NONE=0]="NONE",t[t.CRASH=1]="CRASH",t[t.ERROR=2]="ERROR",t[t.USAGE=3]="USAGE"})(xg||(xg={}));var kg;(function(t){t.OFF="off",t.CRASH="crash",t.ERROR="error",t.ON="all"})(kg||(kg={}));var Cg=new Map;async function Yl(t,e){const s=`${t}::${e.join(":")}`,i=Cg.get(s);if(i)return i;const n=[{tag:"grunt.js",filePattern:/^gruntfile\.js$/i},{tag:"gulp.js",filePattern:/^gulpfile\.js$/i},{tag:"tsconfig.json",filePattern:/^tsconfig\.json$/i},{tag:"package.json",filePattern:/^package\.json$/i},{tag:"jsconfig.json",filePattern:/^jsconfig\.json$/i},{tag:"tslint.json",filePattern:/^tslint\.json$/i},{tag:"eslint.json",filePattern:/^eslint\.json$/i},{tag:"tasks.json",filePattern:/^tasks\.json$/i},{tag:"launch.json",filePattern:/^launch\.json$/i},{tag:"mcp.json",filePattern:/^mcp\.json$/i},{tag:"settings.json",filePattern:/^settings\.json$/i},{tag:"webpack.config.js",filePattern:/^webpack\.config\.js$/i},{tag:"project.json",filePattern:/^project\.json$/i},{tag:"makefile",filePattern:/^makefile$/i},{tag:"sln",filePattern:/^.+\.sln$/i},{tag:"csproj",filePattern:/^.+\.csproj$/i},{tag:"cmake",filePattern:/^.+\.cmake$/i},{tag:"github-actions",filePattern:/^.+\.ya?ml$/i,relativePathPattern:/^\.github(?:\/|\\)workflows$/i},{tag:"devcontainer.json",filePattern:/^devcontainer\.json$/i},{tag:"dockerfile",filePattern:/^(dockerfile|docker\-compose\.ya?ml)$/i},{tag:"cursorrules",filePattern:/^\.cursorrules$/i},{tag:"cursorrules-dir",filePattern:/\.mdc$/i,relativePathPattern:/^\.cursor[\/\\]rules$/i},{tag:"github-instructions-dir",filePattern:/\.instructions\.md$/i,relativePathPattern:/^\.github[\/\\]instructions$/i},{tag:"github-prompts-dir",filePattern:/\.prompt\.md$/i,relativePathPattern:/^\.github[\/\\]prompts$/i},{tag:"clinerules",filePattern:/^\.clinerules$/i},{tag:"clinerules-dir",filePattern:/\.md$/i,relativePathPattern:/^\.clinerules$/i},{tag:"agent.md",filePattern:/^agent\.md$/i},{tag:"agents.md",filePattern:/^agents\.md$/i},{tag:"claude.md",filePattern:/^claude\.md$/i},{tag:"gemini.md",filePattern:/^gemini\.md$/i},{tag:"copilot-instructions.md",filePattern:/^copilot\-instructions\.md$/i,relativePathPattern:/^\.github$/i}],r=new Map,o=new Map,a=2e4;function c(h,u,f,p){const g=u.substring(h.length+1);return Xe.withAsyncBody(async m=>{let v;p.readdirCount++;try{v=await le.readdir(u,{withFileTypes:!0})}catch{m();return}if(p.count>=a){p.count+=v.length,p.maxReached=!0,m();return}let b=v.length;if(b===0){m();return}let S=v;p.count+v.length>a&&(p.maxReached=!0,b=a-p.count,S=v.slice(0,b)),p.count+=v.length;for(const $ of S)if($.isDirectory()){if(f.includes($.name)||await c(h,J(u,$.name),f,p),--b===0){m();return}}else{const F=$.name.lastIndexOf(".");if(F>=0){const B=$.name.substring(F+1);B&&r.set(B,(r.get(B)??0)+1)}for(const B of n)B.relativePathPattern?.test(g)!==!1&&B.filePattern.test($.name)&&o.set(B.tag,(o.get(B.tag)??0)+1);if(--b===0){m();return}}})}const l=Xe.withAsyncBody(async h=>{const u={count:0,maxReached:!1,readdirCount:0},f=new hn(!0);await c(t,t,e,u);const p=await v5(t);h({configFiles:eh(o),fileTypes:eh(r),fileCount:u.count,maxFilesReached:u.maxReached,launchConfigFiles:p,totalScanTime:f.elapsed(),totalReaddirCount:u.readdirCount})});return Cg.set(s,l),l}function eh(t){return Array.from(t.entries(),([e,s])=>({name:e,count:s})).sort((e,s)=>s.count-e.count)}function m5(){const t={os:`${Lt.type()} ${Lt.arch()} ${Lt.release()}`,memory:`${(Lt.totalmem()/Sr.GB).toFixed(2)}GB (${(Lt.freemem()/Sr.GB).toFixed(2)}GB free)`,vmHint:`${Math.round(yg.value()*100)}%`},e=Lt.cpus();return e&&e.length>0&&(t.cpus=`${e[0].model} (${e.length} x ${e[0].speed})`),t}async function v5(t){try{const e=new Map,s=J(t,".vscode","launch.json"),i=await l5.promises.readFile(s),n=[],r=Be(i.toString(),n);if(n.length)return console.log(`Unable to parse ${s}`),[];if(In(r)==="object"&&r.configurations)for(const o of r.configurations){const a=o.type;a&&(e.has(a)?e.set(a,e.get(a)+1):e.set(a,1))}return eh(e)}catch{return[]}}var th=class{constructor(e,s){this.c=e,this.d=s}f(e){const s=[];return s.push(`OS Version:       ${e.os}`),s.push(`CPUs:             ${e.cpus}`),s.push(`Memory (System):  ${e.memory}`),s.push(`VM:               ${e.vmHint}`),s.join(`
`)}g(e){const s=[];s.push(`Version:          ${this.d.nameShort} ${this.d.version} (${this.d.commit||"Commit unknown"}, ${this.d.date||"Date unknown"})`),s.push(`OS Version:       ${Lt.type()} ${Lt.arch()} ${Lt.release()}`);const i=Lt.cpus();return i&&i.length>0&&s.push(`CPUs:             ${i[0].model} (${i.length} x ${i[0].speed})`),s.push(`Memory (System):  ${(Lt.totalmem()/Sr.GB).toFixed(2)}GB (${(Lt.freemem()/Sr.GB).toFixed(2)}GB free)`),Le||s.push(`Load (avg):       ${Lt.loadavg().map(n=>Math.round(n)).join(", ")}`),s.push(`VM:               ${Math.round(yg.value()*100)}%`),s.push(`Screen Reader:    ${e.screenReader?"yes":"no"}`),s.push(`Process Argv:     ${e.mainArguments.join(" ")}`),s.push(`GPU Status:       ${this.j(e.gpuFeatureStatus)}`),s.join(`
`)}async getPerformanceInfo(e,s){return Promise.all([bg(e.mainPID),this.k(e)]).then(async i=>{let[n,r]=i,o=this.m(e,n);return s.forEach(a=>{if(wg(a))o+=`
${a.errorMessage}`,r+=`
${a.errorMessage}`;else if(o+=`

Remote: ${a.hostName}`,a.processes&&(o+=`
${this.m(e,a.processes)}`),a.workspaceMetadata){r+=`
|  Remote: ${a.hostName}`;for(const c of Object.keys(a.workspaceMetadata)){const l=a.workspaceMetadata[c];let h=`${l.fileCount} files`;l.maxFilesReached&&(h=`more than ${h}`),r+=`|    Folder (${c}): ${h}`,r+=this.h(l)}}}),{processInfo:o,workspaceInfo:r}})}async getSystemInfo(e,s){const{memory:i,vmHint:n,os:r,cpus:o}=m5(),a={os:r,memory:i,cpus:o,vmHint:n,processArgs:`${e.mainArguments.join(" ")}`,gpuStatus:e.gpuFeatureStatus,screenReader:`${e.screenReader?"yes":"no"}`,remoteData:s};return Le||(a.load=`${Lt.loadavg().map(c=>Math.round(c)).join(", ")}`),ut&&(a.linuxEnv={desktopSession:process.env.DESKTOP_SESSION,xdgSessionDesktop:process.env.XDG_SESSION_DESKTOP,xdgCurrentDesktop:process.env.XDG_CURRENT_DESKTOP,xdgSessionType:process.env.XDG_SESSION_TYPE}),Promise.resolve(a)}async getDiagnostics(e,s){const i=[];return bg(e.mainPID).then(async n=>(i.push(""),i.push(this.g(e)),i.push(""),i.push(this.m(e,n)),e.windows.some(r=>r.folderURIs&&r.folderURIs.length>0&&!r.remoteAuthority)&&(i.push(""),i.push("Workspace Stats: "),i.push(await this.k(e))),s.forEach(r=>{if(wg(r))i.push(`
${r.errorMessage}`);else if(i.push(`

`),i.push(`Remote:           ${r.hostName}`),i.push(this.f(r.machineInfo)),r.processes&&i.push(this.m(e,r.processes)),r.workspaceMetadata)for(const o of Object.keys(r.workspaceMetadata)){const a=r.workspaceMetadata[o];let c=`${a.fileCount} files`;a.maxFilesReached&&(c=`more than ${c}`),i.push(`Folder (${o}): ${c}`),i.push(this.h(a))}}),i.push(""),i.push(""),i.join(`
`)))}h(e){const s=[];let n=0;const r=(l,h)=>{const u=` ${l}(${h})`;n+u.length>60?(s.push(o),o="|                 ",n=o.length):n+=u.length,o+=u};let o="|      File types:";const a=10,c=e.fileTypes.length>a?a:e.fileTypes.length;for(let l=0;l<c;l++){const h=e.fileTypes[l];r(h.name,h.count)}if(s.push(o),e.configFiles.length>=0&&(o="|      Conf files:",n=0,e.configFiles.forEach(l=>{r(l.name,l.count)}),s.push(o)),e.launchConfigFiles.length>0){let l="|      Launch Configs:";e.launchConfigFiles.forEach(h=>{const u=h.count>1?` ${h.name}(${h.count})`:` ${h.name}`;l+=u}),s.push(l)}return s.join(`
`)}j(e){const s=Math.max(...Object.keys(e).map(i=>i.length));return Object.keys(e).map(i=>`${i}:  ${" ".repeat(s-i.length)}  ${e[i]}`).join(`
                  `)}k(e){const s=[],i=[];return e.windows.forEach(n=>{n.folderURIs.length===0||n.remoteAuthority||(s.push(`|  Window (${n.title})`),n.folderURIs.forEach(r=>{const o=k.revive(r);if(o.scheme===ne.file){const a=o.fsPath;i.push(Yl(a,["node_modules",".git"]).then(c=>{let l=`${c.fileCount} files`;c.maxFilesReached&&(l=`more than ${l}`),s.push(`|    Folder (${qt(a)}): ${l}`),s.push(this.h(c))}).catch(c=>{s.push(`|      Error: Unable to collect workspace stats for folder ${a} (${c.toString()})`)}))}else s.push(`|    Folder (${o.toString()}): Workspace stats not available.`)}))}),Promise.all(i).then(n=>s.join(`
`)).catch(n=>`Unable to collect workspace stats: ${n}`)}m(e,s){const i=new Map;e.windows.forEach(r=>i.set(r.pid,`window [${r.id}] (${r.title})`)),e.pidToNames.forEach(({pid:r,name:o})=>i.set(r,o));const n=[];return n.push("CPU %	Mem MB	   PID	Process"),s&&this.n(e.mainPID,i,n,s,0),n.join(`
`)}n(e,s,i,n,r){const o=r===0;let a;o?a=n.pid===e?this.d.applicationName:"remote-server":s.has(n.pid)?a=s.get(n.pid):a=`${"  ".repeat(r)} ${n.name}`;const c=process.platform==="win32"?n.mem:Lt.totalmem()*(n.mem/100);i.push(`${n.load.toFixed(0).padStart(5," ")}	${(c/Sr.MB).toFixed(0).padStart(6," ")}	${n.pid.toFixed(0).padStart(6," ")}	${a}`),Array.isArray(n.children)&&n.children.forEach(l=>this.n(e,s,i,l,r+1))}async getWorkspaceFileExtensions(e){const s=new Set;for(const{uri:i}of e.folders){const n=k.revive(i);if(n.scheme!==ne.file)continue;const r=n.fsPath;try{(await Yl(r,["node_modules",".git"])).fileTypes.forEach(a=>s.add(a.name))}catch{}}return{extensions:[...s]}}async reportWorkspaceStats(e){for(const{uri:s}of e.folders){const i=k.revive(s);if(i.scheme!==ne.file)continue;const n=i.fsPath;try{const r=await Yl(n,["node_modules",".git"]);this.c.publicLog2("workspace.stats",{"workspace.id":e.telemetryId,rendererSessionId:e.rendererSessionId}),r.fileTypes.forEach(o=>{this.c.publicLog2("workspace.stats.file",{rendererSessionId:e.rendererSessionId,type:o.name,count:o.count})}),r.launchConfigFiles.forEach(o=>{this.c.publicLog2("workspace.stats.launchConfigFile",{rendererSessionId:e.rendererSessionId,type:o.name,count:o.count})}),r.configFiles.forEach(o=>{this.c.publicLog2("workspace.stats.configFiles",{rendererSessionId:e.rendererSessionId,type:o.name,count:o.count})}),this.c.publicLog2("workspace.stats.metadata",{duration:r.totalScanTime,reachedLimit:r.maxFilesReached,fileCount:r.fileCount,readdirCount:r.totalReaddirCount})}catch{}}}};th=__decorate([__param(0,ke),__param(1,ge)],th);var Rg=W("downloadService"),li=W("requestService"),w5=class{constructor(t){this.b=t}toJSON(){if(!this.a){const t=Object.create(null);for(const e in this.b)e.toLowerCase()==="authorization"||e.toLowerCase()==="proxy-authorization"?t[e]="*****":t[e]=this.b[e];this.a=t}return this.a}},y5=class extends j{constructor(t){super(),this.b=t,this.a=0}async c(t,e){const s=`#${++this.a}: ${t.url}`;this.b.trace(`${s} - begin`,t.type,new w5(t.headers??{}));try{const i=await e();return this.b.trace(`${s} - end`,t.type,i.res.statusCode,i.res.headers),i}catch(i){throw this.b.error(`${s} - error`,t.type,se(i)),i}}};function An(t){return t.res.statusCode&&t.res.statusCode>=200&&t.res.statusCode<300||t.res.statusCode===1223}function b5(t){return!!t.res.statusCode&&t.res.statusCode>=400&&t.res.statusCode<500}function S5(t){return!!t.res.statusCode&&t.res.statusCode>=500&&t.res.statusCode<600}function sh(t){return t.res.statusCode===204}async function ih(t){return sh(t)?null:(await Ni(t.stream)).toString()}async function Cs(t){if(!An(t))throw new Error("Server returned "+t.res.statusCode);return ih(t)}async function Js(t){if(!An(t))throw new Error("Server returned "+t.res.statusCode);if(sh(t))return null;const s=(await Ni(t.stream)).toString();try{return JSON.parse(s)}catch(i){throw i.message+=`:
`+s,i}}var Dg=!1,nh=[],Pg=void 0,Ig=void 0;function E5(t=!0,e=!0){if(Pg===t&&Ig===e)return;Pg=t,Ig=e;const s=At.as(rs.Configuration),i=nh;nh=[{id:"http",order:15,title:w(2290,null),type:"object",scope:2,properties:{"http.useLocalProxyConfiguration":{type:"boolean",default:e,markdownDescription:w(2291,null),restricted:!0}}},{id:"http",order:15,title:w(2292,null),type:"object",scope:1,properties:{"http.electronFetch":{type:"boolean",default:!1,description:w(2293,null),restricted:!0}}},{id:"http",order:15,title:w(2294,null),type:"object",scope:t?1:2,properties:{"http.proxy":{type:"string",pattern:"^(https?|socks|socks4a?|socks5h?)://([^:]*(:[^@]*)?@)?([^:]+|\\[[:0-9a-fA-F]+\\])(:\\d+)?/?$|^$",markdownDescription:w(2295,null,"`#http.useLocalProxyConfiguration#`"),restricted:!0},"http.proxyStrictSSL":{type:"boolean",default:!0,markdownDescription:w(2296,null,"`#http.useLocalProxyConfiguration#`"),restricted:!0},"http.proxyKerberosServicePrincipal":{type:"string",markdownDescription:w(2297,null,"`#http.useLocalProxyConfiguration#`"),restricted:!0},"http.noProxy":{type:"array",items:{type:"string"},markdownDescription:w(2298,null,"`#http.useLocalProxyConfiguration#`"),restricted:!0},"http.proxyAuthorization":{type:["null","string"],default:null,markdownDescription:w(2299,null,"`#http.useLocalProxyConfiguration#`"),restricted:!0},"http.proxySupport":{type:"string",enum:["off","on","fallback","override"],enumDescriptions:[w(2300,null),w(2301,null),w(2302,null),w(2303,null)],default:"override",markdownDescription:w(2304,null,"`#http.useLocalProxyConfiguration#`"),restricted:!0},"http.systemCertificates":{type:"boolean",default:!0,markdownDescription:w(2305,null,"`#http.useLocalProxyConfiguration#`"),restricted:!0},"http.systemCertificatesNode":{type:"boolean",tags:["experimental"],default:Dg,markdownDescription:w(2306,null,"`#http.useLocalProxyConfiguration#`"),restricted:!0,experiment:{mode:"auto"}},"http.experimental.systemCertificatesV2":{type:"boolean",tags:["experimental"],default:!1,markdownDescription:w(2307,null,"`#http.useLocalProxyConfiguration#`"),restricted:!0},"http.fetchAdditionalSupport":{type:"boolean",default:!0,markdownDescription:w(2308,null,"`#http.useLocalProxyConfiguration#`","`#http.proxySupport#`","`#http.systemCertificates#`"),restricted:!0},"http.experimental.networkInterfaceCheckInterval":{type:"number",default:300,minimum:-1,tags:["experimental"],markdownDescription:w(2309,null,"`#http.useLocalProxyConfiguration#`"),restricted:!0,experiment:{mode:"auto"}}}}],s.updateConfigurations({add:nh,remove:i})}E5();var rh=class{constructor(e,s){this.a=e,this.b=s}async download(e,s,i=Z.None){if(e.scheme===ne.file||e.scheme===ne.vscodeRemote){await this.b.copy(e,s);return}const n={type:"GET",url:e.toString(!0)},r=await this.a.request(n,i);if(r.res.statusCode===200)await this.b.writeFile(s,r.stream);else{const o=await Cs(r);throw new Error(`Expected 200, got back ${r.res.statusCode} instead.

${o}`)}}};rh=__decorate([__param(0,li),__param(1,K)],rh);var Ag="extensions.user.cache",$5="extensions.builtin.cache",Lg="undefined_publisher",Og;(function(t){t[t.System=0]="System",t[t.User=1]="User"})(Og||(Og={}));var Ng;(function(t){t.WIN32_X64="win32-x64",t.WIN32_ARM64="win32-arm64",t.LINUX_X64="linux-x64",t.LINUX_ARM64="linux-arm64",t.LINUX_ARMHF="linux-armhf",t.ALPINE_X64="alpine-x64",t.ALPINE_ARM64="alpine-arm64",t.DARWIN_X64="darwin-x64",t.DARWIN_ARM64="darwin-arm64",t.WEB="web",t.UNIVERSAL="universal",t.UNKNOWN="unknown",t.UNDEFINED="undefined"})(Ng||(Ng={}));var Ln=class{constructor(t){this.value=t,this._lower=t.toLowerCase()}static equals(t,e){if(typeof t>"u"||t===null)return typeof e>"u"||e===null;if(typeof e>"u"||e===null)return!1;if(typeof t=="string"||typeof e=="string"){const s=typeof t=="string"?t:t.value,i=typeof e=="string"?e:e.value;return ti(s,i)}return t._lower===e._lower}static toKey(t){return typeof t=="string"?t.toLowerCase():t._lower}},x5=class{constructor(){this.c=new Map}clear(){this.c.clear()}delete(t){this.c.delete(Ln.toKey(t))}get(t){return this.c.get(Ln.toKey(t))}has(t){return this.c.has(Ln.toKey(t))}set(t,e){this.c.set(Ln.toKey(t),e)}values(){return this.c.values()}forEach(t){this.c.forEach(t)}[Symbol.iterator](){return this.c[Symbol.iterator]()}};function oh(t){return k5(t)}function k5(t){return t.contributes&&t.contributes.localizations?t.contributes.localizations.length>0:!1}function C5(t){return t.map(e=>{const[s,i]=e.split("@");return{proposalName:s,version:i?parseInt(i):void 0}})}function R5(t){return t.map(e=>e.split("@")[0])}var EE=W("IBuiltinExtensionsScannerService");function D5(t){if(sr===2&&/^penguin(\.|$)/i.test(t))return"chromebook"}function P5(t,e,s,i,n,r,o,a,c,l,h){const u=Object.create(null);u["common.machineId"]=r,u["common.sqmId"]=o,u["common.devDeviceId"]=a,u.sessionID=tt()+Date.now(),u.commitHash=i,u.version=n,u["common.releaseDate"]=l,u["common.platformVersion"]=(t||"").replace(/^(\d+)(\.\d+)?(\.\d+)?(.*)/,"$1$2$3"),u["common.platform"]=Wd(sr),u["common.nodePlatform"]=h1,u["common.nodeArch"]=s,u["common.product"]=h||"desktop",c&&(u["common.msftInternal"]=c);let f=0;const p=Date.now();Object.defineProperties(u,{timestamp:{get:()=>new Date,enumerable:!0},"common.timesincesessionstart":{get:()=>Date.now()-p,enumerable:!0},"common.sequence":{get:()=>f++,enumerable:!0}}),vy&&(u["common.snap"]="true");const g=D5(e);return g&&(u["common.platformDetail"]=g),u}function I5(t){const e=je.USERDNSDOMAIN;if(!e)return!1;const s=e.toLowerCase();return t.some(i=>s===i)}var sa=class{constructor(t){this.value=t,this.isTrustedTelemetryValue=!0}},A5=class{constructor(){this.telemetryLevel=0,this.sessionId="someValue.sessionId",this.machineId="someValue.machineId",this.sqmId="someValue.sqmId",this.devDeviceId="someValue.devDeviceId",this.firstSessionDate="someValue.firstSessionDate",this.sendErrorTelemetry=!1}publicLog(){}publicLog2(){}publicLogError(){}publicLogError2(){}setExperimentProperty(){}},L5=new A5,Tg="telemetry",O5={id:Tg,name:w(2338,null)},N5={log:()=>null,flush:()=>Promise.resolve(void 0)};function jg(t,e){return!e.isBuilt&&!e.disableTelemetry?!0:!(e.disableTelemetry||!t.enableTelemetry)}function Mg(t,e){return e.extensionTestsLocationURI?!0:!(e.isBuilt||e.disableTelemetry||t.enableTelemetry&&t.aiConfig?.ariaKey)}function Ug(t){const e=t.getValue(ta),s=t.getValue($g);if(t.getValue(Zl)===!1||s===!1)return 0;switch(e??"all"){case"all":return 3;case"error":return 2;case"crash":return 1;case"off":return 0}}function Fg(t){const e={},s={},i={};qg(t,i);for(let n in i){n=n.length>150?n.substr(n.length-149):n;const r=i[n];typeof r=="number"?s[n]=r:typeof r=="boolean"?s[n]=r?1:0:typeof r=="string"?(r.length>8192&&console.warn(`Telemetry property: ${n} has been trimmed to 8192, the original length is ${r.length}`),e[n]=r.substring(0,8191)):typeof r<"u"&&r!==null&&(e[n]=String(r))}return{properties:e,measurements:s}}function qg(t,e,s=0,i){if(!t||typeof t!="object"&&typeof t!="function")return;const n=t;for(const r of Object.getOwnPropertyNames(n)){const o=n[r],a=i?i+r:r;Array.isArray(o)?e[a]=dg(o):o instanceof Date?e[a]=o.toISOString():Te(o)?s<2?qg(o,e,s+1,a+"."):e[a]=dg(o):e[a]=o}}function T5(t,e){const s=t.msftInternalDomains||[],i=e.getValue("telemetry.internalTesting");return I5(s)||i}function j5(t){return[t.appRoot,t.extensionsPath,t.userHome.fsPath,t.tmpDir.fsPath,t.userDataPath]}function M5(t,e){if(!t||!t.includes("/")&&!t.includes("\\"))return t;let s=t;const i=[];for(const a of e)for(;;){const c=a.exec(t);if(!c)break;i.push([c.index,a.lastIndex])}const n=/^[\\\/]?(node_modules|node_modules\.asar)[\\\/]/,r=/(file:\/\/)?([a-zA-Z]:(\\\\|\\|\/)|(\\\\|\\|\/))?([\w-\._]+(\\\\|\\|\/))+[\w-\._]*/g;let o=0;for(s="";;){const a=r.exec(t);if(!a)break;const c=i.some(([l,h])=>a.index<h&&l<r.lastIndex);!n.test(a[0])&&!c&&(s+=t.substring(o,a.index)+"<REDACTED: user-file-path>",o=r.lastIndex)}return o<t.length&&(s+=t.substr(o)),s}function U5(t){if(!t)return t;const e=[{label:"URL",regex:/[a-zA-Z][a-zA-Z0-9+.-]*:\/\/[^\s]*/},{label:"Google API Key",regex:/AIza[A-Za-z0-9_\\\-]{35}/},{label:"JWT",regex:/eyJ[0eXAiOiJKV1Qi|hbGci|a-zA-Z0-9\-_]+\.[a-zA-Z0-9\-_]+\.[a-zA-Z0-9\-_]+/},{label:"Slack Token",regex:/xox[pbar]\-[A-Za-z0-9]/},{label:"GitHub Token",regex:/(gh[psuro]_[a-zA-Z0-9]{36}|github_pat_[a-zA-Z0-9]{22}_[a-zA-Z0-9]{59})/},{label:"Generic Secret",regex:/(key|token|sig|secret|signature|password|passwd|pwd|android:value)[^a-zA-Z0-9]/i},{label:"CLI Credentials",regex:/((login|psexec|(certutil|psexec)\.exe).{1,50}(\s-u(ser(name)?)?\s+.{3,100})?\s-(admin|user|vm|root)?p(ass(word)?)?\s+["']?[^$\-\/\s]|(^|[\s\r\n\\])net(\.exe)?.{1,5}(user\s+|share\s+\/user:| user -? secrets ? set) \s + [^ $\s \/])/},{label:"Microsoft Entra ID",regex:/eyJ(?:0eXAiOiJKV1Qi|hbGci|[a-zA-Z0-9\-_]+\.[a-zA-Z0-9\-_]+\.)/},{label:"Email",regex:/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/}];for(const s of e)if(s.regex.test(t))return`<REDACTED: ${s.label}>`;return t}function F5(t,e){return t?Gl(t,s=>{if(s instanceof sa||Object.hasOwnProperty.call(s,"isTrustedTelemetryValue"))return s.value;if(typeof s=="string"){let i=s.replaceAll("%20"," ");i=M5(i,e);for(const n of e)i=i.replace(n,"");return i=U5(i),i}}):{}}function G(t,e){return t.uuid&&e.uuid?t.uuid===e.uuid:t.id===e.id?!0:$o(t.id,e.id)===0}var q5=/^([^.]+\..+)-(\d+\.\d+\.\d+)(-(.+))?$/,Gt=class xc{static create(e){const s=e.manifest?e.manifest.version:e.version,i=e.manifest?e.targetPlatform:e.properties.targetPlatform;return new xc(e.identifier,s,i)}static parse(e){const s=q5.exec(e);return s&&s[1]&&s[2]?new xc({id:s[1]},s[2],s[4]||void 0):null}constructor(e,s,i="undefined"){this.identifier=e,this.version=s,this.targetPlatform=i,this.id=e.id}toString(){return`${this.id}-${this.version}${this.targetPlatform!=="undefined"?`-${this.targetPlatform}`:""}`}equals(e){return e instanceof xc?G(this,e)&&this.version===e.version&&this.targetPlatform===e.targetPlatform:!1}},_5=/^([^.]+\..+)@((prerelease)|(\d+\.\d+\.\d+(-.*)?))$/;function z5(t){const e=_5.exec(t);return e&&e[1]?[Cr(e[1]),e[2]]:[Cr(t),void 0]}function ia(t,e){return`${t}.${e}`}function Cr(t){return t.toLowerCase()}function Ks(t,e){return Cr(ia(t??Lg,e))}function _g(t,e){const s=[],i=n=>{for(const r of s)if(r.some(o=>G(e(o),e(n))))return r;return null};for(const n of t){const r=i(n);r?r.push(n):s.push([n])}return s}function V5(t){return{id:t.identifier.id,name:t.manifest.name,galleryId:null,publisherId:t.publisherId,publisherName:t.manifest.publisher,publisherDisplayName:t.publisherDisplayName,dependencies:t.manifest.extensionDependencies&&t.manifest.extensionDependencies.length>0}}function ah(t){return{id:new sa(t.identifier.id),name:new sa(t.name),extensionVersion:t.version,galleryId:t.identifier.uuid,publisherId:t.publisherId,publisherName:t.publisher,publisherDisplayName:t.publisherDisplayName,isPreReleaseVersion:t.properties.isPreReleaseVersion,dependencies:!!(t.properties.dependencies&&t.properties.dependencies.length>0),isSigned:t.isSigned,...t.telemetryData}}var $E=new Ln("pprice.better-merge");async function B5(t,e){if(!ut)return!1;let s;try{s=(await t.readFile(k.file("/etc/os-release"))).value.toString()}catch{try{s=(await t.readFile(k.file("/usr/lib/os-release"))).value.toString()}catch(n){e.debug("Error while getting the os-release file.",se(n))}}return!!s&&(s.match(/^ID=([^\u001b\r\n]*)/m)||[])[1]==="alpine"}async function zg(t,e){const s=await B5(t,e),i=Dp(s?"alpine":sr,u1);return e.debug("ComputeTargetPlatform:",i),i}function W5(t,e){return H5(t,e)!==void 0}function H5(t,e){return e.find(({extensionOrPublisher:s})=>de(s)?$o(t.id.split(".")[0],s)===0:G(t,s))}function ch(t){const e=[];typeof t=="number"&&e.push("code/timeOrigin",t);function s(n,r){e.push(n,r?.startTime??Date.now())}function i(){const n=[];for(let r=0;r<e.length;r+=2)n.push({name:e[r],startTime:e[r+1]});return n}return{mark:s,getMarks:i}}function G5(){if(typeof performance=="object"&&typeof performance.mark=="function"&&!performance.nodeTiming)return typeof performance.timeOrigin!="number"&&!performance.timing?ch():{mark(t,e){performance.mark(t,e)},getMarks(){let t=performance.timeOrigin;typeof t!="number"&&(t=(performance.timing.navigationStart||performance.timing.redirectStart||performance.timing.fetchStart)??0);const e=[{name:"code/timeOrigin",startTime:Math.round(t)}];for(const s of performance.getEntriesByType("mark"))e.push({name:s.name,startTime:Math.round(t+s.startTime)});return e}};if(typeof process=="object"){const t=performance?.timeOrigin;return ch(t)}else return console.trace("perf-util loaded in UNKNOWN environment"),ch()}function J5(t){return t.MonacoPerformanceMarks||(t.MonacoPerformanceMarks=G5()),t.MonacoPerformanceMarks}var Vg=J5(globalThis),Vi=Vg.mark,xE=Vg.getMarks,Rr;(function(t){t[t.STORAGE_DOES_NOT_EXIST=0]="STORAGE_DOES_NOT_EXIST",t[t.STORAGE_IN_MEMORY=1]="STORAGE_IN_MEMORY"})(Rr||(Rr={}));var vs;(function(t){t[t.None=0]="None",t[t.Initialized=1]="Initialized",t[t.Closed=2]="Closed"})(vs||(vs={}));var na=class Sw extends j{static{this.a=100}constructor(e,s=Object.create(null)){super(),this.q=e,this.r=s,this.b=this.D(new Bc),this.onDidChangeStorage=this.b.event,this.c=vs.None,this.f=new Map,this.g=this.D(new Li(Sw.a)),this.h=new Set,this.j=new Map,this.m=void 0,this.n=[],this.s()}s(){this.D(this.q.onDidChangeItemsExternal(e=>this.t(e)))}t(e){this.b.pause();try{e.changed?.forEach((s,i)=>this.u(i,s)),e.deleted?.forEach(s=>this.u(s,void 0))}finally{this.b.resume()}}u(e,s){if(this.c===vs.Closed)return;let i=!1;Et(s)?i=this.f.delete(e):this.f.get(e)!==s&&(this.f.set(e,s),i=!0),i&&this.b.fire({key:e,external:!0})}get items(){return this.f}get size(){return this.f.size}async init(){this.c===vs.None&&(this.c=vs.Initialized,this.r.hint!==Rr.STORAGE_DOES_NOT_EXIST&&(this.f=await this.q.getItems()))}get(e,s){const i=this.f.get(e);return Et(i)?s:i}getBoolean(e,s){const i=this.get(e);return Et(i)?s:i==="true"}getNumber(e,s){const i=this.get(e);return Et(i)?s:parseInt(i,10)}getObject(e,s){const i=this.get(e);return Et(i)?s:rb(i)}async set(e,s,i=!1){if(this.c===vs.Closed)return;if(Et(s))return this.delete(e,i);const n=Te(s)||Array.isArray(s)?nb(s):String(s);if(this.f.get(e)!==n)return this.f.set(e,n),this.j.set(e,n),this.h.delete(e),this.b.fire({key:e,external:i}),this.C()}async delete(e,s=!1){if(!(this.c===vs.Closed||!this.f.delete(e)))return this.h.has(e)||this.h.add(e),this.j.delete(e),this.b.fire({key:e,external:s}),this.C()}async optimize(){if(this.c!==vs.Closed)return await this.flush(0),this.q.optimize()}async close(){return this.m||(this.m=this.w()),this.m}async w(){this.c=vs.Closed;try{await this.C(0)}catch{}await this.q.close(()=>this.f)}get y(){return this.j.size>0||this.h.size>0}async z(){if(!this.y)return;const e={insert:this.j,delete:this.h};return this.h=new Set,this.j=new Map,this.q.updateItems(e).finally(()=>{if(!this.y)for(;this.n.length;)this.n.pop()?.()})}async flush(e){if(!(this.c===vs.Closed||this.m))return this.C(e)}async C(e){return this.r.hint===Rr.STORAGE_IN_MEMORY?this.z():this.g.trigger(()=>this.z(),e)}async whenFlushed(){if(this.y)return new Promise(e=>this.n.push(e))}isInMemory(){return this.r.hint===Rr.STORAGE_IN_MEMORY}},he=W("IUriIdentityService"),Bg;(function(t){t.Settings="settings",t.Keybindings="keybindings",t.Snippets="snippets",t.Prompts="prompts",t.Tasks="tasks",t.Extensions="extensions",t.GlobalState="globalState",t.Mcp="mcp"})(Bg||(Bg={}));function Wg(t){const e=t;return!!(e&&typeof e=="object"&&typeof e.id=="string"&&typeof e.isDefault=="boolean"&&typeof e.name=="string"&&k.isUri(e.location)&&k.isUri(e.globalStorageHome)&&k.isUri(e.settingsResource)&&k.isUri(e.keybindingsResource)&&k.isUri(e.tasksResource)&&k.isUri(e.snippetsHome)&&k.isUri(e.promptsHome)&&k.isUri(e.extensionsResource)&&k.isUri(e.mcpResource))}var Ne=W("IUserDataProfilesService");function Yt(t,e){return{id:t.id,isDefault:t.isDefault,name:t.name,icon:t.icon,location:k.revive(t.location).with({scheme:e}),globalStorageHome:k.revive(t.globalStorageHome).with({scheme:e}),settingsResource:k.revive(t.settingsResource).with({scheme:e}),keybindingsResource:k.revive(t.keybindingsResource).with({scheme:e}),tasksResource:k.revive(t.tasksResource).with({scheme:e}),snippetsHome:k.revive(t.snippetsHome).with({scheme:e}),promptsHome:k.revive(t.promptsHome).with({scheme:e}),extensionsResource:k.revive(t.extensionsResource).with({scheme:e}),mcpResource:k.revive(t.mcpResource).with({scheme:e}),cacheHome:k.revive(t.cacheHome).with({scheme:e}),useDefaultFlags:t.useDefaultFlags,isTransient:t.isTransient,workspaces:t.workspaces?.map(s=>k.revive(s))}}function ra(t,e,s,i,n,r){return{id:t,name:e,location:s,isDefault:!1,icon:n?.icon,globalStorageHome:r&&n?.useDefaultFlags?.globalState?r.globalStorageHome:V(s,"globalStorage"),settingsResource:r&&n?.useDefaultFlags?.settings?r.settingsResource:V(s,"settings.json"),keybindingsResource:r&&n?.useDefaultFlags?.keybindings?r.keybindingsResource:V(s,"keybindings.json"),tasksResource:r&&n?.useDefaultFlags?.tasks?r.tasksResource:V(s,"tasks.json"),snippetsHome:r&&n?.useDefaultFlags?.snippets?r.snippetsHome:V(s,"snippets"),promptsHome:r&&n?.useDefaultFlags?.prompts?r.promptsHome:V(s,"prompts"),extensionsResource:r&&n?.useDefaultFlags?.extensions?r.extensionsResource:V(s,"extensions.json"),mcpResource:r&&n?.useDefaultFlags?.mcp?r.mcpResource:V(s,"mcp.json"),cacheHome:V(i,t),useDefaultFlags:n?.useDefaultFlags,isTransient:n?.transient,workspaces:n?.workspaces}}var Hg=class extends j{static{this.b="userDataProfiles"}static{this.c="profileAssociations"}get defaultProfile(){return this.profiles[0]}get profiles(){return[...this.z.profiles,...this.q.profiles]}constructor(e,s,i,n){super(),this.r=e,this.s=s,this.t=i,this.u=n,this.g=this.D(new R),this.onDidChangeProfiles=this.g.event,this.h=this.D(new R),this.onWillCreateProfile=this.h.event,this.j=this.D(new R),this.onWillRemoveProfile=this.j.event,this.m=this.D(new R),this.onDidResetWorkspaces=this.m.event,this.n=new Map,this.q={profiles:[],emptyWindows:new Map},this.profilesHome=V(this.r.userRoamingDataHome,"profiles"),this.f=V(this.r.cacheHome,"CachedProfilesData")}init(){this.y=void 0}get z(){if(!this.y){const e=this.C(),s=[e];try{for(const n of this.N()){if(!n.name||!de(n.name)||!n.location){this.u.warn("Skipping the invalid stored profile",n.location||n.name);continue}s.push(ra(nr(n.location),n.name,n.location,this.f,{icon:n.icon,useDefaultFlags:n.useDefaultFlags},e))}}catch(n){this.u.error(n)}const i=new Map;if(s.length)try{const n=this.P();if(n.workspaces)for(const[r,o]of Object.entries(n.workspaces)){const a=k.parse(r),c=s.find(l=>l.id===o);if(c){const l=c.workspaces?c.workspaces.slice(0):[];l.push(a),c.workspaces=l}}if(n.emptyWindows)for(const[r,o]of Object.entries(n.emptyWindows)){const a=s.find(c=>c.id===o);a&&i.set(r,a)}}catch(n){this.u.error(n)}this.y={profiles:s,emptyWindows:i}}return this.y}C(){const e=ra("__default__profile__",w(2713,null),this.r.userRoamingDataHome,this.f);return{...e,extensionsResource:this.R()??e.extensionsResource,isDefault:!0}}async createTransientProfile(e){const s="Temp",i=new RegExp(`${Di(s)}\\s(\\d+)`);let n=0;for(const o of this.profiles){const a=i.exec(o.name),c=a?parseInt(a[1]):0;n=c>n?c:n}const r=`${s} ${n+1}`;return this.createProfile(En(tt()).toString(16),r,{transient:!0},e)}async createNamedProfile(e,s,i){return this.createProfile(En(tt()).toString(16),e,s,i)}async createProfile(e,s,i,n){return await this.F(e,s,i,n)}async F(e,s,i,n){if(!de(s)||!s)throw new Error("Name of the profile is mandatory and must be of type `string`");let r=this.n.get(s);return r||(r=(async()=>{try{if(this.profiles.find(h=>h.id===e||!h.isTransient&&!i?.transient&&h.name===s))throw new Error(`Profile with ${s} name already exists`);const a=n?this.G(n):void 0;k.isUri(a)&&(i={...i,workspaces:[a]});const c=ra(e,s,V(this.profilesHome,e),this.f,i,this.defaultProfile);await this.s.createFolder(c.location);const l=[];return this.h.fire({profile:c,join(h){l.push(h)}}),await Xe.settled(l),a&&!k.isUri(a)&&this.L(a,c,!!c.isTransient),this.I([c],[],[]),c}finally{this.n.delete(s)}})(),this.n.set(s,r)),r}async updateProfile(e,s){const i=[];for(const r of this.profiles){let o;if(e.id===r.id)r.isDefault?s.workspaces&&(o=r,o.workspaces=s.workspaces):o=ra(r.id,s.name??r.name,r.location,this.f,{icon:s.icon===null?void 0:s.icon??r.icon,transient:s.transient??r.isTransient,useDefaultFlags:s.useDefaultFlags??r.useDefaultFlags,workspaces:s.workspaces??r.workspaces},this.defaultProfile);else if(s.workspaces){const a=r.workspaces?.filter(c=>!s.workspaces?.some(l=>this.t.extUri.isEqual(c,l)));r.workspaces?.length!==a?.length&&(o=r,o.workspaces=a)}o&&i.push(o)}if(!i.length)throw e.isDefault?new Error("Cannot update default profile"):new Error(`Profile '${e.name}' does not exist`);this.I([],[],i);const n=this.profiles.find(r=>r.id===e.id);if(!n)throw new Error(`Profile '${e.name}' was not updated`);return n}async removeProfile(e){if(e.isDefault)throw new Error("Cannot remove default profile");const s=this.profiles.find(n=>n.id===e.id);if(!s)throw new Error(`Profile '${e.name}' does not exist`);const i=[];this.j.fire({profile:s,join(n){i.push(n)}});try{await Promise.allSettled(i)}catch(n){this.u.error(n)}this.I([],[s],[]);try{await this.s.del(s.cacheHome,{recursive:!0})}catch(n){Ue(n)!==1&&this.u.error(n)}}async setProfileForWorkspace(e,s){const i=this.profiles.find(r=>r.id===s.id);if(!i)throw new Error(`Profile '${s.name}' does not exist`);const n=this.G(e);if(k.isUri(n)){const r=i.workspaces?[...i.workspaces]:[];r.some(o=>this.t.extUri.isEqual(o,n))||(r.push(n),await this.updateProfile(i,{workspaces:r}))}else this.L(n,i,!1),this.M(this.profiles)}unsetWorkspace(e,s=!1){const i=this.G(e);if(k.isUri(i)){const n=this.getProfileForWorkspace(e);n&&this.updateProfile(n,{workspaces:n.workspaces?.filter(r=>!this.t.extUri.isEqual(r,i))})}else this.L(i,void 0,s),this.M(this.profiles)}async resetWorkspaces(){this.q.emptyWindows.clear(),this.z.emptyWindows.clear();for(const e of this.profiles)e.workspaces=void 0;this.I([],[],this.profiles),this.m.fire()}async cleanUp(){if(await this.s.exists(this.profilesHome)){const e=await this.s.resolve(this.profilesHome);await Promise.all((e.children||[]).filter(s=>s.isDirectory&&this.profiles.every(i=>!this.t.extUri.isEqual(i.location,s.resource))).map(s=>this.s.del(s.resource,{recursive:!0})))}}async cleanUpTransientProfiles(){const e=this.q.profiles.filter(s=>!this.H(s));await Promise.allSettled(e.map(s=>this.removeProfile(s)))}getProfileForWorkspace(e){const s=this.G(e);return k.isUri(s)?this.profiles.find(i=>i.workspaces?.some(n=>this.t.extUri.isEqual(n,s))):this.z.emptyWindows.get(s)??this.q.emptyWindows.get(s)}G(e){return F2(e)?e.uri:_2(e)?e.configPath:e.id}H(e){return!!(e.workspaces?.length||[...this.z.emptyWindows.values()].some(s=>this.t.extUri.isEqual(s.location,e.location))||[...this.q.emptyWindows.values()].some(s=>this.t.extUri.isEqual(s.location,e.location)))}I(e,s,i){const n=[...this.profiles,...e],r=this.q.profiles;this.q.profiles=[];const o=[];for(let a of n){if(s.some(c=>a.id===c.id)){for(const c of[...this.z.emptyWindows.keys()])a.id===this.z.emptyWindows.get(c)?.id&&this.z.emptyWindows.delete(c);continue}if(!a.isDefault){a=i.find(l=>a.id===l.id)??a;const c=r.find(l=>a.id===l.id);if(a.isTransient)this.q.profiles.push(a);else if(c){for(const[l,h]of this.q.emptyWindows.entries())if(a.id===h.id){this.q.emptyWindows.delete(l),this.z.emptyWindows.set(l,a);break}}}a.workspaces?.length===0&&(a.workspaces=void 0),o.push(a)}this.M(o),this.J(e,s,i)}J(e,s,i){this.g.fire({added:e,removed:s,updated:i,all:this.profiles})}L(e,s,i){i=s?.isTransient?!0:i,i?s?this.q.emptyWindows.set(e,s):this.q.emptyWindows.delete(e):(this.q.emptyWindows.delete(e),s?this.z.emptyWindows.set(e,s):this.z.emptyWindows.delete(e))}M(e){const s=[],i={},n={};for(const r of e)if(!r.isTransient&&(r.isDefault||s.push({location:r.location,name:r.name,icon:r.icon,useDefaultFlags:r.useDefaultFlags}),r.workspaces))for(const o of r.workspaces)i[o.toString()]=r.id;for(const[r,o]of this.z.emptyWindows.entries())n[r.toString()]=o.id;this.Q({workspaces:i,emptyWindows:n}),this.O(s),this.y=void 0}N(){return[]}O(e){throw new Error("not implemented")}P(){return{}}Q(e){throw new Error("not implemented")}R(){}};Hg=__decorate([__param(0,ae),__param(1,K),__param(2,he),__param(3,Q)],Hg);var K5="__$__isNewStorageMarker",oa="__$__targetStorageMarker",re=W("storageService"),Bi;(function(t){t[t.NONE=0]="NONE",t[t.SHUTDOWN=1]="SHUTDOWN"})(Bi||(Bi={}));var Gg;(function(t){t[t.APPLICATION=-1]="APPLICATION",t[t.PROFILE=0]="PROFILE",t[t.WORKSPACE=1]="WORKSPACE"})(Gg||(Gg={}));var Jg;(function(t){t[t.USER=0]="USER",t[t.MACHINE=1]="MACHINE"})(Jg||(Jg={}));function Q5(t){const e=t.get(oa);if(e)try{return JSON.parse(e)}catch{}return Object.create(null)}var Kg=class Ew extends j{static{this.a=60*1e3}constructor(e={flushInterval:Ew.a}){super(),this.b=this.D(new Bc),this.f=this.D(new Bc),this.onDidChangeTarget=this.f.event,this.g=this.D(new R),this.onWillSaveState=this.g.event,this.m=this.D(new us),this.z=void 0,this.F=void 0,this.H=void 0,this.j=this.D(new ps(()=>this.n(),e.flushInterval))}onDidChangeValue(e,s,i){return O.filter(this.b.event,n=>n.scope===e&&(s===void 0||n.key===s),i)}n(){this.m.value=j1(()=>{this.q()&&this.flush(),this.j.schedule()})}q(){return!0}r(){Zt([this.m,this.j])}initialize(){return this.h||(this.h=(async()=>{Vi("code/willInitStorage");try{await this.O()}finally{Vi("code/didInitStorage")}this.j.schedule()})()),this.h}t(e,s){const{key:i,external:n}=s;if(i===oa){switch(e){case-1:this.H=void 0;break;case 0:this.F=void 0;break;case 1:this.z=void 0;break}this.f.fire({scope:e})}else this.b.fire({scope:e,key:i,target:this.J(e)[i],external:n})}u(e){this.g.fire({reason:e})}get(e,s,i){return this.P(s)?.get(e,i)}getBoolean(e,s,i){return this.P(s)?.getBoolean(e,i)}getNumber(e,s,i){return this.P(s)?.getNumber(e,i)}getObject(e,s,i){return this.P(s)?.getObject(e,i)}storeAll(e,s){this.w(()=>{for(const i of e)this.store(i.key,i.value,i.scope,i.target,s)})}store(e,s,i,n,r=!1){if(Et(s)){this.remove(e,i,r);return}this.w(()=>{this.y(e,i,n),this.P(i)?.set(e,s,r)})}remove(e,s,i=!1){this.w(()=>{this.y(e,s,void 0),this.P(s)?.delete(e,i)})}w(e){this.b.pause(),this.f.pause();try{e()}finally{this.b.resume(),this.f.resume()}}keys(e,s){const i=[],n=this.J(e);for(const r of Object.keys(n))n[r]===s&&i.push(r);return i}y(e,s,i,n=!1){const r=this.J(s);typeof i=="number"?r[e]!==i&&(r[e]=i,this.P(s)?.set(oa,JSON.stringify(r),n)):typeof r[e]=="number"&&(delete r[e],this.P(s)?.set(oa,JSON.stringify(r),n))}get C(){return this.z||(this.z=this.L(1)),this.z}get G(){return this.F||(this.F=this.L(0)),this.F}get I(){return this.H||(this.H=this.L(-1)),this.H}J(e){switch(e){case-1:return this.I;case 0:return this.G;default:return this.C}}L(e){const s=this.P(e);return s?Q5(s):Object.create(null)}isNew(e){return this.getBoolean(K5,e)===!0}async flush(e=Bi.NONE){this.g.fire({reason:e});const s=this.P(-1),i=this.P(0),n=this.P(1);switch(e){case Bi.NONE:await Xe.settled([s?.whenFlushed()??Promise.resolve(),i?.whenFlushed()??Promise.resolve(),n?.whenFlushed()??Promise.resolve()]);break;case Bi.SHUTDOWN:await Xe.settled([s?.flush(0)??Promise.resolve(),i?.flush(0)??Promise.resolve(),n?.flush(0)??Promise.resolve()]);break}}async log(){const e=this.P(-1)?.items??new Map,s=this.P(0)?.items??new Map,i=this.P(1)?.items??new Map;return X5(e,s,i,this.Q(-1)??"",this.Q(0)??"",this.Q(1)??"")}async optimize(e){return await this.flush(),this.P(e)?.optimize()}async switch(e,s){return this.u(Bi.NONE),Wg(e)?this.R(e,s):this.S(e,s)}M(e,s){return!(e.id===s.id||aa(s)&&aa(e))}N(e,s,i){this.w(()=>{const n=new Set;for(const[r,o]of e)n.add(r),s.get(r)!==o&&this.t(i,{key:r,external:!0});for(const[r]of s.items)n.has(r)||this.t(i,{key:r,external:!0})})}};function aa(t){return t.isDefault||!!t.useDefaultFlags?.globalState}async function X5(t,e,s,i,n,r){const o=m=>{try{return JSON.parse(m)}catch{return m}},a=new Map,c=new Map;t.forEach((m,v)=>{a.set(v,m),c.set(v,o(m))});const l=new Map,h=new Map;e.forEach((m,v)=>{l.set(v,m),h.set(v,o(m))});const u=new Map,f=new Map;s.forEach((m,v)=>{u.set(v,m),f.set(v,o(m))}),console.group(i!==n?`Storage: Application (path: ${i})`:`Storage: Application & Profile (path: ${i}, default profile)`);const p=[];if(a.forEach((m,v)=>{p.push({key:v,value:m})}),console.table(p),console.groupEnd(),console.log(c),i!==n){console.group(`Storage: Profile (path: ${n}, profile specific)`);const m=[];l.forEach((v,b)=>{m.push({key:b,value:v})}),console.table(m),console.groupEnd(),console.log(h)}console.group(`Storage: Workspace (path: ${r})`);const g=[];u.forEach((m,v)=>{g.push({key:v,value:m})}),console.table(g),console.groupEnd(),console.log(f)}var ca=class extends j{constructor(e,s){super(),this.a=new R,this.onDidChangeEnablement=this.a.event,this.b=this.D(new Z5(e)),this.D(this.b.onDidChange(i=>this.a.fire({extensions:i,source:"storage"}))),this.D(s.onDidInstallExtensions(i=>i.forEach(({local:n,operation:r})=>{n&&r===4&&this.f(n.identifier)})))}async enableExtension(e,s){return this.f(e)?(this.a.fire({extensions:[e],source:s}),!0):!1}async disableExtension(e,s){return this.c(e)?(this.a.fire({extensions:[e],source:s}),!0):!1}getDisabledExtensions(){return this.h(Dl)}async getDisabledExtensionsAsync(){return this.getDisabledExtensions()}c(e){const s=this.getDisabledExtensions();return s.every(i=>!G(i,e))?(s.push(e),this.g(s),!0):!1}f(e){const s=this.getDisabledExtensions();for(let i=0;i<s.length;i++){const n=s[i];if(G(n,e))return s.splice(i,1),this.g(s),!0}return!1}g(e){this.j(Dl,e)}h(e){return this.b.get(e,0)}j(e,s){this.b.set(e,s,0)}};ca=__decorate([__param(0,re),__param(1,Gs)],ca);var Z5=class extends j{constructor(t){super(),this.c=t,this.a=Object.create(null),this.b=this.D(new R),this.onDidChange=this.b.event,this.D(t.onDidChangeValue(0,void 0,this.B)(e=>this.f(e)))}get(t,e){let s;return e===0?(Et(this.a[t])&&(this.a[t]=this.g(t,e)),s=this.a[t]):s=this.g(t,e),JSON.parse(s)}set(t,e,s){const i=JSON.stringify(e.map(({id:r,uuid:o})=>({id:r,uuid:o})));this.g(t,s)!==i&&(s===0&&(e.length?this.a[t]=i:delete this.a[t]),this.h(t,e.length?i:void 0,s))}f(t){if(!Et(this.a[t.key])&&this.g(t.key,t.scope)!==this.a[t.key]){const s=this.get(t.key,t.scope);delete this.a[t.key];const i=this.get(t.key,t.scope),n=s.filter(o=>!i.some(a=>G(o,a))),r=i.filter(o=>!s.some(a=>G(a,o)));(n.length||r.length)&&this.b.fire([...n,...r])}}g(t,e){return this.c.get(t,e,"[]")}h(t,e,s){e?this.c.store(t,e,s,1):this.c.remove(t,s)}},la={},ue={exports:la};(function(t,e){if(typeof la=="object"&&typeof ue=="object")ue.exports=e();else if(typeof define=="function"&&define.amd)define([],e);else{var s=e();for(var i in s)(typeof la=="object"?la:t)[i]=s[i]}})(typeof self<"u"?self:void 0,function(){return function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=t,s.c=e,s.d=function(i,n,r){s.o(i,n)||Object.defineProperty(i,n,{enumerable:!0,get:r})},s.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},s.t=function(i,n){if(1&n&&(i=s(i)),8&n||4&n&&typeof i=="object"&&i&&i.__esModule)return i;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:i}),2&n&&typeof i!="string")for(var o in i)s.d(r,o,function(a){return i[a]}.bind(null,o));return r},s.n=function(i){var n=i&&i.__esModule?function(){return i.default}:function(){return i};return s.d(n,"a",n),n},s.o=function(i,n){return Object.prototype.hasOwnProperty.call(i,n)},s.p="",s(s.s=0)}([function(t,e,s){(function(i){var n;e=t.exports=Se,n=typeof i=="object"&&i.env&&i.env.NODE_DEBUG&&/\bsemver\b/i.test(i.env.NODE_DEBUG)?function(){var y=Array.prototype.slice.call(arguments,0);y.unshift("SEMVER"),console.log.apply(console,y)}:function(){},e.SEMVER_SPEC_VERSION="2.0.0";var r=256,o=Number.MAX_SAFE_INTEGER||9007199254740991,a=e.re=[],c=e.src=[],l=0,h=l++;c[h]="0|[1-9]\\d*";var u=l++;c[u]="[0-9]+";var f=l++;c[f]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var p=l++;c[p]="("+c[h]+")\\.("+c[h]+")\\.("+c[h]+")";var g=l++;c[g]="("+c[u]+")\\.("+c[u]+")\\.("+c[u]+")";var m=l++;c[m]="(?:"+c[h]+"|"+c[f]+")";var v=l++;c[v]="(?:"+c[u]+"|"+c[f]+")";var b=l++;c[b]="(?:-("+c[m]+"(?:\\."+c[m]+")*))";var S=l++;c[S]="(?:-?("+c[v]+"(?:\\."+c[v]+")*))";var $=l++;c[$]="[0-9A-Za-z-]+";var F=l++;c[F]="(?:\\+("+c[$]+"(?:\\."+c[$]+")*))";var B=l++,ve="v?"+c[p]+c[b]+"?"+c[F]+"?";c[B]="^"+ve+"$";var N="[v=\\s]*"+c[g]+c[S]+"?"+c[F]+"?",E=l++;c[E]="^"+N+"$";var C=l++;c[C]="((?:<|>)?=?)";var _=l++;c[_]=c[u]+"|x|X|\\*";var q=l++;c[q]=c[h]+"|x|X|\\*";var T=l++;c[T]="[v=\\s]*("+c[q]+")(?:\\.("+c[q]+")(?:\\.("+c[q]+")(?:"+c[b]+")?"+c[F]+"?)?)?";var A=l++;c[A]="[v=\\s]*("+c[_]+")(?:\\.("+c[_]+")(?:\\.("+c[_]+")(?:"+c[S]+")?"+c[F]+"?)?)?";var P=l++;c[P]="^"+c[C]+"\\s*"+c[T]+"$";var M=l++;c[M]="^"+c[C]+"\\s*"+c[A]+"$";var U=l++;c[U]="(?:^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])";var z=l++;c[z]="(?:~>?)";var ee=l++;c[ee]="(\\s*)"+c[z]+"\\s+",a[ee]=new RegExp(c[ee],"g");var ye=l++;c[ye]="^"+c[z]+c[T]+"$";var st=l++;c[st]="^"+c[z]+c[A]+"$";var He=l++;c[He]="(?:\\^)";var ts=l++;c[ts]="(\\s*)"+c[He]+"\\s+",a[ts]=new RegExp(c[ts],"g");var Si=l++;c[Si]="^"+c[He]+c[T]+"$";var Zs=l++;c[Zs]="^"+c[He]+c[A]+"$";var sn=l++;c[sn]="^"+c[C]+"\\s*("+N+")$|^$";var Ys=l++;c[Ys]="^"+c[C]+"\\s*("+ve+")$|^$";var Ei=l++;c[Ei]="(\\s*)"+c[C]+"\\s*("+N+"|"+c[T]+")",a[Ei]=new RegExp(c[Ei],"g");var ro=l++;c[ro]="^\\s*("+c[T]+")\\s+-\\s+("+c[T]+")\\s*$";var pd=l++;c[pd]="^\\s*("+c[A]+")\\s+-\\s+("+c[A]+")\\s*$";var gd=l++;c[gd]="(<|>)?=?\\s*\\*";for(var $i=0;$i<35;$i++)n($i,c[$i]),a[$i]||(a[$i]=new RegExp(c[$i]));function xi(y,x){if(y instanceof Se)return y;if(typeof y!="string"||y.length>r||!(x?a[E]:a[B]).test(y))return null;try{return new Se(y,x)}catch{return null}}function Se(y,x){if(y instanceof Se){if(y.loose===x)return y;y=y.version}else if(typeof y!="string")throw new TypeError("Invalid Version: "+y);if(y.length>r)throw new TypeError("version is longer than "+r+" characters");if(!(this instanceof Se))return new Se(y,x);n("SemVer",y,x),this.loose=x;var D=y.trim().match(x?a[E]:a[B]);if(!D)throw new TypeError("Invalid Version: "+y);if(this.raw=y,this.major=+D[1],this.minor=+D[2],this.patch=+D[3],this.major>o||this.major<0)throw new TypeError("Invalid major version");if(this.minor>o||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>o||this.patch<0)throw new TypeError("Invalid patch version");D[4]?this.prerelease=D[4].split(".").map(function(H){if(/^[0-9]+$/.test(H)){var X=+H;if(X>=0&&X<o)return X}return H}):this.prerelease=[],this.build=D[5]?D[5].split("."):[],this.format()}e.parse=xi,e.valid=function(y,x){var D=xi(y,x);return D?D.version:null},e.clean=function(y,x){var D=xi(y.trim().replace(/^[=v]+/,""),x);return D?D.version:null},e.SemVer=Se,Se.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},Se.prototype.toString=function(){return this.version},Se.prototype.compare=function(y){return n("SemVer.compare",this.version,this.loose,y),y instanceof Se||(y=new Se(y,this.loose)),this.compareMain(y)||this.comparePre(y)},Se.prototype.compareMain=function(y){return y instanceof Se||(y=new Se(y,this.loose)),nn(this.major,y.major)||nn(this.minor,y.minor)||nn(this.patch,y.patch)},Se.prototype.comparePre=function(y){if(y instanceof Se||(y=new Se(y,this.loose)),this.prerelease.length&&!y.prerelease.length)return-1;if(!this.prerelease.length&&y.prerelease.length)return 1;if(!this.prerelease.length&&!y.prerelease.length)return 0;var x=0;do{var D=this.prerelease[x],H=y.prerelease[x];if(n("prerelease compare",x,D,H),D===void 0&&H===void 0)return 0;if(H===void 0)return 1;if(D===void 0)return-1;if(D!==H)return nn(D,H)}while(++x)},Se.prototype.inc=function(y,x){switch(y){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",x);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",x);break;case"prepatch":this.prerelease.length=0,this.inc("patch",x),this.inc("pre",x);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",x),this.inc("pre",x);break;case"major":this.minor===0&&this.patch===0&&this.prerelease.length!==0||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":this.patch===0&&this.prerelease.length!==0||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var D=this.prerelease.length;--D>=0;)typeof this.prerelease[D]=="number"&&(this.prerelease[D]++,D=-2);D===-1&&this.prerelease.push(0)}x&&(this.prerelease[0]===x?isNaN(this.prerelease[1])&&(this.prerelease=[x,0]):this.prerelease=[x,0]);break;default:throw new Error("invalid increment argument: "+y)}return this.format(),this.raw=this.version,this},e.inc=function(y,x,D,H){typeof D=="string"&&(H=D,D=void 0);try{return new Se(y,D).inc(x,H).version}catch{return null}},e.diff=function(y,x){if(Cc(y,x))return null;var D=xi(y),H=xi(x);if(D.prerelease.length||H.prerelease.length){for(var X in D)if((X==="major"||X==="minor"||X==="patch")&&D[X]!==H[X])return"pre"+X;return"prerelease"}for(var X in D)if((X==="major"||X==="minor"||X==="patch")&&D[X]!==H[X])return X},e.compareIdentifiers=nn;var md=/^[0-9]+$/;function nn(y,x){var D=md.test(y),H=md.test(x);return D&&H&&(y=+y,x=+x),D&&!H?-1:H&&!D?1:y<x?-1:y>x?1:0}function js(y,x,D){return new Se(y,D).compare(new Se(x,D))}function oo(y,x,D){return js(y,x,D)>0}function ao(y,x,D){return js(y,x,D)<0}function Cc(y,x,D){return js(y,x,D)===0}function vd(y,x,D){return js(y,x,D)!==0}function Rc(y,x,D){return js(y,x,D)>=0}function Dc(y,x,D){return js(y,x,D)<=0}function co(y,x,D,H){var X;switch(x){case"===":typeof y=="object"&&(y=y.version),typeof D=="object"&&(D=D.version),X=y===D;break;case"!==":typeof y=="object"&&(y=y.version),typeof D=="object"&&(D=D.version),X=y!==D;break;case"":case"=":case"==":X=Cc(y,D,H);break;case"!=":X=vd(y,D,H);break;case">":X=oo(y,D,H);break;case">=":X=Rc(y,D,H);break;case"<":X=ao(y,D,H);break;case"<=":X=Dc(y,D,H);break;default:throw new TypeError("Invalid operator: "+x)}return X}function ss(y,x){if(y instanceof ss){if(y.loose===x)return y;y=y.value}if(!(this instanceof ss))return new ss(y,x);n("comparator",y,x),this.loose=x,this.parse(y),this.semver===Hn?this.value="":this.value=this.operator+this.semver.version,n("comp",this)}e.rcompareIdentifiers=function(y,x){return nn(x,y)},e.major=function(y,x){return new Se(y,x).major},e.minor=function(y,x){return new Se(y,x).minor},e.patch=function(y,x){return new Se(y,x).patch},e.compare=js,e.compareLoose=function(y,x){return js(y,x,!0)},e.rcompare=function(y,x,D){return js(x,y,D)},e.sort=function(y,x){return y.sort(function(D,H){return e.compare(D,H,x)})},e.rsort=function(y,x){return y.sort(function(D,H){return e.rcompare(D,H,x)})},e.gt=oo,e.lt=ao,e.eq=Cc,e.neq=vd,e.gte=Rc,e.lte=Dc,e.cmp=co,e.Comparator=ss;var Hn={};function ze(y,x){if(y instanceof ze)return y.loose===x?y:new ze(y.raw,x);if(y instanceof ss)return new ze(y.value,x);if(!(this instanceof ze))return new ze(y,x);if(this.loose=x,this.raw=y,this.set=y.split(/\s*\|\|\s*/).map(function(D){return this.parseRange(D.trim())},this).filter(function(D){return D.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+y);this.format()}function Rt(y){return!y||y.toLowerCase()==="x"||y==="*"}function Rw(y,x,D,H,X,lt,Ee,Nt,Ge,St,ys,Je,vt){return((x=Rt(D)?"":Rt(H)?">="+D+".0.0":Rt(X)?">="+D+"."+H+".0":">="+x)+" "+(Nt=Rt(Ge)?"":Rt(St)?"<"+(+Ge+1)+".0.0":Rt(ys)?"<"+Ge+"."+(+St+1)+".0":Je?"<="+Ge+"."+St+"."+ys+"-"+Je:"<="+Nt)).trim()}function Dw(y,x){for(var D=0;D<y.length;D++)if(!y[D].test(x))return!1;if(x.prerelease.length){for(D=0;D<y.length;D++)if(n(y[D].semver),y[D].semver!==Hn&&y[D].semver.prerelease.length>0){var H=y[D].semver;if(H.major===x.major&&H.minor===x.minor&&H.patch===x.patch)return!0}return!1}return!0}function lo(y,x,D){try{x=new ze(x,D)}catch{return!1}return x.test(y)}function Pc(y,x,D,H){var X,lt,Ee,Nt,Ge;switch(y=new Se(y,H),x=new ze(x,H),D){case">":X=oo,lt=Dc,Ee=ao,Nt=">",Ge=">=";break;case"<":X=ao,lt=Rc,Ee=oo,Nt="<",Ge="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(lo(y,x,H))return!1;for(var St=0;St<x.set.length;++St){var ys=x.set[St],Je=null,vt=null;if(ys.forEach(function(Tt){Tt.semver===Hn&&(Tt=new ss(">=0.0.0")),Je=Je||Tt,vt=vt||Tt,X(Tt.semver,Je.semver,H)?Je=Tt:Ee(Tt.semver,vt.semver,H)&&(vt=Tt)}),Je.operator===Nt||Je.operator===Ge||(!vt.operator||vt.operator===Nt)&&lt(y,vt.semver)||vt.operator===Ge&&Ee(y,vt.semver))return!1}return!0}ss.prototype.parse=function(y){var x=this.loose?a[sn]:a[Ys],D=y.match(x);if(!D)throw new TypeError("Invalid comparator: "+y);this.operator=D[1],this.operator==="="&&(this.operator=""),D[2]?this.semver=new Se(D[2],this.loose):this.semver=Hn},ss.prototype.toString=function(){return this.value},ss.prototype.test=function(y){return n("Comparator.test",y,this.loose),this.semver===Hn||(typeof y=="string"&&(y=new Se(y,this.loose)),co(y,this.operator,this.semver,this.loose))},ss.prototype.intersects=function(y,x){if(!(y instanceof ss))throw new TypeError("a Comparator is required");var D;if(this.operator==="")return D=new ze(y.value,x),lo(this.value,D,x);if(y.operator==="")return D=new ze(this.value,x),lo(y.semver,D,x);var H=!(this.operator!==">="&&this.operator!==">"||y.operator!==">="&&y.operator!==">"),X=!(this.operator!=="<="&&this.operator!=="<"||y.operator!=="<="&&y.operator!=="<"),lt=this.semver.version===y.semver.version,Ee=!(this.operator!==">="&&this.operator!=="<="||y.operator!==">="&&y.operator!=="<="),Nt=co(this.semver,"<",y.semver,x)&&(this.operator===">="||this.operator===">")&&(y.operator==="<="||y.operator==="<"),Ge=co(this.semver,">",y.semver,x)&&(this.operator==="<="||this.operator==="<")&&(y.operator===">="||y.operator===">");return H||X||lt&&Ee||Nt||Ge},e.Range=ze,ze.prototype.format=function(){return this.range=this.set.map(function(y){return y.join(" ").trim()}).join("||").trim(),this.range},ze.prototype.toString=function(){return this.range},ze.prototype.parseRange=function(y){var x=this.loose;y=y.trim(),n("range",y,x);var D=x?a[pd]:a[ro];y=y.replace(D,Rw),n("hyphen replace",y),y=y.replace(a[Ei],"$1$2$3"),n("comparator trim",y,a[Ei]),y=(y=(y=y.replace(a[ee],"$1~")).replace(a[ts],"$1^")).split(/\s+/).join(" ");var H=x?a[sn]:a[Ys],X=y.split(" ").map(function(lt){return function(Ee,Nt){return n("comp",Ee),Ee=function(Ge,St){return Ge.trim().split(/\s+/).map(function(ys){return function(Je,vt){n("caret",Je,vt);var Tt=vt?a[Zs]:a[Si];return Je.replace(Tt,function(cs,te,fe,Ae,qe){var wt;return n("caret",Je,cs,te,fe,Ae,qe),Rt(te)?wt="":Rt(fe)?wt=">="+te+".0.0 <"+(+te+1)+".0.0":Rt(Ae)?wt=te==="0"?">="+te+"."+fe+".0 <"+te+"."+(+fe+1)+".0":">="+te+"."+fe+".0 <"+(+te+1)+".0.0":qe?(n("replaceCaret pr",qe),qe.charAt(0)!=="-"&&(qe="-"+qe),wt=te==="0"?fe==="0"?">="+te+"."+fe+"."+Ae+qe+" <"+te+"."+fe+"."+(+Ae+1):">="+te+"."+fe+"."+Ae+qe+" <"+te+"."+(+fe+1)+".0":">="+te+"."+fe+"."+Ae+qe+" <"+(+te+1)+".0.0"):(n("no pr"),wt=te==="0"?fe==="0"?">="+te+"."+fe+"."+Ae+" <"+te+"."+fe+"."+(+Ae+1):">="+te+"."+fe+"."+Ae+" <"+te+"."+(+fe+1)+".0":">="+te+"."+fe+"."+Ae+" <"+(+te+1)+".0.0"),n("caret return",wt),wt})}(ys,St)}).join(" ")}(Ee,Nt),n("caret",Ee),Ee=function(Ge,St){return Ge.trim().split(/\s+/).map(function(ys){return function(Je,vt){var Tt=vt?a[st]:a[ye];return Je.replace(Tt,function(cs,te,fe,Ae,qe){var wt;return n("tilde",Je,cs,te,fe,Ae,qe),Rt(te)?wt="":Rt(fe)?wt=">="+te+".0.0 <"+(+te+1)+".0.0":Rt(Ae)?wt=">="+te+"."+fe+".0 <"+te+"."+(+fe+1)+".0":qe?(n("replaceTilde pr",qe),qe.charAt(0)!=="-"&&(qe="-"+qe),wt=">="+te+"."+fe+"."+Ae+qe+" <"+te+"."+(+fe+1)+".0"):wt=">="+te+"."+fe+"."+Ae+" <"+te+"."+(+fe+1)+".0",n("tilde return",wt),wt})}(ys,St)}).join(" ")}(Ee,Nt),n("tildes",Ee),Ee=function(Ge,St){return n("replaceXRanges",Ge,St),Ge.split(/\s+/).map(function(ys){return function(Je,vt){Je=Je.trim();var Tt=vt?a[M]:a[P];return Je.replace(Tt,function(cs,te,fe,Ae,qe,wt){n("xRange",Je,cs,te,fe,Ae,qe,wt);var wd=Rt(fe),Gn=wd||Rt(Ae),Jn=Gn||Rt(qe);return te==="="&&Jn&&(te=""),wd?cs=te===">"||te==="<"?"<0.0.0":"*":te&&Jn?(Gn&&(Ae=0),Jn&&(qe=0),te===">"?(te=">=",Gn?(fe=+fe+1,Ae=0,qe=0):Jn&&(Ae=+Ae+1,qe=0)):te==="<="&&(te="<",Gn?fe=+fe+1:Ae=+Ae+1),cs=te+fe+"."+Ae+"."+qe):Gn?cs=">="+fe+".0.0 <"+(+fe+1)+".0.0":Jn&&(cs=">="+fe+"."+Ae+".0 <"+fe+"."+(+Ae+1)+".0"),n("xRange return",cs),cs})}(ys,St)}).join(" ")}(Ee,Nt),n("xrange",Ee),Ee=function(Ge,St){return n("replaceStars",Ge,St),Ge.trim().replace(a[gd],"")}(Ee,Nt),n("stars",Ee),Ee}(lt,x)}).join(" ").split(/\s+/);return this.loose&&(X=X.filter(function(lt){return!!lt.match(H)})),X=X.map(function(lt){return new ss(lt,x)})},ze.prototype.intersects=function(y,x){if(!(y instanceof ze))throw new TypeError("a Range is required");return this.set.some(function(D){return D.every(function(H){return y.set.some(function(X){return X.every(function(lt){return H.intersects(lt,x)})})})})},e.toComparators=function(y,x){return new ze(y,x).set.map(function(D){return D.map(function(H){return H.value}).join(" ").trim().split(" ")})},ze.prototype.test=function(y){if(!y)return!1;typeof y=="string"&&(y=new Se(y,this.loose));for(var x=0;x<this.set.length;x++)if(Dw(this.set[x],y))return!0;return!1},e.satisfies=lo,e.maxSatisfying=function(y,x,D){var H=null,X=null;try{var lt=new ze(x,D)}catch{return null}return y.forEach(function(Ee){lt.test(Ee)&&(H&&X.compare(Ee)!==-1||(X=new Se(H=Ee,D)))}),H},e.minSatisfying=function(y,x,D){var H=null,X=null;try{var lt=new ze(x,D)}catch{return null}return y.forEach(function(Ee){lt.test(Ee)&&(H&&X.compare(Ee)!==1||(X=new Se(H=Ee,D)))}),H},e.validRange=function(y,x){try{return new ze(y,x).range||"*"}catch{return null}},e.ltr=function(y,x,D){return Pc(y,x,"<",D)},e.gtr=function(y,x,D){return Pc(y,x,">",D)},e.outside=Pc,e.prerelease=function(y,x){var D=xi(y,x);return D&&D.prerelease.length?D.prerelease:null},e.intersects=function(y,x,D){return y=new ze(y,D),x=new ze(x,D),y.intersects(x)},e.coerce=function(y){if(y instanceof Se)return y;if(typeof y!="string")return null;var x=y.match(a[U]);return x==null?null:xi((x[1]||"0")+"."+(x[2]||"0")+"."+(x[3]||"0"))}}).call(this,s(1))},function(t,e){var s,i,n=t.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(v){if(s===setTimeout)return setTimeout(v,0);if((s===r||!s)&&setTimeout)return s=setTimeout,setTimeout(v,0);try{return s(v,0)}catch{try{return s.call(null,v,0)}catch{return s.call(this,v,0)}}}(function(){try{s=typeof setTimeout=="function"?setTimeout:r}catch{s=r}try{i=typeof clearTimeout=="function"?clearTimeout:o}catch{i=o}})();var c,l=[],h=!1,u=-1;function f(){h&&c&&(h=!1,c.length?l=c.concat(l):u=-1,l.length&&p())}function p(){if(!h){var v=a(f);h=!0;for(var b=l.length;b;){for(c=l,l=[];++u<b;)c&&c[u].run();u=-1,b=l.length}c=null,h=!1,function(S){if(i===clearTimeout)return clearTimeout(S);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(S);try{i(S)}catch{try{return i.call(null,S)}catch{return i.call(this,S)}}}(v)}}function g(v,b){this.fun=v,this.array=b}function m(){}n.nextTick=function(v){var b=new Array(arguments.length-1);if(arguments.length>1)for(var S=1;S<arguments.length;S++)b[S-1]=arguments[S];l.push(new g(v,b)),l.length!==1||h||a(p)},g.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=m,n.addListener=m,n.once=m,n.off=m,n.removeListener=m,n.removeAllListeners=m,n.emit=m,n.prependListener=m,n.prependOnceListener=m,n.listeners=function(v){return[]},n.binding=function(v){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(v){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}}])});var RE=ue.exports.SEMVER_SPEC_VERSION,DE=ue.exports.parse,Y5=ue.exports.valid,PE=ue.exports.coerce,IE=ue.exports.clean,AE=ue.exports.inc,LE=ue.exports.major,OE=ue.exports.minor,NE=ue.exports.patch,TE=ue.exports.prerelease,ha=ue.exports.gt,jE=ue.exports.gte,ME=ue.exports.lt,e9=ue.exports.lte,t9=ue.exports.eq,UE=ue.exports.neq,FE=ue.exports.cmp,qE=ue.exports.compare,Qg=ue.exports.rcompare,_E=ue.exports.compareIdentifiers,zE=ue.exports.rcompareIdentifiers,VE=ue.exports.compareBuild,BE=ue.exports.sort,WE=ue.exports.rsort,HE=ue.exports.diff,GE=ue.exports.validRange,s9=ue.exports.satisfies,JE=ue.exports.maxSatisfying,KE=ue.exports.minSatisfying,QE=ue.exports.minVersion,XE=ue.exports.gtr,ZE=ue.exports.ltr,YE=ue.exports.outside,e$=ue.exports.intersects,t$=ue.exports.SemVer,s$=ue.exports.Comparator,i$=ue.exports.Range,lh="Offline";function Xg(t){return t instanceof i9?!0:t instanceof Error&&t.name===lh&&t.message===lh}var i9=class extends Error{constructor(){super(lh),this.name=this.message}},Dr;(function(t){t[t.Ignore=0]="Ignore",t[t.Info=1]="Info",t[t.Warning=2]="Warning",t[t.Error=3]="Error"})(Dr||(Dr={})),function(t){const e="error",s="warning",i="warn",n="info",r="ignore";function o(c){return c?ti(e,c)?t.Error:ti(s,c)||ti(i,c)?t.Warning:ti(n,c)?t.Info:t.Ignore:t.Ignore}t.fromValue=o;function a(c){switch(c){case t.Error:return e;case t.Warning:return s;case t.Info:return n;default:return r}}t.toString=a}(Dr||(Dr={}));var pt=Dr,n9={activeComment:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.activeComment.d.ts"},aiRelatedInformation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.aiRelatedInformation.d.ts"},aiSettingsSearch:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.aiSettingsSearch.d.ts"},aiTextSearchProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.aiTextSearchProvider.d.ts",version:2},authIssuers:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.authIssuers.d.ts"},authLearnMore:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.authLearnMore.d.ts"},authProviderSpecific:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.authProviderSpecific.d.ts"},authSession:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.authSession.d.ts"},authenticationChallenges:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.authenticationChallenges.d.ts"},canonicalUriProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.canonicalUriProvider.d.ts"},chatContextProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatContextProvider.d.ts"},chatEditing:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatEditing.d.ts"},chatOutputRenderer:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatOutputRenderer.d.ts"},chatParticipantAdditions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts"},chatParticipantPrivate:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatParticipantPrivate.d.ts",version:11},chatProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatProvider.d.ts",version:4},chatReferenceBinaryData:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatReferenceBinaryData.d.ts"},chatReferenceDiagnostic:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatReferenceDiagnostic.d.ts"},chatSessionsProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatSessionsProvider.d.ts",version:3},chatStatusItem:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatStatusItem.d.ts"},chatTab:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatTab.d.ts"},codeActionAI:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.codeActionAI.d.ts"},codeActionRanges:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.codeActionRanges.d.ts"},codiconDecoration:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.codiconDecoration.d.ts"},commentReactor:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentReactor.d.ts"},commentReveal:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentReveal.d.ts"},commentThreadApplicability:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentThreadApplicability.d.ts"},commentingRangeHint:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentingRangeHint.d.ts"},commentsDraftState:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentsDraftState.d.ts"},contribAccessibilityHelpContent:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribAccessibilityHelpContent.d.ts"},contribCommentEditorActionsMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentEditorActionsMenu.d.ts"},contribCommentPeekContext:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentPeekContext.d.ts"},contribCommentThreadAdditionalMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentThreadAdditionalMenu.d.ts"},contribCommentsViewThreadMenus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentsViewThreadMenus.d.ts"},contribDebugCreateConfiguration:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribDebugCreateConfiguration.d.ts"},contribDiffEditorGutterToolBarMenus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribDiffEditorGutterToolBarMenus.d.ts"},contribEditSessions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribEditSessions.d.ts"},contribEditorContentMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribEditorContentMenu.d.ts"},contribLabelFormatterWorkspaceTooltip:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribLabelFormatterWorkspaceTooltip.d.ts"},contribLanguageModelToolSets:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribLanguageModelToolSets.d.ts"},contribMenuBarHome:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribMenuBarHome.d.ts"},contribMergeEditorMenus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribMergeEditorMenus.d.ts"},contribMultiDiffEditorMenus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribMultiDiffEditorMenus.d.ts"},contribNotebookStaticPreloads:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribNotebookStaticPreloads.d.ts"},contribRemoteHelp:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribRemoteHelp.d.ts"},contribShareMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribShareMenu.d.ts"},contribSourceControlArtifactGroupMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSourceControlArtifactGroupMenu.d.ts"},contribSourceControlArtifactMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSourceControlArtifactMenu.d.ts"},contribSourceControlHistoryItemMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSourceControlHistoryItemMenu.d.ts"},contribSourceControlHistoryTitleMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSourceControlHistoryTitleMenu.d.ts"},contribSourceControlInputBoxMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSourceControlInputBoxMenu.d.ts"},contribSourceControlTitleMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSourceControlTitleMenu.d.ts"},contribStatusBarItems:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribStatusBarItems.d.ts"},contribViewContainerTitle:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribViewContainerTitle.d.ts"},contribViewsRemote:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribViewsRemote.d.ts"},contribViewsWelcome:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribViewsWelcome.d.ts"},customEditorMove:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.customEditorMove.d.ts"},dataChannels:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.dataChannels.d.ts"},debugVisualization:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.debugVisualization.d.ts"},defaultChatParticipant:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.defaultChatParticipant.d.ts",version:4},devDeviceId:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.devDeviceId.d.ts"},diffCommand:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.diffCommand.d.ts"},diffContentOptions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.diffContentOptions.d.ts"},documentFiltersExclusive:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.documentFiltersExclusive.d.ts"},editSessionIdentityProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.editSessionIdentityProvider.d.ts"},editorHoverVerbosityLevel:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.editorHoverVerbosityLevel.d.ts"},editorInsets:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.editorInsets.d.ts"},embeddings:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.embeddings.d.ts"},extensionRuntime:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.extensionRuntime.d.ts"},extensionsAny:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.extensionsAny.d.ts"},externalUriOpener:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.externalUriOpener.d.ts"},fileSearchProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.fileSearchProvider.d.ts"},fileSearchProvider2:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.fileSearchProvider2.d.ts"},findFiles2:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.findFiles2.d.ts",version:2},findTextInFiles:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.findTextInFiles.d.ts"},findTextInFiles2:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.findTextInFiles2.d.ts"},fsChunks:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.fsChunks.d.ts"},inlineCompletionsAdditions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts"},interactive:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.interactive.d.ts"},interactiveWindow:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.interactiveWindow.d.ts"},ipc:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.ipc.d.ts"},languageModelCapabilities:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.languageModelCapabilities.d.ts"},languageModelProxy:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.languageModelProxy.d.ts"},languageModelSystem:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.languageModelSystem.d.ts"},languageModelThinkingPart:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.languageModelThinkingPart.d.ts",version:1},languageModelToolResultAudience:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.languageModelToolResultAudience.d.ts"},languageStatusText:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.languageStatusText.d.ts"},mappedEditsProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.mappedEditsProvider.d.ts"},markdownAlertSyntax:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.markdownAlertSyntax.d.ts"},mcpToolDefinitions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.mcpToolDefinitions.d.ts"},multiDocumentHighlightProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.multiDocumentHighlightProvider.d.ts"},nativeWindowHandle:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.nativeWindowHandle.d.ts"},newSymbolNamesProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.newSymbolNamesProvider.d.ts"},notebookCellExecution:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookCellExecution.d.ts"},notebookControllerAffinityHidden:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookControllerAffinityHidden.d.ts"},notebookDeprecated:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookDeprecated.d.ts"},notebookExecution:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookExecution.d.ts"},notebookKernelSource:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookKernelSource.d.ts"},notebookLiveShare:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookLiveShare.d.ts"},notebookMessaging:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookMessaging.d.ts"},notebookMime:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookMime.d.ts"},notebookReplDocument:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookReplDocument.d.ts"},notebookVariableProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookVariableProvider.d.ts"},portsAttributes:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.portsAttributes.d.ts"},profileContentHandlers:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.profileContentHandlers.d.ts"},quickDiffProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickDiffProvider.d.ts"},quickInputButtonLocation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickInputButtonLocation.d.ts"},quickPickItemResource:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickPickItemResource.d.ts"},quickPickItemTooltip:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickPickItemTooltip.d.ts"},quickPickPrompt:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickPickPrompt.d.ts"},quickPickSortByLabel:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickPickSortByLabel.d.ts"},remoteCodingAgents:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.remoteCodingAgents.d.ts"},resolvers:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.resolvers.d.ts"},scmActionButton:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmActionButton.d.ts"},scmArtifactProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmArtifactProvider.d.ts"},scmHistoryProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmHistoryProvider.d.ts"},scmMultiDiffEditor:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmMultiDiffEditor.d.ts"},scmProviderOptions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmProviderOptions.d.ts"},scmSelectedProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmSelectedProvider.d.ts"},scmTextDocument:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmTextDocument.d.ts"},scmValidation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmValidation.d.ts"},shareProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.shareProvider.d.ts"},speech:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.speech.d.ts"},statusBarItemTooltip:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.statusBarItemTooltip.d.ts"},tabInputMultiDiff:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tabInputMultiDiff.d.ts"},tabInputTextMerge:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tabInputTextMerge.d.ts"},taskExecutionTerminal:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.taskExecutionTerminal.d.ts"},taskPresentationGroup:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.taskPresentationGroup.d.ts"},taskProblemMatcherStatus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.taskProblemMatcherStatus.d.ts"},telemetry:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.telemetry.d.ts"},terminalCompletionProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalCompletionProvider.d.ts"},terminalDataWriteEvent:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalDataWriteEvent.d.ts"},terminalDimensions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalDimensions.d.ts"},terminalExecuteCommandEvent:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalExecuteCommandEvent.d.ts"},terminalQuickFixProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalQuickFixProvider.d.ts"},terminalSelection:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalSelection.d.ts"},terminalShellEnv:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalShellEnv.d.ts"},testObserver:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.testObserver.d.ts"},testRelatedCode:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.testRelatedCode.d.ts"},textDocumentChangeReason:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.textDocumentChangeReason.d.ts"},textEditorDiffInformation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.textEditorDiffInformation.d.ts"},textSearchComplete2:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.textSearchComplete2.d.ts"},textSearchProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.textSearchProvider.d.ts"},textSearchProvider2:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.textSearchProvider2.d.ts"},timeline:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.timeline.d.ts"},tokenInformation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tokenInformation.d.ts"},toolProgress:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.toolProgress.d.ts"},treeItemMarkdownLabel:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.treeItemMarkdownLabel.d.ts"},treeViewActiveItem:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.treeViewActiveItem.d.ts"},treeViewMarkdownMessage:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.treeViewMarkdownMessage.d.ts"},treeViewReveal:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.treeViewReveal.d.ts"},tunnelFactory:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tunnelFactory.d.ts"},tunnels:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tunnels.d.ts"},valueSelectionInQuickPick:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.valueSelectionInQuickPick.d.ts"},workspaceTrust:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.workspaceTrust.d.ts"}},r9=Object.freeze(n9),Zg=/^(\^|>=)?((\d+)|x)\.((\d+)|x)\.((\d+)|x)(\-.*)?$/,o9=/^-(\d{4})(\d{2})(\d{2})$/;function a9(t){return t=t.trim(),t==="*"||Zg.test(t)}function hh(t){if(!a9(t))return null;if(t=t.trim(),t==="*")return{hasCaret:!1,hasGreaterEquals:!1,majorBase:0,majorMustEqual:!1,minorBase:0,minorMustEqual:!1,patchBase:0,patchMustEqual:!1,preRelease:null};const e=t.match(Zg);return e?{hasCaret:e[1]==="^",hasGreaterEquals:e[1]===">=",majorBase:e[2]==="x"?0:parseInt(e[2],10),majorMustEqual:e[2]!=="x",minorBase:e[4]==="x"?0:parseInt(e[4],10),minorMustEqual:e[4]!=="x",patchBase:e[6]==="x"?0:parseInt(e[6],10),patchMustEqual:e[6]!=="x",preRelease:e[8]||null}:null}function uh(t){if(!t)return null;const e=t.majorBase,s=t.majorMustEqual,i=t.minorBase;let n=t.minorMustEqual;const r=t.patchBase;let o=t.patchMustEqual;t.hasCaret&&(e===0||(n=!1),o=!1);let a=0;if(t.preRelease){const c=o9.exec(t.preRelease);if(c){const[,l,h,u]=c;a=Date.UTC(Number(l),Number(h)-1,Number(u))}}return{majorBase:e,majorMustEqual:s,minorBase:i,minorMustEqual:n,patchBase:r,patchMustEqual:o,isMinimum:t.hasGreaterEquals,notBefore:a}}function c9(t,e,s){let i;typeof t=="string"?i=uh(hh(t)):i=t;let n;e instanceof Date?n=e.getTime():typeof e=="string"&&(n=new Date(e).getTime());let r;if(typeof s=="string"?r=uh(hh(s)):r=s,!i||!r)return!1;const o=i.majorBase,a=i.minorBase,c=i.patchBase;let l=r.majorBase,h=r.minorBase,u=r.patchBase;const f=r.notBefore;let p=r.majorMustEqual,g=r.minorMustEqual,m=r.patchMustEqual;return r.isMinimum?o>l?!0:o<l?!1:a>h?!0:a<h||n&&n<f?!1:c>=u:(o===1&&l===0&&(!p||!g||!m)&&(l=1,h=0,u=0,p=!0,g=!1,m=!1),o<l?!1:o>l?!p:a<h?!1:a>h?!g:c<u?!1:c>u?!m:!(n&&n<f))}function l9(t,e,s,i,n,r){const o=[];if(typeof i.publisher<"u"&&typeof i.publisher!="string")return o.push([pt.Error,w(2051,null)]),o;if(typeof i.name!="string")return o.push([pt.Error,w(2052,null,"name")]),o;if(typeof i.version!="string")return o.push([pt.Error,w(2053,null,"version")]),o;if(!i.engines)return o.push([pt.Error,w(2054,null,"engines")]),o;if(typeof i.engines.vscode!="string")return o.push([pt.Error,w(2055,null,"engines.vscode")]),o;if(typeof i.extensionDependencies<"u"&&!e0(i.extensionDependencies))return o.push([pt.Error,w(2056,null,"extensionDependencies")]),o;if(typeof i.activationEvents<"u"){if(!e0(i.activationEvents))return o.push([pt.Error,w(2057,null,"activationEvents")]),o;if(typeof i.main>"u"&&typeof i.browser>"u")return o.push([pt.Error,w(2058,null,"activationEvents","main","browser")]),o}if(typeof i.extensionKind<"u"&&typeof i.main>"u"&&o.push([pt.Warning,w(2059,null,"extensionKind")]),typeof i.main<"u"){if(typeof i.main!="string")return o.push([pt.Error,w(2060,null,"main")]),o;{const l=V(s,i.main);D1(l,s)||o.push([pt.Warning,w(2061,null,l.path,s.path)])}}if(typeof i.browser<"u"){if(typeof i.browser!="string")return o.push([pt.Error,w(2062,null,"browser")]),o;{const l=V(s,i.browser);D1(l,s)||o.push([pt.Warning,w(2063,null,l.path,s.path)])}}if(!Y5(i.version))return o.push([pt.Error,w(2064,null)]),o;const a=[];if(!h9(t,e,i,n,a))for(const l of a)o.push([pt.Error,l]);if(r&&i.enabledApiProposals?.length){const l=[];if(!dh([...i.enabledApiProposals],l))for(const h of l)o.push([pt.Error,h])}return o}function h9(t,e,s,i,n){return i||typeof s.main>"u"&&typeof s.browser>"u"?!0:Yg(t,e,s.engines.vscode,n)}function fh(t,e,s){return t==="*"||Yg(e,s,t)}function dh(t,e){if(t.length===0)return!0;const s=Array.isArray(e)?e:void 0,i=(Array.isArray(e)?void 0:e)??r9,n=[],r=C5(t);for(const{proposalName:o,version:a}of r){if(!a)continue;i[o]?.version!==a&&n.push(o)}return n.length?(s&&(n.length===1?s.push(w(2065,null,n[0])):s.push(w(2066,null,n.slice(0,n.length-1).map(o=>`'${o}'`).join(", "),n[n.length-1]))),!1):!0}function Yg(t,e,s,i=[]){const n=uh(hh(s));if(!n)return i.push(w(2067,null,s)),!1;if(n.majorBase===0){if(!n.majorMustEqual||!n.minorMustEqual)return i.push(w(2068,null,s)),!1}else if(!n.majorMustEqual)return i.push(w(2069,null,s)),!1;return c9(t,e,n)?!0:(i.push(w(2070,null,t,s)),!1)}function e0(t){if(!Array.isArray(t))return!1;for(let e=0,s=t.length;e<s;e++)if(typeof t[e]!="string")return!1;return!0}async function On(t,e,s){let i=s&&s.get("storage.serviceMachineId",-1)||null;if(i)return i;try{const r=(await e.readFile(t.serviceMachineIdResource)).value.toString();i=f5(r)?r:null}catch{i=null}if(!i){i=tt();try{await e.writeFile(t.serviceMachineIdResource,L.fromString(i))}catch{}}return s?.store("storage.serviceMachineId",i,-1,1),i}async function u9(t,e,s,i,n,r,o){const a={"X-Market-Client-Id":`VSCode ${t}`,"User-Agent":`VSCode ${t} (${e.nameShort})`};if(jg(e,s)&&Ug(i)===3){const c=await On(s,n,r);a["X-Market-User-Id"]=c,a["VSCode-SessionId"]=o.machineId||c}return a}var t0;(function(t){t.ExtensionQueryService="ExtensionQueryService",t.ExtensionLatestVersionUri="ExtensionLatestVersionUriTemplate",t.ExtensionStatisticsUri="ExtensionStatisticsUriTemplate",t.WebExtensionStatisticsUri="WebExtensionStatisticsUriTemplate",t.PublisherViewUri="PublisherViewUriTemplate",t.ExtensionDetailsViewUri="ExtensionDetailsViewUriTemplate",t.ExtensionRatingViewUri="ExtensionRatingViewUriTemplate",t.ExtensionResourceUri="ExtensionResourceUriTemplate",t.ContactSupportUri="ContactSupportUri"})(t0||(t0={}));var s0;(function(t){t.None="None",t.IncludeVersions="IncludeVersions",t.IncludeFiles="IncludeFiles",t.IncludeCategoryAndTags="IncludeCategoryAndTags",t.IncludeSharedAccounts="IncludeSharedAccounts",t.IncludeVersionProperties="IncludeVersionProperties",t.ExcludeNonValidated="ExcludeNonValidated",t.IncludeInstallationTargets="IncludeInstallationTargets",t.IncludeAssetUri="IncludeAssetUri",t.IncludeStatistics="IncludeStatistics",t.IncludeLatestVersionOnly="IncludeLatestVersionOnly",t.Unpublished="Unpublished",t.IncludeNameConflictInfo="IncludeNameConflictInfo",t.IncludeLatestPrereleaseAndStableVersionOnly="IncludeLatestPrereleaseAndStableVersionOnly"})(s0||(s0={}));var i0;(function(t){t.Available="available",t.RequiresSignIn="requiresSignIn",t.AccessDenied="accessDenied",t.Unavailable="unavailable"})(i0||(i0={}));var Pr=W("IExtensionGalleryManifestService");function Wi(t,e){const[s,i]=e.split("/");for(const n of t.resources){const[r,o]=n.type.split("/");if(r===s){if(!i||o===i)return n.id;break}}}var ua=at?"web":Dp(sr,u1),fa="X-Market-Search-Activity-Id",ph="Activityid",gh="Server",mh="X-Vss-E2eid",gt={Icon:"Microsoft.VisualStudio.Services.Icons.Default",Details:"Microsoft.VisualStudio.Services.Content.Details",Changelog:"Microsoft.VisualStudio.Services.Content.Changelog",Manifest:"Microsoft.VisualStudio.Code.Manifest",VSIX:"Microsoft.VisualStudio.Services.VSIXPackage",License:"Microsoft.VisualStudio.Services.Content.License",Repository:"Microsoft.VisualStudio.Services.Links.Source",Signature:"Microsoft.VisualStudio.Services.VsixSignature"},Rs={Dependency:"Microsoft.VisualStudio.Code.ExtensionDependencies",ExtensionPack:"Microsoft.VisualStudio.Code.ExtensionPack",Engine:"Microsoft.VisualStudio.Code.Engine",PreRelease:"Microsoft.VisualStudio.Code.PreRelease",EnabledApiProposals:"Microsoft.VisualStudio.Code.EnabledApiProposals",LocalizedLanguages:"Microsoft.VisualStudio.Code.LocalizedLanguages",WebExtension:"Microsoft.VisualStudio.Code.WebExtension",SponsorLink:"Microsoft.VisualStudio.Code.SponsorLink",SupportLink:"Microsoft.VisualStudio.Services.Links.Support",ExecutesCode:"Microsoft.VisualStudio.Code.ExecutesCode",Private:"PrivateMarketplace"},f9=10,d9={pageNumber:1,pageSize:f9,sortBy:"NoneOrRelevance",sortOrder:0,flags:[],criteria:[],assetTypes:[]},n0;(function(t){t[t.Release=0]="Release",t[t.Prerelease=1]="Prerelease",t[t.Latest=2]="Latest"})(n0||(n0={}));var da=class bi{constructor(e=d9){this.d=e}get pageNumber(){return this.d.pageNumber}get pageSize(){return this.d.pageSize}get sortBy(){return this.d.sortBy}get sortOrder(){return this.d.sortOrder}get flags(){return this.d.flags}get criteria(){return this.d.criteria}get assetTypes(){return this.d.assetTypes}get source(){return this.d.source}get searchText(){const e=this.d.criteria.filter(s=>s.filterType==="SearchText")[0];return e&&e.value?e.value:""}withPage(e,s=this.d.pageSize){return new bi({...this.d,pageNumber:e,pageSize:s})}withFilter(e,...s){const i=[...this.d.criteria,...s.length?s.map(n=>({filterType:e,value:n})):[{filterType:e}]];return new bi({...this.d,criteria:i})}withSortBy(e){return new bi({...this.d,sortBy:e})}withSortOrder(e){return new bi({...this.d,sortOrder:e})}withFlags(...e){return new bi({...this.d,flags:Dt(e)})}withAssetTypes(...e){return new bi({...this.d,assetTypes:e})}withSource(e){return new bi({...this.d,source:e})}};function vh(t,e){const s=(t||[]).filter(i=>i.statisticName===e)[0];return s?s.value:0}function p9(t){const e="Microsoft.VisualStudio.Code.Translation.";return t.files.filter(i=>i.assetType.indexOf(e)===0).reduce((i,n)=>{const r=Ds(t,n.assetType);return r&&i.push([n.assetType.substring(e.length),r]),i},[])}function g9(t){if(t.properties){const e=t.properties.filter(n=>n.key===gt.Repository),s=new RegExp("((git|ssh|http(s)?)|(git@[\\w.]+))(:(//)?)([\\w.@:/\\-~]+)(.git)(/)?"),i=e.filter(n=>s.test(n.value))[0];return i?{uri:i.value,fallbackUri:i.value}:null}return Ds(t,gt.Repository)}function m9(t){return{uri:`${t.fallbackAssetUri}/${gt.VSIX}?redirect=true${t.targetPlatform?`&targetPlatform=${t.targetPlatform}`:""}`,fallbackUri:`${t.fallbackAssetUri}/${gt.VSIX}${t.targetPlatform?`?targetPlatform=${t.targetPlatform}`:""}`}}function Ds(t,e){return t.files.filter(i=>i.assetType===e)[0]?{uri:`${t.assetUri}/${e}${t.targetPlatform?`?targetPlatform=${t.targetPlatform}`:""}`,fallbackUri:`${t.fallbackAssetUri}/${e}${t.targetPlatform?`?targetPlatform=${t.targetPlatform}`:""}`}:null}function r0(t,e){const s=t.properties?t.properties.filter(n=>n.key===e):[],i=s.length>0&&s[0].value;return i?i.split(",").map(n=>Cr(n)):[]}function wh(t){const e=t.properties?t.properties.filter(s=>s.key===Rs.Engine):[];return e.length>0&&e[0].value||""}function Nn(t){const e=t.properties?t.properties.filter(s=>s.key===Rs.PreRelease):[];return e.length>0&&e[0].value==="true"}function o0(t,e){return e.extensionProperties?.[t.toLowerCase()]?.hasPrereleaseVersion}function v9(t,e){return e.extensionProperties?.[t.toLowerCase()]?.excludeVersionRange}function w9(t){const e=t.properties?t.properties.filter(s=>s.key===Rs.Private):[];return e.length>0&&e[0].value==="true"}function y9(t){const e=t.properties?t.properties.filter(s=>s.key===Rs.ExecutesCode):[];return e.length>0?e[0].value==="true":void 0}function yh(t){const e=t.properties?t.properties.filter(i=>i.key===Rs.EnabledApiProposals):[],s=e.length>0&&e[0].value||"";return s?s.split(","):[]}function b9(t){const e=t.properties?t.properties.filter(i=>i.key===Rs.LocalizedLanguages):[],s=e.length>0&&e[0].value||"";return s?s.split(","):[]}function S9(t){return t.properties?.find(e=>e.key===Rs.SponsorLink)?.value}function E9(t){return t.properties?.find(e=>e.key===Rs.SupportLink)?.value}function $9(t){return t.indexOf("preview")!==-1}function Hi(t){return t.targetPlatform?D2(t.targetPlatform):"undefined"}function pa(t){const e=Dt(t.versions.map(Hi)),s=!!t.tags?.includes(x2),i=e.indexOf("web");return s?i===-1&&e.push("web"):i!==-1&&e.splice(i,1),e}function a0(t,e){for(let s=0;s<t.length;s++){const i=t[s];if(i.version===t[s-1]?.version){let n=s;if(Hi(i)===e)for(;n>0&&t[n-1].version===i.version;)n--;n!==s&&(t.splice(s,1),t.splice(n,0,i))}}return t}function x9(t,e,s){const i=[];let n=-1,r=-1;for(const o of t){const a=Hi(o);if(!Rl(a,s,e)){i.push(o);continue}Nn(o)?n===-1?(n=i.length,i.push(o)):a===e&&(i[n]=o):r===-1?(r=i.length,i.push(o)):a===e&&(i[r]=o)}return i}function c0(t,e,s){t.telemetryData={index:e,querySource:s,queryActivityId:t.queryContext?.[fa]}}function bh(t,e,s,i,n,r){const o=t.versions[0],a={manifest:Ds(e,gt.Manifest),readme:Ds(e,gt.Details),changelog:Ds(e,gt.Changelog),license:Ds(e,gt.License),repository:g9(e),download:m9(e),icon:Ds(e,gt.Icon),signature:Ds(e,gt.Signature),coreTranslations:p9(e)},c=Wi(i,t.linkType??"ExtensionDetailsViewUriTemplate"),l=Wi(i,t.publisher.linkType??"PublisherViewUriTemplate"),h=Wi(i,t.ratingLinkType??"ExtensionRatingViewUriTemplate"),u=Ks(t.publisher.publisherName,t.extensionName);return{type:"gallery",identifier:{id:u,uuid:t.extensionId},name:t.extensionName,version:e.version,displayName:t.displayName,publisherId:t.publisher.publisherId,publisher:t.publisher.publisherName,publisherDisplayName:t.publisher.displayName,publisherDomain:t.publisher.domain?{link:t.publisher.domain,verified:!!t.publisher.isDomainVerified}:void 0,publisherSponsorLink:S9(o),description:t.shortDescription??"",installCount:vh(t.statistics,"install"),rating:vh(t.statistics,"averagerating"),ratingCount:vh(t.statistics,"ratingcount"),categories:t.categories||[],tags:t.tags||[],releaseDate:Date.parse(t.releaseDate),lastUpdated:Date.parse(t.lastUpdated),allTargetPlatforms:s,assets:a,properties:{dependencies:r0(e,Rs.Dependency),extensionPack:r0(e,Rs.ExtensionPack),engine:wh(e),enabledApiProposals:yh(e),localizedLanguages:b9(e),targetPlatform:Hi(e),isPreReleaseVersion:Nn(e),executesCode:y9(e)},hasPreReleaseVersion:o0(u,n)??Nn(o),hasReleaseVersion:!0,private:w9(o),preview:$9(t.flags),isSigned:!!a.signature,queryContext:r,supportLink:E9(o),detailsLink:c?is(c,{publisher:t.publisher.publisherName,name:t.extensionName}):void 0,publisherLink:l?is(l,{publisher:t.publisher.publisherName}):void 0,ratingLink:h?is(h,{publisher:t.publisher.publisherName,name:t.extensionName}):void 0}}var ga=class{constructor(e,s,i,n,r,o,a,c,l,h){this.k=s,this.l=i,this.n=n,this.o=r,this.q=o,this.u=a,this.w=c,this.x=l,this.y=h,this.d=a.extensionsGallery?.controlUrl,this.g=a.extensionsGallery?.extensionUrlTemplate,this.j=a.extensionsEnabledWithApiProposalVersion?.map(u=>u.toLowerCase())??[],this.h=u9(a.version,a,this.n,this.w,this.q,e,this.o)}isEnabled(){return this.y.extensionGalleryManifestStatus==="available"}async getExtensions(e,s,i){const n=await this.y.getExtensionGalleryManifest();if(!n)throw new Error("No extension gallery service configured.");const r=Z.isCancellationToken(s)?{}:s,o=Z.isCancellationToken(s)?s:i,a=this.z(n),c=a?await this.B(e,r,a,n,o):await this.A(e,r,n,o),l=c.map(u=>u.identifier.uuid),h=[];for(const u of e)u.uuid&&!l.includes(u.uuid)&&h.push({...u,uuid:void 0});if(h.length){this.o.publicLog2("galleryService:additionalQueryByName",{count:h.length});const u=await this.A(h,r,n,o);c.push(...u)}return c}z(e){const s=Wi(e,"ExtensionLatestVersionUriTemplate");if(s)return{uri:s,fallback:this.g}}async A(e,s,i,n){const r=[],o=[],a=[],c=[];let l=!0;for(const f of e)f.uuid?o.push(f.uuid):r.push(f.id),f.version?c.push({id:f.id,uuid:f.uuid,version:f.version}):a.push({id:f.id,uuid:f.uuid,includePreRelease:!!f.preRelease}),l=l&&!!f.hasPreRelease&&!f.preRelease;if(!o.length&&!r.length)return[];let h=new da().withPage(1,e.length);o.length&&(h=h.withFilter("ExtensionId",...o)),r.length&&(h=h.withFilter("ExtensionName",...r)),s.queryAllVersions&&(h=h.withFlags(...h.flags,"IncludeVersions")),s.source&&(h=h.withSource(s.source));const{extensions:u}=await this.G(h,{targetPlatform:s.targetPlatform??ua,includePreRelease:a,versions:c,compatible:!!s.compatible,productVersion:s.productVersion??{version:this.u.version,date:this.u.date},isQueryForReleaseVersionFromPreReleaseVersion:l},i,n);return s.source&&u.forEach((f,p)=>c0(f,p,s.source)),u}async B(e,s,i,n,r){const o=[],a=[],c=[];for(const l of e)kp.test(l.id)&&(l.version?a.push(l):c.push(l));if(await Promise.all(c.map(async l=>{let h;try{h=await this.C(l,s,i,n,r),de(h)?(this.o.publicLog2("galleryService:fallbacktoquery",{extension:l.id,preRelease:!!l.preRelease,compatible:!!s.compatible,errorCode:h}),a.push(l)):o.push(h)}catch(u){if(u instanceof Hs)switch(u.code){case"Offline":case"Cancelled":case"Timeout":throw u}this.l.error(`Error while getting the latest version for the extension ${l.id}.`,se(u)),this.o.publicLog2("galleryService:fallbacktoquery",{extension:l.id,preRelease:!!l.preRelease,compatible:!!s.compatible,errorCode:u instanceof Hs?u.code:"Unknown"}),a.push(l)}})),a.length){const l=await this.A(a,s,n,r);o.push(...l)}return o}async C(e,s,i,n,r){const o=await this.K(e,i,r);if(!o)return"NOT_FOUND";const a=s.targetPlatform??ua,c=pa(o),l=await this.H(o,x9(o.versions,a,c),{targetPlatform:a,compatible:!!s.compatible,productVersion:s.productVersion??{version:this.u.version,date:this.u.date},version:e.preRelease?2:0},c);return l?bh(o,l,c,n,this.u):"NOT_COMPATIBLE"}async getCompatibleExtension(e,s,i,n={version:this.u.version,date:this.u.date}){return br(e.allTargetPlatforms,i)?null:await this.isExtensionCompatible(e,s,i)?e:this.x.isAllowed({id:e.identifier.id,publisherDisplayName:e.publisherDisplayName})!==!0?null:(await this.getExtensions([{...e.identifier,preRelease:s,hasPreRelease:e.hasPreReleaseVersion}],{compatible:!0,productVersion:n,queryAllVersions:!0,targetPlatform:i},Z.None))[0]??null}async isExtensionCompatible(e,s,i,n={version:this.u.version,date:this.u.date}){return this.D({id:e.identifier.id,version:e.version,isPreReleaseVersion:e.properties.isPreReleaseVersion,targetPlatform:e.properties.targetPlatform,manifestAsset:e.assets.manifest,engine:e.properties.engine,enabledApiProposals:e.properties.enabledApiProposals},{targetPlatform:i,compatible:!0,productVersion:n,version:s?2:0},e.publisherDisplayName,e.allTargetPlatforms)}async D(e,{targetPlatform:s,compatible:i,productVersion:n,version:r},o,a){const c=o0(e.id,this.u),l=v9(e.id,this.u);if(e.isPreReleaseVersion&&c===!1||l&&s9(e.version,l))return!1;if(de(r)){if(e.version!==r)return!1}else if((r===0||r===1)&&e.isPreReleaseVersion!==(r===1))return!1;return!(s&&!Rl(e.targetPlatform,a,s)||i&&(this.x.isAllowed({id:e.id,publisherDisplayName:o,version:e.version,prerelease:e.isPreReleaseVersion,targetPlatform:e.targetPlatform})!==!0||!this.E(e.id,e.enabledApiProposals)||!await this.F(e.id,e.version,e.engine,e.manifestAsset,n)))}E(e,s){return!s||!this.j.includes(e.toLowerCase())?!0:dh(s)}async F(e,s,i,n,r){if(!i){if(!n)return this.l.error(`Missing engine and manifest asset for the extension ${e} with version ${s}`),!1;try{this.o.publicLog2("galleryService:engineFallback",{extension:e,extensionVersion:s});const o={"Accept-Encoding":"gzip"},a=await this.N(e,n,gt.Manifest,s,{headers:o}),c=await Js(a);if(!c)return this.l.error(`Manifest was not found for the extension ${e} with version ${s}`),!1;i=c.engines.vscode}catch(o){return this.l.error(`Error while getting the engine for the version ${s}.`,se(o)),!1}}return fh(i,r.version,r.date)}async query(e,s){const i=await this.y.getExtensionGalleryManifest();if(!i)throw new Error("No extension gallery service configured.");let n=e.text||"";const r=e.pageSize??50;let o=new da().withPage(1,r);n?(n=n.replace(/\bcategory:("([^"]*)"|([^"]\S*))(\s+|\b|$)/g,(u,f,p)=>(o=o.withFilter("Category",p||f),"")),n=n.replace(/\btag:("([^"]*)"|([^"]\S*))(\s+|\b|$)/g,(u,f,p)=>(o=o.withFilter("Tag",p||f),"")),n=n.replace(/\bfeatured(\s+|\b|$)/g,()=>(o=o.withFilter("Featured"),"")),n=n.trim(),n&&(n=n.length<200?n:n.substring(0,200),o=o.withFilter("SearchText",n)),i.capabilities.extensionQuery.sorting?.some(u=>u.name==="NoneOrRelevance")&&(o=o.withSortBy("NoneOrRelevance"))):i.capabilities.extensionQuery.sorting?.some(u=>u.name==="InstallCount")&&(o=o.withSortBy("InstallCount")),e.sortBy&&i.capabilities.extensionQuery.sorting?.some(u=>u.name===e.sortBy)&&(o=o.withSortBy(e.sortBy)),typeof e.sortOrder=="number"&&(o=o.withSortOrder(e.sortOrder)),e.source&&(o=o.withSource(e.source));const a=async(u,f)=>{const{extensions:p,total:g}=await this.G(u,{targetPlatform:ua,compatible:!1,includePreRelease:!!e.includePreRelease,productVersion:e.productVersion??{version:this.u.version,date:this.u.date}},i,f);return p.forEach((m,v)=>c0(m,(u.pageNumber-1)*u.pageSize+v,e.source)),{extensions:p,total:g}},{extensions:c,total:l}=await a(o,s),h=async(u,f)=>{if(f.isCancellationRequested)throw new nt;const{extensions:p}=await a(o.withPage(u+1),f);return p};return{firstPage:c,total:l,pageSize:o.pageSize,getPage:h}}async G(e,s,i,n){const r=e.flags;e.flags.includes("IncludeLatestVersionOnly")&&e.flags.includes("IncludeVersions")&&(e=e.withFlags(...e.flags.filter(f=>f!=="IncludeVersions"))),!e.flags.includes("IncludeLatestVersionOnly")&&!e.flags.includes("IncludeVersions")&&(e=e.withFlags(...e.flags,"IncludeLatestVersionOnly")),(s.versions?.length||s.isQueryForReleaseVersionFromPreReleaseVersion)&&(e=e.withFlags(...e.flags.filter(f=>f!=="IncludeLatestVersionOnly"),"IncludeVersions")),e=e.withFlags(...e.flags,"IncludeAssetUri","IncludeCategoryAndTags","IncludeFiles","IncludeStatistics","IncludeVersionProperties");const{galleryExtensions:o,total:a,context:c}=await this.I(e,i,n);if(!e.flags.includes("IncludeLatestVersionOnly")){const f=[];for(const p of o){const g=pa(p),m={id:Ks(p.publisher.publisherName,p.extensionName),uuid:p.extensionId},v=ls(s.includePreRelease)?s.includePreRelease:!!s.includePreRelease.find(S=>G(S,m))?.includePreRelease,b=await this.H(p,p.versions,{compatible:s.compatible,targetPlatform:s.targetPlatform,productVersion:s.productVersion,version:s.versions?.find(S=>G(S,m))?.version??(v?2:0)},g);b&&f.push(bh(p,b,g,i,this.u,c))}return{extensions:f,total:a}}const h=[],u=new Map;for(let f=0;f<o.length;f++){const p=o[f],g={id:Ks(p.publisher.publisherName,p.extensionName),uuid:p.extensionId},m=ls(s.includePreRelease)?s.includePreRelease:!!s.includePreRelease.find($=>G($,g))?.includePreRelease,v=pa(p);if(s.compatible&&(br(v,s.targetPlatform)||this.x.isAllowed({id:g.id,publisherDisplayName:p.publisher.displayName})!==!0))continue;const b=await this.H(p,p.versions,{compatible:s.compatible,targetPlatform:s.targetPlatform,productVersion:s.productVersion,version:s.versions?.find($=>G($,g))?.version??(m?2:0)},v),S=b?bh(p,b,v,i,this.u,c):null;!S||S.properties.isPreReleaseVersion&&(!m||!S.hasReleaseVersion)||!S.properties.isPreReleaseVersion&&S.properties.targetPlatform!==s.targetPlatform&&S.hasPreReleaseVersion?u.set(p.extensionId,f):h.push([f,S])}if(u.size){const f=new hn,p=new da().withFlags(...r.filter(m=>m!=="IncludeLatestVersionOnly"),"IncludeVersions").withPage(1,u.size).withFilter("ExtensionId",...u.keys()),{extensions:g}=await this.G(p,s,i,n);this.o.publicLog2("galleryService:additionalQuery",{duration:f.elapsed(),count:u.size});for(const m of g){const v=u.get(m.identifier.uuid);h.push([v,m])}}return{extensions:h.sort((f,p)=>f[0]-p[0]).map(([,f])=>f),total:a}}async H(e,s,i,n){const r={id:Ks(e.publisher.publisherName,e.extensionName),uuid:e.extensionId},o=a0(s,i.targetPlatform);if(i.compatible&&br(n,i.targetPlatform))return null;const a=de(i.version)?i.version:void 0;for(let c=0;c<o.length;c++){const l=o[c];if(await this.D({id:r.id,version:l.version,isPreReleaseVersion:Nn(l),targetPlatform:Hi(l),engine:wh(l),manifestAsset:Ds(l,gt.Manifest),enabledApiProposals:yh(l)},i,e.publisher.displayName,n))return l;if(a&&l.version===a)return null}return a||i.compatible?null:e.versions[0]}async I(e,s,i){const n=Wi(s,"ExtensionQueryService");if(!n)throw new Error("No extension gallery query service configured.");e=e.withFlags(...e.flags,"ExcludeNonValidated").withFilter("Target","Microsoft.VisualStudio.Code");const r=s.capabilities.extensionQuery.flags?.find(p=>p.name==="Unpublished");r&&(e=e.withFilter("ExcludeWithFlags",String(r.value)));const o=JSON.stringify({filters:[{criteria:e.criteria.reduce((p,g)=>{const m=s.capabilities.extensionQuery.filtering?.find(v=>v.name===g.filterType);return m&&p.push({filterType:m.value,value:g.value}),p},[]),pageNumber:e.pageNumber,pageSize:e.pageSize,sortBy:s.capabilities.extensionQuery.sorting?.find(p=>p.name===e.sortBy)?.value,sortOrder:e.sortOrder}],assetTypes:e.assetTypes,flags:e.flags.reduce((p,g)=>{const m=s.capabilities.extensionQuery.flags?.find(v=>v.name===g);return m&&(p|=m.value),p},0)}),c={...await this.h,"Content-Type":"application/json",Accept:"application/json;api-version=3.0-preview.1","Accept-Encoding":"gzip","Content-Length":String(o.length)},l=new hn;let h,u,f=0;try{if(h=await this.k.request({type:"POST",url:n,data:o,headers:c},i),h.res.statusCode&&h.res.statusCode>=400&&h.res.statusCode<500)return{galleryExtensions:[],total:f};const p=await Js(h);if(p){const g=p.results[0],m=g.extensions,v=g.resultMetadata&&g.resultMetadata.filter(b=>b.metadataType==="ResultCount")[0];return f=v&&v.metadataItems.filter(b=>b.name==="TotalCount")[0].count||0,{galleryExtensions:m,total:f,context:h.res.headers.activityid?{[fa]:h.res.headers.activityid}:{}}}return{galleryExtensions:[],total:f}}catch(p){if(Ms(p))throw u="Cancelled",p;{const g=se(p);throw u=Xg(p)?"Offline":g.startsWith("XHR timeout")?"Timeout":"Failed",new Hs(g,u)}}finally{this.o.publicLog2("galleryService:query",{filterTypes:e.criteria.map(p=>p.filterType),flags:e.flags,sortBy:e.sortBy,sortOrder:String(e.sortOrder),pageNumber:String(e.pageNumber),source:e.source,searchTextLength:e.searchText.length,requestBodySize:String(o.length),duration:l.elapsed(),success:!!h&&An(h),responseBodySize:h?.res.headers["Content-Length"],statusCode:h?String(h.res.statusCode):void 0,errorCode:u,count:String(f),server:this.J(h?.res.headers,gh),activityId:this.J(h?.res.headers,ph),endToEndId:this.J(h?.res.headers,mh)})}}J(e,s){const i=e?.[s.toLowerCase()],n=Array.isArray(i)?i[0]:i;return n?new sa(n):void 0}async K(e,s,i){const[n,r]=e.id.split(".");let o;try{const a=k.parse(is(s.uri,{publisher:n,name:r}));return await this.L(e.id,a,i)}catch(a){if(a instanceof Hs)switch(o=a.code,a.code){case"Offline":case"Cancelled":case"Timeout":case"ClientError":throw a}else o="Unknown";if(!s.fallback)throw a}finally{this.o.publicLog2("galleryService:getmarketplacelatest",{extension:e.id,errorCode:o})}this.l.error(`Error while getting the latest version for the extension ${e.id} from ${s.uri}. Trying the fallback ${s.fallback}`,o);try{const a=k.parse(is(s.fallback,{publisher:n,name:r}));return await this.L(e.id,a,i)}catch(a){throw o=a instanceof Hs?a.code:"Unknown",a}finally{this.o.publicLog2("galleryService:fallbacktounpkg",{extension:e.id,errorCode:o})}}async L(e,s,i){let n,r;const o=new hn;try{const c={...await this.h,"Content-Type":"application/json",Accept:"application/json;api-version=7.2-preview","Accept-Encoding":"gzip"};if(n=await this.k.request({type:"GET",url:s.toString(!0),headers:c,timeout:this.O()},i),n.res.statusCode===404)return r="NotFound",null;if(n.res.statusCode&&n.res.statusCode!==200)throw new Error("Unexpected HTTP response: "+n.res.statusCode);const l=await Js(n);return l||(r="NoData"),l}catch(a){let c;throw Ms(a)?c="Cancelled":Xg(a)?c="Offline":se(a).startsWith("XHR timeout")?c="Timeout":n&&b5(n)?c="ClientError":n&&S5(n)?c="ServerError":c="Failed",r=c,new Hs(a,c)}finally{this.o.publicLog2("galleryService:getLatest",{extension:e,host:s.authority,duration:o.elapsed(),errorCode:r,statusCode:n?.res.statusCode&&n?.res.statusCode!==200?`${n.res.statusCode}`:void 0,server:this.J(n?.res.headers,gh),activityId:this.J(n?.res.headers,ph),endToEndId:this.J(n?.res.headers,mh)})}}async reportStatistic(e,s,i,n){const r=await this.y.getExtensionGalleryManifest();if(!r)return;let o;if(at){const h=Wi(r,"WebExtensionStatisticsUriTemplate");if(!h)return;o=is(h,{publisher:e,name:s,version:i,statTypeValue:n==="install"?"1":"3"})}else{const h=Wi(r,"ExtensionStatisticsUriTemplate");if(!h)return;o=is(h,{publisher:e,name:s,version:i,statTypeName:n})}const a=at?"api-version=6.1-preview.1":"*/*;api-version=4.0-preview.1",l={...await this.h,Accept:a};try{await this.k.request({type:"POST",url:o,headers:l},Z.None)}catch{}}async download(e,s,i){this.l.trace("ExtensionGalleryService#download",e.identifier.id);const n=ah(e),r=new Date().getTime(),o=i===2?"install":i===3?"update":"",a=o?{uri:`${e.assets.download.uri}${k.parse(e.assets.download.uri).query?"&":"?"}${o}=true`,fallbackUri:`${e.assets.download.fallbackUri}${k.parse(e.assets.download.fallbackUri).query?"&":"?"}${o}=true`}:e.assets.download,c=e.queryContext?.[fa],l=c&&typeof c=="string"?{[fa]:c}:void 0,h=await this.N(e.identifier.id,a,gt.VSIX,e.version,l?{headers:l}:void 0);try{await this.q.writeFile(s,h.stream)}catch(u){try{await this.q.del(s)}catch(f){this.l.warn(`Error while deleting the file ${s.toString()}`,se(f))}throw new Hs(se(u),"DownloadFailedWriting")}this.o.publicLog("galleryService:downloadVSIX",{...n,duration:new Date().getTime()-r})}async downloadSignatureArchive(e,s){if(!e.assets.signature)throw new Error("No signature asset found");this.l.trace("ExtensionGalleryService#downloadSignatureArchive",e.identifier.id);const i=await this.N(e.identifier.id,e.assets.signature,gt.Signature,e.version);try{await this.q.writeFile(s,i.stream)}catch(n){try{await this.q.del(s)}catch(r){this.l.warn(`Error while deleting the file ${s.toString()}`,se(r))}throw new Hs(se(n),"DownloadFailedWriting")}}async getReadme(e,s){if(e.assets.readme){const i=await this.N(e.identifier.id,e.assets.readme,gt.Details,e.version,{},s);return await Cs(i)||""}return""}async getManifest(e,s){if(e.assets.manifest){const i=await this.N(e.identifier.id,e.assets.manifest,gt.Manifest,e.version,{},s),n=await Cs(i);return n?JSON.parse(n):null}return null}async getCoreTranslation(e,s){const i=e.assets.coreTranslations.filter(n=>n[0]===s.toUpperCase())[0];if(i){const n=await this.N(e.identifier.id,i[1],i[0],e.version),r=await Cs(n);return r?JSON.parse(r):null}return null}async getChangelog(e,s){if(e.assets.changelog){const i=await this.N(e.identifier.id,e.assets.changelog,gt.Changelog,e.version,{},s);return await Cs(i)||""}return""}async getAllVersions(e){return this.M(e)}async getAllCompatibleVersions(e,s,i){return this.M(e,{version:s?2:0,targetPlatform:i})}async M(e,s){const i=await this.y.getExtensionGalleryManifest();if(!i)throw new Error("No extension gallery service configured.");let n=new da().withFlags("IncludeVersions","IncludeCategoryAndTags","IncludeFiles","IncludeVersionProperties").withPage(1,1);e.uuid?n=n.withFilter("ExtensionId",e.uuid):n=n.withFilter("ExtensionName",e.id);const{galleryExtensions:r}=await this.I(n,i,Z.None);if(!r.length)return[];const o=pa(r[0]);if(s&&br(o,s.targetPlatform))return[];const a=[],c={version:this.u.version,date:this.u.date};await Promise.all(r[0].versions.map(async u=>{try{await this.D({id:e.id,version:u.version,isPreReleaseVersion:Nn(u),targetPlatform:Hi(u),engine:wh(u),manifestAsset:Ds(u,gt.Manifest),enabledApiProposals:yh(u)},{compatible:!!s,productVersion:c,targetPlatform:s?.targetPlatform,version:s?.version??u.version},r[0].publisher.displayName,o)&&a.push(u)}catch{}}));const l=[],h=new Map;for(const u of a0(a,s?.targetPlatform??ua)){const f=h.get(u.version),p=f!==void 0?l[f]:void 0,g=Hi(u);p?p.targetPlatforms.push(g):(h.set(u.version,l.length),l.push({version:u.version,date:u.lastUpdated,isPreReleaseVersion:Nn(u),targetPlatforms:[g]}))}return l}async N(e,s,i,n,r={},o=Z.None){const a=await this.h,c={type:"GET"},l={...a,...r.headers||{}};r={...r,...c,headers:l};const h=s.uri,u=s.fallbackUri,f={...r,url:h,timeout:this.O()};let p;try{if(p=await this.k.request(f,o),p.res.statusCode===200)return p;const g=await Cs(p);throw new Error(`Expected 200, got back ${p.res.statusCode} instead.

${g}`)}catch(g){if(Ms(g))throw g;const m=se(g);this.o.publicLog2("galleryService:cdnFallback",{extension:e,assetType:i,message:m,extensionVersion:n,server:this.J(p?.res.headers,gh),activityId:this.J(p?.res.headers,ph),endToEndId:this.J(p?.res.headers,mh)});const v={...r,url:u,timeout:this.O()};return this.k.request(v,o)}}async getExtensionsControlManifest(){if(!await this.y.getExtensionGalleryManifest())throw new Error("No extension gallery service configured.");if(!this.d)return{malicious:[],deprecated:{},search:[],autoUpdate:{}};const s=await this.k.request({type:"GET",url:this.d,timeout:this.O()},Z.None);if(s.res.statusCode!==200)throw new Error("Could not get extensions report.");const i=await Js(s),n=[],r={},o=[],a=i?.autoUpdate??{};if(i){for(const c of i.malicious){if(!de(c))continue;const l=kp.test(c)?{id:c}:c;n.push({extensionOrPublisher:l,learnMoreLink:i.learnMoreLinks?.[c]})}if(i.migrateToPreRelease)for(const[c,l]of Object.entries(i.migrateToPreRelease))(!l.engine||fh(l.engine,this.u.version,this.u.date))&&(r[c.toLowerCase()]={disallowInstall:!0,extension:{id:l.id,displayName:l.displayName,autoMigrate:{storage:!!l.migrateStorage},preRelease:!0}});if(i.deprecated)for(const[c,l]of Object.entries(i.deprecated))l&&(r[c.toLowerCase()]=ls(l)?{}:l);if(i.search)for(const c of i.search)o.push(c)}return{malicious:n,deprecated:r,search:o,autoUpdate:a}}O(){const e=this.w.getValue(A2);return fo(e)&&e>=0?e:6e4}};ga=__decorate([__param(1,li),__param(2,Q),__param(3,ae),__param(4,ke),__param(5,K),__param(6,ge),__param(7,me),__param(8,Fi),__param(9,Pr)],ga);var Sh=class extends ga{constructor(e,s,i,n,r,o,a,c,l,h){super(e,s,i,n,r,o,a,c,l,h)}};Sh=__decorate([__param(0,re),__param(1,li),__param(2,Q),__param(3,ae),__param(4,ke),__param(5,K),__param(6,ge),__param(7,me),__param(8,Fi),__param(9,Pr)],Sh);var l0=class extends ga{constructor(e,s,i,n,r,o,a,c,l){super(void 0,e,s,i,n,r,o,a,c,l)}};l0=__decorate([__param(0,li),__param(1,Q),__param(2,ae),__param(3,ke),__param(4,K),__param(5,ge),__param(6,me),__param(7,Fi),__param(8,Pr)],l0);var h0=W("IExtensionSignatureVerificationService"),Eh=class{constructor(e,s){this.b=e,this.c=s}d(){return this.a||(this.a=this.f()),this.a}async f(){return import("@vscode/vsce-sign")}async verify(e,s,i,n,r){let o;try{o=await this.d()}catch(h){this.b.error("Could not load vsce-sign module",se(h)),this.b.info(`Extension signature verification is not done: ${e}`);return}const a=new Date().getTime();let c;try{this.b.trace(`Verifying extension signature for ${e}...`),c=await o.verify(i,n,this.b.getLevel()===ie.Trace)}catch(h){c={code:Ze.UnknownError,didExecute:!1,output:se(h)}}const l=new Date().getTime()-a;return this.b.info(`Extension signature verification result for ${e}: ${c.code}. ${kd(c.internalCode)?`Internal Code: ${c.internalCode}. `:""}Executed: ${c.didExecute}. Duration: ${l}ms.`),this.b.trace(`Extension signature verification output for ${e}:
${c.output}`),this.c.publicLog2("extensionsignature:verification",{extensionId:e,extensionVersion:s,code:c.code,internalCode:c.internalCode,duration:l,didExecute:c.didExecute,clientTargetPlatform:r}),{code:c.code}}};Eh=__decorate([__param(0,Q),__param(1,ke)],Eh);var ma=new class{transformIncoming(t){return t}transformOutgoing(t){return t}transformOutgoingURI(t){return t}transformOutgoingScheme(t){return t}};function u0(t,e,s,i){if(!t||i>200)return null;if(typeof t=="object"){if(t.$mid===1)return s?k.revive(e.transformIncoming(t)):e.transformIncoming(t);if(t instanceof L)return null;for(const n in t)if(Object.hasOwnProperty.call(t,n)){const r=u0(t[n],e,s,i+1);r!==null&&(t[n]=r)}}return null}function va(t,e){const s=u0(t,e,!0,0);return s===null?t:s}var c$=new Uint32Array(10),f0;(function(t){t[t.InitialConsonant=4352]="InitialConsonant",t[t.Vowel=4449]="Vowel",t[t.FinalConsonant=4520]="FinalConsonant",t[t.CompatibilityJamo=12593]="CompatibilityJamo"})(f0||(f0={}));var d0;(function(t){t[t.NUL=0]="NUL",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z",t[t.a=97]="a",t[t.b=98]="b",t[t.c=99]="c",t[t.d=100]="d",t[t.e=101]="e",t[t.f=102]="f",t[t.g=103]="g",t[t.h=104]="h",t[t.i=105]="i",t[t.j=106]="j",t[t.k=107]="k",t[t.l=108]="l",t[t.m=109]="m",t[t.n=110]="n",t[t.o=111]="o",t[t.p=112]="p",t[t.q=113]="q",t[t.r=114]="r",t[t.s=115]="s",t[t.t=116]="t",t[t.u=117]="u",t[t.v=118]="v",t[t.w=119]="w",t[t.x=120]="x",t[t.y=121]="y",t[t.z=122]="z"})(d0||(d0={}));var p0;(function(t){t[t.fa=24934]="fa",t[t.fg=26470]="fg",t[t.fq=29030]="fq",t[t.fr=29286]="fr",t[t.ft=29798]="ft",t[t.fv=30310]="fv",t[t.fx=30822]="fx",t[t.hk=27496]="hk",t[t.hl=27752]="hl",t[t.ho=28520]="ho",t[t.ml=27757]="ml",t[t.nj=27246]="nj",t[t.nl=27758]="nl",t[t.np=28782]="np",t[t.qt=29809]="qt",t[t.rt=29810]="rt",t[t.sg=26483]="sg",t[t.sw=30579]="sw"})(p0||(p0={}));var l$=new Uint8Array([114,82,115,101,69,102,97,113,81,116,84,100,119,87,99,122,120,118,103]),h$=new Uint16Array([107,111,105,79,106,112,117,80,104,27496,28520,27752,121,110,27246,28782,27758,98,109,27757,108]),u$=new Uint16Array([114,82,29810,115,30579,26483,101,102,29286,24934,29030,29798,30822,30310,26470,97,113,29809,116,84,100,119,99,122,120,118,103]),f$=new Uint16Array([114,82,29810,115,30579,26483,101,69,102,29286,24934,29030,29798,30822,30310,26470,97,113,81,29809,116,84,100,119,87,99,122,120,118,103,107,111,105,79,106,112,117,80,104,27496,28520,27752,121,110,27246,28782,27758,98,109,27757,108]);function g0(...t){return function(e,s){for(let i=0,n=t.length;i<n;i++){const r=t[i](e,s);if(r)return r}return null}}var d$=v0.bind(void 0,!1),m0=v0.bind(void 0,!0);function v0(t,e,s){if(!s||s.length<e.length)return null;let i;return t?i=Gc(s,e):i=s.indexOf(e)===0,i?e.length>0?[{start:0,end:e.length}]:[]:null}function k9(t,e){if(t.length>e.length)return null;const s=e.toLowerCase().indexOf(t.toLowerCase());return s===-1?null:[{start:s,end:s+t.length}]}function C9(t,e){return t.length>e.length?null:$h(t.toLowerCase(),e.toLowerCase(),0,0)}function $h(t,e,s,i){if(s===t.length)return[];if(i===e.length)return null;if(t[s]===e[i]){let n=null;return(n=$h(t,e,s+1,i+1))?y0({start:i,end:i+1},n):null}return $h(t,e,s,i+1)}function xh(t){return 97<=t&&t<=122}function wa(t){return 65<=t&&t<=90}function kh(t){return 48<=t&&t<=57}function R9(t){return t===32||t===9||t===10||t===13}var D9=new Set;"()[]{}<>`'\"-/;:,.?!".split("").forEach(t=>D9.add(t.charCodeAt(0)));function w0(t){return xh(t)||wa(t)||kh(t)}function y0(t,e){return e.length===0?e=[t]:t.end===e[0].start?e[0].start=t.start:e.unshift(t),e}function b0(t,e){for(let s=e;s<t.length;s++){const i=t.charCodeAt(s);if(wa(i)||kh(i)||s>0&&!w0(t.charCodeAt(s-1)))return s}return t.length}function Ch(t,e,s,i){if(s===t.length)return[];if(i===e.length)return null;if(t[s]!==e[i].toLowerCase())return null;{let n=null,r=i+1;for(n=Ch(t,e,s+1,i+1);!n&&(r=b0(e,r))<e.length;)n=Ch(t,e,s+1,r),r++;return n===null?null:y0({start:i,end:i+1},n)}}function P9(t){let e=0,s=0,i=0,n=0,r=0;for(let h=0;h<t.length;h++)r=t.charCodeAt(h),wa(r)&&e++,xh(r)&&s++,w0(r)&&i++,kh(r)&&n++;const o=e/t.length,a=s/t.length,c=i/t.length,l=n/t.length;return{upperPercent:o,lowerPercent:a,alphaPercent:c,numericPercent:l}}function I9(t){const{upperPercent:e,lowerPercent:s}=t;return s===0&&e>.6}function A9(t){const{upperPercent:e,lowerPercent:s,alphaPercent:i,numericPercent:n}=t;return s>.2&&e<.8&&i>.6&&n<.2}function L9(t){let e=0,s=0,i=0,n=0;for(let r=0;r<t.length;r++)i=t.charCodeAt(r),wa(i)&&e++,xh(i)&&s++,R9(i)&&n++;return(e===0||s===0)&&n===0?t.length<=30:e<=5}function S0(t,e){if(!e||(e=e.trim(),e.length===0)||!L9(t))return null;e.length>60&&(e=e.substring(0,60));const s=P9(e);if(!A9(s)){if(!I9(s))return null;e=e.toLowerCase()}let i=null,n=0;for(t=t.toLowerCase();n<e.length&&(i=Ch(t,e,0,n))===null;)n=b0(e,n+1);return i}var p$=g0(m0,S0,k9),g$=g0(m0,S0,C9),m$=new Qn(1e4),ya=128;function Rh(){const t=[],e=[];for(let s=0;s<=ya;s++)e[s]=0;for(let s=0;s<=ya;s++)t.push(e.slice(0));return t}function E0(t){const e=[];for(let s=0;s<=t;s++)e[s]=0;return e}var v$=E0(2*ya),w$=E0(2*ya),y$=Rh(),b$=Rh(),S$=Rh(),$0;(function(t){t[t.Diag=1]="Diag",t[t.Left=2]="Left",t[t.LeftLeft=3]="LeftLeft"})($0||($0={}));var x0;(function(t){t.Default=[-100,0];function e(s){return!s||s.length===2&&s[0]===-100&&s[1]===0}t.isDefault=e})(x0||(x0={}));var E$=class{static{this.default={boostFullMatch:!0,firstMatchCanBeWeak:!1}}constructor(t,e){this.firstMatchCanBeWeak=t,this.boostFullMatch=e}},k0=Object.create(null);function d(t,e){if(de(e)){const s=k0[e];if(s===void 0)throw new Error(`${t} references an unknown codicon: ${e}`);e=s}return k0[t]=e,{id:t}}var O9={add:d("add",6e4),plus:d("plus",6e4),gistNew:d("gist-new",6e4),repoCreate:d("repo-create",6e4),lightbulb:d("lightbulb",60001),lightBulb:d("light-bulb",60001),repo:d("repo",60002),repoDelete:d("repo-delete",60002),gistFork:d("gist-fork",60003),repoForked:d("repo-forked",60003),gitPullRequest:d("git-pull-request",60004),gitPullRequestAbandoned:d("git-pull-request-abandoned",60004),recordKeys:d("record-keys",60005),keyboard:d("keyboard",60005),tag:d("tag",60006),gitPullRequestLabel:d("git-pull-request-label",60006),tagAdd:d("tag-add",60006),tagRemove:d("tag-remove",60006),person:d("person",60007),personFollow:d("person-follow",60007),personOutline:d("person-outline",60007),personFilled:d("person-filled",60007),sourceControl:d("source-control",60008),mirror:d("mirror",60009),mirrorPublic:d("mirror-public",60009),star:d("star",60010),starAdd:d("star-add",60010),starDelete:d("star-delete",60010),starEmpty:d("star-empty",60010),comment:d("comment",60011),commentAdd:d("comment-add",60011),alert:d("alert",60012),warning:d("warning",60012),search:d("search",60013),searchSave:d("search-save",60013),logOut:d("log-out",60014),signOut:d("sign-out",60014),logIn:d("log-in",60015),signIn:d("sign-in",60015),eye:d("eye",60016),eyeUnwatch:d("eye-unwatch",60016),eyeWatch:d("eye-watch",60016),circleFilled:d("circle-filled",60017),primitiveDot:d("primitive-dot",60017),closeDirty:d("close-dirty",60017),debugBreakpoint:d("debug-breakpoint",60017),debugBreakpointDisabled:d("debug-breakpoint-disabled",60017),debugHint:d("debug-hint",60017),terminalDecorationSuccess:d("terminal-decoration-success",60017),primitiveSquare:d("primitive-square",60018),edit:d("edit",60019),pencil:d("pencil",60019),info:d("info",60020),issueOpened:d("issue-opened",60020),gistPrivate:d("gist-private",60021),gitForkPrivate:d("git-fork-private",60021),lock:d("lock",60021),mirrorPrivate:d("mirror-private",60021),close:d("close",60022),removeClose:d("remove-close",60022),x:d("x",60022),repoSync:d("repo-sync",60023),sync:d("sync",60023),clone:d("clone",60024),desktopDownload:d("desktop-download",60024),beaker:d("beaker",60025),microscope:d("microscope",60025),vm:d("vm",60026),deviceDesktop:d("device-desktop",60026),file:d("file",60027),more:d("more",60028),ellipsis:d("ellipsis",60028),kebabHorizontal:d("kebab-horizontal",60028),mailReply:d("mail-reply",60029),reply:d("reply",60029),organization:d("organization",60030),organizationFilled:d("organization-filled",60030),organizationOutline:d("organization-outline",60030),newFile:d("new-file",60031),fileAdd:d("file-add",60031),newFolder:d("new-folder",60032),fileDirectoryCreate:d("file-directory-create",60032),trash:d("trash",60033),trashcan:d("trashcan",60033),history:d("history",60034),clock:d("clock",60034),folder:d("folder",60035),fileDirectory:d("file-directory",60035),symbolFolder:d("symbol-folder",60035),logoGithub:d("logo-github",60036),markGithub:d("mark-github",60036),github:d("github",60036),terminal:d("terminal",60037),console:d("console",60037),repl:d("repl",60037),zap:d("zap",60038),symbolEvent:d("symbol-event",60038),error:d("error",60039),stop:d("stop",60039),variable:d("variable",60040),symbolVariable:d("symbol-variable",60040),array:d("array",60042),symbolArray:d("symbol-array",60042),symbolModule:d("symbol-module",60043),symbolPackage:d("symbol-package",60043),symbolNamespace:d("symbol-namespace",60043),symbolObject:d("symbol-object",60043),symbolMethod:d("symbol-method",60044),symbolFunction:d("symbol-function",60044),symbolConstructor:d("symbol-constructor",60044),symbolBoolean:d("symbol-boolean",60047),symbolNull:d("symbol-null",60047),symbolNumeric:d("symbol-numeric",60048),symbolNumber:d("symbol-number",60048),symbolStructure:d("symbol-structure",60049),symbolStruct:d("symbol-struct",60049),symbolParameter:d("symbol-parameter",60050),symbolTypeParameter:d("symbol-type-parameter",60050),symbolKey:d("symbol-key",60051),symbolText:d("symbol-text",60051),symbolReference:d("symbol-reference",60052),goToFile:d("go-to-file",60052),symbolEnum:d("symbol-enum",60053),symbolValue:d("symbol-value",60053),symbolRuler:d("symbol-ruler",60054),symbolUnit:d("symbol-unit",60054),activateBreakpoints:d("activate-breakpoints",60055),archive:d("archive",60056),arrowBoth:d("arrow-both",60057),arrowDown:d("arrow-down",60058),arrowLeft:d("arrow-left",60059),arrowRight:d("arrow-right",60060),arrowSmallDown:d("arrow-small-down",60061),arrowSmallLeft:d("arrow-small-left",60062),arrowSmallRight:d("arrow-small-right",60063),arrowSmallUp:d("arrow-small-up",60064),arrowUp:d("arrow-up",60065),bell:d("bell",60066),bold:d("bold",60067),book:d("book",60068),bookmark:d("bookmark",60069),debugBreakpointConditionalUnverified:d("debug-breakpoint-conditional-unverified",60070),debugBreakpointConditional:d("debug-breakpoint-conditional",60071),debugBreakpointConditionalDisabled:d("debug-breakpoint-conditional-disabled",60071),debugBreakpointDataUnverified:d("debug-breakpoint-data-unverified",60072),debugBreakpointData:d("debug-breakpoint-data",60073),debugBreakpointDataDisabled:d("debug-breakpoint-data-disabled",60073),debugBreakpointLogUnverified:d("debug-breakpoint-log-unverified",60074),debugBreakpointLog:d("debug-breakpoint-log",60075),debugBreakpointLogDisabled:d("debug-breakpoint-log-disabled",60075),briefcase:d("briefcase",60076),broadcast:d("broadcast",60077),browser:d("browser",60078),bug:d("bug",60079),calendar:d("calendar",60080),caseSensitive:d("case-sensitive",60081),check:d("check",60082),checklist:d("checklist",60083),chevronDown:d("chevron-down",60084),chevronLeft:d("chevron-left",60085),chevronRight:d("chevron-right",60086),chevronUp:d("chevron-up",60087),chromeClose:d("chrome-close",60088),chromeMaximize:d("chrome-maximize",60089),chromeMinimize:d("chrome-minimize",60090),chromeRestore:d("chrome-restore",60091),circleOutline:d("circle-outline",60092),circle:d("circle",60092),debugBreakpointUnverified:d("debug-breakpoint-unverified",60092),terminalDecorationIncomplete:d("terminal-decoration-incomplete",60092),circleSlash:d("circle-slash",60093),circuitBoard:d("circuit-board",60094),clearAll:d("clear-all",60095),clippy:d("clippy",60096),closeAll:d("close-all",60097),cloudDownload:d("cloud-download",60098),cloudUpload:d("cloud-upload",60099),code:d("code",60100),collapseAll:d("collapse-all",60101),colorMode:d("color-mode",60102),commentDiscussion:d("comment-discussion",60103),creditCard:d("credit-card",60105),dash:d("dash",60108),dashboard:d("dashboard",60109),database:d("database",60110),debugContinue:d("debug-continue",60111),debugDisconnect:d("debug-disconnect",60112),debugPause:d("debug-pause",60113),debugRestart:d("debug-restart",60114),debugStart:d("debug-start",60115),debugStepInto:d("debug-step-into",60116),debugStepOut:d("debug-step-out",60117),debugStepOver:d("debug-step-over",60118),debugStop:d("debug-stop",60119),debug:d("debug",60120),deviceCameraVideo:d("device-camera-video",60121),deviceCamera:d("device-camera",60122),deviceMobile:d("device-mobile",60123),diffAdded:d("diff-added",60124),diffIgnored:d("diff-ignored",60125),diffModified:d("diff-modified",60126),diffRemoved:d("diff-removed",60127),diffRenamed:d("diff-renamed",60128),diff:d("diff",60129),diffSidebyside:d("diff-sidebyside",60129),discard:d("discard",60130),editorLayout:d("editor-layout",60131),emptyWindow:d("empty-window",60132),exclude:d("exclude",60133),extensions:d("extensions",60134),eyeClosed:d("eye-closed",60135),fileBinary:d("file-binary",60136),fileCode:d("file-code",60137),fileMedia:d("file-media",60138),filePdf:d("file-pdf",60139),fileSubmodule:d("file-submodule",60140),fileSymlinkDirectory:d("file-symlink-directory",60141),fileSymlinkFile:d("file-symlink-file",60142),fileZip:d("file-zip",60143),files:d("files",60144),filter:d("filter",60145),flame:d("flame",60146),foldDown:d("fold-down",60147),foldUp:d("fold-up",60148),fold:d("fold",60149),folderActive:d("folder-active",60150),folderOpened:d("folder-opened",60151),gear:d("gear",60152),gift:d("gift",60153),gistSecret:d("gist-secret",60154),gist:d("gist",60155),gitCommit:d("git-commit",60156),gitCompare:d("git-compare",60157),compareChanges:d("compare-changes",60157),gitMerge:d("git-merge",60158),githubAction:d("github-action",60159),githubAlt:d("github-alt",60160),globe:d("globe",60161),grabber:d("grabber",60162),graph:d("graph",60163),gripper:d("gripper",60164),heart:d("heart",60165),home:d("home",60166),horizontalRule:d("horizontal-rule",60167),hubot:d("hubot",60168),inbox:d("inbox",60169),issueReopened:d("issue-reopened",60171),issues:d("issues",60172),italic:d("italic",60173),jersey:d("jersey",60174),json:d("json",60175),kebabVertical:d("kebab-vertical",60176),key:d("key",60177),law:d("law",60178),lightbulbAutofix:d("lightbulb-autofix",60179),linkExternal:d("link-external",60180),link:d("link",60181),listOrdered:d("list-ordered",60182),listUnordered:d("list-unordered",60183),liveShare:d("live-share",60184),loading:d("loading",60185),location:d("location",60186),mailRead:d("mail-read",60187),mail:d("mail",60188),markdown:d("markdown",60189),megaphone:d("megaphone",60190),mention:d("mention",60191),milestone:d("milestone",60192),gitPullRequestMilestone:d("git-pull-request-milestone",60192),mortarBoard:d("mortar-board",60193),move:d("move",60194),multipleWindows:d("multiple-windows",60195),mute:d("mute",60196),noNewline:d("no-newline",60197),note:d("note",60198),octoface:d("octoface",60199),openPreview:d("open-preview",60200),package:d("package",60201),paintcan:d("paintcan",60202),pin:d("pin",60203),play:d("play",60204),run:d("run",60204),plug:d("plug",60205),preserveCase:d("preserve-case",60206),preview:d("preview",60207),project:d("project",60208),pulse:d("pulse",60209),question:d("question",60210),quote:d("quote",60211),radioTower:d("radio-tower",60212),reactions:d("reactions",60213),references:d("references",60214),refresh:d("refresh",60215),regex:d("regex",60216),remoteExplorer:d("remote-explorer",60217),remote:d("remote",60218),remove:d("remove",60219),replaceAll:d("replace-all",60220),replace:d("replace",60221),repoClone:d("repo-clone",60222),repoForcePush:d("repo-force-push",60223),repoPull:d("repo-pull",60224),repoPush:d("repo-push",60225),report:d("report",60226),requestChanges:d("request-changes",60227),rocket:d("rocket",60228),rootFolderOpened:d("root-folder-opened",60229),rootFolder:d("root-folder",60230),rss:d("rss",60231),ruby:d("ruby",60232),saveAll:d("save-all",60233),saveAs:d("save-as",60234),save:d("save",60235),screenFull:d("screen-full",60236),screenNormal:d("screen-normal",60237),searchStop:d("search-stop",60238),server:d("server",60240),settingsGear:d("settings-gear",60241),settings:d("settings",60242),shield:d("shield",60243),smiley:d("smiley",60244),sortPrecedence:d("sort-precedence",60245),splitHorizontal:d("split-horizontal",60246),splitVertical:d("split-vertical",60247),squirrel:d("squirrel",60248),starFull:d("star-full",60249),starHalf:d("star-half",60250),symbolClass:d("symbol-class",60251),symbolColor:d("symbol-color",60252),symbolConstant:d("symbol-constant",60253),symbolEnumMember:d("symbol-enum-member",60254),symbolField:d("symbol-field",60255),symbolFile:d("symbol-file",60256),symbolInterface:d("symbol-interface",60257),symbolKeyword:d("symbol-keyword",60258),symbolMisc:d("symbol-misc",60259),symbolOperator:d("symbol-operator",60260),symbolProperty:d("symbol-property",60261),wrench:d("wrench",60261),wrenchSubaction:d("wrench-subaction",60261),symbolSnippet:d("symbol-snippet",60262),tasklist:d("tasklist",60263),telescope:d("telescope",60264),textSize:d("text-size",60265),threeBars:d("three-bars",60266),thumbsdown:d("thumbsdown",60267),thumbsup:d("thumbsup",60268),tools:d("tools",60269),triangleDown:d("triangle-down",60270),triangleLeft:d("triangle-left",60271),triangleRight:d("triangle-right",60272),triangleUp:d("triangle-up",60273),twitter:d("twitter",60274),unfold:d("unfold",60275),unlock:d("unlock",60276),unmute:d("unmute",60277),unverified:d("unverified",60278),verified:d("verified",60279),versions:d("versions",60280),vmActive:d("vm-active",60281),vmOutline:d("vm-outline",60282),vmRunning:d("vm-running",60283),watch:d("watch",60284),whitespace:d("whitespace",60285),wholeWord:d("whole-word",60286),window:d("window",60287),wordWrap:d("word-wrap",60288),zoomIn:d("zoom-in",60289),zoomOut:d("zoom-out",60290),listFilter:d("list-filter",60291),listFlat:d("list-flat",60292),listSelection:d("list-selection",60293),selection:d("selection",60293),listTree:d("list-tree",60294),debugBreakpointFunctionUnverified:d("debug-breakpoint-function-unverified",60295),debugBreakpointFunction:d("debug-breakpoint-function",60296),debugBreakpointFunctionDisabled:d("debug-breakpoint-function-disabled",60296),debugStackframeActive:d("debug-stackframe-active",60297),circleSmallFilled:d("circle-small-filled",60298),debugStackframeDot:d("debug-stackframe-dot",60298),terminalDecorationMark:d("terminal-decoration-mark",60298),debugStackframe:d("debug-stackframe",60299),debugStackframeFocused:d("debug-stackframe-focused",60299),debugBreakpointUnsupported:d("debug-breakpoint-unsupported",60300),symbolString:d("symbol-string",60301),debugReverseContinue:d("debug-reverse-continue",60302),debugStepBack:d("debug-step-back",60303),debugRestartFrame:d("debug-restart-frame",60304),debugAlt:d("debug-alt",60305),callIncoming:d("call-incoming",60306),callOutgoing:d("call-outgoing",60307),menu:d("menu",60308),expandAll:d("expand-all",60309),feedback:d("feedback",60310),gitPullRequestReviewer:d("git-pull-request-reviewer",60310),groupByRefType:d("group-by-ref-type",60311),ungroupByRefType:d("ungroup-by-ref-type",60312),account:d("account",60313),gitPullRequestAssignee:d("git-pull-request-assignee",60313),bellDot:d("bell-dot",60314),debugConsole:d("debug-console",60315),library:d("library",60316),output:d("output",60317),runAll:d("run-all",60318),syncIgnored:d("sync-ignored",60319),pinned:d("pinned",60320),githubInverted:d("github-inverted",60321),serverProcess:d("server-process",60322),serverEnvironment:d("server-environment",60323),pass:d("pass",60324),issueClosed:d("issue-closed",60324),stopCircle:d("stop-circle",60325),playCircle:d("play-circle",60326),record:d("record",60327),debugAltSmall:d("debug-alt-small",60328),vmConnect:d("vm-connect",60329),cloud:d("cloud",60330),merge:d("merge",60331),export:d("export",60332),graphLeft:d("graph-left",60333),magnet:d("magnet",60334),notebook:d("notebook",60335),redo:d("redo",60336),checkAll:d("check-all",60337),pinnedDirty:d("pinned-dirty",60338),passFilled:d("pass-filled",60339),circleLargeFilled:d("circle-large-filled",60340),circleLarge:d("circle-large",60341),circleLargeOutline:d("circle-large-outline",60341),combine:d("combine",60342),gather:d("gather",60342),table:d("table",60343),variableGroup:d("variable-group",60344),typeHierarchy:d("type-hierarchy",60345),typeHierarchySub:d("type-hierarchy-sub",60346),typeHierarchySuper:d("type-hierarchy-super",60347),gitPullRequestCreate:d("git-pull-request-create",60348),runAbove:d("run-above",60349),runBelow:d("run-below",60350),notebookTemplate:d("notebook-template",60351),debugRerun:d("debug-rerun",60352),workspaceTrusted:d("workspace-trusted",60353),workspaceUntrusted:d("workspace-untrusted",60354),workspaceUnknown:d("workspace-unknown",60355),terminalCmd:d("terminal-cmd",60356),terminalDebian:d("terminal-debian",60357),terminalLinux:d("terminal-linux",60358),terminalPowershell:d("terminal-powershell",60359),terminalTmux:d("terminal-tmux",60360),terminalUbuntu:d("terminal-ubuntu",60361),terminalBash:d("terminal-bash",60362),arrowSwap:d("arrow-swap",60363),copy:d("copy",60364),personAdd:d("person-add",60365),filterFilled:d("filter-filled",60366),wand:d("wand",60367),debugLineByLine:d("debug-line-by-line",60368),inspect:d("inspect",60369),layers:d("layers",60370),layersDot:d("layers-dot",60371),layersActive:d("layers-active",60372),compass:d("compass",60373),compassDot:d("compass-dot",60374),compassActive:d("compass-active",60375),azure:d("azure",60376),issueDraft:d("issue-draft",60377),gitPullRequestClosed:d("git-pull-request-closed",60378),gitPullRequestDraft:d("git-pull-request-draft",60379),debugAll:d("debug-all",60380),debugCoverage:d("debug-coverage",60381),runErrors:d("run-errors",60382),folderLibrary:d("folder-library",60383),debugContinueSmall:d("debug-continue-small",60384),beakerStop:d("beaker-stop",60385),graphLine:d("graph-line",60386),graphScatter:d("graph-scatter",60387),pieChart:d("pie-chart",60388),bracket:d("bracket",60175),bracketDot:d("bracket-dot",60389),bracketError:d("bracket-error",60390),lockSmall:d("lock-small",60391),azureDevops:d("azure-devops",60392),verifiedFilled:d("verified-filled",60393),newline:d("newline",60394),layout:d("layout",60395),layoutActivitybarLeft:d("layout-activitybar-left",60396),layoutActivitybarRight:d("layout-activitybar-right",60397),layoutPanelLeft:d("layout-panel-left",60398),layoutPanelCenter:d("layout-panel-center",60399),layoutPanelJustify:d("layout-panel-justify",60400),layoutPanelRight:d("layout-panel-right",60401),layoutPanel:d("layout-panel",60402),layoutSidebarLeft:d("layout-sidebar-left",60403),layoutSidebarRight:d("layout-sidebar-right",60404),layoutStatusbar:d("layout-statusbar",60405),layoutMenubar:d("layout-menubar",60406),layoutCentered:d("layout-centered",60407),target:d("target",60408),indent:d("indent",60409),recordSmall:d("record-small",60410),errorSmall:d("error-small",60411),terminalDecorationError:d("terminal-decoration-error",60411),arrowCircleDown:d("arrow-circle-down",60412),arrowCircleLeft:d("arrow-circle-left",60413),arrowCircleRight:d("arrow-circle-right",60414),arrowCircleUp:d("arrow-circle-up",60415),layoutSidebarRightOff:d("layout-sidebar-right-off",60416),layoutPanelOff:d("layout-panel-off",60417),layoutSidebarLeftOff:d("layout-sidebar-left-off",60418),blank:d("blank",60419),heartFilled:d("heart-filled",60420),map:d("map",60421),mapHorizontal:d("map-horizontal",60421),foldHorizontal:d("fold-horizontal",60421),mapFilled:d("map-filled",60422),mapHorizontalFilled:d("map-horizontal-filled",60422),foldHorizontalFilled:d("fold-horizontal-filled",60422),circleSmall:d("circle-small",60423),bellSlash:d("bell-slash",60424),bellSlashDot:d("bell-slash-dot",60425),commentUnresolved:d("comment-unresolved",60426),gitPullRequestGoToChanges:d("git-pull-request-go-to-changes",60427),gitPullRequestNewChanges:d("git-pull-request-new-changes",60428),searchFuzzy:d("search-fuzzy",60429),commentDraft:d("comment-draft",60430),send:d("send",60431),sparkle:d("sparkle",60432),insert:d("insert",60433),mic:d("mic",60434),thumbsdownFilled:d("thumbsdown-filled",60435),thumbsupFilled:d("thumbsup-filled",60436),coffee:d("coffee",60437),snake:d("snake",60438),game:d("game",60439),vr:d("vr",60440),chip:d("chip",60441),piano:d("piano",60442),music:d("music",60443),micFilled:d("mic-filled",60444),repoFetch:d("repo-fetch",60445),copilot:d("copilot",60446),lightbulbSparkle:d("lightbulb-sparkle",60447),robot:d("robot",60448),sparkleFilled:d("sparkle-filled",60449),diffSingle:d("diff-single",60450),diffMultiple:d("diff-multiple",60451),surroundWith:d("surround-with",60452),share:d("share",60453),gitStash:d("git-stash",60454),gitStashApply:d("git-stash-apply",60455),gitStashPop:d("git-stash-pop",60456),vscode:d("vscode",60457),vscodeInsiders:d("vscode-insiders",60458),codeOss:d("code-oss",60459),runCoverage:d("run-coverage",60460),runAllCoverage:d("run-all-coverage",60461),coverage:d("coverage",60462),githubProject:d("github-project",60463),mapVertical:d("map-vertical",60464),foldVertical:d("fold-vertical",60464),mapVerticalFilled:d("map-vertical-filled",60465),foldVerticalFilled:d("fold-vertical-filled",60465),goToSearch:d("go-to-search",60466),percentage:d("percentage",60467),sortPercentage:d("sort-percentage",60467),attach:d("attach",60468),goToEditingSession:d("go-to-editing-session",60469),editSession:d("edit-session",60470),codeReview:d("code-review",60471),copilotWarning:d("copilot-warning",60472),python:d("python",60473),copilotLarge:d("copilot-large",60474),copilotWarningLarge:d("copilot-warning-large",60475),keyboardTab:d("keyboard-tab",60476),copilotBlocked:d("copilot-blocked",60477),copilotNotConnected:d("copilot-not-connected",60478),flag:d("flag",60479),lightbulbEmpty:d("lightbulb-empty",60480),symbolMethodArrow:d("symbol-method-arrow",60481),copilotUnavailable:d("copilot-unavailable",60482),repoPinned:d("repo-pinned",60483),keyboardTabAbove:d("keyboard-tab-above",60484),keyboardTabBelow:d("keyboard-tab-below",60485),gitPullRequestDone:d("git-pull-request-done",60486),mcp:d("mcp",60487),extensionsLarge:d("extensions-large",60488),layoutPanelDock:d("layout-panel-dock",60489),layoutSidebarLeftDock:d("layout-sidebar-left-dock",60490),layoutSidebarRightDock:d("layout-sidebar-right-dock",60491),copilotInProgress:d("copilot-in-progress",60492),copilotError:d("copilot-error",60493),copilotSuccess:d("copilot-success",60494),chatSparkle:d("chat-sparkle",60495),searchSparkle:d("search-sparkle",60496),editSparkle:d("edit-sparkle",60497),copilotSnooze:d("copilot-snooze",60498),sendToRemoteAgent:d("send-to-remote-agent",60499),commentDiscussionSparkle:d("comment-discussion-sparkle",60500),chatSparkleWarning:d("chat-sparkle-warning",60501),chatSparkleError:d("chat-sparkle-error",60502),collection:d("collection",60503),newCollection:d("new-collection",60504),thinking:d("thinking",60505),build:d("build",60506),commentDiscussionQuote:d("comment-discussion-quote",60507),cursor:d("cursor",60508),eraser:d("eraser",60509),fileText:d("file-text",60510),gitLens:d("git-lens",60511),quotes:d("quotes",60512),rename:d("rename",60513),runWithDeps:d("run-with-deps",60514),debugConnected:d("debug-connected",60515),strikethrough:d("strikethrough",60516),openInProduct:d("open-in-product",60517),indexZero:d("index-zero",60518),agent:d("agent",60519),editCode:d("edit-code",60520),repoSelected:d("repo-selected",60521),skip:d("skip",60522),mergeInto:d("merge-into",60523),gitBranchChanges:d("git-branch-changes",60524),gitBranchStagedChanges:d("git-branch-staged-changes",60525),gitBranchConflicts:d("git-branch-conflicts",60526),gitBranch:d("git-branch",60527),gitBranchCreate:d("git-branch-create",60527),gitBranchDelete:d("git-branch-delete",60527),searchLarge:d("search-large",60528),terminalGitBash:d("terminal-git-bash",60529),windowActive:d("window-active",60530),forward:d("forward",60531),download:d("download",60532),clockface:d("clockface",60533),unarchive:d("unarchive",60534),sessionInProgress:d("session-in-progress",60535),collectionSmall:d("collection-small",60536),vmSmall:d("vm-small",60537),cloudSmall:d("cloud-small",60538)},N9={dialogError:d("dialog-error","error"),dialogWarning:d("dialog-warning","warning"),dialogInfo:d("dialog-info","info"),dialogClose:d("dialog-close","close"),treeItemExpanded:d("tree-item-expanded","chevron-down"),treeFilterOnTypeOn:d("tree-filter-on-type-on","list-filter"),treeFilterOnTypeOff:d("tree-filter-on-type-off","list-selection"),treeFilterClear:d("tree-filter-clear","close"),treeItemLoading:d("tree-item-loading","loading"),menuSelection:d("menu-selection","check"),menuSubmenu:d("menu-submenu","chevron-right"),menuBarMore:d("menubar-more","more"),scrollbarButtonLeft:d("scrollbar-button-left","triangle-left"),scrollbarButtonRight:d("scrollbar-button-right","triangle-right"),scrollbarButtonUp:d("scrollbar-button-up","triangle-up"),scrollbarButtonDown:d("scrollbar-button-down","triangle-down"),toolBarMore:d("toolbar-more","more"),quickInputBack:d("quick-input-back","arrow-left"),dropDownButton:d("drop-down-button",60084),symbolCustomColor:d("symbol-customcolor",60252),exportIcon:d("export",60332),workspaceUnspecified:d("workspace-unspecified",60355),newLine:d("newline",60394),thumbsDownFilled:d("thumbsdown-filled",60435),thumbsUpFilled:d("thumbsup-filled",60436),gitFetch:d("git-fetch",60445),lightbulbSparkleAutofix:d("lightbulb-sparkle-autofix",60447),debugBreakpointPending:d("debug-breakpoint-pending",60377)},Dh={...O9,...N9},Ph;(function(t){function e(s){return!!s&&typeof s=="object"&&typeof s.id=="string"}t.isThemeColor=e})(Ph||(Ph={}));var Ir;(function(t){t.iconNameSegment="[A-Za-z0-9]+",t.iconNameExpression="[A-Za-z0-9-]+",t.iconModifierExpression="~[A-Za-z]+",t.iconNameCharacter="[A-Za-z0-9~-]";const e=new RegExp(`^(${t.iconNameExpression})(${t.iconModifierExpression})?$`);function s(g){const m=e.exec(g.id);if(!m)return s(Dh.error);const[,v,b]=m,S=["codicon","codicon-"+v];return b&&S.push("codicon-modifier-"+b.substring(1)),S}t.asClassNameArray=s;function i(g){return s(g).join(" ")}t.asClassName=i;function n(g){return"."+s(g).join(".")}t.asCSSSelector=n;function r(g){return!!g&&typeof g=="object"&&typeof g.id=="string"&&(typeof g.color>"u"||Ph.isThemeColor(g.color))}t.isThemeIcon=r;const o=new RegExp(`^\\$\\((${t.iconNameExpression}(?:${t.iconModifierExpression})?)\\)$`);function a(g){const m=o.exec(g);if(!m)return;const[,v]=m;return{id:v}}t.fromString=a;function c(g){return{id:g}}t.fromId=c;function l(g,m){let v=g.id;const b=v.lastIndexOf("~");return b!==-1&&(v=v.substring(0,b)),m&&(v=`${v}~${m}`),{id:v}}t.modify=l;function h(g){const m=g.id.lastIndexOf("~");if(m!==-1)return g.id.substring(m+1)}t.getModifier=h;function u(g,m){return g.id===m.id&&g.color?.id===m.color?.id}t.isEqual=u;function f(g){return g?.id===Dh.file.id}t.isFile=f;function p(g){return g?.id===Dh.folder.id}t.isFolder=p})(Ir||(Ir={}));var Ih=new RegExp(`\\$\\(${Ir.iconNameExpression}(?:${Ir.iconModifierExpression})?\\)`,"g"),T9=new RegExp(`(\\\\)?${Ih.source}`,"g");function j9(t){return t.replace(T9,(e,s)=>s?e:`\\${e}`)}var $$=new RegExp(`\\\\${Ih.source}`,"g"),x$=new RegExp(`(\\s)?(\\\\)?${Ih.source}(\\s)?`,"g"),k$=new RegExp(`\\$\\(${Ir.iconNameCharacter}+\\)`,"g"),C0;(function(t){t[t.Paragraph=0]="Paragraph",t[t.Break=1]="Break"})(C0||(C0={}));var Ps=class $w{static lift(e){const s=new $w(e.value,e);return s.uris=e.uris,s.baseUri=e.baseUri?k.revive(e.baseUri):void 0,s}constructor(e="",s=!1){if(this.value=e,typeof this.value!="string")throw Bw("value");typeof s=="boolean"?(this.isTrusted=s,this.supportThemeIcons=!1,this.supportHtml=!1,this.supportAlertSyntax=!1):(this.isTrusted=s.isTrusted??void 0,this.supportThemeIcons=s.supportThemeIcons??!1,this.supportHtml=s.supportHtml??!1,this.supportAlertSyntax=s.supportAlertSyntax??!1)}appendText(e,s=0){return this.value+=M9(this.supportThemeIcons?j9(e):e).replace(/([ \t]+)/g,(i,n)=>"&nbsp;".repeat(n.length)).replace(/\>/gm,"\\>").replace(/\n/g,s===1?`\\
`:`

`),this}appendMarkdown(e){return this.value+=e,this}appendCodeblock(e,s){return this.value+=`
${U9(s,e)}
`,this}appendLink(e,s,i){return this.value+="[",this.value+=this.c(s,"]"),this.value+="](",this.value+=this.c(String(e),")"),i&&(this.value+=` "${this.c(this.c(i,'"'),")")}"`),this.value+=")",this}c(e,s){const i=new RegExp(Di(s),"g");return e.replace(i,(n,r)=>e.charAt(r-1)!=="\\"?`\\${n}`:n)}};function M9(t){return t.replace(/[\\`*_{}[\]()#+\-!~]/g,"\\$&")}function U9(t,e){const s=t.match(/^`+/gm)?.reduce((n,r)=>n.length>r.length?n:r).length??0,i=s>=3?s+1:3;return[`${"`".repeat(i)}${e}`,t,`${"`".repeat(i)}`].join(`
`)}function R0(t,...e){return k.from({scheme:ne.command,path:t,query:e.length?encodeURIComponent(JSON.stringify(e)):void 0})}var Ah=class extends j{constructor(e,s){super(),this.g=e,this.h=s,this.preferPreReleases=this.g.quality!=="stable"}async canInstall(e){const s=this.h.isAllowed({id:e.identifier.id,publisherDisplayName:e.publisherDisplayName});if(s!==!0)return new Ps(w(1960,null,s.value));if(!await this.j(e)){const i=at?"https://aka.ms/vscode-web-extensions-guide":"https://aka.ms/vscode-platform-specific-extensions";return new Ps(`${w(1961,null,e.displayName??e.identifier.id,this.g.nameLong,Rp(await this.getTargetPlatform()))} [${w(1962,null)}](${i})`)}return!0}async j(e){const s=await this.getTargetPlatform();return e.allTargetPlatforms.some(i=>Rl(i,e.allTargetPlatforms,s))}};Ah=__decorate([__param(0,ge),__param(1,Fi)],Ah);var Lh=class extends Ah{get onInstallExtension(){return this.t.event}get onDidInstallExtensions(){return this.u.event}get onUninstallExtension(){return this.w.event}get onDidUninstallExtension(){return this.y.event}get onDidUpdateExtensionMetadata(){return this.z.event}constructor(e,s,i,n,r,o,a){super(r,o),this.F=e,this.G=s,this.H=i,this.I=n,this.J=a,this.n=0,this.q=new Map,this.s=new Map,this.t=this.D(new R),this.u=this.D(new R),this.w=this.D(new R),this.y=this.D(new R),this.z=this.D(new R),this.C=[],this.D(pe(()=>{this.q.forEach(({task:c})=>c.cancel()),this.s.forEach(c=>c.cancel()),this.q.clear(),this.s.clear()}))}async installFromGallery(e,s={}){try{const n=(await this.installGalleryExtensions([{extension:e,options:s}])).find(({identifier:r})=>G(r,e.identifier));if(n?.local)return n?.local;throw n?.error?n.error:new Me(`Unknown error while installing extension ${e.identifier.id}`,"Unknown")}catch(i){throw We(i)}}async installGalleryExtensions(e){if(!this.F.isEnabled())throw new Me(w(1963,null),"NotAllowed");const s=[],i=[];return await Promise.allSettled(e.map(async({extension:n,options:r})=>{try{const o=await this.Q(n,!!r?.installGivenVersion,!!r?.installPreReleaseVersion,r.productVersion??{version:this.g.version,date:this.g.date});i.push({...o,options:r})}catch(o){s.push({identifier:n.identifier,operation:2,source:n,error:o,profileLocation:r.profileLocation??this.$()})}})),i.length&&s.push(...await this.L(i)),s}async uninstall(e,s){return this.I.trace("ExtensionManagementService#uninstall",e.identifier.id),this.uninstallExtensions([{extension:e,options:s}])}async toggleApplicationScope(e,s){if(oh(e.manifest)||e.isBuiltin)return e;if(e.isApplicationScoped){let i=await this.updateMetadata(e,{isApplicationScoped:!1},this.J.defaultProfile.extensionsResource);this.H.extUri.isEqual(s,this.J.defaultProfile.extensionsResource)||(i=await this.cb(e,this.J.defaultProfile.extensionsResource,s));for(const n of this.J.profiles){const r=(await this.getInstalled(1,n.extensionsResource)).find(o=>G(o.identifier,e.identifier));r?this.z.fire({local:r,profileLocation:n.extensionsResource}):this.y.fire({identifier:e.identifier,profileLocation:n.extensionsResource})}return i}else{const i=this.H.extUri.isEqual(s,this.J.defaultProfile.extensionsResource)?await this.updateMetadata(e,{isApplicationScoped:!0},this.J.defaultProfile.extensionsResource):await this.cb(e,s,this.J.defaultProfile.extensionsResource,{isApplicationScoped:!0});return this.u.fire([{identifier:i.identifier,operation:2,local:i,profileLocation:this.J.defaultProfile.extensionsResource,applicationScoped:!0}]),i}}getExtensionsControlManifest(){const e=new Date().getTime();return(!this.m||e-this.n>1e3*60*5)&&(this.m=this.Z(),this.n=e),this.m}registerParticipant(e){this.C.push(e)}async resetPinnedStateForAllUserExtensions(e){try{await this.O(this.J.profiles.map(async s=>{const i=await this.getInstalled(1,s.extensionsResource);await this.O(i.map(async n=>{n.pinned!==e&&await this.updateMetadata(n,{pinned:e},s.extensionsResource)}))}))}catch(s){throw this.I.error("Error while resetting pinned state for all user extensions",se(s)),s}}async L(e){const s=new Map,i=new Map,n=[],r=(c,l)=>`${Gt.create(c).toString()}-${l.toString()}`,o=(c,l,h,u)=>{let f;if(!k.isUri(l)){if(i.has(`${l.identifier.id.toLowerCase()}-${h.profileLocation.toString()}`))return;const m=this.q.get(r(l,h.profileLocation));if(m){if(u&&this.N(u,m.task)){const v=m.task.identifier;this.I.info("Waiting for already requested installing extension",v.id,u.identifier.id,h.profileLocation.toString()),m.waitingTasks.push(u),n.push(O.toPromise(O.filter(this.onDidInstallExtensions,b=>b.some(S=>G(S.identifier,v)))).then(b=>{this.I.info("Finished waiting for already requested installing extension",v.id,u.identifier.id,h.profileLocation.toString());const S=b.find($=>G($.identifier,v));if(!S?.local)throw new Error(`Extension ${v.id} is not installed`);return S.local}))}return}f=this.s.get(this.S(l.identifier,h.profileLocation))}const p=this.ab(c,l,h),g=`${Ks(c.publisher,c.name)}-${h.profileLocation.toString()}`;i.set(g,{task:p,root:u,uninstallTaskToWaitFor:f}),this.t.fire({identifier:p.identifier,source:l,profileLocation:h.profileLocation}),this.I.info("Installing extension:",p.identifier.id,h),k.isUri(l)||this.q.set(r(l,h.profileLocation),{task:p,waitingTasks:[]})};try{for(const{manifest:l,extension:h,options:u}of e){const f=u.isApplicationScoped||u.isBuiltin||oh(l),p={...u,isApplicationScoped:f,profileLocation:f?this.J.defaultProfile.extensionsResource:u.profileLocation??this.$(),productVersion:u.productVersion??{version:this.g.version,date:this.g.date}},g=k.isUri(h)?void 0:this.q.get(r(h,p.profileLocation));g?(this.I.info("Extension is already requested to install",g.task.identifier.id,p.profileLocation.toString()),n.push(g.task.waitUntilTaskIsFinished())):o(l,h,p,void 0)}await Promise.all([...i.values()].map(async({task:l})=>{if(l.options.donotIncludePackAndDependencies)this.I.info("Installing the extension without checking dependencies and pack",l.identifier.id);else try{let h=this.preferPreReleases;l.options.installPreReleaseVersion?h=!0:!k.isUri(l.source)&&l.source.hasPreReleaseVersion&&(h=!1);const u=await this.getInstalled(void 0,l.options.profileLocation,l.options.productVersion),f=await this.P(l.identifier,l.manifest,h,l.options.productVersion,u),p={...l.options,pinned:!1,installGivenVersion:!1,context:{...l.options.context,[C2]:!0}};for(const{gallery:g,manifest:m}of Dt(f,({gallery:v})=>v.identifier.id)){const v=u.find(b=>G(b.identifier,g.identifier));v&&v.isApplicationScoped===!!p.isApplicationScoped||o(m,g,p,l)}}catch(h){if(k.isUri(l.source))Kn(l.manifest.extensionDependencies)&&this.I.warn("Cannot install dependencies of extension:",l.identifier.id,h.message),Kn(l.manifest.extensionPack)&&this.I.warn("Cannot install packed extensions of extension:",l.identifier.id,h.message);else throw this.I.error("Error while preparing to install dependencies and extension packs of the extension:",l.identifier.id),h}}));const c=await this.M([...i.values()].map(({task:l})=>l));for(const[l,h]of c)o(h.manifest,h.source,{...h.options,profileLocation:l},void 0);await this.O([...i.entries()].map(async([l,{task:h,uninstallTaskToWaitFor:u}])=>{const f=new Date().getTime();let p;try{if(u){this.I.info("Waiting for existing uninstall task to complete before installing",h.identifier.id);try{await u.waitUntilTaskIsFinished(),this.I.info("Finished waiting for uninstall task, proceeding with install",h.identifier.id)}catch(g){this.I.info("Uninstall task failed, proceeding with install anyway",h.identifier.id,se(g))}}p=await h.run(),await this.O(this.C.map(g=>g.postInstall(p,h.source,h.options,Z.None)),"PostInstall")}catch(g){const m=We(g);throw k.isUri(h.source)||Oh(this.G,h.operation===3?"extensionGallery:update":"extensionGallery:install",{extensionData:ah(h.source),error:m,source:h.options.context?.[Cl]}),s.set(l,{error:m,identifier:h.identifier,operation:h.operation,source:h.source,context:h.options.context,profileLocation:h.options.profileLocation,applicationScoped:h.options.isApplicationScoped}),this.I.error("Error while installing the extension",h.identifier.id,se(m),h.options.profileLocation.toString()),m}if(!k.isUri(h.source)){const g=h.operation===3,m=g?void 0:(new Date().getTime()-h.source.lastUpdated)/1e3;if(Oh(this.G,g?"extensionGallery:update":"extensionGallery:install",{extensionData:ah(h.source),verificationStatus:h.verificationStatus,duration:new Date().getTime()-f,durationSinceUpdate:m,source:h.options.context?.[Cl]}),at&&h.operation!==3)try{await this.F.reportStatistic(p.manifest.publisher,p.manifest.name,p.manifest.version,"install")}catch{}}s.set(l,{local:p,identifier:h.identifier,operation:h.operation,source:h.source,context:h.options.context,profileLocation:h.options.profileLocation,applicationScoped:p.isApplicationScoped})})),n.length&&await this.O(n)}catch(c){const l=(f,p,g)=>{const m=[];f.manifest.extensionDependencies?.length&&m.push(...f.manifest.extensionDependencies),f.manifest.extensionPack?.length&&m.push(...f.manifest.extensionPack);for(const v of m){if(g.includes(v.toLowerCase()))continue;g.push(v.toLowerCase());const b=s.get(`${v.toLowerCase()}-${p.toString()}`);b?.local&&(g=l(b.local,p,g))}return g},h=f=>({identifier:f.identifier,operation:2,source:f.source,context:f.options.context,profileLocation:f.options.profileLocation,error:c}),u=[];for(const[f,{task:p,root:g}]of i){const m=s.get(f);m?m.local&&g&&!s.get(`${g.identifier.id.toLowerCase()}-${p.options.profileLocation.toString()}`)?.local&&(u.push(this.bb(m.local,{versionOnly:!0,profileLocation:p.options.profileLocation})),s.set(f,h(p))):(p.cancel(),s.set(f,h(p)))}for(const[f,{task:p}]of i){const g=s.get(f);if(!g?.local||p.options.donotIncludePackAndDependencies)continue;l(g.local,p.options.profileLocation,[g.local.identifier.id.toLowerCase()]).slice(1).some(v=>i.has(`${v.toLowerCase()}-${p.options.profileLocation.toString()}`)&&!s.get(`${v.toLowerCase()}-${p.options.profileLocation.toString()}`)?.local)&&(u.push(this.bb(g.local,{versionOnly:!0,profileLocation:p.options.profileLocation})),s.set(f,h(p)))}u.length&&await Promise.allSettled(u.map(async f=>{try{await f.run(),this.I.info("Rollback: Uninstalled extension",f.extension.identifier.id)}catch(p){this.I.warn("Rollback: Error while uninstalling extension",f.extension.identifier.id,se(p))}}))}finally{for(const{task:c}of i.values())c.source&&!k.isUri(c.source)&&this.q.delete(r(c.source,c.options.profileLocation))}const a=[...s.values()];for(const c of a)c.local&&this.I.info("Extension installed successfully:",c.identifier.id,c.profileLocation.toString());return this.u.fire(a),a}async M(e){const s=[],i=new ht;for(const n of e)if(!(n.operation!==3||n.options.isApplicationScoped||n.options.pinned||n.options.installGivenVersion||k.isUri(n.source)))for(const r of this.J.profiles){if(this.H.extUri.isEqual(r.extensionsResource,n.options.profileLocation))continue;let o=i.get(r.extensionsResource);o||(o=await this.getInstalled(1,r.extensionsResource),i.set(r.extensionsResource,o));const a=o.find(c=>G(c.identifier,n.identifier));a&&!a.pinned&&s.push([r.extensionsResource,n])}return s}N(e,s){for(const[,{task:i,waitingTasks:n}]of this.q.entries())if(i===e&&(n.includes(s)||n.some(r=>this.N(r,s)))||i===s&&n[0]&&!this.N(e,n[0]))return!1;return!0}async O(e,s){const i=[],n=[],r=await Promise.allSettled(e);for(const a of r)a.status==="fulfilled"?i.push(a.value):n.push(We(a.reason,s));if(!n.length)return i;if(n.length===1)throw n[0];let o=new Me("","Unknown");for(const a of n)o=new Me(o.message?`${o.message}, ${a.message}`:a.message,a.code!=="Unknown"&&a.code!=="Internal"?a.code:o.code);throw o}async P(e,s,i,n,r){if(!this.F.isEnabled())return[];const o=[],a=[],c=async(l,h)=>{o.push(l);const u=h.extensionDependencies?h.extensionDependencies.filter(p=>!r.some(g=>G(g.identifier,{id:p}))):[],f=[...u];if(h.extensionPack){const p=r.find(g=>G(g.identifier,l));for(const g of h.extensionPack)p&&p.manifest.extensionPack&&p.manifest.extensionPack.some(m=>G({id:m},{id:g}))||f.every(m=>!G({id:m},{id:g}))&&f.push(g)}if(f.length){const p=f.filter(g=>o.every(m=>!G(m,{id:g})));if(p.length){const g=await this.F.getExtensions(p.map(m=>({id:m,preRelease:i})),Z.None);for(const m of g){if(o.find(S=>G(S,m.identifier)))continue;const v=u.some(S=>G({id:S},m.identifier));let b;try{b=await this.Q(m,!1,i,n)}catch(S){if(v)throw S;this.I.info("Skipping the packed extension as it cannot be installed",m.identifier.id,se(S));continue}a.push({gallery:b.extension,manifest:b.manifest}),await c(b.extension.identifier,b.manifest)}}}};return await c(e,s),a}async Q(e,s,i,n){let r;const o=await this.getExtensionsControlManifest();if(W5(e.identifier,o.malicious))throw new Me(w(1964,null,e.identifier.id),"Malicious");const a=o.deprecated[e.identifier.id.toLowerCase()];if(a?.extension?.autoMigrate){if(this.I.info(`The '${e.identifier.id}' extension is deprecated, fetching the compatible '${a.extension.id}' extension instead.`),r=(await this.F.getExtensions([{id:a.extension.id,preRelease:a.extension.preRelease}],{targetPlatform:await this.getTargetPlatform(),compatible:!0,productVersion:n},Z.None))[0],!r)throw new Me(w(1965,null,e.identifier.id,a.extension.id),"Deprecated")}else{if(await this.canInstall(e)!==!0){const l=await this.getTargetPlatform();throw new Me(w(1966,null,e.identifier.id,this.g.nameLong,Rp(l)),"IncompatibleTargetPlatform")}if(r=await this.R(e,s,i,n),!r){const l=[];throw dh(e.properties.enabledApiProposals??[],l)?!i&&e.hasPreReleaseVersion&&e.properties.isPreReleaseVersion&&(await this.F.getExtensions([e.identifier],Z.None))[0]?new Me(w(1968,null,e.displayName??e.identifier.id),"ReleaseVersionNotFound"):new Me(w(1969,null,e.identifier.id,this.g.nameLong,this.g.version),"Incompatible"):new Me(w(1967,null,e.displayName??e.identifier.id,l[0]),"IncompatibleApi")}}this.I.info("Getting Manifest...",r.identifier.id);const c=await this.F.getManifest(r,Z.None);if(c===null)throw new Me(`Missing manifest for extension ${r.identifier.id}`,"Invalid");if(c.version!==r.version)throw new Me(`Cannot install '${r.identifier.id}' extension because of version mismatch in Marketplace`,"Invalid");return{extension:r,manifest:c}}async R(e,s,i,n){const r=await this.getTargetPlatform();let o=null;return!s&&e.hasPreReleaseVersion&&e.properties.isPreReleaseVersion!==i&&(o=(await this.F.getExtensions([{...e.identifier,preRelease:i}],{targetPlatform:r,compatible:!0,productVersion:n},Z.None))[0]||null),!o&&await this.F.isExtensionCompatible(e,i,r,n)&&(o=e),o||(s?o=(await this.F.getExtensions([{...e.identifier,version:e.version}],{targetPlatform:r,compatible:!0,productVersion:n},Z.None))[0]||null:o=await this.F.getCompatibleExtension(e,i,r,n)),o}S(e,s,i){return`${e.id.toLowerCase()}${i?`-${i}`:""}@${s.toString()}`}async uninstallExtensions(e){const s=(u,f)=>this.S(u.identifier,f.profileLocation,f.versionOnly?u.manifest.version:void 0),i=(u,f)=>{let p;for(const{task:m}of this.q.values())if(!(m.source instanceof k)&&G(m.identifier,u.identifier)&&this.H.extUri.isEqual(m.options.profileLocation,f.profileLocation)){p=m;break}const g=this.bb(u,f);this.s.set(s(g.extension,f),g),this.I.info("Uninstalling extension from the profile:",`${u.identifier.id}@${u.manifest.version}`,f.profileLocation.toString()),this.w.fire({identifier:u.identifier,profileLocation:f.profileLocation,applicationScoped:u.isApplicationScoped}),r.push({task:g,installTaskToWaitFor:p})},n=(u,f,p)=>{p?this.I.error("Failed to uninstall extension from the profile:",`${u.identifier.id}@${u.manifest.version}`,f.profileLocation.toString(),p.message):this.I.info("Successfully uninstalled extension from the profile",`${u.identifier.id}@${u.manifest.version}`,f.profileLocation.toString()),Oh(this.G,"extensionGallery:uninstall",{extensionData:V5(u),error:p}),this.y.fire({identifier:u.identifier,error:p?.code,profileLocation:f.profileLocation,applicationScoped:u.isApplicationScoped})},r=[],o=[],a=[],c=[],l=new ht,h=async u=>{let f=l.get(u);return f||l.set(u,f=await this.getInstalled(1,u)),f};for(const{extension:u,options:f}of e){const p={...f,profileLocation:u.isApplicationScoped?this.J.defaultProfile.extensionsResource:f?.profileLocation??this.$()},g=this.s.get(s(u,p));if(g?(this.I.info("Extensions is already requested to uninstall",u.identifier.id),a.push(g.waitUntilTaskIsFinished())):i(u,p),p.remove||u.isApplicationScoped){p.remove&&c.push(u);for(const m of this.J.profiles){if(this.H.extUri.isEqual(m.extensionsResource,p.profileLocation))continue;const b=(await h(m.extensionsResource)).find(S=>G(S.identifier,u.identifier));if(b){const S={...p,profileLocation:m.extensionsResource},$=this.s.get(s(b,S));$?(this.I.info("Extensions is already requested to uninstall",b.identifier.id),a.push($.waitUntilTaskIsFinished())):i(b,S)}}}}try{for(const{task:u}of r.slice(0)){const f=await h(u.options.profileLocation);if(u.options.donotIncludePack)this.I.info("Uninstalling the extension without including packed extension",`${u.extension.identifier.id}@${u.extension.manifest.version}`);else{const p=this.X(u.extension,f);for(const g of p)this.s.has(s(g,u.options))?this.I.info("Extensions is already requested to uninstall",g.identifier.id):i(g,u.options)}u.options.donotCheckDependents?this.I.info("Uninstalling the extension without checking dependents",`${u.extension.identifier.id}@${u.extension.manifest.version}`):this.U(r.map(({task:p})=>p.extension),f,u.extension)}await this.O(r.map(async({task:u,installTaskToWaitFor:f})=>{try{if(f){this.I.info("Waiting for existing install task to complete before uninstalling",u.extension.identifier.id);try{await f.waitUntilTaskIsFinished(),this.I.info("Finished waiting for install task, proceeding with uninstall",u.extension.identifier.id)}catch(p){this.I.info("Install task failed, proceeding with uninstall anyway",u.extension.identifier.id,se(p))}}if(await u.run(),await this.O(this.C.map(p=>p.postUninstall(u.extension,u.options,Z.None))),u.extension.identifier.uuid)try{await this.F.reportStatistic(u.extension.manifest.publisher,u.extension.manifest.name,u.extension.manifest.version,"uninstall")}catch{}}catch(p){const g=We(p);throw n(u.extension,u.options,g),g}finally{o.push(u)}})),a.length&&await this.O(a);for(const{task:u}of r)n(u.extension,u.options);c.length&&await this.O(c.map(u=>this.fb(u)))}catch(u){const f=We(u);for(const{task:p}of r){try{p.cancel()}catch{}o.includes(p)||n(p.extension,p.options,f)}throw f}finally{for(const{task:u}of r)this.s.delete(s(u.extension,u.options))||this.I.warn("Uninstallation task is not found in the cache",u.extension.identifier.id)}}U(e,s,i){for(const n of e){const r=this.Y(n,s);if(r.length){const o=r.filter(a=>!e.some(c=>G(c.identifier,a.identifier)));if(o.length)throw new Error(this.W(n,o,i))}}}W(e,s,i){return i===e?s.length===1?w(1970,null,i.manifest.displayName||i.manifest.name,s[0].manifest.displayName||s[0].manifest.name):s.length===2?w(1971,null,i.manifest.displayName||i.manifest.name,s[0].manifest.displayName||s[0].manifest.name,s[1].manifest.displayName||s[1].manifest.name):w(1972,null,i.manifest.displayName||i.manifest.name,s[0].manifest.displayName||s[0].manifest.name,s[1].manifest.displayName||s[1].manifest.name):s.length===1?w(1973,null,i.manifest.displayName||i.manifest.name,e.manifest.displayName||e.manifest.name,s[0].manifest.displayName||s[0].manifest.name):s.length===2?w(1974,null,i.manifest.displayName||i.manifest.name,e.manifest.displayName||e.manifest.name,s[0].manifest.displayName||s[0].manifest.name,s[1].manifest.displayName||s[1].manifest.name):w(1975,null,i.manifest.displayName||i.manifest.name,e.manifest.displayName||e.manifest.name,s[0].manifest.displayName||s[0].manifest.name,s[1].manifest.displayName||s[1].manifest.name)}X(e,s,i=[]){if(i.indexOf(e)!==-1)return[];i.push(e);const n=e.manifest.extensionPack?e.manifest.extensionPack:[];if(n.length){const r=s.filter(a=>!a.isBuiltin&&n.some(c=>G({id:c},a.identifier))),o=[];for(const a of r)o.push(...this.X(a,s,i));return[...r,...o]}return[]}Y(e,s){return s.filter(i=>i.manifest.extensionDependencies&&i.manifest.extensionDependencies.some(n=>G({id:n},e.identifier)))}async Z(){try{return this.I.trace("ExtensionManagementService.updateControlCache"),await this.F.getExtensionsControlManifest()}catch(e){return this.I.trace("ExtensionManagementService.refreshControlCache - failed to get extension control manifest",se(e)),{malicious:[],deprecated:{},search:[]}}}};Lh=__decorate([__param(0,xs),__param(1,ke),__param(2,he),__param(3,Q),__param(4,ge),__param(5,Fi),__param(6,Ne)],Lh);function We(t,e){if(t instanceof Me)return t;let s;return t instanceof Hs?s=new Me(t.message,t.code==="DownloadFailedWriting"?"DownloadFailedWriting":"Gallery"):s=new Me(t.message,Ms(t)?"Cancelled":e??"Internal"),s.stack=t.stack,s}function Oh(t,e,{extensionData:s,verificationStatus:i,duration:n,error:r,source:o,durationSinceUpdate:a}){t.publicLog(e,{...s,source:o,duration:n,durationSinceUpdate:a,success:!r,errorcode:r?.code,verificationStatus:i===Ze.Success?"Verified":i??"Unverified"})}var D0=class{constructor(){this.d=new rr}async waitUntilTaskIsFinished(){return await this.d.wait(),this.g}run(){return this.g||(this.g=yt(t=>this.h(t))),this.d.open(),this.g}cancel(){this.g||(this.g=yt(t=>new Promise((e,s)=>{const i=t.onCancellationRequested(()=>{i.dispose(),s(new nt)})})),this.d.open()),this.g.cancel()}};function ws(t,e){return t?k.revive(e?e.transformIncoming(t):t):void 0}function Tn(t,e){return e?e.transformOutgoingURI(t):t}function Ar(t,e){e=e||ma;const s=t.manifest;return{...va({...t,manifest:void 0},e),manifest:s}}function Lr(t,e){return t?.profileLocation?va(t,e??ma):t}function Or(t,e){return e?Gl(t,s=>s instanceof k?e.transformOutgoingURI(s):void 0):t}var F9=class{constructor(t,e){this.a=t,this.b=e,this.onInstallExtension=O.buffer(t.onInstallExtension,!0),this.onDidInstallExtensions=O.buffer(t.onDidInstallExtensions,!0),this.onUninstallExtension=O.buffer(t.onUninstallExtension,!0),this.onDidUninstallExtension=O.buffer(t.onDidUninstallExtension,!0),this.onDidUpdateExtensionMetadata=O.buffer(t.onDidUpdateExtensionMetadata,!0)}listen(t,e){const s=this.b(t);switch(e){case"onInstallExtension":return O.map(this.onInstallExtension,i=>({...i,profileLocation:i.profileLocation?Tn(i.profileLocation,s):i.profileLocation}));case"onDidInstallExtensions":return O.map(this.onDidInstallExtensions,i=>i.map(n=>({...n,local:n.local?Or(n.local,s):n.local,profileLocation:n.profileLocation?Tn(n.profileLocation,s):n.profileLocation})));case"onUninstallExtension":return O.map(this.onUninstallExtension,i=>({...i,profileLocation:i.profileLocation?Tn(i.profileLocation,s):i.profileLocation}));case"onDidUninstallExtension":return O.map(this.onDidUninstallExtension,i=>({...i,profileLocation:i.profileLocation?Tn(i.profileLocation,s):i.profileLocation}));case"onDidUpdateExtensionMetadata":return O.map(this.onDidUpdateExtensionMetadata,i=>({local:Or(i.local,s),profileLocation:Tn(i.profileLocation,s)}))}throw new Error("Invalid listen")}async call(t,e,s){const i=this.b(t);switch(e){case"zip":{const n=Ar(s[0],i),r=await this.a.zip(n);return Tn(r,i)}case"install":return this.a.install(ws(s[0],i),Lr(s[1],i));case"installFromLocation":return this.a.installFromLocation(ws(s[0],i),ws(s[1],i));case"installExtensionsFromProfile":return this.a.installExtensionsFromProfile(s[0],ws(s[1],i),ws(s[2],i));case"getManifest":return this.a.getManifest(ws(s[0],i));case"getTargetPlatform":return this.a.getTargetPlatform();case"installFromGallery":return this.a.installFromGallery(s[0],Lr(s[1],i));case"installGalleryExtensions":{const n=s[0];return this.a.installGalleryExtensions(n.map(({extension:r,options:o})=>({extension:r,options:Lr(o,i)??{}})))}case"uninstall":return this.a.uninstall(Ar(s[0],i),Lr(s[1],i));case"uninstallExtensions":{const n=s[0];return this.a.uninstallExtensions(n.map(({extension:r,options:o})=>({extension:Ar(r,i),options:Lr(o,i)})))}case"getInstalled":return(await this.a.getInstalled(s[0],ws(s[1],i),s[2],s[3])).map(r=>Or(r,i));case"toggleApplicationScope":{const n=await this.a.toggleApplicationScope(Ar(s[0],i),ws(s[1],i));return Or(n,i)}case"copyExtensions":return this.a.copyExtensions(ws(s[0],i),ws(s[1],i));case"updateMetadata":{const n=await this.a.updateMetadata(Ar(s[0],i),s[1],ws(s[2],i));return Or(n,i)}case"resetPinnedStateForAllUserExtensions":return this.a.resetPinnedStateForAllUserExtensions(s[0]);case"getExtensionsControlManifest":return this.a.getExtensionsControlManifest();case"download":return this.a.download(s[0],s[1],s[2]);case"cleanUp":return this.a.cleanUp()}throw new Error("Invalid call")}},q9=class{constructor(t){this.a=t}listen(t,e){throw new Error("Invalid listen")}call(t,e,s){switch(e){case"getConfigBasedTips":return this.a.getConfigBasedTips(k.revive(s[0]));case"getImportantExecutableBasedTips":return this.a.getImportantExecutableBasedTips();case"getOtherExecutableBasedTips":return this.a.getOtherExecutableBasedTips()}throw new Error("Invalid call")}};import*as _9 from"fs";import{createWriteStream as P0,promises as I0}from"fs";var A0="end of central directory record signature not found",z9=new RegExp(A0),ba=class extends Error{constructor(t,e){let s=e.message;switch(t){case"CorruptZip":s=`Corrupt ZIP: ${s}`;break}super(s),this.type=t,this.cause=e}};function V9(t){const e=t.externalFileAttributes>>16||33188;return[448,56,7].map(s=>e&s).reduce((s,i)=>s+i,e&61440)}function L0(t){if(t instanceof ba)return t;let e;return z9.test(t.message)&&(e="CorruptZip"),new ba(e,t)}function B9(t,e,s,i,n,r){const o=Qe(e),a=J(i,o);if(!a.startsWith(i))return Promise.reject(new Error(w(150,null,e)));const c=J(i,e);let l;return r.onCancellationRequested(()=>{l?.destroy()}),Promise.resolve(I0.mkdir(a,{recursive:!0})).then(()=>new Promise((h,u)=>{if(!r.isCancellationRequested)try{l=P0(c,{mode:s}),l.once("close",()=>h()),l.once("error",u),t.once("error",u),t.pipe(l)}catch(f){u(f)}}))}function W9(t,e,s,i){let n=yt(()=>Promise.resolve()),r=0;const o=i.onCancellationRequested(()=>{n.cancel(),t.close()});return new Promise((a,c)=>{const l=new P4,h=u=>{u.isCancellationRequested||(r++,t.readEntry())};t.once("error",c),t.once("close",()=>n.then(()=>{i.isCancellationRequested||t.entryCount===r?a():c(new ba("Incomplete",new Error(w(151,null,r,t.entryCount))))},c)),t.readEntry(),t.on("entry",u=>{if(i.isCancellationRequested)return;if(!s.sourcePathRegex.test(u.fileName)){h(i);return}const f=u.fileName.replace(s.sourcePathRegex,"");if(/\/$/.test(f)){const m=J(e,f);n=yt(v=>I0.mkdir(m,{recursive:!0}).then(()=>h(v)).then(void 0,c));return}const p=N0(t,u),g=V9(u);n=yt(m=>l.queue(()=>p.then(v=>B9(v,f,g,e,s,m).then(()=>h(m)))).then(null,c))})}).finally(()=>o.dispose())}async function O0(t,e=!1){const{open:s}=await import("yauzl");return new Promise((i,n)=>{s(t,e?{lazyEntries:!0}:void 0,(r,o)=>{r?n(L0(r)):i(hs(o))})})}function N0(t,e){return new Promise((s,i)=>{t.openReadStream(e,(n,r)=>{n?i(L0(n)):s(hs(r))})})}async function H9(t,e){const{ZipFile:s}=await import("yazl");return new Promise((i,n)=>{const r=new s;e.forEach(a=>{a.contents?r.addBuffer(typeof a.contents=="string"?Buffer.from(a.contents,"utf8"):a.contents,a.path):a.localPath&&r.addFile(a.localPath,a.path)}),r.end();const o=P0(t);r.outputStream.pipe(o),r.outputStream.once("error",n),o.once("error",n),o.once("finish",()=>i(t))})}function G9(t,e,s={},i){const n=new RegExp(s.sourcePath?`^${s.sourcePath}`:"");let r=O0(t,!0);return s.overwrite&&(r=r.then(o=>le.rm(e).then(()=>o))),r.then(o=>W9(o,e,{sourcePathRegex:n},i))}function J9(t,e){return O0(t).then(s=>new Promise((i,n)=>{s.on("entry",r=>{r.fileName===e&&N0(s,r).then(o=>i(o),o=>n(o))}),s.once("close",()=>n(new Error(w(152,null,e))))}))}function T0(t,e){return J9(t,e).then(s=>new Promise((i,n)=>{const r=[];s.once("error",n),s.on("data",o=>r.push(o)),s.on("end",()=>i(Buffer.concat(r)))}))}var j0;(function(t){t.ERROR_PROFILE_NOT_FOUND="ERROR_PROFILE_NOT_FOUND",t.ERROR_INVALID_CONTENT="ERROR_INVALID_CONTENT"})(j0||(j0={}));var Sa=class extends Error{constructor(t,e){super(t),this.code=e}},hi=W("IExtensionsProfileScannerService"),Nh=class extends j{constructor(e,s,i,n,r){super(),this.j=e,this.m=s,this.n=i,this.q=n,this.r=r,this.b=this.D(new R),this.onAddExtensions=this.b.event,this.c=this.D(new R),this.onDidAddExtensions=this.c.event,this.f=this.D(new R),this.onRemoveExtensions=this.f.event,this.g=this.D(new R),this.onDidRemoveExtensions=this.g.event,this.h=new ht}scanProfileExtensions(e,s){return this.s(e,void 0,s)}async addExtensionsToProfile(e,s,i){const n=[],r=[];try{return await this.s(s,o=>{const a=[];if(i)a.push(...o);else for(const c of o)e.some(([l])=>G(l.identifier,c.identifier)&&l.manifest.version!==c.version)?n.push(c):a.push(c);for(const[c,l]of e){const h=a.findIndex(f=>G(f.identifier,c.identifier)&&f.version===c.manifest.version),u={identifier:c.identifier,version:c.manifest.version,location:c.location,metadata:l};h===-1?(r.push(u),a.push(u)):a.splice(h,1,u)}return r.length&&this.b.fire({extensions:r,profileLocation:s}),n.length&&this.f.fire({extensions:n,profileLocation:s}),a}),r.length&&this.c.fire({extensions:r,profileLocation:s}),n.length&&this.g.fire({extensions:n,profileLocation:s}),r}catch(o){throw r.length&&this.c.fire({extensions:r,error:o,profileLocation:s}),n.length&&this.g.fire({extensions:n,error:o,profileLocation:s}),o}}async updateMetadata(e,s){const i=[];return await this.s(s,n=>{const r=[];for(const o of n){const a=e.find(([c])=>G({id:c.identifier.id},{id:o.identifier.id})&&c.manifest.version===o.version);a&&(o.metadata={...o.metadata,...a[1]},i.push(o)),r.push(o)}return r}),i}async removeExtensionsFromProfile(e,s){const i=[];try{await this.s(s,n=>{const r=[];for(const o of n)e.some(a=>G(o.identifier,a))?i.push(o):r.push(o);return i.length&&this.f.fire({extensions:i,profileLocation:s}),r}),i.length&&this.g.fire({extensions:i,profileLocation:s})}catch(n){throw i.length&&this.g.fire({extensions:i,error:n,profileLocation:s}),n}}async s(e,s,i){return this.C(e).queue(async()=>{let n=[],r;try{const o=await this.m.readFile(e);r=JSON.parse(o.value.toString().trim()||"[]")}catch(o){if(Ue(o)!==1)throw o;if(this.q.extUri.isEqual(e,this.n.defaultProfile.extensionsResource)&&(r=await this.z()),!r&&i?.bailOutWhenFileNotFound)throw new Sa(se(o),"ERROR_PROFILE_NOT_FOUND")}if(r){Array.isArray(r)||this.t(e);let o=!1;for(const a of r){M0(a)||this.t(e);let c;if(de(a.relativeLocation)&&a.relativeLocation)c=this.w(a.relativeLocation);else if(de(a.location)){this.r.warn(`Extensions profile: Ignoring extension with invalid location: ${a.location}`);continue}else{c=k.revive(a.location);const h=this.u(c);h&&(o=!0,a.relativeLocation=h)}ot(a.metadata?.hasPreReleaseVersion)&&a.metadata?.preRelease&&(o=!0,a.metadata.hasPreReleaseVersion=!0);const l=a.metadata?.id??a.identifier.uuid;n.push({identifier:l?{id:a.identifier.id,uuid:l}:{id:a.identifier.id},location:c,version:a.version,metadata:a.metadata})}o&&await this.m.writeFile(e,L.fromString(JSON.stringify(r)))}if(s){n=s(n);const o=n.map(a=>({identifier:a.identifier,version:a.version,location:a.location.toJSON(),relativeLocation:this.u(a.location),metadata:a.metadata}));await this.m.writeFile(e,L.fromString(JSON.stringify(o)))}return n})}t(e){throw new Sa(`Invalid extensions content in ${e.toString()}`,"ERROR_INVALID_CONTENT")}u(e){return this.q.extUri.isEqual(this.q.extUri.dirname(e),this.j)?this.q.extUri.basename(e):void 0}w(e){return this.q.extUri.joinPath(this.j,e)}async z(){return this.y||(this.y=(async()=>{const e=this.q.extUri.joinPath(this.n.defaultProfile.location,"extensions.json"),s=this.q.extUri.joinPath(this.j,".init-default-profile-extensions");let i;try{i=(await this.m.readFile(e)).value.toString()}catch(r){if(Ue(r)===1)return;throw r}this.r.info("Migrating extensions from old default profile location",e.toString());let n;try{const r=JSON.parse(i);Array.isArray(r)&&r.every(o=>M0(o))?n=r:this.r.warn("Skipping migrating from old default profile locaiton: Found invalid data",r)}catch(r){this.r.error(r)}if(n)try{await this.m.createFile(this.n.defaultProfile.extensionsResource,L.fromString(JSON.stringify(n)),{overwrite:!1}),this.r.info("Migrated extensions from old default profile location to new location",e.toString(),this.n.defaultProfile.extensionsResource.toString())}catch(r){if(Ue(r)===3)this.r.info("Migration from old default profile location to new location is done by another window",e.toString(),this.n.defaultProfile.extensionsResource.toString());else throw r}try{await this.m.del(e)}catch(r){Ue(r)!==1&&this.r.error(r)}try{await this.m.del(s)}catch(r){Ue(r)!==1&&this.r.error(r)}return n})()),this.y}C(e){let s=this.h.get(e);return s||(s=new pn,this.h.set(e,s)),s}};Nh=__decorate([__param(1,K),__param(2,Ne),__param(3,he),__param(4,Q)],Nh);function M0(t){const e=t;return Te(e)&&P2(e.identifier)&&(K9(e.location)||de(e.location)&&!!e.location)&&(ot(e.relativeLocation)||de(e.relativeLocation))&&!!e.version&&de(e.version)}function K9(t){if(!t)return!1;const e=t;return typeof e?.path=="string"&&typeof e?.scheme=="string"}function Th(t){switch(t){case 1:return w(116,null);case 2:return w(117,null);case 3:return w(118,null);case 4:return w(119,null);case 5:return w(120,null);case 6:return w(121,null);case 7:return w(122,null);case 8:return w(123,null);case 9:return w(124,null);default:return""}}function Q9(t,e,s,i){try{X9(t,e,s,i)}catch(n){t.error(n?.message??n)}return e}function X9(t,e,s,i){const n=(r,o,a)=>{const c=r[o];if(de(c)){const l=c,h=l.length;if(h>1&&l[0]==="%"&&l[h-1]==="%"){const u=l.substr(1,h-2);let f=s[u];f===void 0&&i&&(f=i[u]);const p=typeof f=="string"?f:f?.message,g=i?.[u],m=typeof g=="string"?g:g?.message;if(!p){m||t.warn(`[${e.name}]: ${w(2032,null,u)}`);return}if(a&&(o==="title"||o==="category")&&m&&m!==p){const v={value:p,original:m};r[o]=v}else r[o]=p}}else if(Te(c))for(const l in c)c.hasOwnProperty(l)&&(l==="commands"?n(c,l,!0):n(c,l,a));else if(Array.isArray(c))for(let l=0;l<c.length;l++)n(c,l,a)};for(const r in e)e.hasOwnProperty(r)&&n(e,r)}var jh;(function(t){function e(s,i){if(s===i)return!0;const n=Object.keys(s),r=new Set;for(const o of Object.keys(i))r.add(o);if(n.length!==r.size)return!1;for(const o of n){if(s[o]!==i[o])return!1;r.delete(o)}return r.size===0}t.equals=e})(jh||(jh={}));var Ea=W("IExtensionsScannerService"),Mh=class extends j{constructor(e,s,i,n,r,o,a,c,l,h,u,f){super(),this.systemExtensionsLocation=e,this.userExtensionsLocation=s,this.n=i,this.q=r,this.r=o,this.s=a,this.t=c,this.u=l,this.w=h,this.y=u,this.z=f,this.g=this.D(new R),this.onDidChangeCache=this.g.event,this.G=void 0,this.h=this.D(this.z.createInstance(xa,n)),this.j=this.D(this.z.createInstance(xa,n)),this.m=this.D(this.z.createInstance($a)),this.D(this.h.onDidChangeCache(()=>this.g.fire(0))),this.D(this.j.onDidChangeCache(()=>this.g.fire(1)))}F(){return this.C||(this.C=zg(this.s,this.t)),this.C}async scanAllExtensions(e,s){const[i,n]=await Promise.all([this.scanSystemExtensions(e),this.scanUserExtensions(s)]);return this.J(i,n,[],await this.F(),!0)}async scanSystemExtensions(e){const s=[];s.push(this.L(e.language)),s.push(this.M(e.language,!!e.checkControlFile));const[i,n]=await Promise.all(s);return this.I([...i,...n],0,{pickLatest:!1})}async scanUserExtensions(e){this.t.trace("Started scanning user extensions",e.profileLocation);const s=this.y.extUri.isEqual(e.profileLocation,this.q.defaultProfile.extensionsResource)?{bailOutWhenFileNotFound:!0}:void 0,i=await this.O(e.profileLocation,!0,1,e.language,!0,s,e.productVersion??this.Q()),n=e.useCache&&!i.devMode?this.j:this.m;let r;try{r=await n.scanExtensions(i)}catch(o){if(o instanceof Sa&&o.code==="ERROR_PROFILE_NOT_FOUND")await this.H(),r=await n.scanExtensions(i);else throw o}return r=await this.I(r,1,{includeInvalid:e.includeInvalid,pickLatest:!0}),this.t.trace("Scanned user extensions:",r.length),r}async scanAllUserExtensions(e={includeInvalid:!0,includeAllVersions:!0}){const s=await this.O(this.userExtensionsLocation,!1,1,void 0,!0,void 0,this.Q()),i=await this.m.scanExtensions(s);return this.I(i,1,{includeAllVersions:e.includeAllVersions,includeInvalid:e.includeInvalid})}async scanExtensionsUnderDevelopment(e,s){if(this.u.isExtensionDevelopment&&this.u.extensionDevelopmentLocationURI){const i=(await Promise.all(this.u.extensionDevelopmentLocationURI.filter(n=>n.scheme===ne.file).map(async n=>{const r=await this.O(n,!1,1,s.language,!1,void 0,this.Q());return(await this.m.scanOneOrMultipleExtensions(r)).map(a=>(a.type=e.find(c=>G(c.identifier,a.identifier))?.type??a.type,this.m.validate(a,r)))}))).flat();return this.I(i,"development",{includeInvalid:s.includeInvalid,pickLatest:!0})}return[]}async scanExistingExtension(e,s,i){const n=await this.O(e,!1,s,i.language,!0,void 0,this.Q()),r=await this.m.scanExtension(n);return!r||!i.includeInvalid&&!r.isValid?null:r}async scanOneOrMultipleExtensions(e,s,i){const n=await this.O(e,!1,s,i.language,!0,void 0,this.Q()),r=await this.m.scanOneOrMultipleExtensions(n);return this.I(r,s,{includeInvalid:i.includeInvalid,pickLatest:!0})}async scanMultipleExtensions(e,s,i){const n=[];return await Promise.all(e.map(async r=>{const o=await this.scanOneOrMultipleExtensions(r,s,i);n.push(...o)})),this.I(n,s,{includeInvalid:i.includeInvalid,pickLatest:!0})}async updateManifestMetadata(e,s){const i=V(e,"package.json"),n=(await this.s.readFile(i)).value.toString(),r=JSON.parse(n);r.__metadata={...r.__metadata,...s},await this.s.writeFile(V(e,"package.json"),L.fromString(JSON.stringify(r,null,"	")))}async initializeDefaultProfileExtensions(){try{await this.r.scanProfileExtensions(this.q.defaultProfile.extensionsResource,{bailOutWhenFileNotFound:!0})}catch(e){if(e instanceof Sa&&e.code==="ERROR_PROFILE_NOT_FOUND")await this.H();else throw e}}async H(){return this.G||(this.G=(async()=>{try{this.t.info("Started initializing default profile extensions in extensions installation folder.",this.userExtensionsLocation.toString());const e=await this.scanAllUserExtensions({includeInvalid:!0});if(e.length)await this.r.addExtensionsToProfile(e.map(s=>[s,s.metadata]),this.q.defaultProfile.extensionsResource);else try{await this.s.createFile(this.q.defaultProfile.extensionsResource,L.fromString(JSON.stringify([])))}catch(s){Ue(s)!==1&&this.t.warn("Failed to create default profile extensions manifest in extensions installation folder.",this.userExtensionsLocation.toString(),se(s))}this.t.info("Completed initializing default profile extensions in extensions installation folder.",this.userExtensionsLocation.toString())}catch(e){this.t.error(e)}finally{this.G=void 0}})()),this.G}async I(e,s,i={}){return i.includeAllVersions||(e=this.J(s===0?e:void 0,s===1?e:void 0,s==="development"?e:void 0,await this.F(),!!i.pickLatest)),i.includeInvalid||(e=e.filter(n=>n.isValid)),e.sort((n,r)=>{const o=qt(n.location.fsPath),a=qt(r.location.fsPath);return o<a?-1:o>a?1:0})}J(e,s,i,n,r){const o=(c,l,h)=>{if(!h){if(c.metadata?.isApplicationScoped&&!l.metadata?.isApplicationScoped)return!1;if(!c.metadata?.isApplicationScoped&&l.metadata?.isApplicationScoped)return!0}if(c.isValid&&!l.isValid)return!1;if(c.isValid===l.isValid){if(r&&ha(c.manifest.version,l.manifest.version))return this.t.debug(`Skipping extension ${l.location.path} with lower version ${l.manifest.version} in favour of ${c.location.path} with version ${c.manifest.version}`),!1;if(t9(c.manifest.version,l.manifest.version)){if(c.type===0)return this.t.debug(`Skipping extension ${l.location.path} in favour of system extension ${c.location.path} with same version`),!1;if(c.targetPlatform===n)return this.t.debug(`Skipping extension ${l.location.path} from different target platform ${l.targetPlatform}`),!1}}return h?this.t.warn(`Overwriting user extension ${c.location.path} with ${l.location.path}.`):this.t.debug(`Overwriting user extension ${c.location.path} with ${l.location.path}.`),!0},a=new x5;return e?.forEach(c=>{const l=a.get(c.identifier.id);(!l||o(l,c,!1))&&a.set(c.identifier.id,c)}),s?.forEach(c=>{const l=a.get(c.identifier.id);if(!l&&e&&c.type===0){this.t.debug(`Skipping obsolete system extension ${c.location.path}.`);return}(!l||o(l,c,!1))&&a.set(c.identifier.id,c)}),i?.forEach(c=>{const l=a.get(c.identifier.id);(!l||o(l,c,!0))&&a.set(c.identifier.id,c),a.set(c.identifier.id,c)}),[...a.values()]}async L(e){this.t.trace("Started scanning system extensions");const s=await this.O(this.systemExtensionsLocation,!1,0,e,!0,void 0,this.Q()),n=await(s.devMode?this.m:this.h).scanExtensions(s);return this.t.trace("Scanned system extensions:",n.length),n}async M(e,s){const i=this.u.isBuilt?[]:this.w.builtInExtensions;if(!i?.length)return[];this.t.trace("Started scanning dev system extensions");const n=s?await this.N():{},r=[],o=k.file(si(J(ii.asFileUri("").fsPath,"..",".build","builtInExtensions")));for(const c of i){const l=n[c.name]||"marketplace";switch(l){case"disabled":break;case"marketplace":r.push(V(o,c.name));break;default:r.push(k.file(l));break}}const a=await Promise.all(r.map(async c=>this.m.scanExtension(await this.O(c,!1,0,e,!0,void 0,this.Q()))));return this.t.trace("Scanned dev system extensions:",a.length),rn(a)}async N(){try{const e=await this.s.readFile(this.n);return JSON.parse(e.value.toString())}catch{return{}}}async O(e,s,i,n,r,o,a){const c=await this.f(n??Es),l=await this.P(e),h=s&&!this.y.extUri.isEqual(e,this.q.defaultProfile.extensionsResource)?this.q.defaultProfile.extensionsResource:void 0,u=h?await this.P(h):void 0;return new Nr(e,l,h,u,s,o,i,r,a.version,a.date,this.w.commit,!this.u.isBuilt,n,c)}async P(e){try{const s=await this.s.stat(e);if(typeof s.mtime=="number")return s.mtime}catch{}}Q(){return{version:this.w.version,date:this.w.date}}};Mh=__decorate([__param(4,Ne),__param(5,hi),__param(6,K),__param(7,Q),__param(8,ae),__param(9,ge),__param(10,he),__param(11,ns)],Mh);var Nr=class{constructor(t,e,s,i,n,r,o,a,c,l,h,u,f,p){this.location=t,this.mtime=e,this.applicationExtensionslocation=s,this.applicationExtensionslocationMtime=i,this.profile=n,this.profileScanOptions=r,this.type=o,this.validate=a,this.productVersion=c,this.productDate=l,this.productCommit=h,this.devMode=u,this.language=f,this.translations=p}static createNlsConfiguration(t){return{language:t.language,pseudo:t.language==="pseudo",devMode:t.devMode,translations:t.translations}}static equals(t,e){return Vs(t.location,e.location)&&t.mtime===e.mtime&&Vs(t.applicationExtensionslocation,e.applicationExtensionslocation)&&t.applicationExtensionslocationMtime===e.applicationExtensionslocationMtime&&t.profile===e.profile&&bt(t.profileScanOptions,e.profileScanOptions)&&t.type===e.type&&t.validate===e.validate&&t.productVersion===e.productVersion&&t.productDate===e.productDate&&t.productCommit===e.productCommit&&t.devMode===e.devMode&&t.language===e.language&&jh.equals(t.translations,e.translations)}},$a=class extends j{constructor(e,s,i,n,r,o){super(),this.g=e,this.h=s,this.j=i,this.m=r,this.n=o,this.f=n.extensionsEnabledWithApiProposalVersion?.map(a=>a.toLowerCase())??[]}async scanExtensions(e){return e.profile?this.r(e):this.q(e)}async q(e){const s=await this.j.resolve(e.location);if(!s.children?.length)return[];const i=await Promise.all(s.children.map(async n=>{if(!n.isDirectory||e.type===1&&nr(n.resource).indexOf(".")===0)return null;const r=new Nr(n.resource,e.mtime,e.applicationExtensionslocation,e.applicationExtensionslocationMtime,e.profile,e.profileScanOptions,e.type,e.validate,e.productVersion,e.productDate,e.productCommit,e.devMode,e.language,e.translations);return this.scanExtension(r)}));return rn(i).sort((n,r)=>n.location.path<r.location.path?-1:1)}async r(e){let s=await this.s(e.location,()=>!0,e);if(e.applicationExtensionslocation&&!this.h.extUri.isEqual(e.location,e.applicationExtensionslocation)){s=s.filter(n=>!n.metadata?.isApplicationScoped);const i=await this.s(e.applicationExtensionslocation,n=>!!n.metadata?.isBuiltin||!!n.metadata?.isApplicationScoped,e);s.push(...i)}return s}async s(e,s,i){const n=await this.g.scanProfileExtensions(e,i.profileScanOptions);if(!n.length)return[];const r=await Promise.all(n.map(async o=>{if(s(o)){const a=new Nr(o.location,i.mtime,i.applicationExtensionslocation,i.applicationExtensionslocationMtime,i.profile,i.profileScanOptions,i.type,i.validate,i.productVersion,i.productDate,i.productCommit,i.devMode,i.language,i.translations);return this.scanExtension(a,o)}return null}));return rn(r)}async scanOneOrMultipleExtensions(e){try{if(await this.j.exists(V(e.location,"package.json"))){const s=await this.scanExtension(e);return s?[s]:[]}else return await this.scanExtensions(e)}catch(s){return this.n.error(`Error scanning extensions at ${e.location.path}:`,se(s)),[]}}async scanExtension(e,s){const i=[];let n=!0,r;try{r=await this.t(e.location)}catch(f){if(s){i.push([pt.Error,se(f)]),n=!1;const[p,g]=s.identifier.id.split(".");r={name:g,publisher:p,version:s.version,engines:{vscode:""}}}else return e.type!==0&&this.n.error(f),null}r.publisher||(r.publisher=Lg);let o;s?o={...s.metadata,size:r.__metadata?.size}:r.__metadata&&(o={installedTimestamp:r.__metadata.installedTimestamp,size:r.__metadata.size,targetPlatform:r.__metadata.targetPlatform}),delete r.__metadata;const a=Ks(r.publisher,r.name),c=o?.id?{id:a,uuid:o.id}:{id:a},l=o?.isSystem?0:e.type,h=l===0||!!o?.isBuiltin;try{r=await this.u(e.location,r,Nr.createNlsConfiguration(e))}catch(f){this.n.warn("Failed to translate manifest",se(f))}let u={type:l,identifier:c,manifest:r,location:e.location,isBuiltin:h,targetPlatform:o?.targetPlatform??"undefined",publisherDisplayName:o?.publisherDisplayName,metadata:o,isValid:n,validations:i,preRelease:!!o?.preRelease};return e.validate&&(u=this.validate(u,e)),r.enabledApiProposals&&(!this.m.isBuilt||this.f.includes(a.toLowerCase()))&&(r.originalEnabledApiProposals=r.enabledApiProposals,r.enabledApiProposals=R5([...r.enabledApiProposals])),u}validate(e,s){let i=e.isValid;const n=this.m.isBuilt&&this.f.includes(e.identifier.id.toLowerCase()),r=l9(s.productVersion,s.productDate,s.location,e.manifest,e.isBuiltin,n);for(const[o,a]of r)o===pt.Error&&(i=!1,this.n.error(this.C(s.location,a)));return e.isValid=i,e.validations=[...e.validations,...r],e}async t(e){const s=V(e,"package.json");let i;try{i=(await this.j.readFile(s)).value.toString()}catch(r){throw Ue(r)!==1&&this.n.error(this.C(e,w(2033,null,s.path,r.message))),r}let n;try{n=JSON.parse(i)}catch(r){const o=[];Be(i,o);for(const a of o)this.n.error(this.C(e,w(2034,null,s.path,a.offset,a.length,Th(a.error))));throw r}if(In(n)!=="object"){const r=this.C(e,w(2035,null,s.path));throw this.n.error(r),new Error(r)}return n}async u(e,s,i){const n=await this.w(e,s,i);if(n)try{const r=[],o=await this.y(n.default,r);if(r.length>0)return r.forEach(c=>{this.n.error(this.C(e,w(2036,null,n.default?.path,Th(c.error))))}),s;if(In(n)!=="object")return this.n.error(this.C(e,w(2037,null,n.default?.path))),s;const a=n.values||Object.create(null);return Q9(this.n,s,a,o)}catch{}return s}async w(e,s,i){const n=V(e,"package.nls.json"),r=(l,h)=>{h.forEach(u=>{this.n.error(this.C(e,w(2038,null,l?.path,Th(u.error))))})},o=l=>{this.n.error(this.C(e,w(2039,null,l?.path)))},a=`${s.publisher}.${s.name}`,c=i.translations[a];if(c)try{const l=k.file(c),h=(await this.j.readFile(l)).value.toString(),u=[],f=Be(h,u);return u.length>0?(r(l,u),{values:void 0,default:n}):In(f)!=="object"?(o(l),{values:void 0,default:n}):{values:f.contents?f.contents.package:void 0,default:n}}catch{return{values:void 0,default:n}}else{if(!await this.j.exists(n))return;let h;try{h=await this.z(e,i)}catch{return}if(!h.localized)return{values:void 0,default:h.original};try{const u=(await this.j.readFile(h.localized)).value.toString(),f=[],p=Be(u,f);return f.length>0?(r(h.localized,f),{values:void 0,default:h.original}):In(p)!=="object"?(o(h.localized),{values:void 0,default:h.original}):{values:p,default:h.original}}catch{return{values:void 0,default:h.original}}}}async y(e,s){if(e)try{const i=(await this.j.readFile(e)).value.toString();return Be(i,s)}catch{}}z(e,s){return new Promise((i,n)=>{const r=o=>{const a=V(e,`package.nls.${o}.json`);this.j.exists(a).then(c=>{c&&i({localized:a,original:V(e,"package.nls.json")});const l=o.lastIndexOf("-");l===-1?i({localized:V(e,"package.nls.json"),original:null}):(o=o.substring(0,l),r(o))})};if(s.devMode||s.pseudo||!s.language)return i({localized:V(e,"package.nls.json"),original:null});r(s.language)})}C(e,s){return`[${e.path}]: ${s}`}};$a=__decorate([__param(0,hi),__param(1,he),__param(2,K),__param(3,ge),__param(4,ae),__param(5,Q)],$a);var xa=class extends $a{constructor(e,s,i,n,r,o,a,c){super(i,n,r,o,a,c),this.I=e,this.J=s,this.G=this.D(new Li(3e3)),this.H=this.D(new R),this.onDidChangeCache=this.H.event}async scanExtensions(e){const s=this.O(e),i=await this.L(s);if(this.F=e,i&&i.input&&Nr.equals(i.input,this.F))return this.n.debug("Using cached extensions scan result",e.type===0?"system":"user",e.location.toString()),this.G.trigger(()=>this.N()),i.result.map(r=>(r.location=k.revive(r.location),r));const n=await super.scanExtensions(e);return await this.M(s,{input:e,result:n}),n}async L(e){try{const s=await this.j.readFile(e),i=JSON.parse(s.value.toString());return{result:i.result,input:mn(i.input)}}catch(s){this.n.debug("Error while reading the extension cache file:",e.path,se(s))}return null}async M(e,s){try{await this.j.writeFile(e,L.fromString(JSON.stringify(s)))}catch(i){this.n.debug("Error while writing the extension cache file:",e.path,se(i))}}async N(){if(!this.F)return;const e=this.O(this.F),s=await this.L(e);if(!s)return;const i=s.result,n=JSON.parse(JSON.stringify(await super.scanExtensions(this.F)));if(!bt(n,i))try{this.n.info("Invalidating Cache",i,n),await this.j.del(e),this.H.fire()}catch(r){this.n.error(r)}}O(e){const s=this.P(e);return this.h.extUri.joinPath(s.cacheHome,e.type===0?$5:Ag)}P(e){return e.type===0?this.J.defaultProfile:e.profile?this.h.extUri.isEqual(e.location,this.I.extensionsResource)?this.I:this.J.profiles.find(s=>this.h.extUri.isEqual(e.location,s.extensionsResource))??this.I:this.J.defaultProfile}};xa=__decorate([__param(1,Ne),__param(2,hi),__param(3,he),__param(4,K),__param(5,ge),__param(6,ae),__param(7,Q)],xa);var Z9=class extends Mh{constructor(t,e,s,i,n,r,o,a,c,l,h,u){super(t,e,V(s,".vscode-oss-dev","extensions","control.json"),i,n,r,o,a,c,l,h,u),this.R=(async()=>{if(Gd)try{const f=await this.s.readFile(k.file(Gd));return JSON.parse(f.value.toString())}catch{}return Object.create(null)})()}f(t){return this.R}};function Uh(t){let e="Extract";return t instanceof ba&&(t.type==="CorruptZip"?e="CorruptZip":t.type==="Incomplete"&&(e="IncompleteZip")),We(t,e)}async function Fh(t){let e;try{e=await T0(t,"extension/package.json")}catch(s){throw Uh(s)}try{return JSON.parse(e.toString("utf8"))}catch{throw new Me(w(2050,null),"Invalid")}}var ka,qh=class extends j{static{ka=this}static{this.c=".sigzip"}constructor(e,s,i,n,r,o,a){super(),this.j=s,this.m=i,this.n=n,this.q=r,this.r=o,this.t=a,this.extensionsDownloadDir=e.extensionsDownloadLocation,this.f=o.extUri.joinPath(e.extensionsDownloadLocation,".trash"),this.g=20,this.h=this.F()}async download(e,s,i,n){await this.h;const r=await this.u(e,s);if(!i)return{location:r,verificationStatus:void 0};if(!e.isSigned)return{location:r,verificationStatus:Ze.NotSigned};let o;try{o=await this.w(e);const a=(await this.n.verify(e.identifier.id,e.version,r.fsPath,o.fsPath,n))?.code;if(a===Ze.PackageIsInvalidZip||a===Ze.SignatureArchiveIsInvalidZip){try{await this.delete(r)}catch(c){this.t.error(c)}throw new Me(A0,"CorruptZip")}return{location:r,verificationStatus:a}}catch(a){try{await this.delete(r)}catch(c){this.t.error(c)}throw a}finally{if(o)try{await this.delete(o)}catch(a){this.t.error(a)}}}async u(e,s){try{const i=V(this.extensionsDownloadDir,this.G(e)),n=await this.z(e,"vsix",async()=>{await this.y(e,i,r=>this.m.download(e,r,s));try{await this.C(i.fsPath,"extension/package.json")}catch(r){try{await this.j.del(i)}catch(o){this.t.warn(`Error while deleting: ${i.path}`,se(o))}throw r}},2);return n>1&&this.q.publicLog2("extensiongallery:downloadvsix:retry",{extensionId:e.identifier.id,attempts:n}),i}catch(i){throw We(i,"Download")}}async w(e){try{const s=V(this.extensionsDownloadDir,`${this.G(e)}${ka.c}`),i=await this.z(e,"sigzip",async()=>{await this.m.downloadSignatureArchive(e,s);try{await this.C(s.fsPath,".signature.p7s")}catch(n){try{await this.j.del(s)}catch(r){this.t.warn(`Error while deleting: ${s.path}`,se(r))}throw n}},2);return i>1&&this.q.publicLog2("extensiongallery:downloadsigzip:retry",{extensionId:e.identifier.id,attempts:i}),s}catch(s){throw We(s,"DownloadSignature")}}async y(e,s,i){if(await this.j.exists(s))return;if(s.scheme!==ne.file){await i(s);return}const n=V(this.extensionsDownloadDir,`.${tt()}`);try{await i(n)}catch(r){try{await this.j.del(n)}catch{}throw r}try{await le.rename(n.fsPath,s.fsPath,2*60*1e3)}catch(r){try{await this.j.del(n)}catch{}let o=!1;try{o=await this.j.exists(s)}catch{}if(o)this.t.info("Rename failed because the file was downloaded by another source. So ignoring renaming.",e.identifier.id,s.path);else throw this.t.info(`Rename failed because of ${se(r)}. Deleted the file from downloaded location`,n.path),r}}async z(e,s,i,n){let r=1;for(;;)try{return await i(),r}catch(o){if(r++>n)throw o;this.t.warn(`Failed downloading ${s}. ${se(o)}. Retry again...`,e.identifier.id)}}async C(e,s){try{await T0(e,s)}catch(i){throw Uh(i)}}async delete(e){await this.h;const s=this.r.extUri.relativePath(this.extensionsDownloadDir,e);s?await this.j.move(e,this.r.extUri.joinPath(this.f,s),!0):await this.j.del(e)}async F(){try{if(!await this.j.exists(this.extensionsDownloadDir)){this.t.trace("Extension VSIX downloads cache dir does not exist");return}try{await this.j.del(this.f,{recursive:!0})}catch(s){Ue(s)!==1&&this.t.error(s)}const e=await this.j.resolve(this.extensionsDownloadDir,{resolveMetadata:!0});if(e.children){const s=[],i=[],n=[];for(const a of e.children)if(a.name.endsWith(ka.c))n.push(a.resource);else{const c=Gt.parse(a.name);c&&i.push([c,a])}const r=_g(i,([a])=>a),o=[];for(const a of r)a.sort((c,l)=>Qg(c[0].version,l[0].version)),s.push(...a.slice(1).map(c=>c[1].resource)),o.push(a[0][1]);o.sort((a,c)=>a.mtime-c.mtime),s.push(...o.slice(0,Math.max(0,o.length-this.g)).map(a=>a.resource)),s.push(...n),await Xe.settled(s.map(a=>(this.t.trace("Deleting from cache",a.path),this.j.del(a))))}}catch(e){this.t.error(e)}}G(e){return Gt.create(e).toString().toLowerCase()}};qh=ka=__decorate([__param(0,Vt),__param(1,K),__param(2,xs),__param(3,h0),__param(4,ke),__param(5,he),__param(6,Q)],qh);import{fork as Y9}from"child_process";var _h=class extends j{constructor(e,s){super(),this.b=e,this.f=s,this.a=new O1(5)}async postUninstall(e){const s=this.g(e,"uninstall");s&&(this.f.info(e.identifier.id,e.manifest.version,"Running post uninstall script"),await this.a.queue(async()=>{try{await this.h(s.script,"uninstall",s.args,!0,e),this.f.info("Finished running post uninstall script",e.identifier.id,e.manifest.version)}catch(i){this.f.error("Failed to run post uninstall script",e.identifier.id,e.manifest.version),this.f.error(i)}}));try{await le.rm(this.m(e))}catch(i){this.f.error("Error while removing extension storage path",e.identifier.id),this.f.error(i)}}g(e,s){const i=`vscode:${s}`;if(e.location.scheme===ne.file&&e.manifest&&e.manifest.scripts&&typeof e.manifest.scripts[i]=="string"){const n=e.manifest.scripts[i].split(" ");return n.length<2||n[0]!=="node"||!n[1]?(this.f.warn(e.identifier.id,e.manifest.version,`${i} should be a node script`),null):{script:J(e.location.fsPath,n[1]),args:n.slice(2)||[]}}return null}h(e,s,i,n,r){return new Promise((o,a)=>{const c=this.j(e,s,i,r);let l;const h=u=>{l&&(clearTimeout(l),l=null),u?a(u):o(void 0)};c.on("error",u=>{h(Xt(u)||"Unknown")}),c.on("exit",(u,f)=>{h(u?`post-${s} process exited with code ${u}`:void 0)}),n&&(l=setTimeout(()=>{l=null,c.kill(),a("timed out")},5e3))})}j(e,s,i,n){const r={silent:!0,execArgv:void 0},o=Y9(e,[`--type=extension-post-${s}`,...i],r);o.stdout.setEncoding("utf8"),o.stderr.setEncoding("utf8");const a=O.fromNodeEventEmitter(o.stdout,"data"),c=O.fromNodeEventEmitter(o.stderr,"data");this.D(a(u=>this.f.info(n.identifier.id,n.manifest.version,`post-${s}`,u))),this.D(c(u=>this.f.error(n.identifier.id,n.manifest.version,`post-${s}`,u)));const l=O.any(O.map(a,u=>({data:`%c${u}`,format:[""]}),this.B),O.map(c,u=>({data:`%c${u}`,format:["color: red"]}),this.B));return O.debounce(l,(u,f)=>u?{data:u.data+f.data,format:[...u.format,...f.format]}:{data:f.data,format:f.format},100,void 0,void 0,void 0,this.B)(u=>{console.group(n.identifier.id),console.log(u.data,...u.format),console.groupEnd()}),o}m(e){return J(this.b.defaultProfile.globalStorageHome.fsPath,e.identifier.id.toLowerCase())}};_h=__decorate([__param(0,Ne),__param(1,Q)],_h);var e7=class extends j{constructor(t,e,s,i,n){super(),this.a=t,this.b=e,this.c=s,this.f=n,this.D(i.onDidInstallExtensions(r=>this.g(r))),this.D(i.onDidUninstallExtension(r=>this.h(r)))}g(t){for(const e of t)e.local&&this.invalidate(e.profileLocation)}h(t){t.error||this.invalidate(t.profileLocation)}async invalidate(t){if(t)for(const e of this.a.profiles)this.c.extUri.isEqual(e.extensionsResource,t)&&await this.j(e);else await this.j(this.a.defaultProfile)}async j(t){try{await this.b.del(this.c.extUri.joinPath(t.cacheHome,Ag))}catch(e){Ue(e)!==1&&this.f.error(e)}}},t7=class extends j{constructor(t,e,s,i,n,r,o){super(),this.f=t,this.g=e,this.h=s,this.j=i,this.m=n,this.n=r,this.q=o,this.a=this.D(new R),this.onDidChangeExtensionsByAnotherSource=this.a.event,this.b=new Map,this.c=this.D(new go),this.r().then(null,a=>o.error("Error while initializing Extensions Watcher",se(a)))}async r(){await this.g.initializeDefaultProfileExtensions(),await this.t(this.h.profiles),this.s(),await this.H()}s(){this.D(this.h.onDidChangeProfiles(t=>this.t(t.added))),this.D(this.j.onAddExtensions(t=>this.u(t))),this.D(this.j.onDidAddExtensions(t=>this.w(t))),this.D(this.j.onRemoveExtensions(t=>this.y(t))),this.D(this.j.onDidRemoveExtensions(t=>this.z(t))),this.D(this.n.onDidFilesChange(t=>this.C(t)))}async t(t){try{t.length&&await Promise.all(t.map(e=>(this.c.set(e.id,qc(this.n.watch(this.m.extUri.dirname(e.extensionsResource)),this.n.watch(e.extensionsResource))),this.G(e.extensionsResource))))}catch(e){throw this.q.error(e),e}}async u(t){for(const e of t.extensions)this.I(this.L(e.identifier,e.version),t.profileLocation)}async w(t){for(const e of t.extensions){const s=this.L(e.identifier,e.version);t.error?this.J(s,t.profileLocation):this.I(s,t.profileLocation)}}async y(t){for(const e of t.extensions)this.J(this.L(e.identifier,e.version),t.profileLocation)}async z(t){const e=[],s=[];for(const i of t.extensions){const n=this.L(i.identifier,i.version);t.error?this.I(n,t.profileLocation):(this.J(n,t.profileLocation),this.b.has(n)||(this.q.debug("Extension is removed from all profiles",i.identifier.id,i.version),s.push(this.f.scanInstalledExtensionAtLocation(i.location).then(r=>{r?e.push(r):this.q.info("Extension not found at the location",i.location.toString())},r=>this.q.error(r)))))}try{await Promise.all(s),e.length&&await this.H(e)}catch(i){this.q.error(i)}}C(t){for(const e of this.h.profiles)t.contains(e.extensionsResource,0,1)&&this.F(e.extensionsResource)}async F(t){const e=[],s=[],i=await this.j.scanProfileExtensions(t),n=new Set,r=new Set;for(const[o,a]of this.b)a.has(t)&&r.add(o);for(const o of i){const a=this.L(o.identifier,o.version);n.add(a),r.has(a)||(e.push(o.identifier),this.I(a,t))}for(const o of r)if(!n.has(o)){const a=this.M(o);a&&(s.push(a.identifier),this.J(o,t))}(e.length||s.length)&&this.a.fire({added:e.length?{extensions:e,profileLocation:t}:void 0,removed:s.length?{extensions:s,profileLocation:t}:void 0})}async G(t){const e=await this.j.scanProfileExtensions(t);for(const s of e)this.I(this.L(s.identifier,s.version),t)}async H(t){t||(t=(await this.f.scanAllUserInstalledExtensions()).filter(s=>!this.b.has(this.L(s.identifier,s.manifest.version)))),t.length&&await this.f.deleteExtensions(...t)}I(t,e){let s=this.b.get(t);s||this.b.set(t,s=new Uc(i=>this.m.extUri.getComparisonKey(i))),s.add(e)}J(t,e){const s=this.b.get(t);s&&s.delete(e),s?.size||this.b.delete(t)}L(t,e){return`${Ln.toKey(t.id)}@${e}`}M(t){const[e,s]=z5(t);return s?{identifier:{id:e},version:s}:void 0}},zh=Gs,Vh=".vsctmp",Bh=class extends Lh{constructor(e,s,i,n,r,o,a,c,l,h,u,f,p,g,m){super(e,s,g,i,f,p,m),this.kb=n,this.lb=r,this.mb=o,this.nb=a,this.ob=c,this.pb=l,this.qb=h,this.rb=u,this.jb=new Map,this.Gb=new Uc;const v=this.D(c.createInstance(_h));this.gb=this.D(c.createInstance(Wh,S=>v.postUninstall(S))),this.hb=this.D(new e7(m,l,g,this,this.I)),this.ib=this.D(c.createInstance(qh));const b=this.D(new t7(this,this.lb,m,o,g,l,i));this.D(b.onDidChangeExtensionsByAnotherSource(S=>this.Fb(S))),this.Hb()}getTargetPlatform(){return this.sb||(this.sb=zg(this.pb,this.I)),this.sb}async zip(e){this.I.trace("ExtensionManagementService#zip",e.identifier.id);const s=await this.Eb(e),i=await H9(V(this.ib.extensionsDownloadDir,tt()).fsPath,s);return k.file(i)}async getManifest(e){const{location:s,cleanup:i}=await this.xb(e),n=Ai(s.fsPath);try{return await Fh(n)}finally{await i()}}getInstalled(e,s=this.J.defaultProfile.extensionsResource,i={version:this.g.version,date:this.g.date},n){return this.gb.scanExtensions(e??null,s,i,n)}scanAllUserInstalledExtensions(){return this.gb.scanAllUserExtensions()}scanInstalledExtensionAtLocation(e){return this.gb.scanUserExtensionAtLocation(e)}async install(e,s={}){this.I.trace("ExtensionManagementService#install",e.toString());const{location:i,cleanup:n}=await this.xb(e);try{const r=await Fh(Ai(i.fsPath)),o=Ks(r.publisher,r.name);if(r.engines&&r.engines.vscode&&!fh(r.engines.vscode,this.g.version,this.g.date))throw new Error(w(2040,null,o,this.g.version));const a=this.h.isAllowed({id:o,version:r.version,publisherDisplayName:void 0});if(a!==!0)throw new Error(w(2041,null,a.value));const l=(await this.L([{manifest:r,extension:i,options:s}])).find(({identifier:h})=>G(h,{id:o}));if(l?.local)return l.local;throw l?.error?l.error:We(new Error(`Unknown error while installing extension ${o}`))}finally{await n()}}async installFromLocation(e,s){this.I.trace("ExtensionManagementService#installFromLocation",e.toString());const i=await this.gb.scanUserExtensionAtLocation(e);if(!i||!i.manifest.name||!i.manifest.version)throw new Error(`Cannot find a valid extension from the location ${e.toString()}`);return await this.Jb([[i,{source:"resource"}]],s),this.I.info("Successfully installed extension",i.identifier.id,s.toString()),i}async installExtensionsFromProfile(e,s,i){this.I.trace("ExtensionManagementService#installExtensionsFromProfile",e,s.toString(),i.toString());const n=(await this.getInstalled(1,s)).filter(r=>e.some(o=>G(o,r.identifier)));if(n.length){const r=await Promise.all(n.map(o=>this.gb.scanMetadata(o,s)));await this.Jb(n.map((o,a)=>[o,r[a]]),i),this.I.info("Successfully installed extensions",n.map(o=>o.identifier.id),i.toString())}return n}async updateMetadata(e,s,i){return this.I.trace("ExtensionManagementService#updateMetadata",e.identifier.id),s.isPreReleaseVersion&&(s.preRelease=!0,s.hasPreReleaseVersion=!0),s.isMachineScoped===!1&&(s.isMachineScoped=void 0),s.isBuiltin===!1&&(s.isBuiltin=void 0),s.pinned===!1&&(s.pinned=void 0),e=await this.gb.updateMetadata(e,s,i),this.hb.invalidate(i),this.z.fire({local:e,profileLocation:i}),e}fb(e){return this.gb.deleteExtension(e,"remove")}cb(e,s,i,n){return this.gb.copyExtension(e,s,i,n)}db(e,s,i,n){return this.gb.moveExtension(e,s,i,n)}eb(e,s){return this.gb.removeExtension(e.identifier,s)}copyExtensions(e,s){return this.gb.copyExtensions(e,s,{version:this.g.version,date:this.g.date})}deleteExtensions(...e){return this.gb.setExtensionsForRemoval(...e)}async cleanUp(){this.I.trace("ExtensionManagementService#cleanUp");try{await this.gb.cleanUp()}catch(e){this.I.error(e)}}async download(e,s,i){const{location:n}=await this.Cb(e,s,!i);return n}async xb(e){if(e.scheme===ne.file)return{location:e,async cleanup(){}};this.I.trace("Downloading extension from",e.toString());const s=V(this.ib.extensionsDownloadDir,tt());return await this.nb.download(e,s),this.I.info("Downloaded extension to",s.toString()),{location:s,cleanup:async()=>{try{await this.pb.del(s)}catch(n){this.I.error(n)}}}}$(){return this.J.defaultProfile.extensionsResource}ab(e,s,i){const n=s instanceof k?new Gt({id:Ks(e.publisher,e.name)},e.version):Gt.create(s);return this.ob.createInstance(Hh,n,e,s,i,(r,o)=>{if(s instanceof k)return this.Db(n,s,i,o);let a=this.jb.get(n.toString());return a||(this.jb.set(n.toString(),a=this.Bb(n,s,r,i,o)),a.finally(()=>this.jb.delete(n.toString()))),a},this.gb)}bb(e,s){return new s7(e,s,this.mb)}async Bb(e,s,i,n,r){const{verificationStatus:o,location:a}=await this.Cb(s,i,!n.donotVerifySignature,n.context?.[R2]);try{if(r.isCancellationRequested)throw new nt;const c=await Fh(a.fsPath);if(!new Gt(s.identifier,s.version).equals(new Gt({id:Ks(c.publisher,c.name)},c.version)))throw new Me(w(2042,null,s.identifier.id),"Invalid");const l=await this.gb.extractUserExtension(e,a.fsPath,!1,r);if(o!==Ze.Success&&this.kb.isBuilt)try{await this.ib.delete(a)}catch(h){this.I.warn("Error while deleting the downloaded file",a.toString(),se(h))}return{local:l,verificationStatus:o}}catch(c){try{await this.ib.delete(a)}catch(l){this.I.warn("Error while deleting the downloaded file",a.toString(),se(l))}throw We(c)}}async Cb(e,s,i,n){if(i){const c=this.qb.getValue(I2);i=ls(c)?c:!0}const{location:r,verificationStatus:o}=await this.ib.download(e,s,i,n),a=L2(e.private,await this.rb.getExtensionGalleryManifest());if(o!==Ze.Success&&!(o===Ze.NotSigned&&!a)&&i&&this.kb.isBuilt&&await this.getTargetPlatform()!=="linux-armhf"){try{await this.ib.delete(r)}catch(c){this.I.warn("Error while deleting the downloaded file",r.toString(),se(c))}if(!o)throw new Me(w(2043,null),"SignatureVerificationInternal");switch(o){case Ze.PackageIntegrityCheckFailed:case Ze.SignatureIsInvalid:case Ze.SignatureManifestIsInvalid:case Ze.SignatureIntegrityCheckFailed:case Ze.EntryIsMissing:case Ze.EntryIsTampered:case Ze.Untrusted:case Ze.CertificateRevoked:case Ze.SignatureIsNotValid:case Ze.SignatureArchiveHasTooManyEntries:case Ze.NotSigned:throw new Me(w(2044,null,o),"SignatureVerificationFailed")}throw new Me(w(2045,null,o),"SignatureVerificationInternal")}return{location:r,verificationStatus:o}}async Db(e,s,i,n){return{local:await this.gb.extractUserExtension(e,Ai(s.fsPath),ls(i.keepExisting)?!i.keepExisting:!0,n)}}async Eb(e){const s=async n=>{let r=await le.readdir(n);r=r.map(c=>J(n,c));const o=await Promise.all(r.map(c=>_9.promises.stat(c)));let a=Promise.resolve([]);return o.forEach((c,l)=>{const h=r[l];c.isFile()&&(a=a.then(u=>[...u,h])),c.isDirectory()&&(a=a.then(u=>s(h).then(f=>[...u,...f])))}),a};return(await s(e.location.fsPath)).map(n=>({path:`extension/${g1(e.location.fsPath,n)}`,localPath:n}))}async Fb({added:e,removed:s}){if(s){const i=e&&this.H.extUri.isEqual(s.profileLocation,e.profileLocation)?s.extensions.filter(n=>e.extensions.every(r=>!G(r,n))):s.extensions;for(const n of i)this.I.info("Extensions removed from another source",n.id,s.profileLocation.toString()),this.y.fire({identifier:n,profileLocation:s.profileLocation})}if(e){const n=(await this.getInstalled(1,e.profileLocation)).filter(r=>e.extensions.some(o=>G(o,r.identifier)));this.u.fire(n.map(r=>(this.I.info("Extensions added from another source",r.identifier.id,e.profileLocation.toString()),{identifier:r.identifier,local:r,profileLocation:e.profileLocation,operation:1})))}}async Hb(){this.D(this.gb.onExtract(s=>this.Gb.add(s)));const e=await this.pb.resolve(this.lb.userExtensionsLocation);for(const s of e.children??[])s.isDirectory&&this.Gb.add(s.resource);this.D(this.pb.watch(this.lb.userExtensionsLocation)),this.D(this.pb.onDidFilesChange(s=>this.Ib(s)))}async Ib(e){if(!e.affects(this.lb.userExtensionsLocation,1))return;const s=[];for(const i of e.rawAdded){if(this.Gb.has(i)||!this.H.extUri.isEqual(this.H.extUri.dirname(i),this.lb.userExtensionsLocation)||this.H.extUri.isEqual(i,this.H.extUri.joinPath(this.lb.userExtensionsLocation,".obsolete"))||this.H.extUri.basename(i).startsWith(".")||this.H.extUri.basename(i).endsWith(Vh))continue;try{if(!(await this.pb.stat(i)).isDirectory)continue}catch(r){Ue(r)!==1&&this.I.error(r);continue}const n=await this.gb.scanUserExtensionAtLocation(i);n&&n.installedTimestamp===void 0&&(this.Gb.add(i),s.push(n))}s.length&&(await this.Jb(s.map(i=>[i,void 0]),this.J.defaultProfile.extensionsResource),this.I.info("Added extensions to default profile from external source",s.map(i=>i.identifier.id)))}async Jb(e,s){const i=e.map(n=>n[0]);await this.gb.unsetExtensionsForRemoval(...i.map(n=>Gt.create(n))),await this.mb.addExtensionsToProfile(e,s),this.u.fire(i.map(n=>({local:n,identifier:n.identifier,operation:1,profileLocation:s})))}};Bh=__decorate([__param(0,xs),__param(1,ke),__param(2,Q),__param(3,Vt),__param(4,Ea),__param(5,hi),__param(6,Rg),__param(7,ns),__param(8,K),__param(9,me),__param(10,Pr),__param(11,ge),__param(12,Fi),__param(13,he),__param(14,Ne)],Bh);var Wh=class extends j{constructor(e,s,i,n,r,o,a){super(),this.n=e,this.q=s,this.s=i,this.t=n,this.u=r,this.w=o,this.y=a,this.h=this.D(new R),this.onExtract=this.h.event,this.j=new ht,this.m=new ht,this.c=V(this.s.userExtensionsLocation,".obsolete"),this.g=new pn}async cleanUp(){await this.L(),await this.J(),await this.I()}async scanExtensions(e,s,i,n){try{const r=s.with({query:n}),o={includeInvalid:!0,profileLocation:s,productVersion:i,language:n};let a=[];if(e===null||e===0){let c=this.j.get(r);c||(c=this.s.scanAllExtensions({language:n},o).finally(()=>this.j.delete(r)),this.j.set(r,c)),a.push(...await c)}else if(e===1){let c=this.m.get(r);c||(c=this.s.scanUserExtensions(o).finally(()=>this.m.delete(r)),this.m.set(r,c)),a.push(...await c)}return a=e!==null?a.filter(c=>c.type===e):a,await Promise.all(a.map(c=>this.H(c)))}catch(r){throw We(r,"Scanning")}}async scanAllUserExtensions(){try{const e=await this.s.scanAllUserExtensions();return await Promise.all(e.map(s=>this.H(s)))}catch(e){throw We(e,"Scanning")}}async scanUserExtensionAtLocation(e){try{const s=await this.s.scanExistingExtension(e,1,{includeInvalid:!0});if(s)return await this.H(s)}catch(s){this.y.error(s)}return null}async extractUserExtension(e,s,i,n){const r=e.toString(),o=k.file(J(this.s.userExtensionsLocation.fsPath,`.${tt()}`)),a=k.file(J(this.s.userExtensionsLocation.fsPath,r));if(await this.q.exists(a)){if(!i)try{return await this.scanLocalExtension(a,1)}catch(c){this.y.warn(`Error while scanning the existing extension at ${a.path}. Deleting the existing extension and extracting it.`,se(c))}try{await this.C(e.id,a,"removeExisting")}catch{throw new Me(w(2046,null,a.fsPath,e.id),"Delete")}}try{if(n.isCancellationRequested)throw new nt;try{this.y.trace(`Started extracting the extension from ${s} to ${a.fsPath}`),await G9(s,o.fsPath,{sourcePath:"extension",overwrite:!0},n),this.y.info(`Extracted extension to ${a}:`,e.id)}catch(l){throw Uh(l)}const c={installedTimestamp:Date.now(),targetPlatform:e.targetPlatform};try{c.size=await Pl(o,this.q)}catch(l){this.y.warn(`Error while getting the size of the extracted extension : ${o.fsPath}`,se(l))}try{await this.s.updateManifestMetadata(o,c)}catch(l){throw this.w.publicLog2("extension:extract",{extensionId:e.id,code:`${Ue(l)}`}),We(l,"UpdateMetadata")}if(n.isCancellationRequested)throw new nt;try{this.y.trace(`Started renaming the extension from ${o.fsPath} to ${a.fsPath}`),await this.G(o.fsPath,a.fsPath),this.y.info("Renamed to",a.fsPath)}catch(l){if(l.code==="ENOTEMPTY"){this.y.info("Rename failed because extension was installed by another source. So ignoring renaming.",e.id);try{await this.q.del(o,{recursive:!0})}catch{}}else throw this.y.info(`Rename failed because of ${se(l)}. Deleted from extracted location`,o),l}this.h.fire(a)}catch(c){try{await this.q.del(o,{recursive:!0})}catch{}throw c}return this.scanLocalExtension(a,1)}async scanMetadata(e,s){return(await this.z(e,s))?.metadata}async z(e,s){return(await this.t.scanProfileExtensions(s)).find(n=>G(n.identifier,e.identifier))}async updateMetadata(e,s,i){try{await this.t.updateMetadata([[e,s]],i)}catch(n){throw this.w.publicLog2("extension:extract",{extensionId:e.identifier.id,code:`${Ue(n)}`,isProfile:!!i}),We(n,"UpdateMetadata")}return this.scanLocalExtension(e.location,e.type,i)}async setExtensionsForRemoval(...e){const s=[];for(const n of e)await this.q.exists(n.location)&&s.push(n);const i=s.map(n=>Gt.create(n));await this.F(n=>i.forEach(r=>{n[r.toString()]=!0,this.y.info("Marked extension as removed",r.toString())}))}async unsetExtensionsForRemoval(...e){try{const s=[];return await this.F(i=>e.forEach(n=>{i[n.toString()]?(s.push(!0),delete i[n.toString()]):s.push(!1)})),s}catch(s){throw We(s,"UnsetRemoved")}}async deleteExtension(e,s){this.u.extUri.isEqualOrParent(e.location,this.s.userExtensionsLocation)&&(await this.C(e.identifier.id,e.location,s),await this.unsetExtensionsForRemoval(Gt.create(e)))}async copyExtension(e,s,i,n){const r=await this.z(e,s),o=await this.z(e,i);if(n={...r?.metadata,...n},o)if(this.u.extUri.isEqual(o.location,e.location))await this.t.updateMetadata([[e,{...o.metadata,...n}]],i);else{const a=await this.scanLocalExtension(o.location,e.type,i);await this.t.removeExtensionsFromProfile([a.identifier],i),await this.t.addExtensionsToProfile([[e,{...o.metadata,...n}]],i)}else await this.t.addExtensionsToProfile([[e,n]],i);return this.scanLocalExtension(e.location,e.type,i)}async moveExtension(e,s,i,n){const r=await this.z(e,s),o=await this.z(e,i);if(n={...r?.metadata,...n},o)if(this.u.extUri.isEqual(o.location,e.location))await this.t.updateMetadata([[e,{...o.metadata,...n}]],i);else{const a=await this.scanLocalExtension(o.location,e.type,i);await this.removeExtension(a.identifier,i),await this.t.addExtensionsToProfile([[e,{...o.metadata,...n}]],i)}else await this.t.addExtensionsToProfile([[e,n]],i),r&&await this.removeExtension(r.identifier,s);return this.scanLocalExtension(e.location,e.type,i)}async removeExtension(e,s){await this.t.removeExtensionsFromProfile([e],s)}async copyExtensions(e,s,i){const n=await this.scanExtensions(1,e,i),r=await Promise.all(n.filter(o=>!o.isApplicationScoped).map(async o=>[o,await this.scanMetadata(o,e)]));await this.t.addExtensionsToProfile(r,s)}async C(e,s,i){this.y.trace(`Deleting ${i} extension from disk`,e,s.fsPath);const n=this.u.extUri.joinPath(this.u.extUri.dirname(s),`${this.u.extUri.basename(s)}.${En(tt()).toString(16)}${Vh}`);await this.G(s.fsPath,n.fsPath),await this.q.del(n,{recursive:!0}),this.y.info(`Deleted ${i} extension from disk`,e,s.fsPath)}F(e){return this.g.queue(async()=>{let s;try{s=(await this.q.readFile(this.c,"utf8")).value.toString()}catch(n){if(Ue(n)!==1)throw n}let i={};if(s)try{i=JSON.parse(s)}catch{}if(e)if(e(i),Object.keys(i).length)await this.q.writeFile(this.c,L.fromString(JSON.stringify(i)));else try{await this.q.del(this.c)}catch(n){if(Ue(n)!==1)throw n}return i})}async G(e,s){try{await le.rename(e,s,2*60*1e3)}catch(i){throw We(i,"Rename")}}async scanLocalExtension(e,s,i){try{if(i){const r=(await this.s.scanUserExtensions({profileLocation:i})).find(o=>this.u.extUri.isEqual(o.location,e));if(r)return await this.H(r)}else{const n=await this.s.scanExistingExtension(e,s,{includeInvalid:!0});if(n)return await this.H(n)}throw new Me(w(2047,null,e.path),"ScanningExtension")}catch(n){throw We(n,"ScanningExtension")}}async H(e){let s;try{s=await this.q.resolve(e.location)}catch{}let i,n;return s?.children&&(i=s.children.find(({name:r})=>/^readme(\.txt|\.md|)$/i.test(r))?.resource,n=s.children.find(({name:r})=>/^changelog(\.txt|\.md|)$/i.test(r))?.resource),{identifier:e.identifier,type:e.type,isBuiltin:e.isBuiltin||!!e.metadata?.isBuiltin,location:e.location,manifest:e.manifest,targetPlatform:e.targetPlatform,validations:e.validations,isValid:e.isValid,readmeUrl:i,changelogUrl:n,publisherDisplayName:e.metadata?.publisherDisplayName,publisherId:e.metadata?.publisherId||null,isApplicationScoped:!!e.metadata?.isApplicationScoped,isMachineScoped:!!e.metadata?.isMachineScoped,isPreReleaseVersion:!!e.metadata?.isPreReleaseVersion,hasPreReleaseVersion:!!e.metadata?.hasPreReleaseVersion,preRelease:e.preRelease,installedTimestamp:e.metadata?.installedTimestamp,updated:!!e.metadata?.updated,pinned:!!e.metadata?.pinned,private:!!e.metadata?.private,isWorkspaceScoped:!1,source:e.metadata?.source??(e.identifier.uuid?"gallery":"vsix"),size:e.metadata?.size??0}}async I(){const e=await this.s.scanAllUserExtensions();await Promise.all(e.map(async s=>{if(kd(s.metadata?.installedTimestamp)&&ot(s.metadata?.size)){const i=await Pl(s.location,this.q);await this.s.updateManifestMetadata(s.location,{size:i})}}))}async J(){let e;try{e=await this.F()}catch(r){throw We(r,"ReadRemoved")}if(Object.keys(e).length===0){this.y.debug("No extensions are marked as removed.");return}this.y.debug("Deleting extensions marked as removed:",Object.keys(e));const s=await this.scanAllUserExtensions(),i=new Set;for(const r of s)e[Gt.create(r).toString()]||i.add(r.identifier.id.toLowerCase());try{const r=_g(s,o=>o.identifier);await Xe.settled(r.map(async o=>{const a=o.sort((c,l)=>Qg(c.manifest.version,l.manifest.version))[0];i.has(a.identifier.id.toLowerCase())||await this.n(a)}))}catch(r){this.y.error(r)}const n=s.filter(r=>r.installedTimestamp&&e[Gt.create(r).toString()]);await Promise.allSettled(n.map(r=>this.deleteExtension(r,"marked for removal")))}async L(){this.y.trace("ExtensionManagementService#removeTempDeleteFolders");let e;try{e=await this.q.resolve(this.s.userExtensionsLocation)}catch(s){Ue(s)!==1&&this.y.error(s);return}if(e?.children)try{await Promise.allSettled(e.children.map(async s=>{if(!(!s.isDirectory||!s.name.endsWith(Vh))){this.y.trace("Deleting the temporarily deleted folder",s.resource.toString());try{await this.q.del(s.resource,{recursive:!0}),this.y.trace("Deleted the temporarily deleted folder",s.resource.toString())}catch(i){Ue(i)!==1&&this.y.error(i)}}}))}catch{}}};Wh=__decorate([__param(1,K),__param(2,Ea),__param(3,hi),__param(4,he),__param(5,ke),__param(6,Q)],Wh);var Hh=class extends D0{get operation(){return this.options.operation??this.j}get verificationStatus(){return this.k}constructor(e,s,i,n,r,o,a,c,l,h,u,f){super(),this.l=e,this.manifest=s,this.source=i,this.options=n,this.m=r,this.n=o,this.o=a,this.p=c,this.q=l,this.s=h,this.t=u,this.u=f,this.j=2,this.identifier=this.l.identifier}async h(e){const i=(await this.n.scanExtensions(1,this.options.profileLocation,this.options.productVersion)).find(a=>G(a.identifier,this.identifier));i&&(this.j=3);const n={isApplicationScoped:this.options.isApplicationScoped||i?.isApplicationScoped,isMachineScoped:this.options.isMachineScoped||i?.isMachineScoped,isBuiltin:this.options.isBuiltin||i?.isBuiltin,isSystem:i?.type===0?!0:void 0,installedTimestamp:Date.now(),pinned:this.options.installGivenVersion?!0:this.options.pinned??i?.pinned,source:this.source instanceof k?"vsix":"gallery"};let r;if(this.source instanceof k){if(i&&this.l.equals(new Gt(i.identifier,i.manifest.version)))try{await this.n.deleteExtension(i,"existing")}catch{throw new Error(w(2048,null,this.manifest.displayName||this.manifest.name))}const a=await this.w(this.l);if(a)try{await this.n.deleteExtension(a,"existing")}catch{throw new Error(w(2049,null,this.manifest.displayName||this.manifest.name))}}else{if(n.id=this.source.identifier.uuid,n.publisherId=this.source.publisherId,n.publisherDisplayName=this.source.publisherDisplayName,n.targetPlatform=this.source.properties.targetPlatform,n.updated=!!i,n.private=this.source.private,n.isPreReleaseVersion=this.source.properties.isPreReleaseVersion,n.hasPreReleaseVersion=i?.hasPreReleaseVersion||this.source.properties.isPreReleaseVersion,n.preRelease=ls(this.options.preRelease)?this.options.preRelease:this.options.installPreReleaseVersion||this.source.properties.isPreReleaseVersion||i?.preRelease,i&&i.type!==0&&i.manifest.version===this.source.version)return this.n.updateMetadata(i,n,this.options.profileLocation);r=await this.w(this.l)}if(e.isCancellationRequested)throw We(new nt);if(!r){const a=await this.m(this.operation,e);r=a.local,this.k=a.verificationStatus}if(this.o.extUri.isEqual(this.q.defaultProfile.extensionsResource,this.options.profileLocation))try{await this.s.initializeDefaultProfileExtensions()}catch(a){throw We(a,"IntializeDefaultProfile")}if(e.isCancellationRequested)throw We(new nt);try{await this.t.addExtensionsToProfile([[r,n]],this.options.profileLocation,!r.isValid)}catch(a){throw We(a,"AddToProfile")}const o=await this.n.scanLocalExtension(r.location,1,this.options.profileLocation);if(!o)throw new Me("Cannot find the installed extension","InstalledExtensionNotFound");return this.source instanceof k&&this.x(r,e),o}async w(e){const[s]=await this.n.unsetExtensionsForRemoval(e);if(s)return this.u.info("Removed the extension from removed list:",e.id),(await this.n.scanAllUserExtensions()).find(n=>Gt.create(n).equals(e))}async x(e,s){try{let[i]=await this.p.getExtensions([{id:e.identifier.id,version:e.manifest.version}],s);if(i||([i]=await this.p.getExtensions([{id:e.identifier.id}],s)),i){const n={id:i.identifier.uuid,publisherDisplayName:i.publisherDisplayName,publisherId:i.publisherId,isPreReleaseVersion:i.properties.isPreReleaseVersion,hasPreReleaseVersion:e.hasPreReleaseVersion||i.properties.isPreReleaseVersion,preRelease:i.properties.isPreReleaseVersion||this.options.installPreReleaseVersion};await this.n.updateMetadata(e,n,this.options.profileLocation)}}catch{}}};Hh=__decorate([__param(6,he),__param(7,xs),__param(8,Ne),__param(9,Ea),__param(10,hi),__param(11,Q)],Hh);var s7=class extends D0{constructor(t,e,s){super(),this.extension=t,this.options=e,this.j=s}h(t){return this.j.removeExtensionsFromProfile([this.extension.identifier],this.options.profileLocation)}},U0;(function(t){t[t.FILE=1]="FILE",t[t.WORKSPACE=2]="WORKSPACE",t[t.EXE=3]="EXE"})(U0||(U0={}));var F0;(function(t){t.Ignored="ignored",t.Cancelled="cancelled",t.TooMany="toomany",t.IncompatibleWindow="incompatibleWindow",t.Accepted="reacted"})(F0||(F0={}));var q0=W("IExtensionRecommendationNotificationService");async function _0(t,e,s,i,n,r){let o;try{await i7(t,e,s,i,n,r)}catch(a){o=a}finally{o&&n.errorTransformer&&(o=n.errorTransformer(o)),typeof o<"u"&&s.error(o),s.end()}}async function i7(t,e,s,i,n,r){Gh(r);const o=await t.open(e,{create:!1});try{Gh(r);let a=0,c=0,l=n&&typeof n.length=="number"?n.length:void 0,h=L.alloc(Math.min(n.bufferSize,typeof l=="number"?l:n.bufferSize)),u=n&&typeof n.position=="number"?n.position:0,f=0;do c=await t.read(o,u,h.buffer,f,h.byteLength-f),u+=c,f+=c,a+=c,typeof l=="number"&&(l-=c),f===h.byteLength&&(await s.write(i(h)),h=L.alloc(Math.min(n.bufferSize,typeof l=="number"?l:n.bufferSize)),f=0);while(c>0&&(typeof l!="number"||l>0)&&Gh(r)&&n7(a,n));if(f>0){let p=f;typeof l=="number"&&(p=Math.min(f,l)),s.write(i(h.slice(0,p)))}}catch(a){throw _i(a)}finally{await t.close(o)}}function Gh(t){if(t.isCancellationRequested)throw uo();return!0}function n7(t,e){if(typeof e?.limits?.size=="number"&&t>e.limits.size)throw ks(w(2118,null),Y.FileTooLarge);return!0}var Jh,Kh=class extends j{static{Jh=this}constructor(e){super(),this.b=e,this.a=256*1024,this.c=this.D(new R),this.onDidChangeFileSystemProviderRegistrations=this.c.event,this.f=this.D(new R),this.onWillActivateFileSystemProvider=this.f.event,this.g=this.D(new R),this.onDidChangeFileSystemProviderCapabilities=this.g.event,this.h=new Map,this.q=this.D(new R),this.onDidRunOperation=this.q.event,this.Y=this.D(new R),this.Z=this.D(new R),this.onDidFilesChange=this.Z.event,this.$=this.D(new R),this.onDidWatchError=this.$.event,this.ab=new Map,this.db=this.D(new N1)}registerProvider(e,s){if(this.h.has(e))throw new Error(`A filesystem provider for the scheme '${e}' is already registered.`);Vi(`code/registerFilesystem/${e}`);const i=new Pe;return this.h.set(e,s),this.c.fire({added:!0,scheme:e,provider:s}),i.add(s.onDidChangeFile(n=>{const r=new J2(n,!this.U(s));this.Y.fire(r),r.hasCorrelation()||this.Z.fire(r)})),typeof s.onDidWatchError=="function"&&i.add(s.onDidWatchError(n=>this.$.fire(new Error(n)))),i.add(s.onDidChangeCapabilities(()=>this.g.fire({provider:s,scheme:e}))),pe(()=>{this.c.fire({added:!1,scheme:e,provider:s}),this.h.delete(e),Zt(i)})}getProvider(e){return this.h.get(e)}async activateProvider(e){const s=[];this.f.fire({scheme:e,join(i){s.push(i)}}),!this.h.has(e)&&await Xe.settled(s)}async canHandleResource(e){return await this.activateProvider(e.scheme),this.hasProvider(e)}hasProvider(e){return this.h.has(e.scheme)}hasCapability(e,s){const i=this.h.get(e.scheme);return!!(i&&i.capabilities&s)}listCapabilities(){return on.map(this.h,([e,s])=>({scheme:e,capabilities:s.capabilities}))}async j(e){if(!k4(e))throw new Ye(w(2091,null,this.tb(e)),8);await this.activateProvider(e.scheme);const s=this.h.get(e.scheme);if(!s){const i=new ki;throw i.message=w(2092,null,e.toString()),i}return s}async m(e){const s=await this.j(e);if(ai(s)||os(s)||jl(s))return s;throw new Error(`Filesystem provider for scheme '${e.scheme}' neither has FileReadWrite, FileReadStream nor FileOpenReadWriteClose capability which is needed for the read operation.`)}async n(e){const s=await this.j(e);if(ai(s)||os(s))return s;throw new Error(`Filesystem provider for scheme '${e.scheme}' neither has FileReadWrite nor FileOpenReadWriteClose capability which is needed for the write operation.`)}async resolve(e,s){try{return await this.r(e,s)}catch(i){throw Qo(i)===Y.FileNotFound?new Ye(w(2093,null,this.tb(e)),1):_i(i)}}async r(e,s){const i=await this.j(e),n=this.U(i),r=s?.resolveTo,o=s?.resolveSingleChildDescendants,a=s?.resolveMetadata,c=await i.stat(e);let l;return this.s(i,e,c,void 0,!!a,(h,u)=>(l||(l=kn.forUris(()=>!n),l.set(e,!0),r&&l.fill(!0,r)),l.get(h.resource)||l.findSuperstr(h.resource.with({query:null,fragment:null}))?!0:h.isDirectory&&o?u===1:!1))}async s(e,s,i,n,r,o){const{providerExtUri:a}=this.S(e),c={resource:s,name:a.basename(s),isFile:(i.type&Wt.File)!==0,isDirectory:(i.type&Wt.Directory)!==0,isSymbolicLink:(i.type&Wt.SymbolicLink)!==0,mtime:i.mtime,ctime:i.ctime,size:i.size,readonly:!!((i.permissions??0)&Rn.Readonly)||!!(e.capabilities&2048),locked:!!((i.permissions??0)&Rn.Locked),etag:ig({mtime:i.mtime,size:i.size}),children:void 0};if(c.isDirectory&&o(c,n)){try{const l=await e.readdir(s),h=await Xe.settled(l.map(async([u,f])=>{try{const p=a.joinPath(s,u),g=r?await e.stat(p):{type:f};return await this.s(e,p,g,l.length,r,o)}catch(p){return this.b.trace(p),null}}));c.children=rn(h)}catch(l){this.b.trace(l),c.children=[]}return c}return c}async resolveAll(e){return Xe.settled(e.map(async s=>{try{return{stat:await this.r(s.resource,s.options),success:!0}}catch(i){return this.b.trace(i),{stat:void 0,success:!1}}}))}async stat(e){const s=await this.j(e),i=await s.stat(e);return this.s(s,e,i,void 0,!0,()=>!1)}async realpath(e){const s=await this.j(e);if(W2(s)){const i=await s.realpath(e);return e.with({path:i})}}async exists(e){const s=await this.j(e);try{return!!await s.stat(e)}catch{return!1}}async canCreateFile(e,s){try{await this.t(e,s)}catch(i){return i}return!0}async t(e,s){if(!s?.overwrite&&await this.exists(e))throw new Ye(w(2094,null,this.tb(e)),3,s)}async createFile(e,s=L.fromString(""),i){await this.t(e,i);const n=await this.writeFile(e,s);return this.q.fire(new Dn(e,0,n)),n}async writeFile(e,s,i){const n=this.rb(await this.n(e),e),{providerExtUri:r}=this.S(n);let o=i;if(Zp(n)&&!o?.atomic){const a=n.enforceAtomicWriteFile?.(e);a&&(o={...i,atomic:a})}try{let{stat:a,buffer:c}=await this.w(n,e,s,o);a||await this.W(n,r.dirname(e)),c||(c=await this.u(n,s)),!ai(n)||os(n)&&c instanceof L||os(n)&&Zp(n)&&o?.atomic?await this.ib(n,e,o,c):await this.eb(n,e,o,c instanceof L?Q4(c):c),this.q.fire(new Dn(e,4))}catch(a){throw new Ye(w(2095,null,this.tb(e),_i(a).toString()),Ue(a),o)}return this.resolve(e,{resolveMetadata:!0})}async u(e,s){let i;if(os(e)&&!(s instanceof L))if(Ao(s)){const n=await q4(s,3);n.ended?i=L.concat(n.buffer):i=n}else i=F4(s,n=>L.concat(n),3);else i=s;return i}async w(e,s,i,n){const r=!!n?.unlock;if(r&&!(e.capabilities&8192))throw new Error(w(2096,null,this.tb(s)));if(!!n?.atomic){if(!(e.capabilities&32768))throw new Error(w(2097,null,this.tb(s)));if(!(e.capabilities&2))throw new Error(w(2098,null,this.tb(s)));if(r)throw new Error(w(2099,null,this.tb(s)))}let a;try{a=await e.stat(s)}catch{return Object.create(null)}if((a.type&Wt.Directory)!==0)throw new Ye(w(2100,null,this.tb(s)),0,n);this.sb(s,a);let c;if(typeof n?.mtime=="number"&&typeof n.etag=="string"&&n.etag!==_l&&typeof a.mtime=="number"&&typeof a.size=="number"&&n.mtime<a.mtime&&n.etag!==ig({mtime:n.mtime,size:a.size})){if(c=await this.u(e,i),c instanceof L&&c.byteLength===a.size)try{const{value:l}=await this.readFile(s,{limits:{size:a.size}});if(c.equals(l))return{stat:a,buffer:c}}catch{}throw new Ye(w(2101,null),3,n)}return{stat:a,buffer:c}}async readFile(e,s,i){const n=await this.m(e);return s?.atomic?this.z(n,e,s,i):this.C(n,e,s,i)}async z(e,s,i,n){return new Promise((r,o)=>{this.db.queueFor(s,async()=>{try{const a=await this.C(e,s,i,n);r(a)}catch(a){o(a)}},this.S(e).providerExtUri)})}async C(e,s,i,n){const r=await this.F(e,s,{...i,preferUnbuffered:!0},n);return{...r,value:await Ni(r.value)}}async readFileStream(e,s,i){const n=await this.m(e);return this.F(n,e,s,i)}async F(e,s,i,n){const r=new fs(n);let o=i;Ml(e)&&e.enforceAtomicReadFile?.(s)&&(o={...i,atomic:!0});const a=this.L(s,o).then(l=>l,l=>{throw r.dispose(!0),l});let c;try{return typeof o?.etag=="string"&&o.etag!==_l&&await a,o?.atomic&&Ml(e)||!(ai(e)||jl(e))||os(e)&&o?.preferUnbuffered?c=this.J(e,s,o):jl(e)?c=this.H(e,s,r.token,o):c=this.I(e,s,r.token,o),c.on("end",()=>r.dispose()),c.on("error",()=>r.dispose()),{...await a,value:c}}catch(l){throw c&&await F1(c),this.G(l,s,o)}}G(e,s,i){const n=w(2102,null,this.tb(s),_i(e).toString());return e instanceof ql?new ql(n,e.stat,i):e instanceof Fl?new Fl(n,e.fileOperationResult,e.size,e.options):new Ye(n,Ue(e),i)}H(e,s,i,n=Object.create(null)){const r=e.readFileStream(s,n,i);return q1(r,{data:o=>o instanceof L?o:L.wrap(o),error:o=>this.G(o,s,n)},o=>L.concat(o))}I(e,s,i,n=Object.create(null)){const r=Y4();return _0(e,s,r,o=>o,{...n,bufferSize:this.a,errorTransformer:o=>this.G(o,s,n)},i),r}J(e,s,i){const n=or(r=>L.concat(r));return(async()=>{try{let r;i?.atomic&&Ml(e)?r=await e.readFile(s,{atomic:!0}):r=await e.readFile(s),typeof i?.position=="number"&&(r=r.slice(i.position)),typeof i?.length=="number"&&(r=r.slice(0,i.length)),this.M(s,r.byteLength,i),n.end(L.wrap(r))}catch(r){n.error(r),n.end()}})(),n}async L(e,s){const i=await this.resolve(e,{resolveMetadata:!0});if(i.isDirectory)throw new Ye(w(2103,null,this.tb(e)),0,s);if(typeof s?.etag=="string"&&s.etag!==_l&&s.etag===i.etag)throw new ql(w(2104,null),i,s);return this.M(e,i.size,s),i}M(e,s,i){if(typeof i?.limits?.size=="number"&&s>i.limits.size)throw new Fl(w(2105,null,this.tb(e)),7,s,i)}async canMove(e,s,i){return this.N(e,s,"move",i)}async canCopy(e,s,i){return this.N(e,s,"copy",i)}async N(e,s,i,n){if(e.toString()!==s.toString())try{const r=i==="move"?this.rb(await this.n(e),e):await this.m(e),o=this.rb(await this.n(s),s);await this.R(r,e,o,s,i,n)}catch(r){return r}return!0}async move(e,s,i){const n=this.rb(await this.n(e),e),r=this.rb(await this.n(s),s),o=await this.O(n,e,r,s,"move",!!i),a=await this.resolve(s,{resolveMetadata:!0});return this.q.fire(new Dn(e,o==="move"?2:3,a)),a}async copy(e,s,i){const n=await this.m(e),r=this.rb(await this.n(s),s),o=await this.O(n,e,r,s,"copy",!!i),a=await this.resolve(s,{resolveMetadata:!0});return this.q.fire(new Dn(e,o==="copy"?3:2,a)),a}async O(e,s,i,n,r,o){if(s.toString()===n.toString())return r;const{exists:a,isSameResourceWithDifferentPathCase:c}=await this.R(e,s,i,n,r,o);if(a&&!c&&o&&await this.del(n,{recursive:!0}),await this.W(i,this.S(i).providerExtUri.dirname(n)),r==="copy"){if(e===i&&Tl(e))await e.copy(s,n,{overwrite:o});else{const l=await this.resolve(s);l.isDirectory?await this.Q(e,l,i,n):await this.P(e,s,i,n)}return r}else return e===i?(await e.rename(s,n,{overwrite:o}),r):(await this.O(e,s,i,n,"copy",o),await this.del(s,{recursive:!0}),"copy")}async P(e,s,i,n){if(ai(e)&&ai(i))return this.kb(e,s,i,n);if(ai(e)&&os(i))return this.qb(e,s,i,n);if(os(e)&&ai(i))return this.ob(e,s,i,n);if(os(e)&&os(i))return this.mb(e,s,i,n)}async Q(e,s,i,n){await i.mkdir(n),Array.isArray(s.children)&&await Xe.settled(s.children.map(async r=>{const o=this.S(i).providerExtUri.joinPath(n,r.name);return r.isDirectory?this.Q(e,await this.resolve(r.resource),i,o):this.P(e,r.resource,i,o)}))}async R(e,s,i,n,r,o){let a=!1;if(e===i){const{providerExtUri:l,isPathCaseSensitive:h}=this.S(e);if(h||(a=l.isEqual(s,n)),a&&r==="copy")throw new Error(w(2106,null,this.tb(s),this.tb(n)));if(!a&&l.isEqualOrParent(n,s))throw new Error(w(2107,null,this.tb(s),this.tb(n)))}const c=await this.exists(n);if(c&&!a){if(!o)throw new Ye(w(2108,null,this.tb(s),this.tb(n)),4);if(e===i){const{providerExtUri:l}=this.S(e);if(l.isEqualOrParent(s,n))throw new Error(w(2109,null,this.tb(s),this.tb(n)))}}return{exists:c,isSameResourceWithDifferentPathCase:a}}S(e){const s=this.U(e);return{providerExtUri:s?we:E4,isPathCaseSensitive:s}}U(e){return!!(e.capabilities&1024)}async createFolder(e){const s=this.rb(await this.j(e),e);await this.W(s,e);const i=await this.resolve(e,{resolveMetadata:!0});return this.q.fire(new Dn(e,0,i)),i}async W(e,s){const i=[],{providerExtUri:n}=this.S(e);for(;!n.isEqual(s,n.dirname(s));)try{if(((await e.stat(s)).type&Wt.Directory)===0)throw new Error(w(2110,null,this.tb(s)));break}catch(r){if(Qo(r)!==Y.FileNotFound)throw r;i.push(n.basename(s)),s=n.dirname(s)}for(let r=i.length-1;r>=0;r--){s=n.joinPath(s,i[r]);try{await e.mkdir(s)}catch(o){if(Qo(o)!==Y.FileExists)throw o}}}async canDelete(e,s){try{await this.X(e,s)}catch(i){return i}return!0}async X(e,s){const i=this.rb(await this.j(e),e),n=!!s?.useTrash;if(n&&!(i.capabilities&4096))throw new Error(w(2111,null,this.tb(e)));const r=s?.atomic;if(r&&!(i.capabilities&65536))throw new Error(w(2112,null,this.tb(e)));if(n&&r)throw new Error(w(2113,null,this.tb(e)));let o;try{o=await i.stat(e)}catch{}if(o)this.sb(e,o);else throw new Ye(w(2114,null,this.tb(e)),1);if(!!!s?.recursive){const c=await this.resolve(e);if(c.isDirectory&&Array.isArray(c.children)&&c.children.length>0)throw new Error(w(2115,null,this.tb(e)))}return i}async del(e,s){const i=await this.X(e,s);let n=s;if(H2(i)&&!n?.atomic){const c=i.enforceAtomicDelete?.(e);c&&(n={...s,atomic:c})}const r=!!n?.useTrash,o=!!n?.recursive,a=n?.atomic??!1;await i.delete(e,{recursive:o,useTrash:r,atomic:a}),this.q.fire(new Dn(e,1))}async cloneFile(e,s){const i=await this.j(e),n=this.rb(await this.n(s),s);if(!(i===n&&this.S(i).providerExtUri.isEqual(e,s)))return i===n&&Xp(i)?i.cloneFile(e,s):(await this.W(n,this.S(n).providerExtUri.dirname(s)),i===n&&Tl(i)?this.db.queueFor(e,()=>i.copy(e,s,{overwrite:!0}),this.S(i).providerExtUri):this.db.queueFor(e,()=>this.P(i,e,n,s),this.S(i).providerExtUri))}static{this.bb=0}createWatcher(e,s){return this.watch(e,{...s,correlationId:Jh.bb++})}watch(e,s={recursive:!1,excludes:[]}){const i=new Pe;let n=!1,r=()=>{n=!0};i.add(pe(()=>r())),(async()=>{try{const a=await this.cb(e,s);n?Zt(a):r=()=>Zt(a)}catch(a){this.b.error(a)}})();const o=s.correlationId;if(typeof o=="number"){const a=i.add(new R);return i.add(this.Y.event(l=>{l.correlates(o)&&a.fire(l)})),{onDidChange:a.event,dispose:()=>i.dispose()}}return i}async cb(e,s){const i=await this.j(e),n=En([this.S(i).providerExtUri.getComparisonKey(e),s]);let r=this.ab.get(n);return r||(r={count:0,disposable:i.watch(e,s)},this.ab.set(n,r)),r.count+=1,pe(()=>{r&&(r.count--,r.count===0&&(Zt(r.disposable),this.ab.delete(n)))})}dispose(){super.dispose();for(const[,e]of this.ab)Zt(e.disposable);this.ab.clear()}async eb(e,s,i,n){return this.db.queueFor(s,async()=>{const r=await e.open(s,{create:!0,unlock:i?.unlock??!1});try{Ao(n)||tl(n)?await this.fb(e,r,n):await this.gb(e,r,n)}catch(o){throw _i(o)}finally{await e.close(r)}},this.S(e).providerExtUri)}async fb(e,s,i){let n=0,r;if(tl(i)){if(i.buffer.length>0){const o=L.concat(i.buffer);await this.hb(e,s,o,o.byteLength,n,0),n+=o.byteLength}if(i.ended)return;r=i.stream}else r=i;return new Promise((o,a)=>{Lo(r,{onData:async c=>{r.pause();try{await this.hb(e,s,c,c.byteLength,n,0)}catch(l){return a(l)}n+=c.byteLength,setTimeout(()=>r.resume())},onError:c=>a(c),onEnd:()=>o()})})}async gb(e,s,i){let n=0,r;for(;(r=i.read())!==null;)await this.hb(e,s,r,r.byteLength,n,0),n+=r.byteLength}async hb(e,s,i,n,r,o){let a=0;for(;a<n;){const c=await e.write(s,r+a,i.buffer,o+a,n-a);a+=c}}async ib(e,s,i,n){return this.db.queueFor(s,()=>this.jb(e,s,i,n),this.S(e).providerExtUri)}async jb(e,s,i,n){let r;n instanceof L?r=n:Ao(n)?r=await Ni(n):tl(n)?r=await X4(n):r=K4(n),await e.writeFile(s,r.buffer,{create:!0,overwrite:!0,unlock:i?.unlock??!1,atomic:i?.atomic??!1})}async kb(e,s,i,n){return this.db.queueFor(n,()=>this.lb(e,s,i,n),this.S(i).providerExtUri)}async lb(e,s,i,n){let r,o;try{r=await e.open(s,{create:!1}),o=await i.open(n,{create:!0,unlock:!1});const a=L.alloc(this.a);let c=0,l=0,h=0;do h=await e.read(r,c,a.buffer,l,a.byteLength-l),await this.hb(i,o,a,h,c,l),c+=h,l+=h,l===a.byteLength&&(l=0);while(h>0)}catch(a){throw _i(a)}finally{await Xe.settled([typeof r=="number"?e.close(r):Promise.resolve(),typeof o=="number"?i.close(o):Promise.resolve()])}}async mb(e,s,i,n){return this.db.queueFor(n,()=>this.nb(e,s,i,n),this.S(i).providerExtUri)}async nb(e,s,i,n){return i.writeFile(n,await e.readFile(s),{create:!0,overwrite:!0,unlock:!1,atomic:!1})}async ob(e,s,i,n){return this.db.queueFor(n,()=>this.pb(e,s,i,n),this.S(i).providerExtUri)}async pb(e,s,i,n){const r=await i.open(n,{create:!0,unlock:!1});try{const o=await e.readFile(s);await this.hb(i,r,L.wrap(o),o.byteLength,0,0)}catch(o){throw _i(o)}finally{await i.close(r)}}async qb(e,s,i,n){const r=await Ni(this.I(e,s,Z.None));await this.ib(i,n,void 0,r)}rb(e,s){if(e.capabilities&2048)throw new Ye(w(2116,null,this.tb(s)),6);return e}sb(e,s){if((s.permissions??0)&Rn.Readonly)throw new Ye(w(2117,null,this.tb(e)),6)}tb(e){return e.scheme===ne.file?e.fsPath:e.toString(!0)}};Kh=Jh=__decorate([__param(0,Q)],Kh);import{promises as Gi}from"fs";var Tr="**",z0="/",Ca="[/\\\\]",Ra="[^/\\\\]",r7=/\//g;function V0(t,e){switch(t){case 0:return"";case 1:return`${Ra}*?`;default:return`(?:${Ca}|${Ra}+${Ca}${e?`|${Ca}${Ra}+`:""})*?`}}function B0(t,e){if(!t)return[];const s=[];let i=!1,n=!1,r="";for(const o of t){switch(o){case e:if(!i&&!n){s.push(r),r="";continue}break;case"{":i=!0;break;case"}":i=!1;break;case"[":n=!0;break;case"]":n=!1;break}r+=o}return r&&s.push(r),s}function W0(t){if(!t)return"";let e="";const s=B0(t,z0);if(s.every(i=>i===Tr))e=".*";else{let i=!1;s.forEach((n,r)=>{if(n===Tr){if(i)return;e+=V0(2,r===s.length-1)}else{let o=!1,a="",c=!1,l="";for(const h of n){if(h!=="}"&&o){a+=h;continue}if(c&&(h!=="]"||!l)){let u;h==="-"?u=h:(h==="^"||h==="!")&&!l?u="^":h===z0?u="":u=Di(h),l+=u;continue}switch(h){case"{":o=!0;continue;case"[":c=!0;continue;case"}":{const f=`(?:${B0(a,",").map(p=>W0(p)).join("|")})`;e+=f,o=!1,a="";break}case"]":{e+="["+l+"]",c=!1,l="";break}case"?":e+=Ra;continue;case"*":e+=V0(1);continue;default:e+=Di(h)}}r<s.length-1&&(s[r+1]!==Tr||r+2<s.length)&&(e+=Ca)}i=n===Tr})}return e}var o7=/^\*\*\/\*\.[\w\.-]+$/,a7=/^\*\*\/([\w\.-]+)\/?$/,c7=/^{\*\*\/\*?[\w\.-]+\/?(,\*\*\/\*?[\w\.-]+\/?)*}$/,l7=/^{\*\*\/\*?[\w\.-]+(\/(\*\*)?)?(,\*\*\/\*?[\w\.-]+(\/(\*\*)?)?)*}$/,h7=/^\*\*((\/[\w\.-]+)+)\/?$/,u7=/^([\w\.-]+(\/[\w\.-]+)*)\/?$/,H0=new Qn(1e4),G0=function(){return!1},Is=function(){return null};function Qh(t,e){if(!t)return Is;let s;typeof t!="string"?s=t.pattern:s=t,s=s.trim();const i=e.ignoreCase??!1,n={...e,equals:i?ti:(c,l)=>c===l,endsWith:i?qy:(c,l)=>c.endsWith(l),isEqualOrParent:(c,l)=>ir(c,l,!ut||i)},r=`${i?s.toLowerCase():s}_${!!e.trimForExclusions}_${i}`;let o=H0.get(r);if(o)return J0(o,t,n);let a;return o7.test(s)?o=f7(s.substring(4),s,n):(a=a7.exec(Xh(s,n)))?o=d7(a[1],s,n):(e.trimForExclusions?l7:c7).test(s)?o=p7(s,n):(a=h7.exec(Xh(s,n)))?o=K0(a[1].substring(1),s,!0,n):(a=u7.exec(Xh(s,n)))?o=K0(a[1],s,!1,n):o=g7(s,n),H0.set(r,o),J0(o,t,n)}function J0(t,e,s){if(typeof e=="string")return t;const i=function(n,r){return s.isEqualOrParent(n,e.base)?t(n1(n.substring(e.base.length),Pt),r):null};return i.allBasenames=t.allBasenames,i.allPaths=t.allPaths,i.basenames=t.basenames,i.patterns=t.patterns,i}function Xh(t,e){return e.trimForExclusions&&t.endsWith("/**")?t.substring(0,t.length-2):t}function f7(t,e,s){return function(i,n){return typeof i=="string"&&s.endsWith(i,t)?e:null}}function d7(t,e,s){const i=`/${t}`,n=`\\${t}`,r=function(a,c){return typeof a!="string"?null:c?s.equals(c,t)?e:null:s.equals(a,t)||s.endsWith(a,i)||s.endsWith(a,n)?e:null},o=[t];return r.basenames=o,r.patterns=[e],r.allBasenames=o,r}function p7(t,e){const s=Q0(t.slice(1,-1).split(",").map(a=>Qh(a,e)).filter(a=>a!==Is),t),i=s.length;if(!i)return Is;if(i===1)return s[0];const n=function(a,c){for(let l=0,h=s.length;l<h;l++)if(s[l](a,c))return t;return null},r=s.find(a=>!!a.allBasenames);r&&(n.allBasenames=r.allBasenames);const o=s.reduce((a,c)=>c.allPaths?a.concat(c.allPaths):a,[]);return o.length&&(n.allPaths=o),n}function K0(t,e,s,i){const n=Pt===be.sep,r=n?t:t.replace(r7,Pt),o=Pt+r,a=be.sep+t;let c;return s?c=function(l,h){return typeof l=="string"&&(i.equals(l,r)||i.endsWith(l,o)||!n&&(i.equals(l,t)||i.endsWith(l,a)))?e:null}:c=function(l,h){return typeof l=="string"&&(i.equals(l,r)||!n&&i.equals(l,t))?e:null},c.allPaths=[(s?"*/":"./")+t],c}function g7(t,e){try{const s=new RegExp(`^${W0(t)}$`,e.ignoreCase?"i":void 0);return function(i){return s.lastIndex=0,typeof i=="string"&&s.test(i)?t:null}}catch{return Is}}function m7(t,e={}){if(!t)return G0;if(typeof t=="string"||v7(t)){const s=Qh(t,e);if(s===Is)return G0;const i=function(n,r){return!!s(n,r)};return s.allBasenames&&(i.allBasenames=s.allBasenames),s.allPaths&&(i.allPaths=s.allPaths),i}return w7(t,e)}function v7(t){const e=t;return e?typeof e.base=="string"&&typeof e.pattern=="string":!1}function w7(t,e){const s=Q0(Object.getOwnPropertyNames(t).map(a=>y7(a,t[a],e)).filter(a=>a!==Is)),i=s.length;if(!i)return Is;if(!s.some(a=>!!a.requiresSiblings)){if(i===1)return s[0];const a=function(h,u){let f;for(let p=0,g=s.length;p<g;p++){const m=s[p](h,u);if(typeof m=="string")return m;Yc(m)&&(f||(f=[]),f.push(m))}return f?(async()=>{for(const p of f){const g=await p;if(typeof g=="string")return g}return null})():null},c=s.find(h=>!!h.allBasenames);c&&(a.allBasenames=c.allBasenames);const l=s.reduce((h,u)=>u.allPaths?h.concat(u.allPaths):h,[]);return l.length&&(a.allPaths=l),a}const n=function(a,c,l){let h,u;for(let f=0,p=s.length;f<p;f++){const g=s[f];g.requiresSiblings&&l&&(c||(c=qt(a)),h||(h=c.substring(0,c.length-t4(a).length)));const m=g(a,c,h,l);if(typeof m=="string")return m;Yc(m)&&(u||(u=[]),u.push(m))}return u?(async()=>{for(const f of u){const p=await f;if(typeof p=="string")return p}return null})():null},r=s.find(a=>!!a.allBasenames);r&&(n.allBasenames=r.allBasenames);const o=s.reduce((a,c)=>c.allPaths?a.concat(c.allPaths):a,[]);return o.length&&(n.allPaths=o),n}function y7(t,e,s){if(e===!1)return Is;const i=Qh(t,s);if(i===Is)return Is;if(typeof e=="boolean")return i;if(e){const n=e.when;if(typeof n=="string"){const r=(o,a,c,l)=>{if(!l||!i(o,a))return null;const h=n.replace("$(basename)",()=>c),u=l(h);return Yc(u)?u.then(f=>f?t:null):u?t:null};return r.requiresSiblings=!0,r}}return i}function Q0(t,e){const s=t.filter(a=>!!a.basenames);if(s.length<2)return t;const i=s.reduce((a,c)=>{const l=c.basenames;return l?a.concat(l):a},[]);let n;if(e){n=[];for(let a=0,c=i.length;a<c;a++)n.push(e)}else n=s.reduce((a,c)=>{const l=c.patterns;return l?a.concat(l):a},[]);const r=function(a,c){if(typeof a!="string")return null;if(!c){let h;for(h=a.length;h>0;h--){const u=a.charCodeAt(h-1);if(u===47||u===92)break}c=a.substring(h)}const l=i.indexOf(c);return l!==-1?n[l]:null};r.basenames=i,r.patterns=n,r.allBasenames=i;const o=t.filter(a=>!a.basenames);return o.push(r),o}function X0(t,e){return jt(t,e,(s,i)=>typeof s=="string"&&typeof i=="string"?s===i:typeof s!="string"&&typeof i!="string"?s.base===i.base&&s.pattern===i.pattern:!1)}function Z0(t){return typeof t.correlationId=="number"}function b7(t){return t.recursive===!0}var Y0=class xw extends j{static{this.a=5}constructor(e,s,i,n){super(),this.h=e,this.j=s,this.m=i,this.n=n,this.c=this.D(new us),this.f=void 0,this.g=0}r(){const e=new Pe;this.c.value=e,this.b=this.q(e),this.b.setVerboseLogging(this.m),e.add(this.b.onDidChangeFile(s=>this.h(s))),e.add(this.b.onDidLogMessage(s=>this.j(s))),e.add(this.b.onDidError(s=>this.s(s.error,s.request)))}s(e,s){this.t(e,s)?this.g<xw.a&&this.f?(this.w(`restarting watcher after unexpected error: ${e}`),this.u(this.f)):this.w(`gave up attempting to restart watcher after unexpected error: ${e}`):this.w(e)}t(e,s){return!(!this.n.restartOnError||s||e.indexOf("No space left on device")!==-1||e.indexOf("EMFILE")!==-1)}u(e){this.g++,this.r(),this.watch(e)}async watch(e){this.f=e,await this.b?.watch(e)}async setVerboseLogging(e){this.m=e,await this.b?.setVerboseLogging(e)}w(e){this.j({type:"error",message:`[File Watcher (${this.n.type})] ${e}`})}y(e){this.j({type:"trace",message:`[File Watcher (${this.n.type})] ${e}`})}dispose(){return this.b=void 0,super.dispose()}},S7=class extends Y0{constructor(t,e,s){super(t,e,s,{type:"node.js",restartOnError:!1})}},E7=class extends Y0{constructor(t,e,s){super(t,e,s,{type:"universal",restartOnError:!0})}};function Zh(t){return t.map(e=>({type:e.type,resource:k.revive(e.resource),cId:e.cId}))}function $7(t){const e=new k7;for(const s of t)e.processEvent(s);return e.coalesce()}function x7(t,e){return typeof e=="string"&&!e.startsWith(Tr)&&!p1(e)?{base:t,pattern:e}:e}function em(t,e,s){const i=[];for(const n of e)i.push(m7(x7(t,n),{ignoreCase:s}));return i}var k7=class{constructor(){this.a=new Set,this.b=new Map}c(t){return ut?t.resource.fsPath:t.resource.fsPath.toLowerCase()}processEvent(t){const e=this.b.get(this.c(t));let s=!1;if(e){const i=e.type,n=t.type;e.resource.fsPath!==t.resource.fsPath&&(t.type===2||t.type===1)?s=!0:i===1&&n===2?(this.b.delete(this.c(t)),this.a.delete(e)):i===2&&n===1?e.type=0:i===1&&n===0||(e.type=n)}else s=!0;s&&(this.a.add(t),this.b.set(this.c(t),t))}coalesce(){const t=[],e=[];return Array.from(this.a).filter(s=>s.type!==2?(t.push(s),!1):!0).sort((s,i)=>s.resource.fsPath.length-i.resource.fsPath.length).filter(s=>e.some(i=>K2(s.resource.fsPath,i,!ut))?!1:(e.push(s.resource.fsPath),!0)).concat(t)}};function C7(t,e){if(typeof e=="number")switch(t.type){case 1:return(e&4)===0;case 2:return(e&8)===0;case 0:return(e&2)===0}return!1}function R7(t){if(typeof t=="number"){const e=[];return t&4&&e.push("Added"),t&8&&e.push("Deleted"),t&2&&e.push("Updated"),e.length===0?"<all>":`[${e.join(", ")}]`}return"<none>"}var D7=class extends j{constructor(t,e){super(),this.a=t,this.b=e,this.c=this.D(new R),this.onDidChangeFile=this.c.event,this.g=this.D(new R),this.onDidWatchError=this.g.event,this.m=[],this.n=this.D(new Li(this.h(this.m.length))),this.y=[],this.z=this.D(new Li(this.h(this.y.length)))}watch(t,e){return e.recursive||this.b?.watcher?.forceUniversal?this.q(t,e):this.C(t,e)}h(t){return t>200?500:0}q(t,e){const s=this.r(t,e),i=$d(this.m,s);return this.s(),pe(()=>{i(),this.s()})}r(t,e){const s={path:this.M(t),excludes:e.excludes,includes:e.includes,recursive:e.recursive,filter:e.filter,correlationId:e.correlationId};if(b7(s)){const i=this.b?.watcher?.recursive?.usePolling;i===!0?s.pollingInterval=this.b?.watcher?.recursive?.pollingInterval??5e3:Array.isArray(i)&&i.includes(s.path)&&(s.pollingInterval=this.b?.watcher?.recursive?.pollingInterval??5e3)}return s}s(){this.n.trigger(()=>this.t(),this.h(this.m.length)).catch(t=>it(t))}t(){return this.j||(this.j=this.D(this.u(t=>this.c.fire(Zh(t)),t=>this.I(t),this.a.getLevel()===ie.Trace)),this.D(this.a.onDidChangeLogLevel(()=>{this.j?.setVerboseLogging(this.a.getLevel()===ie.Trace)}))),this.j.watch(this.m)}C(t,e){const s={path:this.M(t),excludes:e.excludes,includes:e.includes,recursive:!1,filter:e.filter,correlationId:e.correlationId},i=$d(this.y,s);return this.F(),pe(()=>{i(),this.F()})}F(){this.z.trigger(()=>this.G(),this.h(this.y.length)).catch(t=>it(t))}G(){return this.w||(this.w=this.D(this.H(t=>this.c.fire(Zh(t)),t=>this.I(t),this.a.getLevel()===ie.Trace)),this.D(this.a.onDidChangeLogLevel(()=>{this.w?.setVerboseLogging(this.a.getLevel()===ie.Trace)}))),this.w.watch(this.y)}I(t){t.type==="error"&&this.g.fire(t.message),this.J(t)}J(t){this.a[t.type](t.message)}L(t){return si(t.fsPath)}M(t){const e=this.L(t);return v4(e)}};import{fork as P7}from"child_process";function I7(t){const e=t;return e&&typeof e.type=="string"&&typeof e.severity=="string"}function A7(t){const e=[];let s;try{const i=JSON.parse(t.arguments),n=i[i.length-1];n&&n.__$stack&&(i.pop(),s=n.__$stack),e.push(...i)}catch{e.push("Unable to log remote console arguments",t.arguments)}return{args:e,stack:s}}function L7(t){if(!t)return t;const e=t.indexOf(`
`);return e===-1?t:t.substring(0,e)}function O7(t,e){const{args:s,stack:i}=A7(t),n=typeof s[0]=="string"&&s.length===1;let r=L7(i);r&&(r=`(${r.trim()})`);let o=[];if(typeof s[0]=="string"?r&&n?o=[`%c[${e}] %c${s[0]} %c${r}`,jn("blue"),jn(""),jn("grey")]:o=[`%c[${e}] %c${s[0]}`,jn("blue"),jn(""),...s.slice(1)]:o=[`%c[${e}]%`,jn("blue"),...s],r&&!n&&o.push(r),typeof console[t.severity]!="function")throw new Error("Unknown console method");console[t.severity].apply(console,o)}function jn(t){return`color: ${t}`}import"child_process";import"fs";var tm;(function(t){t[t.stdout=0]="stdout",t[t.stderr=1]="stderr"})(tm||(tm={}));var sm;(function(t){t[t.Success=0]="Success",t[t.Unknown=1]="Unknown",t[t.AccessDenied=2]="AccessDenied",t[t.ProcessNotFound=3]="ProcessNotFound"})(sm||(sm={}));function N7(t){t&&(delete t.DEBUG,ut&&delete t.LD_PRELOAD)}function T7(t=je){return t.comspec||"cmd.exe"}function j7(t){let e=[],s=!1;const i=function(n){if(s){e.push(n);return}(!t.send(n,o=>{if(o&&console.error(o),s=!1,e.length>0){const a=e.slice(0);e=[],a.forEach(c=>i(c))}})||Le)&&(s=!0)};return{send:i}}var im=class{constructor(t,e){this.i=t,this.j=e,this.c=new Set,this.g=new Map,this.h=new R,this.onDidProcessExit=this.h.event;const s=e.timeout||6e4;this.b=new el(s),this.d=null,this.f=null}getChannel(t){const e=this;return{call(s,i,n){return e.k(t,s,i,n)},listen(s,i){return e.l(t,s,i)}}}k(t,e,s,i=Z.None){if(!this.b)return Promise.reject(new Error("disposed"));if(i.isCancellationRequested)return Promise.reject(uo());this.b.cancel();const n=this.n(t),r=yt(c=>n.call(e,s,c)),o=i.onCancellationRequested(()=>r.cancel()),a=pe(()=>r.cancel());return this.c.add(a),r.finally(()=>{o.dispose(),this.c.delete(a),this.c.size===0&&this.b&&this.b.trigger(()=>this.o())}),r}l(t,e,s){if(!this.b)return O.None;this.b.cancel();let i;const n=new R({onWillAddFirstListener:()=>{i=this.n(t).listen(e,s)(n.fire,n),this.c.add(i)},onDidRemoveLastListener:()=>{this.c.delete(i),i.dispose(),this.c.size===0&&this.b&&this.b.trigger(()=>this.o())}});return n.event}get m(){if(!this.f){const t=this.j.args||[],e=Object.create(null);e.env={...Ht(process.env),VSCODE_PARENT_PID:String(process.pid)},this.j.env&&(e.env={...e.env,...this.j.env}),this.j.freshExecArgv&&(e.execArgv=[]),typeof this.j.debug=="number"&&(e.execArgv=["--nolazy","--inspect="+this.j.debug]),typeof this.j.debugBrk=="number"&&(e.execArgv=["--nolazy","--inspect-brk="+this.j.debugBrk]),e.execArgv===void 0&&(e.execArgv=process.execArgv.filter(h=>!/^--inspect(-brk)?=/.test(h)).filter(h=>!h.startsWith("--vscode-"))),N7(e.env),this.d=P7(this.i,t,e);const s=new R,n=O.fromNodeEventEmitter(this.d,"message",h=>h)(h=>{if(I7(h)){O7(h,`IPC Library: ${this.j.serverName}`);return}s.fire(L.wrap(Buffer.from(h,"base64")))}),r=this.j.useQueue?j7(this.d):this.d,o=h=>this.d?.connected&&r.send(h.buffer.toString("base64")),a=s.event,c={send:o,onMessage:a};this.f=new rl(c);const l=()=>this.o();process.once("exit",l),this.d.on("error",h=>console.warn('IPC "'+this.j.serverName+'" errored with '+h)),this.d.on("exit",(h,u)=>{process.removeListener("exit",l),n.dispose(),this.c.forEach(f=>Zt(f)),this.c.clear(),h!==0&&u!=="SIGTERM"&&console.warn('IPC "'+this.j.serverName+'" crashed with exit code '+h+" and signal "+u),this.b?.cancel(),this.o(),this.h.fire({code:h,signal:u})})}return this.f}n(t){let e=this.g.get(t);return e||(e=this.m.getChannel(t),this.g.set(t,e)),e}o(){this.f&&(this.d&&(this.d.kill(),this.d=null),this.f=null,this.g.clear())}dispose(){this.h.dispose(),this.b?.cancel(),this.b=void 0,this.o(),this.c.clear()}},M7=class extends E7{constructor(t,e,s){super(t,e,s),this.r()}q(t){const e=t.add(new im(ii.asFileUri("bootstrap-fork").fsPath,{serverName:"File Watcher",args:["--type=fileWatcher"],env:{VSCODE_ESM_ENTRYPOINT:"vs/platform/files/node/watcher/watcherMain",VSCODE_PIPE_LOGGING:"true",VSCODE_VERBOSE_LOGGING:"true"}}));return t.add(e.onDidProcessExit(({code:s,signal:i})=>this.s(`terminated by itself with code ${s}, signal: ${i} (ETERM)`))),xt.toService(hb(e.getChannel("watcher")))}};import{watchFile as U7,unwatchFile as F7}from"fs";var q7=class extends j{constructor(){super(),this.a=this.D(new R),this.onDidChangeFile=this.a.event,this.b=this.D(new R),this.onDidLogMessage=this.b.event,this.c=this.D(new R),this.f=this.c.event,this.g=new Map,this.h=new Map,this.j=this.D(new go),this.m=new Set,this.n=this.D(new Li(this.w())),this.q=5007,this.r=new gn,this.R=!1,this.D(this.f(t=>this.y({id:this.t(t),correlationId:this.s(t)?t.correlationId:void 0,path:t.path})))}s(t){return Z0(t)}t(t){return this.s(t)?t.correlationId:En(t)}async watch(t){this.r.isSettled||this.r.complete(),this.r=new gn;try{this.g.clear(),this.h.clear();for(const e of t)this.s(e)?this.g.set(e.correlationId,e):this.h.set(this.t(e),e);for(const[e]of this.j)!this.h.has(e)&&!this.g.has(e)&&(this.j.deleteAndDispose(e),this.m.delete(e));return await this.u(!1)}finally{this.r.complete()}}u(t){const e=[];for(const[s,i]of[...this.h,...this.g])this.j.has(s)||e.push(i);return this.n.trigger(()=>this.N(e),t?this.w():0).catch(s=>it(s))}w(){return 800}isSuspended(t){const e=this.t(t);return this.m.has(e)?"polling":this.j.has(e)}async y(t){if(this.j.has(t.id))return;const e=new Pe;this.j.set(t.id,e),await this.r.p,!e.isDisposed&&(this.C(t,e),this.u(!0))}z(t){this.j.deleteAndDispose(t.id),this.m.delete(t.id),this.u(!1)}C(t,e){this.F(t,e)?(this.P(`reusing an existing recursive watcher to monitor ${t.path}`),this.m.delete(t.id)):(this.G(t,e),this.m.add(t.id))}F(t,e){const s=this.O?.subscribe(t.path,(i,n)=>{e.isDisposed||(i?this.C(t,e):n?.type===1&&this.H(t))});return s?(e.add(s),!0):!1}G(t,e){let s=!1;const i=(n,r)=>{if(e.isDisposed)return;const o=this.I(n),a=this.I(r),c=s;s=o,!o&&(a||c)&&this.H(t)};this.P(`starting fs.watchFile() on ${t.path} (correlationId: ${t.correlationId})`);try{U7(t.path,{persistent:!1,interval:this.q},i)}catch(n){this.Q(`fs.watchFile() failed with error ${n} on path ${t.path} (correlationId: ${t.correlationId})`)}e.add(pe(()=>{this.P(`stopping fs.watchFile() on ${t.path} (correlationId: ${t.correlationId})`);try{F7(t.path,i)}catch(n){this.Q(`fs.unwatchFile() failed with error ${n} on path ${t.path} (correlationId: ${t.correlationId})`)}}))}H(t){this.P(`detected ${t.path} exists again, resuming watcher (correlationId: ${t.correlationId})`);const e={resource:k.file(t.path),type:1,cId:t.correlationId};this.a.fire([e]),this.J(e,t),this.z(t)}I(t){return t.ctimeMs===0&&t.ino===0}async stop(){this.j.clearAndDisposeAll(),this.m.clear()}J(t,e){if(this.R){const s=` >> normalized ${t.type===1?"[ADDED]":t.type===2?"[DELETED]":"[CHANGED]"} ${t.resource.fsPath}`;this.L(s,e)}}L(t,e){this.R&&this.P(`${t}${typeof e.correlationId=="number"?` <${e.correlationId}> `:""}`)}M(t){return`${t.path} (excludes: ${t.excludes.length>0?t.excludes:"<none>"}, includes: ${t.includes&&t.includes.length>0?JSON.stringify(t.includes):"<all>"}, filter: ${R7(t.filter)}, correlationId: ${typeof t.correlationId=="number"?t.correlationId:"<none>"})`}async setVerboseLogging(t){this.R=t}};import{watch as _7,promises as z7}from"fs";var V7=class kc extends j{static{this.a=100}static{this.b=75}get isReusingRecursiveWatcher(){return this.q}get failed(){return this.r}constructor(e,s,i,n,r,o){super(),this.s=e,this.t=s,this.u=i,this.w=n,this.y=r,this.z=o,this.c=this.D(new T1({maxWorkChunkSize:100,throttleDelay:200,maxBufferedWork:1e4},c=>this.u(c))),this.f=this.D(new L4(c=>this.M(c),kc.b)),this.m=new fs,this.n=new Ri(async()=>{let c=this.s.path;try{c=await le.realpath(this.s.path),this.s.path!==c&&this.Q(`correcting a path to watch that seems to be a symbolic link (original: ${this.s.path}, real: ${c})`)}catch{}return c}),this.q=!1,this.r=!1;const a=!ut;this.g=em(this.s.path,this.s.excludes,a),this.h=this.s.includes?em(this.s.path,this.s.includes,a):void 0,this.j=Z0(this.s)?this.s.filter:void 0,this.ready=this.C()}async C(){try{const e=await z7.stat(this.s.path);if(this.m.token.isCancellationRequested)return;this.D(await this.G(e.isDirectory()))}catch(e){e.code!=="ENOENT"?this.O(e):this.Q(`ignoring a path for watching who's stat info failed to resolve: ${this.s.path} (error: ${e})`),this.F()}}F(){this.r=!0,this.w?.()}async G(e){const s=new Pe;return this.H(e,s)?(this.Q(`reusing an existing recursive watcher for ${this.s.path}`),this.q=!0):(this.q=!1,await this.I(e,s)),s}H(e,s){if(e)return!1;const i=k.file(this.s.path),n=this.t?.subscribe(this.s.path,async(r,o)=>{s.isDisposed||(r?await fy(this.G(e),s):o&&(typeof o.cId=="number"||typeof this.s.correlationId=="number")&&this.L({resource:i,type:o.type,cId:this.s.correlationId},!0))});return n?(s.add(n),!0):!1}async I(e,s){const i=await this.n.value;if(this.m.token.isCancellationRequested)return;if(bs&&ir(i,"/Volumes/",!0)){this.O(`Refusing to watch ${i} for changes using fs.watch() for possibly being a network share where watching is unreliable and unstable.`);return}const n=new fs(this.m.token);s.add(pe(()=>n.dispose(!0)));const r=new Pe;s.add(r);try{const o=k.file(this.s.path),a=qt(i),c=_7(i);r.add(pe(()=>{c.removeAllListeners(),c.close()})),this.Q(`Started watching: '${i}'`);const l=new Set;if(e)try{for(const u of await le.readdir(i))l.add(u)}catch(u){this.O(u)}if(n.token.isCancellationRequested)return;const h=new Map;r.add(pe(()=>{for(const[,u]of h)u.dispose();h.clear()})),c.on("error",(u,f)=>{n.token.isCancellationRequested||(this.O(`Failed to watch ${i} for changes using fs.watch() (${u}, ${f})`),this.F())}),c.on("change",(u,f)=>{if(n.token.isCancellationRequested)return;this.z&&this.R(`[raw] ["${u}"] ${f}`);let p="";if(f&&(p=f.toString(),bs&&(p=ol(p))),!(!p||u!=="change"&&u!=="rename"))if(e)if(u==="rename"){h.get(p)?.dispose();const g=setTimeout(async()=>{if(h.delete(p),Do(p,a,!ut)&&!await le.exists(i)){this.J(o);return}if(n.token.isCancellationRequested)return;const m=await this.N(J(i,p));if(n.token.isCancellationRequested)return;let v;m?l.has(p)?v=0:(v=1,l.add(p)):(l.delete(p),v=2),this.L({resource:V(o,p),type:v,cId:this.s.correlationId})},kc.a);h.set(p,pe(()=>clearTimeout(g)))}else{let g;l.has(p)?g=0:(g=1,l.add(p)),this.L({resource:V(o,p),type:g,cId:this.s.correlationId})}else if(u==="rename"||!Do(p,a,!ut)){const g=setTimeout(async()=>{const m=await le.exists(i);n.token.isCancellationRequested||(m?(this.L({resource:o,type:0,cId:this.s.correlationId},!0),r.add(await this.G(!1))):this.J(o))},kc.a);r.clear(),r.add(pe(()=>clearTimeout(g)))}else this.L({resource:o,type:0,cId:this.s.correlationId},!0)})}catch(o){if(n.token.isCancellationRequested)return;this.O(`Failed to watch ${i} for changes using fs.watch() (${o.toString()})`),this.F()}}J(e){this.P("Watcher shutdown because watched path got deleted"),this.L({resource:e,type:2,cId:this.s.correlationId},!0),this.f.flush(),this.F()}L(e,s=!1){this.m.token.isCancellationRequested||(this.z&&this.R(`${e.type===1?"[ADDED]":e.type===2?"[DELETED]":"[CHANGED]"} ${e.resource.fsPath}`),!s&&this.g.some(i=>i(e.resource.fsPath))?this.z&&this.R(` >> ignored (excluded) ${e.resource.fsPath}`):!s&&this.h&&this.h.length>0&&!this.h.some(i=>i(e.resource.fsPath))?this.z&&this.R(` >> ignored (not included) ${e.resource.fsPath}`):this.f.work(e))}M(e){const s=$7(e),i=[];for(const r of s){if(C7(r,this.j)){this.z&&this.R(` >> ignored (filtered) ${r.resource.fsPath}`);continue}i.push(r)}if(i.length===0)return;if(this.z)for(const r of i)this.R(` >> normalized ${r.type===1?"[ADDED]":r.type===2?"[DELETED]":"[CHANGED]"} ${r.resource.fsPath}`);this.c.work(i)?this.c.pending>0&&this.Q(`started throttling events due to large amount of file change events at once (pending: ${this.c.pending}, most recent change: ${i[0].resource.fsPath}). Use 'files.watcherExclude' setting to exclude folders with lots of changing files (e.g. compilation output).`):this.P(`started ignoring events due to too many file change events at once (incoming: ${i.length}, most recent change: ${i[0].resource.fsPath}). Use 'files.watcherExclude' setting to exclude folders with lots of changing files (e.g. compilation output).`)}async N(e){if(ut)return le.exists(e);try{const s=qt(e);return(await le.readdir(Qe(e))).some(n=>n===s)}catch(s){return this.Q(s),!1}}setVerboseLogging(e){this.z=e}O(e){this.m.token.isCancellationRequested||this.y?.({type:"error",message:`[File Watcher (node.js)] ${e}`})}P(e){this.m.token.isCancellationRequested||this.y?.({type:"warn",message:`[File Watcher (node.js)] ${e}`})}Q(e){!this.m.token.isCancellationRequested&&this.z&&this.y?.({type:"trace",message:`[File Watcher (node.js)] ${e}`})}R(e){!this.m.token.isCancellationRequested&&this.z&&this.Q(`${e}${typeof this.s.correlationId=="number"?` <${this.s.correlationId}> `:""}`)}dispose(){this.m.dispose(!0),super.dispose()}},B7=class extends q7{get watchers(){return this.S.values()}constructor(t){super(),this.O=t,this.onDidError=O.None,this.S=new Map,this.U=this.D(new us)}async N(t){t=this.cb(t);const e=[],s=new Set(Array.from(this.watchers));for(const i of t){const n=this.S.get(this.Z(i));n&&X0(n.request.excludes,i.excludes)&&X0(n.request.includes,i.includes)?s.delete(n):e.push(i)}e.length&&this.P(`Request to start watching: ${e.map(i=>this.M(i)).join(",")}`),s.size&&this.P(`Request to stop watching: ${Array.from(s).map(i=>this.M(i.request)).join(",")}`),this.U.clear();for(const i of s)this.bb(i);this.Y().work(e)}Y(){return this.U.value=new T1({maxWorkChunkSize:100,throttleDelay:100,maxBufferedWork:Number.MAX_VALUE},t=>{for(const e of t)this.ab(e)}),this.U.value}Z(t){return typeof t.correlationId=="number"?t.correlationId:this.$(t.path)}$(t){return ut?t:t.toLowerCase()}ab(t){const e=new V7(t,this.O,i=>this.a.fire(i),()=>this.c.fire(t),i=>this.b.fire(i),this.R),s={request:t,instance:e};this.S.set(this.Z(t),s)}async stop(){await super.stop();for(const t of this.watchers)this.bb(t)}bb(t){this.P("stopping file watcher",t),this.S.delete(this.Z(t.request)),t.instance.dispose()}cb(t){const e=new Map;for(const s of t){let i=e.get(s.correlationId);i||(i=new Map,e.set(s.correlationId,i));const n=this.$(s.path);i.has(n)&&this.P(`ignoring a request for watching who's path is already watched: ${this.M(s)}`),i.set(n,s)}return Array.from(e.values()).flatMap(s=>Array.from(s.values()))}async setVerboseLogging(t){super.setVerboseLogging(t);for(const e of this.watchers)e.instance.setVerboseLogging(t)}P(t,e){this.R&&this.b.fire({type:"trace",message:this.fb(t,e)})}Q(t){this.b.fire({type:"warn",message:this.fb(t)})}fb(t,e){return e?`[File Watcher (node.js)] ${t} (${this.M(e.request)})`:`[File Watcher (node.js)] ${t}`}},W7=class extends S7{constructor(t,e,s){super(t,e,s),this.r()}q(t){return t.add(new B7(void 0))}},H7=class no extends D7{constructor(){super(...arguments),this.onDidChangeCapabilities=O.None,this.R=new ht(e=>Zc.getComparisonKey(e)),this.Z=new Map,this.$=new Map,this.ab=new Map}static{this.N=!1}get capabilities(){return this.O||(this.O=516126,ut&&(this.O|=1024)),this.O}async stat(e){try{const{stat:s,symbolicLink:i}=await _t.stat(this.L(e));return{type:this.Q(s,i),ctime:s.birthtime.getTime(),mtime:s.mtime.getTime(),size:s.size,permissions:(s.mode&128)===0?Rn.Locked:void 0}}catch(s){throw this.jb(s)}}async P(e){try{return await this.stat(e)}catch{return}}async realpath(e){const s=this.L(e);return le.realpath(s)}async readdir(e){try{const s=await le.readdir(this.L(e),{withFileTypes:!0}),i=[];return await Promise.all(s.map(async n=>{try{let r;n.isSymbolicLink()?r=(await this.stat(V(e,n.name))).type:r=this.Q(n),i.push([n.name,r])}catch(r){this.a.trace(r)}})),i}catch(s){throw this.jb(s)}}Q(e,s){let i;return s?.dangling?i=Wt.Unknown:e.isFile()?i=Wt.File:e.isDirectory()?i=Wt.Directory:i=Wt.Unknown,s&&(i|=Wt.SymbolicLink),i}async S(e){const s=this.L(e);this.U(`[Disk FileSystemProvider]: createResourceLock() - request to acquire resource lock (${s})`);let i;for(;i=this.R.get(e);)this.U(`[Disk FileSystemProvider]: createResourceLock() - waiting for resource lock to be released (${s})`),await i.wait();const n=new rr;return this.R.set(e,n),this.U(`[Disk FileSystemProvider]: createResourceLock() - new resource lock created (${s})`),pe(()=>{this.U(`[Disk FileSystemProvider]: createResourceLock() - resource lock dispose() (${s})`),this.R.get(e)===n&&(this.U(`[Disk FileSystemProvider]: createResourceLock() - resource lock removed from resource-lock map (${s})`),this.R.delete(e)),this.U(`[Disk FileSystemProvider]: createResourceLock() - resource lock barrier open() (${s})`),n.open()})}async readFile(e,s){let i;try{s?.atomic&&(this.U(`[Disk FileSystemProvider]: atomic read operation started (${this.L(e)})`),i=await this.S(e));const n=this.L(e);return await Gi.readFile(n)}catch(n){throw this.jb(n)}finally{i?.dispose()}}U(e){no.N&&this.a.trace(e)}readFileStream(e,s,i){const n=or(r=>L.concat(r.map(o=>L.wrap(o))).buffer);return _0(this,e,n,r=>r.buffer,{...s,bufferSize:256*1024},i),n}async writeFile(e,s,i){return i?.atomic!==!1&&i?.atomic?.postfix&&await this.W(e)?this.X(e,V(P1(e),`${nr(e)}${i.atomic.postfix}`),s,i):this.Y(e,s,i)}async W(e){try{const s=this.L(e),{symbolicLink:i}=await _t.stat(s);if(i)return!1}catch{}return!0}async X(e,s,i,n){const r=new Pe;try{r.add(await this.S(e)),r.add(await this.S(s)),await this.Y(s,i,n,!0);try{await this.rename(s,e,{overwrite:!0})}catch(o){try{await this.delete(s,{recursive:!1,useTrash:!1,atomic:!1})}catch{}throw o}}finally{r.dispose()}}async Y(e,s,i,n){let r;try{const o=this.L(e);if(!i.create||!i.overwrite){if(await le.exists(o)){if(!i.overwrite)throw ks(w(2121,null),Y.FileExists)}else if(!i.create)throw ks(w(2122,null),Y.FileNotFound)}r=await this.open(e,{create:!0,unlock:i.unlock},n),await this.write(r,0,s,0,s.byteLength)}catch(o){throw await this.kb(e,o)}finally{typeof r=="number"&&await this.close(r)}}static{this.bb=!0}static configureFlushOnWrite(e){no.bb=e}async open(e,s,i){const n=this.L(e);let r;Cn(s)&&!i&&(r=await this.S(e));let o;try{if(Cn(s)&&s.unlock)try{const{stat:a}=await _t.stat(n);a.mode&128||await Gi.chmod(n,a.mode|128)}catch(a){a.code!=="ENOENT"&&this.a.trace(a)}if(Le&&Cn(s))try{o=await le.open(n,"r+"),await le.ftruncate(o,0)}catch(a){if(a.code!=="ENOENT"&&this.a.trace(a),typeof o=="number"){try{await le.close(o)}catch(c){this.a.trace(c)}o=void 0}}typeof o!="number"&&(o=await le.open(n,Cn(s)?"w":"r"))}catch(a){throw r?.dispose(),Cn(s)?await this.kb(e,a):this.jb(a)}if(this.Z.set(o,0),Cn(s)&&this.ab.set(o,e),r){const a=this.$.get(o);this.U(`[Disk FileSystemProvider]: open() - storing lock for handle ${o} (${n})`),this.$.set(o,r),a&&(this.U(`[Disk FileSystemProvider]: open() - disposing a previous lock that was still stored on same handle ${o} (${n})`),a.dispose())}return o}async close(e){const s=this.$.get(e);try{if(this.Z.delete(e),this.ab.delete(e)&&no.bb)try{await le.fdatasync(e)}catch(i){no.configureFlushOnWrite(!1),this.a.error(i)}return await le.close(e)}catch(i){throw this.jb(i)}finally{s&&(this.$.get(e)===s&&(this.U(`[Disk FileSystemProvider]: close() - resource lock removed from handle-lock map ${e}`),this.$.delete(e)),this.U(`[Disk FileSystemProvider]: close() - disposing lock for handle ${e}`),s.dispose())}}async read(e,s,i,n,r){const o=this.cb(e,s);let a=null;try{a=(await le.read(e,i,n,r,o)).bytesRead}catch(c){throw this.jb(c)}finally{this.db(e,o,a)}return a}cb(e,s){return s===this.Z.get(e)?null:s}db(e,s,i){const n=this.Z.get(e);typeof n=="number"&&(typeof s=="number"||(typeof i=="number"?this.Z.set(e,n+i):this.Z.delete(e)))}async write(e,s,i,n,r){return T4(()=>this.eb(e,s,i,n,r),100,3)}async eb(e,s,i,n,r){const o=this.cb(e,s);let a=null;try{a=(await le.write(e,i,n,r,o)).bytesWritten}catch(c){throw await this.kb(this.ab.get(e),c)}finally{this.db(e,o,a)}return a}async mkdir(e){try{await Gi.mkdir(this.L(e))}catch(s){throw this.jb(s)}}async delete(e,s){try{const i=this.L(e);if(s.recursive){let n;s?.atomic!==!1&&s.atomic.postfix&&(n=J(Qe(i),`${qt(i)}${s.atomic.postfix}`)),await le.rm(i,Sn.MOVE,n)}else try{await Gi.unlink(i)}catch(n){if(n.code==="EPERM"||n.code==="EISDIR"){let r=!1;try{const{stat:o,symbolicLink:a}=await _t.stat(i);r=o.isDirectory()&&!a}catch{}if(r)await Gi.rmdir(i);else throw n}else throw n}}catch(i){throw this.jb(i)}}async rename(e,s,i){const n=this.L(e),r=this.L(s);if(n!==r)try{await this.fb(e,s,"move",i.overwrite),await le.rename(n,r)}catch(o){throw(o.code==="EINVAL"||o.code==="EBUSY"||o.code==="ENAMETOOLONG")&&(o=new Error(w(2123,null,qt(n),qt(Qe(r)),o.toString()))),this.jb(o)}}async copy(e,s,i){const n=this.L(e),r=this.L(s);if(n!==r)try{await this.fb(e,s,"copy",i.overwrite),await le.copy(n,r,{preserveSymlinks:!0})}catch(o){throw(o.code==="EINVAL"||o.code==="EBUSY"||o.code==="ENAMETOOLONG")&&(o=new Error(w(2124,null,qt(n),qt(Qe(r)),o.toString()))),this.jb(o)}}async fb(e,s,i,n){const r=this.L(e),o=this.L(s);let a=!1;if(!!(this.capabilities&1024)||(a=Do(r,o,!0)),a){if(i==="copy")throw ks(w(2125,null),Y.FileExists);if(i==="move")return}const l=await this.P(e);if(!l)throw ks(w(2126,null),Y.FileNotFound);const h=await this.P(s);if(h){if(!n)throw ks(w(2127,null),Y.FileExists);(l.type&Wt.File)!==0&&(h.type&Wt.File)!==0||await this.delete(s,{recursive:!0,useTrash:!1,atomic:!1})}}async cloneFile(e,s){return this.gb(e,s,!1)}async gb(e,s,i){const n=this.L(e),r=this.L(s),o=!!(this.capabilities&1024);if(Do(n,r,!o))return;const a=new Pe;try{a.add(await this.S(e)),a.add(await this.S(s)),i&&await Gi.mkdir(Qe(r),{recursive:!0}),await Gi.copyFile(n,r)}catch(c){if(c.code==="ENOENT"&&!i)return this.gb(e,s,!0);throw this.jb(c)}finally{a.dispose()}}u(e,s,i){return new M7(n=>e(n),n=>s(n),i)}H(e,s,i){return new W7(n=>e(n),n=>s(n),i)}jb(e){if(e instanceof Ul)return e;let s=e,i;switch(e.code){case"ENOENT":i=Y.FileNotFound;break;case"EISDIR":i=Y.FileIsADirectory;break;case"ENOTDIR":i=Y.FileNotADirectory;break;case"EEXIST":i=Y.FileExists;break;case"EPERM":case"EACCES":i=Y.NoPermissions;break;case"ERR_UNC_HOST_NOT_ALLOWED":s=`${e.message}. Please update the 'security.allowedUNCHosts' setting if you want to allow this host.`,i=Y.Unknown;break;default:i=Y.Unknown}return ks(s,i)}async kb(e,s){let i=this.jb(s);if(e&&i.code===Y.NoPermissions)try{const{stat:n}=await _t.stat(this.L(e));n.mode&128||(i=ks(s,Y.FileWriteLocked))}catch(n){this.a.trace(n)}return i}},ce=class{constructor(t,e=[],s=!1){this.ctor=t,this.staticArguments=e,this.supportsDelayedInstantiation=s}},G7=class{constructor(t,e){this.key=t,this.data=e,this.incoming=new Map,this.outgoing=new Map}},nm=class{constructor(t){this.b=t,this.a=new Map}roots(){const t=[];for(const e of this.a.values())e.outgoing.size===0&&t.push(e);return t}insertEdge(t,e){const s=this.lookupOrInsertNode(t),i=this.lookupOrInsertNode(e);s.outgoing.set(i.key,i),i.incoming.set(s.key,s)}removeNode(t){const e=this.b(t);this.a.delete(e);for(const s of this.a.values())s.outgoing.delete(e),s.incoming.delete(e)}lookupOrInsertNode(t){const e=this.b(t);let s=this.a.get(e);return s||(s=new G7(e,t),this.a.set(e,s)),s}lookup(t){return this.a.get(this.b(t))}isEmpty(){return this.a.size===0}toString(){const t=[];for(const[e,s]of this.a)t.push(`${e}
	(-> incoming)[${[...s.incoming.keys()].join(", ")}]
	(outgoing ->)[${[...s.outgoing.keys()].join(",")}]
`);return t.join(`
`)}findCycleSlow(){for(const[t,e]of this.a){const s=new Set([t]),i=this.c(e,s);if(i)return i}}c(t,e){for(const[s,i]of t.outgoing){if(e.has(s))return[...e,s].join(" -> ");e.add(s);const n=this.c(i,e);if(n)return n;e.delete(s)}}},Yh=class{constructor(...t){this.a=new Map;for(const[e,s]of t)this.set(e,s)}set(t,e){const s=this.a.get(t);return this.a.set(t,e),s}has(t){return this.a.has(t)}get(t){return this.a.get(t)}},J7=!1,rm=class extends Error{constructor(t){super("cyclic dependency between services"),this.message=t.findCycleSlow()??`UNABLE to detect cycle, dumping graph: 
${t.toString()}`}},K7=class hd{constructor(e=new Yh,s=!1,i,n=J7){this.i=e,this.j=s,this.k=i,this.l=n,this.f=!1,this.g=new Set,this.h=new Set,this.t=new Set,this.i.set(ns,this),this._globalGraph=n?i?._globalGraph??new nm(r=>r):void 0}dispose(){if(!this.f){this.f=!0,Zt(this.h),this.h.clear();for(const e of this.g)Fc(e)&&e.dispose();this.g.clear()}}m(){if(this.f)throw new Error("InstantiationService has been disposed")}createChild(e,s){this.m();const i=this,n=new class extends hd{dispose(){i.h.delete(n),super.dispose()}}(e,this.j,this,this.l);return this.h.add(n),s?.add(n),n}invokeFunction(e,...s){this.m();const i=eu.traceInvocation(this.l,e);let n=!1;try{return e({get:o=>{if(n)throw Ed("service accessor is only valid during the invocation of its target method");const a=this.s(o,i);return a||this.y(`[invokeFunction] unknown service '${o}'`,!1),a}},...s)}finally{n=!0,i.stop()}}createInstance(e,...s){this.m();let i,n;return e instanceof ce?(i=eu.traceCreation(this.l,e.ctor),n=this.o(e.ctor,e.staticArguments.concat(s),i)):(i=eu.traceCreation(this.l,e),n=this.o(e,s,i)),i.stop(),n}o(e,s=[],i){const n=gs.getServiceDependencies(e).sort((a,c)=>a.index-c.index),r=[];for(const a of n){const c=this.s(a.id,i);c||this.y(`[createInstance] ${e.name} depends on UNKNOWN service ${a.id}.`,!1),r.push(c)}const o=n.length>0?n[0].index:s.length;if(s.length!==o){console.trace(`[createInstance] First service dependency of ${e.name} at position ${o+1} conflicts with ${s.length} static arguments`);const a=o-s.length;a>0?s=s.concat(new Array(a)):s=s.slice(0,o)}return Reflect.construct(e,s.concat(r))}q(e,s){if(this.i.get(e)instanceof ce)this.i.set(e,s);else if(this.k)this.k.q(e,s);else throw new Error("illegalState - setting UNKNOWN service instance")}r(e){const s=this.i.get(e);return!s&&this.k?this.k.r(e):s}s(e,s){this._globalGraph&&this.c&&this._globalGraph.insertEdge(this.c,String(e));const i=this.r(e);return i instanceof ce?this.u(e,i,s.branch(e,!0)):(s.branch(e,!1),i)}u(e,s,i){if(this.t.has(e))throw new Error(`illegal state - RECURSIVELY instantiating service '${e}'`);this.t.add(e);try{return this.v(e,s,i)}finally{this.t.delete(e)}}v(e,s,i){const n=new nm(c=>c.id.toString());let r=0;const o=[{id:e,desc:s,_trace:i}],a=new Set;for(;o.length;){const c=o.pop();if(!a.has(String(c.id))){if(a.add(String(c.id)),n.lookupOrInsertNode(c),r++>1e3)throw new rm(n);for(const l of gs.getServiceDependencies(c.desc.ctor)){const h=this.r(l.id);if(h||this.y(`[createInstance] ${e} depends on ${l.id} which is NOT registered.`,!0),this._globalGraph?.insertEdge(String(c.id),String(l.id)),h instanceof ce){const u={id:l.id,desc:h,_trace:c._trace.branch(l.id,!0)};n.insertEdge(c,u),o.push(u)}}}}for(;;){const c=n.roots();if(c.length===0){if(!n.isEmpty())throw new rm(n);break}for(const{data:l}of c){if(this.r(l.id)instanceof ce){const u=this.w(l.id,l.desc.ctor,l.desc.staticArguments,l.desc.supportsDelayedInstantiation,l._trace);this.q(l.id,u)}n.removeNode(l)}}return this.r(e)}w(e,s,i=[],n,r){if(this.i.get(e)instanceof ce)return this.x(e,s,i,n,r,this.g);if(this.k)return this.k.w(e,s,i,n,r);throw new Error(`illegalState - creating UNKNOWN service instance ${s.name}`)}x(e,s,i=[],n,r,o){if(n){const a=new hd(void 0,this.j,this,this.l);a.c=String(e);const c=new Map,l=new N4(()=>{const h=a.o(s,i,r);for(const[u,f]of c){const p=h[u];if(typeof p=="function")for(const g of f)g.disposable=p.apply(h,g.listener)}return c.clear(),o.add(h),h});return new Proxy(Object.create(null),{get(h,u){if(!l.isInitialized&&typeof u=="string"&&(u.startsWith("onDid")||u.startsWith("onWill"))){let g=c.get(u);return g||(g=new Zd,c.set(u,g)),(v,b,S)=>{if(l.isInitialized)return l.value[u](v,b,S);{const $={listener:[v,b,S],disposable:void 0},F=g.push($);return pe(()=>{F(),$.disposable?.dispose()})}}}if(u in h)return h[u];const f=l.value;let p=f[u];return typeof p!="function"||(p=p.bind(f),h[u]=p),p},set(h,u,f){return l.value[u]=f,!0},getPrototypeOf(h){return s.prototype}})}else{const a=this.o(s,i,r);return o.add(a),a}}y(e,s){if(s&&console.warn(e),this.j)throw new Error(e)}},om;(function(t){t[t.None=0]="None",t[t.Creation=1]="Creation",t[t.Invocation=2]="Invocation",t[t.Branch=3]="Branch"})(om||(om={}));var eu=class Ns{static{this.all=new Set}static{this.c=new class extends Ns{constructor(){super(0,null)}stop(){}branch(){return this}}}static traceInvocation(e,s){return e?new Ns(2,s.name||new Error().stack.split(`
`).slice(3,4).join(`
`)):Ns.c}static traceCreation(e,s){return e?new Ns(1,s.name):Ns.c}static{this.f=0}constructor(e,s){this.type=e,this.name=s,this.g=Date.now(),this.h=[]}branch(e,s){const i=new Ns(3,e.toString());return this.h.push([e,s,i]),i}stop(){const e=Date.now()-this.g;Ns.f+=e;let s=!1;function i(r,o){const a=[],c=new Array(r+1).join("	");for(const[l,h,u]of o.h)if(h&&u){s=!0,a.push(`${c}CREATES -> ${l}`);const f=i(r+1,u);f&&a.push(f)}else a.push(`${c}uses -> ${l}`);return a.join(`
`)}const n=[`${this.type===1?"CREATE":"CALL"} ${this.name}`,`${i(1,this)}`,`DONE, took ${e.toFixed(2)}ms (grand total ${Ns.f.toFixed(2)}ms)`];(e>2||s)&&Ns.all.add(n.join(`
`))}};import*as Q7 from"fs";import{createHash as X7}from"crypto";var tu=class extends Al{constructor(e,s,i,n){super(i),this.h=e,this.j=n,this.g=this.D(new su(s,n)),this.h.registerParticipant({postInstall:async r=>this.m(r),postUninstall:async r=>this.n(r)})}async getBuiltInExtensionTranslationsUri(e,s){const n=(await this.g.getLanguagePacks())[s];if(!n){this.j.warn(`No language pack found for ${s}`);return}const r=n.translations[e];return r?k.file(r):void 0}async getInstalledLanguages(){const e=await this.g.getLanguagePacks(),s=Object.keys(e).map(i=>{const n=e[i];return{...this.f(i,n.label),extensionId:n.extensions[0].extensionIdentifier.id}});return s.push(this.f("en","English")),s.sort((i,n)=>i.label.localeCompare(n.label)),s}async m(e){e&&e.manifest&&e.manifest.contributes&&e.manifest.contributes.localizations&&e.manifest.contributes.localizations.length&&(this.j.info("Adding language packs from the extension",e.identifier.id),await this.update())}async n(e){const s=await this.g.getLanguagePacks();Object.keys(s).some(i=>s[i]&&s[i].extensions.some(n=>G(n.extensionIdentifier,e.identifier)))&&(this.j.info("Removing language packs from the extension",e.identifier.id),await this.update())}async update(){const[e,s]=await Promise.all([this.g.getLanguagePacks(),this.h.getInstalled()]),i=await this.g.update(s);return!jt(Object.keys(e),Object.keys(i))}};tu=__decorate([__param(0,Gs),__param(1,Vt),__param(2,xs),__param(3,Q)],tu);var su=class extends j{constructor(e,s){super(),this.j=s,this.c={},this.f=J(e.userDataPath,"languagepacks.json"),this.g=new pn}getLanguagePacks(){return this.g.size||!this.h?this.r().then(()=>this.c):Promise.resolve(this.c)}update(e){return this.r(s=>{Object.keys(s).forEach(i=>delete s[i]),this.m(s,...e)}).then(()=>this.c)}m(e,...s){for(const i of s)i&&i.manifest&&i.manifest.contributes&&i.manifest.contributes.localizations&&i.manifest.contributes.localizations.length&&this.n(e,i);Object.keys(e).forEach(i=>this.q(e[i]))}n(e,s){const i=s.identifier,n=s.manifest.contributes&&s.manifest.contributes.localizations?s.manifest.contributes.localizations:[];for(const r of n)if(s.location.scheme===ne.file&&Z7(r)){let o=e[r.languageId];o||(o={hash:"",extensions:[],translations:{},label:r.localizedLanguageName??r.languageName},e[r.languageId]=o);const a=o.extensions.filter(c=>G(c.extensionIdentifier,i))[0];a?a.version=s.manifest.version:o.extensions.push({extensionIdentifier:i,version:s.manifest.version});for(const c of r.translations)o.translations[c.id]=J(s.location.fsPath,c.path)}}q(e){if(e){const s=X7("md5");for(const i of e.extensions)s.update(i.extensionIdentifier.uuid||i.extensionIdentifier.id).update(i.version);e.hash=s.digest("hex")}}r(e=()=>null){return this.g.queue(()=>{let s=null;return Q7.promises.readFile(this.f,"utf8").then(void 0,i=>i.code==="ENOENT"?Promise.resolve("{}"):Promise.reject(i)).then(i=>{try{return JSON.parse(i)}catch{return{}}}).then(i=>(s=e(i),i)).then(i=>{for(const r of Object.keys(i))i[r]||delete i[r];this.c=i,this.h=!0;const n=JSON.stringify(this.c);return this.j.debug("Writing language packs",n),le.writeFile(this.f,n)}).then(()=>s,i=>this.j.error(i))})}};su=__decorate([__param(0,Vt),__param(1,Q)],su);function Z7(t){if(typeof t.languageId!="string"||!Array.isArray(t.translations)||t.translations.length===0)return!1;for(const e of t.translations)if(typeof e.id!="string"||typeof e.path!="string")return!1;return!(t.languageName&&typeof t.languageName!="string"||t.localizedLanguageName&&typeof t.localizedLanguageName!="string")}var Y7=class extends o2{constructor(t,e,s,i,n){super(e,s,i),this.c=t,this.r=n,this.D(n.listen("onDidChangeLogLevel",t)(r=>{e2(r)?super.setLogLevel(r):super.setLogLevel(k.revive(r[0]),r[1])})),this.D(n.listen("onDidChangeVisibility",t)(([r,o])=>super.setVisibility(k.revive(r),o))),this.D(n.listen("onDidChangeLoggers",t)(({added:r,removed:o})=>{for(const a of r)super.registerLogger({...a,resource:k.revive(a.resource)});for(const a of o)super.deregisterLogger(a.resource)}))}createConsoleMainLogger(){return new n2({log:(t,e)=>{this.r.call("consoleLog",[t,e])}})}registerLogger(t){super.registerLogger(t),this.r.call("registerLogger",[t,this.c])}deregisterLogger(t){super.deregisterLogger(t),this.r.call("deregisterLogger",[t,this.c])}setLogLevel(t,e){super.setLogLevel(t,e),this.r.call("setLogLevel",[t,e])}setVisibility(t,e){super.setVisibility(t,e),this.r.call("setVisibility",[this.q(t),e])}s(t,e,s){return new e6(this.r,t,e,s,this.c)}static setLogLevel(t,e,s){return t.call("setLogLevel",[e,s])}},e6=class extends s2{constructor(t,e,s,i,n){super(i?.logLevel==="always"),this.r=t,this.s=e,this.n=!1,this.q=[],this.setLevel(s),this.r.call("createLogger",[e,i,n]).then(()=>{this.u(this.q),this.n=!0})}m(t,e){const s=[[t,e]];this.n?this.u(s):this.q.push(...s)}u(t){this.r.call("log",[this.s,t])}},t6=class{constructor(t){this.b=t}listen(t,e){throw new Error(`Event not found: ${e}`)}call(t,e,{eventName:s,data:i}){return this.b.forEach(n=>n.log(s,i??{})),Promise.resolve(null)}},s6=class{constructor(t){this.b=t}log(t,e){return this.b.call("log",{eventName:t,data:e}).then(void 0,s=>`Failed to log telemetry: ${console.warn(s)}`),Promise.resolve(null)}flush(){return Promise.resolve()}},Da=class extends j{constructor(e,s,i,n,r){super(),this.b=e;const o=s?"remoteTelemetry":Tg,a=i.getLogger(o);if(a)this.a=this.D(a);else{const l=Mg(r,n)?" (Not Sent)":"";this.a=this.D(i.createLogger(o,{name:w(2313,null,l),group:O5,hidden:!0}))}}flush(){return Promise.resolve()}log(e,s){this.a.trace(`${this.b}telemetry/${e}`,Fg(s))}};Da=__decorate([__param(2,gr),__param(3,ae),__param(4,ge)],Da);var Pa=class{static{this.IDLE_START_EVENT_NAME="UserIdleStart"}static{this.IDLE_STOP_EVENT_NAME="UserIdleStop"}constructor(e,s,i){this.k=s,this.l=i,this.d={},this.i=new Pe,this.j=[],this.b=e.appenders,this.c=e.commonProperties??Object.create(null),this.sessionId=this.c.sessionID,this.machineId=this.c["common.machineId"],this.sqmId=this.c["common.sqmId"],this.devDeviceId=this.c["common.devDeviceId"],this.firstSessionDate=this.c["common.firstSessionDate"],this.msftInternal=this.c["common.msftInternal"],this.f=e.piiPaths||[],this.g=3,this.h=!!e.sendErrorTelemetry,this.j=[/(vscode-)?file:\/\/.*?\/resources\/app\//gi];for(const n of this.f)this.j.push(new RegExp(Di(n),"gi")),n.indexOf("\\")>=0&&this.j.push(new RegExp(Di(n.replace(/\\/g,"/")),"gi"));this.m(),this.i.add(this.k.onDidChangeConfiguration(n=>{(n.affectsConfiguration(ta)||n.affectsConfiguration(Zl)||n.affectsConfiguration($g))&&this.m()}))}setExperimentProperty(e,s){this.d[e]=s}m(){let e=Ug(this.k);const s=this.l.enabledTelemetryLevels;if(s){this.h=this.sendErrorTelemetry?s.error:!1;const i=s.usage?3:s.error?2:0;e=Math.min(e,i)}this.g=e}get sendErrorTelemetry(){return this.h}get telemetryLevel(){return this.g}dispose(){this.i.dispose()}n(e,s,i){this.g<s||(i=Yo(i,this.d),i=F5(i,this.j),i=Yo(i,this.c),this.b.forEach(n=>n.log(e,i??{})))}publicLog(e,s){this.n(e,3,s)}publicLog2(e,s){this.publicLog(e,s)}publicLogError(e,s){this.h&&this.n(e,2,s)}publicLogError2(e,s){this.publicLogError(e,s)}};Pa=__decorate([__param(1,me),__param(2,ge)],Pa);function i6(){const t=w(2314,null,ms.nameLong),e=ms.privacyStatementUrl?w(2316,null,"https://aka.ms/vscode-telemetry",ms.privacyStatementUrl):w(2315,null,"https://aka.ms/vscode-telemetry"),s=at?"":w(2317,null),i=w(2318,null),n=w(2319,null),r=w(2320,null),o=w(2321,null),a=`
|       | ${i} | ${n} | ${r} |
|:------|:-------------:|:---------------:|:----------:|
| all   |       \u2713       |        \u2713        |     \u2713      |
| error |       \u2713       |        \u2713        |     -      |
| crash |       \u2713       |        -        |     -      |
| off   |       -       |        -        |     -      |
`,c=w(2322,null);return`
${t} ${e} ${s}

&nbsp;

${o}
${a}

&nbsp;

${c}
`}var n6=At.as(rs.Configuration);n6.registerConfiguration({id:g5,order:1,type:"object",title:w(2323,null),properties:{[ta]:{type:"string",enum:["all","error","crash","off"],enumDescriptions:[w(2324,null),w(2325,null),w(2326,null),w(2327,null)],markdownDescription:i6(),default:"all",restricted:!0,scope:1,tags:["usesOnlineServices","telemetry"],policy:{name:"TelemetryLevel",category:$s.Telemetry,minimumVersion:"1.99",localization:{description:{key:"telemetry.telemetryLevel.policyDescription",value:w(2328,null)},enumDescriptions:[{key:"telemetry.telemetryLevel.default",value:w(2329,null)},{key:"telemetry.telemetryLevel.error",value:w(2330,null)},{key:"telemetry.telemetryLevel.crash",value:w(2331,null)},{key:"telemetry.telemetryLevel.off",value:w(2332,null)}]}}},"telemetry.feedback.enabled":{type:"boolean",default:!0,description:w(2333,null),policy:{name:"EnableFeedback",category:$s.Telemetry,minimumVersion:"1.99",localization:{description:{key:"telemetry.feedback.enabled",value:w(2334,null)}}}},[Zl]:{type:"boolean",markdownDescription:ms.privacyStatementUrl?w(2336,null,ms.nameLong,ms.privacyStatementUrl):w(2335,null,ms.nameLong),default:!0,restricted:!0,markdownDeprecationMessage:w(2337,null,`\`#${ta}#\``),scope:1,tags:["usesOnlineServices","telemetry"]}}});var iu=class{constructor(e,s,i,n,r){this.b=e,this.c=s,this.d=i,this.e=n,this.f=r,this.a=new Map}g(e){if(!this.a.has(e.id)){const s=Object.create(null);s["common.vscodemachineid"]=this.c.machineId,s["common.vscodesessionid"]=this.c.sessionId;const i=[e.id,JSON.stringify(s),e.aiKey],r=new im(ii.asFileUri("bootstrap-fork").fsPath,{serverName:"Debug Telemetry",timeout:1e3*60*5,args:i,env:{ELECTRON_RUN_AS_NODE:1,VSCODE_PIPE_LOGGING:"true",VSCODE_ESM_ENTRYPOINT:"vs/workbench/contrib/debug/node/telemetryApp"}}).getChannel("telemetryAppender"),o=[new s6(r),new Da(`[${e.id}] `,!1,this.d,this.e,this.f)];this.a.set(e.id,new Pa({appenders:o,sendErrorTelemetry:e.sendErrorTelemetry},this.b,this.f))}return this.a.get(e.id)}publicLog(e,s,i){this.g(e).publicLog(s,i)}publicLogError(e,s,i){this.g(e).publicLogError(s,i)}};iu=__decorate([__param(0,me),__param(1,ke),__param(2,gr),__param(3,ae),__param(4,ge)],iu);var As,nu=W("IExtensionStorageService"),r6=/^extensionKeys\/([^.]+\..+)@(\d+\.\d+\.\d+(-.*)?)$/,jr=class extends j{static{As=this}static{this.a=512*1024}static b(e){return`extensionKeys/${Cr(e.id)}@${e.version}`}static c(e){const s=r6.exec(e);if(s&&s[1])return{id:s[1],version:s[2]}}static async removeOutdatedExtensionVersions(e,s){const i=await e.getInstalled(),n=[];for(const[r,o]of As.f(s)){const a=i.find(c=>G(c.identifier,{id:r}))?.manifest.version;for(const c of o)a!==c&&n.push(As.b({id:r,version:c}))}for(const r of n)s.remove(r,0)}static f(e){const s=new Map,i=e.keys(0,1);for(const n of i){const r=As.c(n);if(r){let o=s.get(r.id.toLowerCase());o||s.set(r.id.toLowerCase(),o=[]),o.push(r.version)}}return s}constructor(e,s,i){super(),this.j=e,this.m=s,this.n=i,this.g=this.D(new R),this.onDidChangeExtensionStorageToSync=this.g.event,this.h=As.f(e),this.D(this.j.onDidChangeValue(0,void 0,this.B)(n=>this.q(n)))}q(e){if(this.h.has(e.key.toLowerCase())){this.g.fire();return}const s=As.c(e.key);if(s){if(this.j.get(e.key,0)===void 0)this.h.delete(s.id.toLowerCase());else{let i=this.h.get(s.id.toLowerCase());i||this.h.set(s.id.toLowerCase(),i=[]),i.push(s.version),this.g.fire()}return}}r(e){if(de(e))return e;const s=e.manifest?e.manifest.publisher:e.publisher,i=e.manifest?e.manifest.name:e.name;return ia(s,i)}getExtensionState(e,s){const i=this.r(e),n=this.getExtensionStateRaw(e,s);if(n)try{return JSON.parse(n)}catch(r){this.n.error(`[mainThreadStorage] unexpected error parsing storage contents (extensionId: ${i}, global: ${s}): ${r}`)}}getExtensionStateRaw(e,s){const i=this.r(e),n=this.j.get(i,s?0:1);return n&&n?.length>As.a&&this.n.warn(`[mainThreadStorage] large extension state detected (extensionId: ${i}, global: ${s}): ${n.length/1024}kb. Consider to use 'storageUri' or 'globalStorageUri' to store this data on disk instead.`),n}setExtensionState(e,s,i){const n=this.r(e);s===void 0?this.j.remove(n,i?0:1):this.j.store(n,JSON.stringify(s),i?0:1,1)}setKeysForSync(e,s){this.j.store(As.b(e),JSON.stringify(s),0,1)}getKeysForSync(e){const s=this.m.extensionSyncedKeys?.[e.id.toLowerCase()],i=this.j.get(As.b(e),0),n=i?JSON.parse(i):void 0;return n&&s?Dt([...n,...s]):n||s}addToMigrationList(e,s){if(e!==s){const i=this.s.filter(n=>!n.includes(e)&&!n.includes(s));i.push([e,s]),this.s=i}}getSourceExtensionToMigrate(e){const s=this.s.find(([,i])=>e===i);return s?s[0]:void 0}get s(){const e=this.j.get("extensionStorage.migrationList",-1,"[]");try{const s=JSON.parse(e);if(Array.isArray(s))return s}catch{}return[]}set s(e){e.length?this.j.store("extensionStorage.migrationList",JSON.stringify(e),-1,1):this.j.remove("extensionStorage.migrationList",-1)}};jr=As=__decorate([__param(0,re),__param(1,ge),__param(2,Q)],jr);var Ia=W("IIgnoredExtensionsManagementService"),ru=class{constructor(e){this.a=e}hasToNeverSyncExtension(e){return this.b().includes(e.toLowerCase())}hasToAlwaysSyncExtension(e){return this.b().includes(`-${e.toLowerCase()}`)}updateIgnoredExtensions(e,s){let i=[...this.a.getValue("settingsSync.ignoredExtensions")].map(n=>n.toLowerCase());return i=i.filter(n=>n!==e&&n!==`-${e}`),s&&i.push(e.toLowerCase()),this.a.updateValue("settingsSync.ignoredExtensions",i.length?i:void 0,2)}updateSynchronizedExtensions(e,s){let i=[...this.a.getValue("settingsSync.ignoredExtensions")].map(n=>n.toLowerCase());return i=i.filter(n=>n!==e&&n!==`-${e}`),s&&i.push(`-${e.toLowerCase()}`),this.a.updateValue("settingsSync.ignoredExtensions",i.length?i:void 0,2)}getIgnoredExtensions(e){const s=e.filter(o=>o.isMachineScoped).map(o=>o.identifier.id.toLowerCase()),i=this.b().map(o=>o.toLowerCase()),n=[],r=[];if(Array.isArray(i))for(const o of i)o.startsWith("-")?r.push(o.substring(1)):n.push(o);return Dt([...s,...n].filter(o=>!r.includes(o)))}b(){return(this.a.getValue("settingsSync.ignoredExtensions")||[]).map(e=>e.toLowerCase())}};ru=__decorate([__param(0,me)],ru);function ou(){const t=At.as(rs.Configuration).getConfigurationProperties();return Object.keys(t).filter(e=>!!t[e].disallowSyncIgnore)}function o6(t=!1){const e=At.as(rs.Configuration).getConfigurationProperties(),s=cm(e,t),i=ou();return Dt([...s,...i])}function am(t){if(!t.contributes?.configuration)return[];const e=Array.isArray(t.contributes.configuration)?t.contributes.configuration:[t.contributes.configuration];if(!e.length)return[];const s=$p(e);return cm(s,!1)}function cm(t,e){const s=new Set;for(const i in t){if(e&&t[i].source)continue;const n=de(t[i].scope)?E2(t[i].scope):t[i].scope;(t[i].ignoreSync||n===2||n===7)&&s.add(i)}return[...s.values()]}var Aa="settingsSync",au="settingsSync.keybindingsPerPlatform";function a6(){const t="vscode://schemas/ignoredSettings",e=At.as(rs.Configuration);e.registerConfiguration({id:"settingsSync",order:30,title:w(2726,null),type:"object",properties:{[au]:{type:"boolean",description:w(2727,null),default:!0,scope:1,tags:["sync","usesOnlineServices"]},"settingsSync.ignoredExtensions":{type:"array",markdownDescription:w(2728,null),items:[{type:"string",pattern:xp,errorMessage:w(2729,null)}],default:[],scope:1,uniqueItems:!0,disallowSyncIgnore:!0,tags:["sync","usesOnlineServices"]},"settingsSync.ignoredSettings":{type:"array",description:w(2730,null),default:[],scope:1,$ref:t,additionalProperties:!0,uniqueItems:!0,disallowSyncIgnore:!0,tags:["sync","usesOnlineServices"]}}});const s=At.as($l.JSONContribution),i=()=>{const n=ou(),r=o6(),o=Object.keys(vr.properties).filter(l=>!r.includes(l)),a=r.filter(l=>!n.includes(l)),c={items:{type:"string",enum:[...o,...a.map(l=>`-${l}`)]}};s.registerSchema(t,c)};return e.onDidUpdateConfiguration(()=>i())}var c6="0",lm;(function(t){t.Settings="settings",t.Keybindings="keybindings",t.Snippets="snippets",t.Prompts="prompts",t.Tasks="tasks",t.Mcp="mcp",t.Extensions="extensions",t.GlobalState="globalState",t.Profiles="profiles",t.WorkspaceState="workspaceState"})(lm||(lm={}));var Mn=["settings","keybindings","snippets","prompts","tasks","extensions","globalState","profiles","mcp"];function hm(t,...e){return t?[t,...e]:e}function um(t,e,s,i){return i.joinPath(s.userDataSyncHome,...hm(t,e,`lastSync${e}.json`))}function l6(t){return t&&de(t.session)&&de(t.ref)&&(Te(t.latest)||t.latest===void 0)&&(Te(t.collections)||t.collections===void 0)}var ui=W("IUserDataSyncStoreManagementService"),rt=W("IUserDataSyncStoreService"),kt=W("IUserDataSyncLocalStoreService"),Ls="x-operation-id",fm="X-Execution-Id";function Un(t){const e={};return e[fm]=t,e}var dm;(function(t){t.Unauthorized="Unauthorized",t.Forbidden="Forbidden",t.NotFound="NotFound",t.MethodNotFound="MethodNotFound",t.Conflict="Conflict",t.Gone="Gone",t.PreconditionFailed="PreconditionFailed",t.TooLarge="TooLarge",t.UpgradeRequired="UpgradeRequired",t.PreconditionRequired="PreconditionRequired",t.TooManyRequests="RemoteTooManyRequests",t.TooManyRequestsAndRetryAfter="TooManyRequestsAndRetryAfter",t.RequestFailed="RequestFailed",t.RequestCanceled="RequestCanceled",t.RequestTimeout="RequestTimeout",t.RequestProtocolNotSupported="RequestProtocolNotSupported",t.RequestPathNotEscaped="RequestPathNotEscaped",t.RequestHeadersNotObject="RequestHeadersNotObject",t.NoCollection="NoCollection",t.NoRef="NoRef",t.EmptyResponse="EmptyResponse",t.TurnedOff="TurnedOff",t.SessionExpired="SessionExpired",t.ServiceChanged="ServiceChanged",t.DefaultServiceChanged="DefaultServiceChanged",t.LocalTooManyProfiles="LocalTooManyProfiles",t.LocalTooManyRequests="LocalTooManyRequests",t.LocalPreconditionFailed="LocalPreconditionFailed",t.LocalInvalidContent="LocalInvalidContent",t.LocalError="LocalError",t.IncompatibleLocalContent="IncompatibleLocalContent",t.IncompatibleRemoteContent="IncompatibleRemoteContent",t.Unknown="Unknown"})(dm||(dm={}));var Ce=class extends Error{constructor(t,e,s,i){super(t),this.code=e,this.resource=s,this.operationId=i,this.name=`${this.code} (UserDataSyncError) syncResource:${this.resource||"unknown"} operationId:${this.operationId||"unknown"}`}},Ie=class extends Ce{constructor(t,e,s,i,n){super(t,s,void 0,n),this.url=e,this.serverCode=i}},fi=class extends Ce{constructor(t,e){super(t,e)}};(function(t){function e(s){if(s instanceof t)return s;const i=/^(.+) \(UserDataSyncError\) syncResource:(.+) operationId:(.+)$/.exec(s.name);if(i&&i[1]){const n=i[2]==="unknown"?void 0:i[2],r=i[3]==="unknown"?void 0:i[3];return new t(s.message,i[1],n,r)}return new t(s.message,"Unknown")}t.toUserDataSyncError=e})(Ce||(Ce={}));var pm;(function(t){t.Uninitialized="uninitialized",t.Idle="idle",t.Syncing="syncing",t.HasConflicts="hasConflicts"})(pm||(pm={}));var gm;(function(t){t[t.None=0]="None",t[t.Added=1]="Added",t[t.Modified=2]="Modified",t[t.Deleted=3]="Deleted"})(gm||(gm={}));var mm;(function(t){t.Preview="preview",t.Conflict="conflict",t.Accepted="accepted"})(mm||(mm={}));var di="sync.store.url.type";function Mr(t){return`sync.enable.${t}`}var mt=W("IUserDataSyncEnablementService"),La=W("IUserDataSyncService"),cu=W("IUserDataSyncResourceProviderService"),tx=W("IUserDataAutoSyncService"),Oa=W("IUserDataSyncUtilService"),Re=W("IUserDataSyncLogService"),vm="userDataSync",I="vscode-userdata-sync",h6="preview",Na=W("IUserDataSyncAccountService"),lu=class extends j{get account(){return this.a}constructor(e,s){super(),this.g=e,this.h=s,this.b=this.D(new R),this.onDidChangeAccount=this.b.event,this.c=this.D(new R),this.onTokenFailed=this.c.event,this.f=!1,this.D(e.onTokenFailed(i=>{this.h.info("Settings Sync auth token failed",this.account?.authenticationProviderId,this.f,i),this.updateAccount(void 0),i==="Forbidden"?this.c.fire(!0):this.c.fire(this.f),this.f=!0})),this.D(e.onTokenSucceed(()=>this.f=!1))}async updateAccount(e){(e&&this.a?e.token!==this.a.token||e.authenticationProviderId!==this.a.authenticationProviderId:e!==this.a)&&(this.a=e,this.a&&this.g.setAuthToken(this.a.token,this.a.authenticationProviderId),this.b.fire(e))}};lu=__decorate([__param(0,rt),__param(1,Re)],lu);var u6=60,f6=u6*60,hu=f6*24,ix=hu*7,nx=hu*30,rx=hu*365;function uu(t){return t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0")+"T"+String(t.getHours()).padStart(2,"0")+":"+String(t.getMinutes()).padStart(2,"0")+":"+String(t.getSeconds()).padStart(2,"0")+"."+(t.getMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}var fu=class extends j{constructor(e,s,i,n,r){super(),this.a=e,this.b=s,this.c=i,this.f=n,this.g=r,this.h()}async h(){for(const s of this.g.profiles)for(const i of Mn)try{await this.m(this.j(i,s.isDefault?void 0:s.id))}catch(n){this.f.error(n)}let e;try{e=await this.b.resolve(this.a.userDataSyncHome)}catch(s){Ue(s)!==1&&this.f.error(s);return}if(e.children){for(const s of e.children)if(s.isDirectory&&!Mn.includes(s.name)&&!this.g.profiles.some(i=>i.id===s.name))try{this.f.info("Deleting non existing profile from backup",s.resource.path),await this.b.del(s.resource,{recursive:!0})}catch(i){this.f.error(i)}}}async getAllResourceRefs(e,s,i){const n=this.j(e,s,i);try{const r=await this.b.resolve(n);if(r.children)return r.children.filter(a=>a.isFile&&!a.name.startsWith("lastSync")).sort().reverse().map(a=>({ref:a.name,created:this.n(a)}))}catch(r){if(Ue(r)!==1)throw r}return[]}async resolveResourceContent(e,s,i,n){const r=this.j(e,i,n),o=V(r,s);try{return(await this.b.readFile(o)).value.toString()}catch(a){return this.f.error(a),null}}async writeResource(e,s,i,n,r){const o=this.j(e,n,r),a=V(o,`${uu(i).replace(/-|:|\.\d+Z$/g,"")}.json`);try{await this.b.writeFile(a,L.fromString(s))}catch(c){this.f.error(c)}}j(e,s,i=this.a.userDataSyncHome){return V(i,...s?[s,e]:[e])}async m(e){try{try{if(!await this.b.exists(e))return}catch{return}const s=await this.b.resolve(e);if(s.children){const i=s.children.filter(a=>a.isFile&&/^\d{8}T\d{6}(\.json)?$/.test(a.name)).sort(),n=1e3*60*60*24*(this.c.getValue("sync.localBackupDuration")||30);let r=i.filter(a=>Date.now()-this.n(a)>n);const o=i.length-r.length;o<10&&(r=r.slice(10-o)),await Xe.settled(r.map(async a=>{this.f.info("Deleting from backup",a.resource.path),await this.b.del(a.resource)}))}}catch(s){this.f.error(s)}}n(e){return new Date(parseInt(e.name.substring(0,4)),parseInt(e.name.substring(4,6))-1,parseInt(e.name.substring(6,8)),parseInt(e.name.substring(9,11)),parseInt(e.name.substring(11,13)),parseInt(e.name.substring(13,15))).getTime()}};fu=__decorate([__param(0,ae),__param(1,K),__param(2,me),__param(3,Re),__param(4,Ne)],fu);var du=Object.freeze({text:"text/plain",binary:"application/octet-stream",unknown:"application/unknown",markdown:"text/markdown",latex:"text/latex",uriList:"text/uri-list",html:"text/html"}),wm="configurationSync.store",pu="sync.previous.store",gu="sync.donot-make-requests-until",Ta="sync.user-session-id",mu="sync.machine-session-id",d6=100,p6=1e3*60*5,ja=class extends j{get userDataSyncStore(){return this.b}get c(){return this.h.get(di,-1)}set c(e){this.h.store(di,e,-1,at?0:1)}constructor(e,s,i){super(),this.f=e,this.g=s,this.h=i,this.a=this.D(new R),this.onDidChangeUserDataSyncStore=this.a.event,this.j();const n=this.D(new Pe);this.D(O.filter(i.onDidChangeValue(-1,di,n),()=>this.c!==this.userDataSyncStore?.type,n)(()=>this.j()))}j(){this.b=this.m(this.f[wm]),this.a.fire()}m(e){if(e&&(e=at&&e.web?{...e,...e.web}:e,de(e.url)&&Te(e.authenticationProviders)&&Object.keys(e.authenticationProviders).every(s=>Array.isArray(e.authenticationProviders[s].scopes)))){const s=e,i=!!s.canSwitch,n=s.url===s.insidersUrl?"insiders":"stable",r=(i?this.c:void 0)||n,o=r==="insiders"?s.insidersUrl:r==="stable"?s.stableUrl:s.url;return{url:k.parse(o),type:r,defaultType:n,defaultUrl:k.parse(s.url),stableUrl:k.parse(s.stableUrl),insidersUrl:k.parse(s.insidersUrl),canSwitch:i,authenticationProviders:Object.keys(s.authenticationProviders).reduce((a,c)=>(a.push({id:c,scopes:s.authenticationProviders[c].scopes}),a),[])}}}};ja=__decorate([__param(0,ge),__param(1,me),__param(2,re)],ja);var vu=class extends ja{constructor(e,s,i){super(e,s,i);const n=this.h.get(pu,-1);n&&(this.n=JSON.parse(n));const r=this.f[wm];r?this.h.store(pu,JSON.stringify(r),-1,1):this.h.remove(pu,-1)}async switch(e){e!==this.c&&(this.c=e,this.j())}async getPreviousUserDataSyncStore(){return this.m(this.n)}};vu=__decorate([__param(0,ge),__param(1,me),__param(2,re)],vu);var wu=class extends j{get donotMakeRequestsUntil(){return this.j}constructor(e,s,i,n,r,o,a){super(),this.n=i,this.q=n,this.r=a,this.g=this.D(new R),this.onTokenFailed=this.g.event,this.h=this.D(new R),this.onTokenSucceed=this.h.event,this.j=void 0,this.m=this.D(new R),this.onDidChangeDonotMakeRequestsUntil=this.m.event,this.u=void 0,this.s(e),this.c=On(r,o,a).then(c=>{const l={"X-Client-Name":`${s.applicationName}${at?"-web":""}`,"X-Client-Version":s.version};return s.commit&&(l["X-Client-Commit"]=s.commit),l}),this.f=new g6(d6,p6,this.n,this.q),this.t(),this.D(pe(()=>{this.u&&(this.u.cancel(),this.u=void 0)}))}setAuthToken(e,s){this.b={token:e,type:s}}s(e){this.a=e?V(e,"v1"):void 0}t(){const e=this.r.getNumber(gu,-1);e&&Date.now()<e&&this.w(new Date(e))}w(e){this.j?.getTime()!==e?.getTime()&&(this.j=e,this.u&&(this.u.cancel(),this.u=void 0),this.j?(this.r.store(gu,this.j.getTime(),-1,1),this.u=yt(s=>Oi(this.j.getTime()-Date.now(),s).then(()=>this.w(void 0))),this.u.then(null,s=>null)):this.r.remove(gu,-1),this.m.fire())}async getAllCollections(e={}){if(!this.a)throw new Error("No settings sync store url configured.");const s=V(this.a,"collection").toString();e={...e},e["Content-Type"]="application/json";const i=await this.C(s,{type:"GET",headers:e},[],Z.None);return(await Js(i))?.map(({id:n})=>n)||[]}async createCollection(e={}){if(!this.a)throw new Error("No settings sync store url configured.");const s=V(this.a,"collection").toString();e={...e},e["Content-Type"]=du.text;const i=await this.C(s,{type:"POST",headers:e},[],Z.None),n=await Cs(i);if(!n)throw new Ie("Server did not return the collection id",s,"NoCollection",i.res.statusCode,i.res.headers[Ls]);return n}async deleteCollection(e,s={}){if(!this.a)throw new Error("No settings sync store url configured.");const i=e?V(this.a,"collection",e).toString():V(this.a,"collection").toString();s={...s},await this.C(i,{type:"DELETE",headers:s},[],Z.None)}async getAllResourceRefs(e,s){if(!this.a)throw new Error("No settings sync store url configured.");const i=this.y(this.a,s,e),n={},r=await this.C(i.toString(),{type:"GET",headers:n},[],Z.None);return(await Js(r)||[]).map(({url:a,created:c})=>({ref:x4(i,i.with({path:a})),created:c*1e3}))}async resolveResourceContent(e,s,i,n={}){if(!this.a)throw new Error("No settings sync store url configured.");const r=V(this.y(this.a,i,e),s).toString();n={...n},n["Cache-Control"]="no-cache";const o=await this.C(r,{type:"GET",headers:n},[],Z.None);return await Cs(o)}async deleteResource(e,s,i){if(!this.a)throw new Error("No settings sync store url configured.");const n=s!==null?V(this.y(this.a,i,e),s).toString():this.y(this.a,i,e).toString(),r={};await this.C(n,{type:"DELETE",headers:r},[],Z.None)}async deleteResources(){if(!this.a)throw new Error("No settings sync store url configured.");const e=V(this.a,"resource").toString(),s={"Content-Type":du.text};await this.C(e,{type:"DELETE",headers:s},[],Z.None)}async readResource(e,s,i,n={}){if(!this.a)throw new Error("No settings sync store url configured.");const r=V(this.y(this.a,i,e),"latest").toString();n={...n},n["Cache-Control"]="no-cache",s&&(n["If-None-Match"]=s.ref);const o=await this.C(r,{type:"GET",headers:n},[304],Z.None);let a=null;if(o.res.statusCode===304&&(a=s),a===null){const c=o.res.headers.etag;if(!c)throw new Ie("Server did not return the ref",r,"NoRef",o.res.statusCode,o.res.headers[Ls]);const l=await Cs(o);if(!l&&o.res.statusCode===304)throw new Ie("Empty response",r,"EmptyResponse",o.res.statusCode,o.res.headers[Ls]);a={ref:c,content:l}}return a}async writeResource(e,s,i,n,r={}){if(!this.a)throw new Error("No settings sync store url configured.");const o=this.y(this.a,n,e).toString();r={...r},r["Content-Type"]=du.text,i&&(r["If-Match"]=i);const a=await this.C(o,{type:"POST",data:s,headers:r},[],Z.None),c=a.res.headers.etag;if(!c)throw new Ie("Server did not return the ref",o,"NoRef",a.res.statusCode,a.res.headers[Ls]);return c}async manifest(e,s={}){if(!this.a)throw new Error("No settings sync store url configured.");const i=V(this.a,"manifest").toString();s={...s},s["Content-Type"]="application/json",e&&(s["If-None-Match"]=e.ref);const n=await this.C(i,{type:"GET",headers:s},[304],Z.None);let r=null;if(n.res.statusCode===304&&(r=e),!r){const a=n.res.headers.etag;if(!a)throw new Ie("Server did not return the ref",i,"NoRef",n.res.statusCode,n.res.headers[Ls]);const c=await Cs(n);if(!c&&n.res.statusCode===304)throw new Ie("Empty response",i,"EmptyResponse",n.res.statusCode,n.res.headers[Ls]);c&&(r={...JSON.parse(c),ref:a})}const o=this.r.get(Ta,-1);return o&&r&&o!==r.session&&this.z(),r===null&&o&&this.z(),r&&this.r.store(Ta,r.session,-1,1),r}async clear(){if(!this.a)throw new Error("No settings sync store url configured.");await this.deleteCollection(),await this.deleteResources(),this.z()}async getLatestData(e={}){if(!this.a)throw new Error("No settings sync store url configured.");const s=V(this.a,"download","latest").toString();e={...e},e["Content-Type"]="application/json";const i=await this.C(s,{type:"GET",headers:e},[],Z.None);if(!An(i))throw new Ie("Server returned "+i.res.statusCode,s,"EmptyResponse",i.res.statusCode,i.res.headers[Ls]);const n=await Js(i);if(!n)return null;const r={};if(n.resources){r.resources={};for(const o in n.resources){const[a]=n.resources[o];r.resources[o]={content:a.content,ref:a.ref}}}if(n.collections){r.collections={};for(const o in n.collections){const a={};r.collections[o]={resources:a};for(const c in n.collections[o].resources){const[l]=n.collections[o].resources[c];a[c]={content:l.content,ref:l.ref}}}}return r}async getActivityData(){if(!this.a)throw new Error("No settings sync store url configured.");const e=V(this.a,"download").toString(),s={},i=await this.C(e,{type:"GET",headers:s},[],Z.None);if(!An(i))throw new Ie("Server returned "+i.res.statusCode,e,"EmptyResponse",i.res.statusCode,i.res.headers[Ls]);if(sh(i))throw new Ie("Empty response",e,"EmptyResponse",i.res.statusCode,i.res.headers[Ls]);return i.stream}y(e,s,i){return s?V(e,"collection",s,"resource",i):V(e,"resource",i)}z(){this.r.remove(Ta,-1),this.r.remove(mu,-1)}async C(e,s,i,n){if(!this.b)throw new Ie("No Auth Token Available",e,"Unauthorized",void 0,void 0);if(this.j&&Date.now()<this.j.getTime())throw new Ie(`${s.type} request '${e}' failed because of too many requests (429).`,e,"TooManyRequestsAndRetryAfter",void 0,void 0);this.w(void 0);const r=await this.c;s.headers={...s.headers||{},...r,"X-Account-Type":this.b.type,authorization:`Bearer ${this.b.token}`},this.F(s.headers),this.q.trace("Sending request to server",{url:e,type:s.type,headers:{...s.headers,authorization:void 0}});let o;try{o=await this.f.request(e,s,n)}catch(u){if(!(u instanceof Ie)){let f="RequestFailed";const p=se(u).toLowerCase();p.includes("xhr timeout")?f="RequestTimeout":p.includes("protocol")&&p.includes("not supported")?f="RequestProtocolNotSupported":p.includes("request path contains unescaped characters")?f="RequestPathNotEscaped":p.includes("headers must be an object")?f="RequestHeadersNotObject":Ms(u)&&(f="RequestCanceled"),u=new Ie(`Connection refused for the request '${e}'.`,e,f,void 0,void 0)}throw this.q.info("Request failed",e),u}const a=o.res.headers[Ls],c={url:e,status:o.res.statusCode,"execution-id":s.headers[fm],"operation-id":a},l=An(o)||o.res.statusCode&&i.includes(o.res.statusCode);let h="";if(l?this.q.trace("Request succeeded",c):(h=await ih(o)||"",this.q.info("Request failed",c,h)),o.res.statusCode===401||o.res.statusCode===403){if(this.b=void 0,o.res.statusCode===401)throw this.g.fire("Unauthorized"),new Ie(`${s.type} request '${e}' failed because of Unauthorized (401).`,e,"Unauthorized",o.res.statusCode,a);if(o.res.statusCode===403)throw this.g.fire("Forbidden"),new Ie(`${s.type} request '${e}' failed because the access is forbidden (403).`,e,"Forbidden",o.res.statusCode,a)}if(this.h.fire(),o.res.statusCode===404)throw new Ie(`${s.type} request '${e}' failed because the requested resource is not found (404).`,e,"NotFound",o.res.statusCode,a);if(o.res.statusCode===405)throw new Ie(`${s.type} request '${e}' failed because the requested endpoint is not found (405). ${h}`,e,"MethodNotFound",o.res.statusCode,a);if(o.res.statusCode===409)throw new Ie(`${s.type} request '${e}' failed because of Conflict (409). There is new data for this resource. Make the request again with latest data.`,e,"Conflict",o.res.statusCode,a);if(o.res.statusCode===410)throw new Ie(`${s.type} request '${e}' failed because the requested resource is not longer available (410).`,e,"Gone",o.res.statusCode,a);if(o.res.statusCode===412)throw new Ie(`${s.type} request '${e}' failed because of Precondition Failed (412). There is new data for this resource. Make the request again with latest data.`,e,"PreconditionFailed",o.res.statusCode,a);if(o.res.statusCode===413)throw new Ie(`${s.type} request '${e}' failed because of too large payload (413).`,e,"TooLarge",o.res.statusCode,a);if(o.res.statusCode===426)throw new Ie(`${s.type} request '${e}' failed with status Upgrade Required (426). Please upgrade the client and try again.`,e,"UpgradeRequired",o.res.statusCode,a);if(o.res.statusCode===429){const u=o.res.headers["retry-after"];throw u?(this.w(new Date(Date.now()+parseInt(u)*1e3)),new Ie(`${s.type} request '${e}' failed because of too many requests (429).`,e,"TooManyRequestsAndRetryAfter",o.res.statusCode,a)):new Ie(`${s.type} request '${e}' failed because of too many requests (429).`,e,"RemoteTooManyRequests",o.res.statusCode,a)}if(!l)throw new Ie("Server returned "+o.res.statusCode,e,"Unknown",o.res.statusCode,a);return o}F(e){let s=this.r.get(mu,-1);s===void 0&&(s=tt(),this.r.store(mu,s,-1,1)),e["X-Machine-Session-Id"]=s;const i=this.r.get(Ta,-1);i!==void 0&&(e["X-User-Session-Id"]=i)}};wu=__decorate([__param(1,ge),__param(2,li),__param(3,Re),__param(4,ae),__param(5,K),__param(6,re)],wu);var yu=class extends wu{constructor(e,s,i,n,r,o,a){super(e.userDataSyncStore?.url,s,i,n,r,o,a),this.D(e.onDidChangeUserDataSyncStore(()=>this.s(e.userDataSyncStore?.url)))}};yu=__decorate([__param(0,ui),__param(1,ge),__param(2,li),__param(3,Re),__param(4,ae),__param(5,K),__param(6,re)],yu);var g6=class{constructor(t,e,s,i){this.c=t,this.d=e,this.f=s,this.g=i,this.a=[],this.b=void 0}request(t,e,s){if(this.h()&&this.i(),e.url=t,this.a.length>=this.c)throw this.g.info("Too many requests",...this.a),new Ie(`Too many requests. Only ${this.c} requests allowed in ${this.d/(1e3*60)} minutes.`,t,"LocalTooManyRequests",void 0,void 0);return this.b=this.b||new Date,this.a.push(t),this.f.request(e,s)}h(){return this.b!==void 0&&new Date().getTime()-this.b.getTime()>this.d}i(){this.a=[],this.b=void 0}},m6=class{constructor(t){this.a=t}listen(t,e){switch(e){case"onDidChangeAccount":return this.a.onDidChangeAccount;case"onTokenFailed":return this.a.onTokenFailed}throw new Error(`[UserDataSyncAccountServiceChannel] Event not found: ${e}`)}call(t,e,s){switch(e){case"_getInitialData":return Promise.resolve(this.a.account);case"updateAccount":return this.a.updateAccount(s)}throw new Error("Invalid call")}},v6=class{constructor(t){this.a=t}listen(t,e){switch(e){case"onDidChangeUserDataSyncStore":return this.a.onDidChangeUserDataSyncStore}throw new Error(`[UserDataSyncStoreManagementServiceChannel] Event not found: ${e}`)}call(t,e,s){switch(e){case"switch":return this.a.switch(s[0]);case"getPreviousUserDataSyncStore":return this.a.getPreviousUserDataSyncStore()}throw new Error("Invalid call")}},ym=class extends ja{constructor(e,s,i,n){super(s,i,n),this.n=e,this.D(this.n.listen("onDidChangeUserDataSyncStore")(()=>this.j()))}async switch(e){return this.n.call("switch",[e])}async getPreviousUserDataSyncStore(){const e=await this.n.call("getPreviousUserDataSyncStore");return this.q(e)}q(e){return{url:k.revive(e.url),type:e.type,defaultUrl:k.revive(e.defaultUrl),insidersUrl:k.revive(e.insidersUrl),stableUrl:k.revive(e.stableUrl),canSwitch:e.canSwitch,authenticationProviders:e.authenticationProviders}}};ym=__decorate([__param(1,ge),__param(2,me),__param(3,re)],ym);var bu=class extends mr{constructor(e,s){super(),this.h=this.D(e.createLogger(V(s.logsHome,`${vm}.log`),{id:vm,name:w(2731,null)}))}trace(e,...s){this.h.trace(e,...s)}debug(e,...s){this.h.debug(e,...s)}info(e,...s){this.h.info(e,...s)}warn(e,...s){this.h.warn(e,...s)}error(e,...s){this.h.error(e,...s)}flush(){this.h.flush()}};bu=__decorate([__param(0,gr),__param(1,ae)],bu);var Ji,Ma=W("IUserDataSyncMachinesService"),Su="sync.currentMachineName",w6="Safari",y6="Chrome",b6="Edge",S6="Firefox",E6="Android";function bm(){return Qd?w6:zc?y6:Xd?b6:Kd?S6:$y?E6:Wd(at?0:sr)}var Eu=class extends j{static{Ji=this}static{this.a=1}static{this.b="machines"}constructor(e,s,i,n,r,o){super(),this.h=i,this.j=n,this.m=r,this.n=o,this.c=this.D(new R),this.onDidChange=this.c.event,this.g=null,this.f=On(e,s,i)}async getMachines(e){const s=await this.f;return(await this.r(e)).machines.map(n=>({...n,isCurrent:n.id===s}))}async addCurrentMachine(e){const s=await this.f,i=await this.r(e);i.machines.some(({id:n})=>n===s)||(i.machines.push({id:s,name:this.q(i.machines),platform:bm()}),await this.s(i))}async removeCurrentMachine(e){const s=await this.f,i=await this.r(e),n=i.machines.filter(({id:r})=>r!==s);n.length!==i.machines.length&&(i.machines=n,await this.s(i))}async renameMachine(e,s,i){const n=await this.r(i),r=n.machines.find(({id:o})=>o===e);if(r){r.name=s,await this.s(n);const o=await this.f;e===o&&this.h.store(Su,s,-1,1)}}async setEnablements(e){const s=await this.r();for(const[i,n]of e){const r=s.machines.find(o=>o.id===i);r&&(r.disabled=n?void 0:!0)}await this.s(s)}q(e){const s=this.h.get(Su,-1);if(s){if(!e.some(o=>o.name===s))return s;this.h.remove(Su,-1)}const i=`${this.n.embedderIdentifier?`${this.n.embedderIdentifier} - `:""}${bm()} (${this.n.nameShort})`,n=new RegExp(`${Di(i)}\\s#(\\d+)`);let r=0;for(const o of e){const a=n.exec(o.name),c=a?parseInt(a[1]):0;r=c>r?c:r}return`${i} #${r+1}`}async r(e){this.g=await this.t(e);const s=this.u(this.g);if(s.version!==Ji.a)throw new Error(w(2732,null,this.n.nameLong));return s}async s(e){const s=JSON.stringify(e),i=await this.j.writeResource(Ji.b,s,this.g?.ref||null);this.g={ref:i,content:s},this.c.fire()}async t(e){if(this.g){const s=e&&e.latest?e.latest[Ji.b]:void 0;if(this.g.ref===s)return this.g;if(s===void 0&&this.g.content===null)return this.g}return this.j.readResource(Ji.b,this.g)}u(e){if(e.content!==null)try{return JSON.parse(e.content)}catch(s){this.m.error(s)}return{version:Ji.a,machines:[]}}};Eu=Ji=__decorate([__param(0,ae),__param(1,K),__param(2,re),__param(3,rt),__param(4,Re),__param(5,ge)],Eu);var $u="sync.enable",xu=class extends j{constructor(e,s,i){super(),this.c=e,this.f=s,this.g=i,this.a=new R,this.onDidChangeEnablement=this.a.event,this.b=new R,this.onDidChangeResourceEnablement=this.b.event,this.D(e.onDidChangeValue(-1,void 0,this.B)(n=>this.j(n)))}isEnabled(){switch(this.f.sync){case"on":return!0;case"off":return!1}return this.c.getBoolean($u,-1,!1)}canToggleEnablement(){return this.g.userDataSyncStore!==void 0&&this.f.sync===void 0}setEnablement(e){e&&!this.canToggleEnablement()||this.c.store($u,e,-1,1)}isResourceEnabled(e,s){const i=this.c.getBoolean(Mr(e),-1);return s=s??e!=="prompts",i??s}isResourceEnablementConfigured(e){return this.c.getBoolean(Mr(e),-1)!==void 0}setResourceEnablement(e,s){if(this.isResourceEnabled(e)!==s){const i=Mr(e);this.h(i,s)}}getResourceSyncStateVersion(e){}h(e,s){this.c.store(e,s,-1,at?0:1)}j(e){if($u===e.key){this.a.fire(this.isEnabled());return}const s=Mn.filter(i=>Mr(i)===e.key)[0];if(s){this.b.fire([s,this.isResourceEnabled(s)]);return}}};xu=__decorate([__param(0,re),__param(1,ae),__param(2,ui)],xu);function $6(t){return!!(t&&t.ref!==void 0&&typeof t.ref=="string"&&t.ref!==""&&t.syncData!==void 0&&(t.syncData===null||Ur(t.syncData)))}function Ur(t){return!!(t&&t.version!==void 0&&typeof t.version=="number"&&t.content!==void 0&&typeof t.content=="string"&&(Object.keys(t).length===2||Object.keys(t).length===3&&t.machineId!==void 0&&typeof t.machineId=="string"))}function Ua(t,e){return`${Jc(t)}${e.isDefault?"":` (${e.name})`}`}var Sm;(function(t){t.Preview="preview",t.Merge="merge",t.PullOrPush="pull-push"})(Sm||(Sm={}));var pi=class extends j{get status(){return this.m}get conflicts(){return{...this.syncResource,conflicts:this.q}}constructor(e,s,i,n,r,o,a,c,l,h,u,f){super(),this.syncResource=e,this.collection=s,this.G=i,this.H=n,this.I=r,this.J=o,this.L=a,this.M=c,this.N=l,this.O=h,this.P=u,this.c=null,this.m="idle",this.n=this.D(new R),this.onDidChangeStatus=this.n.event,this.q=[],this.s=this.D(new R),this.onDidChangeConflicts=this.s.event,this.t=this.D(new Li(50)),this.u=this.D(new R),this.onDidChangeLocal=this.u.event,this.z=!1,this.F={},this.y=`${s?`${s}.`:""}${e.syncResource}.lastSyncUserData`,this.resource=e.syncResource,this.C=Ua(e.syncResource,e.profile),this.h=f.extUri,this.f=this.h.joinPath(n.userDataSyncHome,...hm(e.profile.isDefault?void 0:e.profile.id,e.syncResource)),this.g=this.h.joinPath(this.f,h6),this.w=um(e.profile.isDefault?void 0:e.profile.id,e.syncResource,n,this.h),this.j=On(n,i,r)}Q(){this.t.trigger(()=>this.R())}async R(){if(this.status==="hasConflicts"){this.O.info(`${this.C}: In conflicts state and local change detected. Syncing again...`);const e=await this.c;this.c=null;const s=await this.X(e.remoteUserData,e.lastSyncUserData,"merge",this.nb());this.S(s)}else{this.O.trace(`${this.C}: Checking for local changes...`);const e=await this.getLastSyncUserData();(e?await this.tb(e):!0)&&this.u.fire()}}S(e){this.m!==e&&(this.m=e,this.n.fire(e))}async sync(e,s=!1,i=this.nb(),n={}){try{if(this.F={...n},this.status==="hasConflicts")return this.O.info(`${this.C}: Skipped synchronizing ${this.resource.toLowerCase()} as there are conflicts.`),this.c;if(this.status==="syncing")return this.O.info(`${this.C}: Skipped synchronizing ${this.resource.toLowerCase()} as it is running already.`),this.c;this.O.trace(`${this.C}: Started synchronizing ${this.resource.toLowerCase()}...`),this.S("syncing");let r="idle";try{const o=await this.getLastSyncUserData(),a=await this.W(e,o);return r=await this.X(a,o,s?"preview":"merge",i),r==="hasConflicts"?this.O.info(`${this.C}: Detected conflicts while synchronizing ${this.resource.toLowerCase()}.`):r==="idle"&&this.O.trace(`${this.C}: Finished synchronizing ${this.resource.toLowerCase()}.`),this.c||null}finally{this.S(r)}}finally{this.F={}}}async apply(e,s={}){try{this.F={...s};const i=await this.$(e);return this.S(i),this.c}finally{this.F={}}}async replace(e){const s=this.jb(e);if(!s)return!1;await this.stop();try{this.O.trace(`${this.C}: Started resetting ${this.resource.toLowerCase()}...`),this.S("syncing");const i=await this.getLastSyncUserData(),n=await this.W(null,i),r=await this.U(n),o=await this.pb({ref:n.ref,syncData:s},i,r,this.nb(),Z.None),a=[];for(const c of o){const l=await this.rb(c,c.remoteResource,void 0,Z.None),{remoteChange:h}=await this.rb(c,c.previewResource,c.remoteContent,Z.None);a.push([c,{...l,remoteChange:h!==0?h:2}])}await this.sb(n,i,a,!1),this.O.info(`${this.C}: Finished resetting ${this.resource.toLowerCase()}.`)}finally{this.S("idle")}return!0}async U(e){const s=await this.j;return!!e.syncData?.machineId&&e.syncData.machineId===s}async W(e,s){return e===null?{ref:c6,syncData:null}:de(e)?s?.ref===e?s:this.getRemoteUserData(s):this.ib(e)}async X(e,s,i,n){if(e.syncData&&e.syncData.version>this.ob)throw new Ce(w(2714,null,this.resource,this.ob,e.syncData.version),"IncompatibleLocalContent",this.resource);try{return await this.Y(e,s,i,n)}catch(r){if(r instanceof Ce)switch(r.code){case"LocalPreconditionFailed":return this.O.info(`${this.C}: Failed to synchronize ${this.C} as there is a new local version available. Synchronizing again...`),this.X(e,s,i,n);case"Conflict":case"PreconditionFailed":return this.O.info(`${this.C}: Failed to synchronize as there is a new remote version available. Synchronizing again...`),e=await this.getRemoteUserData(null),s=await this.getLastSyncUserData(),this.X(e,s,"merge",n)}throw r}}async Y(e,s,i,n){try{const r=await this.U(e),o=!r&&s===null&&this.fb()!==void 0,a=i==="preview"||i==="merge"&&!o,c=i==="merge"||i==="pull-push";this.c||(this.c=yt(h=>this.db(e,s,r,a,n,h)));let l=await this.c;if(i==="merge"&&o){this.O.info(`${this.C}: Accepting remote because it was synced before and the last sync data is not available.`);for(const h of l.resourcePreviews)l=await this.accept(h.remoteResource)||l}else if(i==="pull-push")for(const h of l.resourcePreviews)h.mergeState!=="accepted"&&(e.ref===s?.ref||r?l=await this.accept(h.localResource)??l:l=await this.accept(h.remoteResource)??l);return this.bb(l.resourcePreviews),l.resourcePreviews.some(({mergeState:h})=>h==="conflict")?"hasConflicts":c?await this.$(!1):"syncing"}catch(r){throw this.c=null,r}}async accept(e,s){return await this.Z(e,async i=>{const n=await this.rb(i,e,s,Z.None);return i.acceptResult=n,i.mergeState="accepted",i.localChange=n.localChange,i.remoteChange=n.remoteChange,i}),this.c}async discard(e){return await this.Z(e,async s=>{const i=await this.qb(s,Z.None);return await this.G.writeFile(s.previewResource,L.fromString(i.content||"")),s.acceptResult=void 0,s.mergeState="preview",s.localChange=i.localChange,s.remoteChange=i.remoteChange,s}),this.c}async Z(e,s){if(!this.c)return;let i=await this.c;const n=i.resourcePreviews.findIndex(({localResource:r,remoteResource:o,previewResource:a})=>this.h.isEqual(r,e)||this.h.isEqual(o,e)||this.h.isEqual(a,e));n!==-1&&(this.c=yt(async r=>{const o=[...i.resourcePreviews];return o[n]=await s(o[n]),{...i,resourcePreviews:o}}),i=await this.c,this.bb(i.resourcePreviews),i.resourcePreviews.some(({mergeState:r})=>r==="conflict")?this.S("hasConflicts"):this.S("syncing"))}async $(e){if(!this.c)return"idle";const s=await this.c;return s.resourcePreviews.some(({mergeState:i})=>i==="conflict")?"hasConflicts":s.resourcePreviews.some(({mergeState:i})=>i!=="accepted")?"syncing":(await this.sb(s.remoteUserData,s.lastSyncUserData,s.resourcePreviews.map(i=>[i,i.acceptResult]),e),this.c=null,await this.ab(),"idle")}async ab(){try{await this.G.del(this.g,{recursive:!0})}catch{}}bb(e){const s=e.filter(({mergeState:i})=>i==="conflict");jt(this.q,s,(i,n)=>this.h.isEqual(i.previewResource,n.previewResource))||(this.q=s,this.s.fire(this.conflicts))}async hasPreviouslySynced(){const e=await this.getLastSyncUserData();return!!e&&e.syncData!==null}async cb(e){const s=this.c?await this.c:null;if(s)for(const i of s.resourcePreviews){if(this.h.isEqual(i.acceptedResource,e))return i.acceptResult?i.acceptResult.content:null;if(this.h.isEqual(i.remoteResource,e))return i.remoteContent;if(this.h.isEqual(i.localResource,e))return i.localContent;if(this.h.isEqual(i.baseResource,e))return i.baseContent}return null}async resetLocal(){this.I.remove(this.y,-1);try{await this.G.del(this.w)}catch(e){Ue(e)!==1&&this.O.error(e)}}async db(e,s,i,n,r,o){const a=await this.pb(e,s,i,r,o),c=[];for(const l of a){const h=l.previewResource.with({scheme:I,authority:"accepted"});if(l.localChange===0&&l.remoteChange===0)c.push({...l,acceptedResource:h,acceptResult:{content:null,localChange:0,remoteChange:0},mergeState:"accepted"});else{const u=n?await this.qb(l,o):void 0;if(o.isCancellationRequested)break;await this.G.writeFile(l.previewResource,L.fromString(u?.content||""));const f=u&&!u.hasConflicts?await this.rb(l,l.previewResource,void 0,o):void 0;c.push({...l,acceptResult:f,mergeState:u?.hasConflicts?"conflict":f?"accepted":"preview",localChange:f?f.localChange:u?u.localChange:l.localChange,remoteChange:f?f.remoteChange:u?u.remoteChange:l.remoteChange})}}return{syncResource:this.resource,profile:this.syncResource.profile,remoteUserData:e,lastSyncUserData:s,resourcePreviews:c,isLastSyncFromCurrentMachine:i}}async getLastSyncUserData(){const e=this.fb();if(!e)return this.O.info(`${this.C}: Last sync data state does not exist.`),null;const s=JSON.parse(e),i=this.M.getResourceSyncStateVersion(this.resource);if(this.z=!!s.version&&!!i&&s.version!==i,this.z)return this.O.info(`${this.C}: Reset last sync state because last sync state version ${s.version} is not compatible with current sync state version ${i}.`),await this.resetLocal(),null;let n,r=1;for(;n===void 0&&r++<6;)try{const o=await this.gb();o&&(o.ref===s.ref?n=o.syncData:this.O.info(`${this.C}: Last sync data stored locally is not same as the last sync state.`));break}catch(o){if(o instanceof Ye&&o.fileOperationResult===1){this.O.info(`${this.C}: Last sync resource does not exist locally.`);break}else{if(o instanceof Ce)throw o;this.O.error(o,r)}}if(n===void 0)try{const o=await this.J.resolveResourceContent(this.resource,s.ref,this.collection,this.F);n=o===null?null:this.jb(o),await this.hb({ref:s.ref,syncData:n})}catch(o){if(o instanceof Ce&&o.code==="NotFound")this.O.info(`${this.C}: Last sync resource does not exist remotely.`);else throw o}return n===void 0?null:{...s,syncData:n}}async eb(e,s={}){if(s.ref||s.version)throw new Error("Cannot have core properties as additional");const i=this.M.getResourceSyncStateVersion(this.resource),n={ref:e.ref,version:i,...s};this.I.store(this.y,JSON.stringify(n),-1,1),await this.hb(e)}fb(){return this.I.get(this.y,-1)}async gb(){const e=(await this.G.readFile(this.w)).value.toString();try{const s=e?JSON.parse(e):void 0;if($6(s))return s}catch(s){this.O.error(s)}}async hb(e){await this.G.writeFile(this.w,L.fromString(JSON.stringify(e)))}async getRemoteUserData(e){const s=await this.kb(e);return this.ib(s)}ib({ref:e,content:s}){let i=null;return s!==null&&(i=this.jb(s)),{ref:e,syncData:i}}jb(e){try{const s=JSON.parse(e);if(Ur(s))return s}catch(s){this.O.error(s)}throw new Ce(w(2715,null),"IncompatibleRemoteContent",this.resource)}async kb(e){const s=e?{ref:e.ref,content:e.syncData?JSON.stringify(e.syncData):null}:null;return this.J.readResource(this.resource,s,this.collection,this.F)}async lb(e,s){const i=await this.j,n={version:this.ob,machineId:i,content:e};try{return s=await this.J.writeResource(this.resource,JSON.stringify(n),s,this.collection,this.F),{ref:s,syncData:n}}catch(r){throw r instanceof Ce&&r.code==="TooLarge"&&(r=new Ce(r.message,r.code,this.resource)),r}}async mb(e){const s={version:this.ob,content:e};return this.L.writeResource(this.resource,JSON.stringify(s),new Date,this.syncResource.profile.isDefault?void 0:this.syncResource.profile.id)}async stop(){this.status!=="idle"&&(this.O.trace(`${this.C}: Stopping synchronizing ${this.resource.toLowerCase()}.`),this.c&&(this.c.cancel(),this.c=null),this.bb([]),await this.ab(),this.S("idle"),this.O.info(`${this.C}: Stopped synchronizing ${this.resource.toLowerCase()}.`))}nb(){return this.P.getValue(Aa)}};pi=__decorate([__param(2,K),__param(3,ae),__param(4,re),__param(5,rt),__param(6,kt),__param(7,mt),__param(8,ke),__param(9,Re),__param(10,me),__param(11,he)],pi);var Fa=class extends pi{constructor(e,s,i,n,r,o,a,c,l,h,u,f,p){super(s,i,n,r,o,a,c,l,h,u,f,p),this.r=e,this.D(this.G.watch(this.h.dirname(e))),this.D(this.G.onDidFilesChange(g=>this.xb(g)))}async ub(){try{return await this.G.readFile(this.r)}catch{return null}}async vb(e,s,i){try{s?await this.G.writeFile(this.r,L.fromString(e),i?void 0:s):await this.G.createFile(this.r,L.fromString(e),{overwrite:i})}catch(n){throw n instanceof Ye&&n.fileOperationResult===1||n instanceof Ye&&n.fileOperationResult===3?new Ce(n.message,"LocalPreconditionFailed"):n}}async wb(){try{await this.G.del(this.r)}catch(e){if(!(e instanceof Ye&&e.fileOperationResult===1))throw e}}xb(e){e.contains(this.r)&&this.Q()}};Fa=__decorate([__param(3,K),__param(4,ae),__param(5,re),__param(6,rt),__param(7,kt),__param(8,mt),__param(9,ke),__param(10,Re),__param(11,me),__param(12,he)],Fa);var qa=class extends Fa{constructor(e,s,i,n,r,o,a,c,l,h,u,f,p,g){super(e,s,i,n,r,o,a,c,l,h,u,p,g),this.yb=f,this.Ab=void 0}zb(e,s){const i=[],n=Be(e,i,{allowEmptyContent:!0,allowTrailingComma:!0});return i.length>0||!ot(n)&&s!==Array.isArray(n)}Bb(){return this.Ab||(this.Ab=this.yb.resolveFormattingOptions(this.r)),this.Ab}};qa=__decorate([__param(3,K),__param(4,ae),__param(5,re),__param(6,rt),__param(7,kt),__param(8,mt),__param(9,ke),__param(10,Re),__param(11,Oa),__param(12,me),__param(13,he)],qa);var gi=class{constructor(e,s,i,n,r,o,a){this.resource=e,this.g=s,this.h=i,this.j=n,this.k=r,this.l=o,this.d=a.extUri,this.f=um(void 0,this.resource,i,this.d)}async initialize({ref:e,content:s}){if(!s){this.j.info("Remote content does not exist.",this.resource);return}const i=this.m(s);if(i)try{await this.o({ref:e,syncData:i})}catch(n){this.j.error(n)}}m(e){try{const s=JSON.parse(e);if(Ur(s))return s}catch(s){this.j.error(s)}this.j.info("Cannot parse sync data as it is not compatible with the current version.",this.resource)}async n(e,s={}){if(s.ref||s.version)throw new Error("Cannot have core properties as additional");const i={ref:e.ref,version:void 0,...s};this.l.store(`${this.resource}.lastSyncUserData`,JSON.stringify(i),-1,1),await this.k.writeFile(this.f,L.fromString(JSON.stringify(e)))}};gi=__decorate([__param(1,Ne),__param(2,ae),__param(3,Q),__param(4,K),__param(5,re),__param(6,he)],gi);function _a(t,e,s,i,n,r){const o=[],a=[],c=[];if(!e){const E=t.filter(({identifier:C})=>n.every(_=>_.toLowerCase()!==C.id.toLowerCase()));return{local:{added:o,removed:a,updated:c},remote:E.length>0?{added:E,updated:[],removed:[],all:E}:null}}t=t.map(Cu),e=e.map(Cu),s=s?s.map(Cu):null;const l=new Map,h=E=>{E.uuid&&l.set(E.id.toLowerCase(),E.uuid)};t.forEach(({identifier:E})=>h(E)),e.forEach(({identifier:E})=>h(E)),s?.forEach(({identifier:E})=>h(E)),i?.forEach(({identifier:E})=>h(E)),r?.forEach(E=>h(E));const u=E=>{const C=E.identifier.uuid||l.get(E.identifier.id.toLowerCase());return C?`uuid:${C}`:`id:${E.identifier.id.toLowerCase()}`},f=(E,C)=>(E.set(u(C),C),E),p=t.reduce(f,new Map),g=e.reduce(f,new Map),m=e.reduce((E,C)=>f(E,Ht(C)),new Map),v=s?s.reduce(f,new Map):null,b=i.reduce(f,new Map),S=n.reduce((E,C)=>{const _=l.get(C.toLowerCase());return E.add(_?`uuid:${_}`:`id:${C.toLowerCase()}`)},new Set),$=r?r.reduce((E,{id:C,uuid:_})=>(_=_??l.get(C.toLowerCase()),E.add(_?`uuid:${_}`:`id:${C.toLowerCase()}`)),new Set):null,F=za(p,g,S,!1);if(F.added.size>0||F.removed.size>0||F.updated.size>0){const E=za(v,p,S,!1),C=za(v,g,S,!0),_=(q,T,A,P)=>{let M,U,z;return T.installed?(M=P.pinned,z=P.preRelease,M&&(U=P.version)):(M=A.pinned,z=A.preRelease,M&&(U=A.version)),M===void 0&&(M=T.pinned,M&&(U=T.version)),z===void 0&&(z=T.preRelease),{...P,installed:T.installed||A.installed,pinned:M,preRelease:z,version:U??(A.version&&(!T.installed||ha(A.version,T.version))?A.version:T.version),state:x6(T,A,v?.get(q))}};for(const q of C.removed.values()){const T=p.get(q);if(!T)continue;const A=hs(v?.get(q)),P=$&&!$.has(q)&&A.installed;T.installed&&P?a.push(T.identifier):m.set(q,T)}for(const q of C.added.values()){const T=hs(g.get(q)),A=p.get(q);if(A){if(F.updated.has(q)){const P=_(q,A,T,T);Em(A,T,!1,!1)||c.push(Fr(P,q)),m.set(q,P)}}else T.installed&&o.push(Fr(T,q))}for(const q of C.updated.values()){const T=hs(g.get(q)),A=hs(v?.get(q)),P=p.get(q);if(P)if($&&!$.has(q)&&A.installed&&P.installed&&!T.installed)a.push(P.identifier);else{const U=_(q,P,T,T);c.push(Fr(U,q)),m.set(q,U)}else T.installed&&o.push(Fr(T,q))}for(const q of E.added.values())C.added.has(q)||m.set(q,hs(p.get(q)));for(const q of E.updated.values()){if(C.removed.has(q)||C.updated.has(q))continue;const T=hs(p.get(q)),A=hs(g.get(q));m.set(q,_(q,T,A,T))}for(const q of E.removed.values())C.updated.has(q)||C.removed.has(q)||b.has(q)||hs(g.get(q)).installed&&$&&($.has(q)||!hs(v?.get(q)).installed||m.delete(q))}const B=[],ve=za(g,m,new Set,!0),N=ve.added.size>0||ve.updated.size>0||ve.removed.size>0;return N&&m.forEach((E,C)=>B.push(Fr(E,C))),{local:{added:o,removed:a,updated:c},remote:N?{added:[...ve.added].map(E=>m.get(E)),updated:[...ve.updated].map(E=>m.get(E)),removed:[...ve.removed].map(E=>g.get(E)),all:B}:null}}function za(t,e,s,i){const n=t?[...t.keys()].filter(l=>!s.has(l)):[],r=[...e.keys()].filter(l=>!s.has(l)),o=r.filter(l=>!n.includes(l)).reduce((l,h)=>(l.add(h),l),new Set),a=n.filter(l=>!r.includes(l)).reduce((l,h)=>(l.add(h),l),new Set),c=new Set;for(const l of n){if(a.has(l))continue;const h=t.get(l),u=e.get(l);(!u||!Em(h,u,i,!0))&&c.add(l)}return{added:o,removed:a,updated:c}}function Em(t,e,s,i){return!(t.disabled!==e.disabled||!!t.isApplicationScoped!=!!e.isApplicationScoped||i&&t.installed!==e.installed||t.installed&&e.installed&&(t.preRelease!==e.preRelease||t.pinned!==e.pinned||e.pinned&&t.version!==e.version)||!k6(t.state,e.state)||s&&t.version!==e.version)}function x6(t,e,s){const i=t.state,n=e.state,r=s?.state;if(!e.version||i&&ha(t.version,e.version))return i;if(n&&ha(e.version,t.version)||!i)return n;if(!n)return i;const o=Ht(i),a=r?ku(r,n):{added:Object.keys(n).reduce((l,h)=>(l.add(h),l),new Set),removed:new Set,updated:new Set},c=r?ku(r,i):{added:Object.keys(i).reduce((l,h)=>(l.add(h),l),new Set),removed:new Set,updated:new Set};for(const l of[...a.added.values(),...a.updated.values()])o[l]=n[l];for(const l of a.removed.values())c.updated.has(l)||delete o[l];return o}function ku(t,e){const s=Object.keys(t),i=Object.keys(e),n=i.filter(a=>!s.includes(a)).reduce((a,c)=>(a.add(c),a),new Set),r=s.filter(a=>!i.includes(a)).reduce((a,c)=>(a.add(c),a),new Set),o=new Set;for(const a of s){if(r.has(a))continue;const c=t[a],l=e[a];bt(c,l)||o.add(a)}return{added:n,removed:r,updated:o}}function k6(t={},e={}){const{added:s,removed:i,updated:n}=ku(t,e);return s.size===0&&i.size===0&&n.size===0}function Cu(t){return{...t,disabled:!!t.disabled,installed:!!t.installed}}function Fr(t,e){const s={...t,identifier:{id:t.identifier.id,uuid:e.startsWith("uuid:")?e.substring(5):void 0},preRelease:!!t.preRelease,pinned:!!t.pinned};return t.disabled||delete s.disabled,t.installed||delete s.installed,t.state||delete s.state,t.isApplicationScoped||delete s.isApplicationScoped,s}var qr=W("IUserDataProfileStorageService"),Ru=class extends j{constructor(e,s){super(),this.b=s,e&&(this.a=this.D(new go))}async readStorageData(e){return this.withProfileScopedStorageService(e,async s=>this.c(s))}async updateStorageData(e,s,i){return this.withProfileScopedStorageService(e,async n=>this.f(n,s,i))}async withProfileScopedStorageService(e,s){if(this.b.hasScope(e))return s(this.b);let i=this.a?.get(e.id);if(!i){i=new R6(this.g(e)),this.a?.set(e.id,i);try{await i.initialize()}catch(n){throw this.a?.has(e.id)?this.a.deleteAndDispose(e.id):i.dispose(),n}}try{const n=await s(i);return await i.flush(),n}finally{this.a?.has(e.id)||i.dispose()}}c(e){const s=new Map,i=n=>{for(const r of e.keys(0,n))s.set(r,{value:e.get(r,0),target:n})};return i(0),i(1),s}f(e,s,i){e.storeAll(Array.from(s.entries()).map(([n,r])=>({key:n,value:r,scope:0,target:i})),!0)}};Ru=__decorate([__param(1,re)],Ru);var C6=class extends Ru{constructor(t,e,s,i,n){super(t,i),this.j=e;const r=e.getChannel("profileStorageListener"),o=this.D(new us);this.h=this.D(new R({onWillAddFirstListener:()=>{o.value=r.listen("onDidChange")(a=>{n.trace("profile storage changes",a),this.h.fire({targetChanges:a.targetChanges.map(c=>Yt(c,s.profilesHome.scheme)),valueChanges:a.valueChanges.map(c=>({...c,profile:Yt(c.profile,s.profilesHome.scheme)}))})})},onDidRemoveLastListener:()=>o.value=void 0})),this.onDidChange=this.h.event}async g(t){const e=this.j.getChannel("storage");return aa(t)?new qp(e):new _p(e,t)}},R6=class extends Kg{constructor(t){super({flushInterval:100}),this.s=t}async O(){const t=await this.s,e=new na(t);return this.D(e.onDidChangeStorage(s=>{this.t(0,s)})),this.D(pe(()=>{e.close(),e.dispose(),Fc(t)&&t.dispose()})),this.c=e,this.c.init()}P(t){return t===0?this.c:void 0}Q(){}async R(){}async S(){}hasScope(){return!1}};async function Va(t,e){const s=JSON.parse(t.content);if(t.version===1||t.version===2){const i=(await e.getInstalled(0)).filter(n=>n.isBuiltin);for(const n of s)t.version===1&&(n.enabled===!1&&(n.disabled=!0),delete n.enabled),t.version===2&&i.every(r=>!G(r.identifier,n.identifier))&&(n.installed=!0)}return s}function D6(t){return JSON.parse(t.content)}function Du(t,e){return t.sort((s,i)=>!s.identifier.uuid&&i.identifier.uuid?-1:s.identifier.uuid&&!i.identifier.uuid?1:Eo(s.identifier.id,i.identifier.id)),e?xr(t,{}):JSON.stringify(t)}var Pu=class extends pi{constructor(e,s,i,n,r,o,a,c,l,h,u,f,p,g,m,v,b){super({syncResource:"extensions",profile:e},s,n,i,r,o,a,f,p,h,u,m),this.Bb=c,this.Cb=l,this.Db=b,this.ob=6,this.vb=this.h.joinPath(this.g,"extensions.json"),this.wb=this.vb.with({scheme:I,authority:"base"}),this.xb=this.vb.with({scheme:I,authority:"local"}),this.yb=this.vb.with({scheme:I,authority:"remote"}),this.zb=this.vb.with({scheme:I,authority:"accepted"}),this.Ab=this.Db.createInstance(Ba),this.D(O.any(O.filter(this.Bb.onDidInstallExtensions,S=>S.some(({local:$})=>!!$)),O.filter(this.Bb.onDidUninstallExtension,S=>!S.error),O.filter(v.onDidChange,S=>S.valueChanges.some(({profile:$,changes:F})=>this.syncResource.profile.id===$.id&&F.some(B=>B.key===Dl))),g.onDidChangeExtensionStorageToSync)(()=>this.Q()))}async pb(e,s){const i=e.syncData?await Va(e.syncData,this.Bb):null,n=s?.skippedExtensions??[],r=s?.builtinExtensions??null,o=s?.syncData?await Va(s.syncData,this.Bb):null,{localExtensions:a,ignoredExtensions:c}=await this.Ab.getLocalExtensions(this.syncResource.profile);i?this.O.trace(`${this.C}: Merging remote extensions with local extensions...`):this.O.trace(`${this.C}: Remote extensions does not exist. Synchronizing extensions for the first time.`);const{local:l,remote:h}=_a(a,i,o,n,c,r),u={local:l,remote:h,content:this.Gb(a,l.added,l.updated,l.removed),localChange:l.added.length>0||l.removed.length>0||l.updated.length>0?2:0,remoteChange:h!==null?2:0},f=this.Nb(a,!1);return[{skippedExtensions:n,builtinExtensions:r,baseResource:this.wb,baseContent:o?this.Nb(o,!1):f,localResource:this.xb,localContent:f,localExtensions:a,remoteResource:this.yb,remoteExtensions:i,remoteContent:i?this.Nb(i,!1):null,previewResource:this.vb,previewResult:u,localChange:u.localChange,remoteChange:u.remoteChange,acceptedResource:this.zb}]}async tb(e){const s=e.syncData?await Va(e.syncData,this.Bb):null,{localExtensions:i,ignoredExtensions:n}=await this.Ab.getLocalExtensions(this.syncResource.profile),{remote:r}=_a(i,s,s,e.skippedExtensions||[],n,e.builtinExtensions||[]);return r!==null}Gb(e,s,i,n){const r=[...s,...i],o=new Set,a=c=>{o.add(c.id.toLowerCase()),c.uuid&&o.add(c.uuid)};r.forEach(({identifier:c})=>a(c)),n.forEach(a);for(const c of e)o.has(c.identifier.id.toLowerCase())||c.identifier.uuid&&o.has(c.identifier.uuid)||r.push(c);return this.Nb(r,!1)}async qb(e,s){return{...e.previewResult,hasConflicts:!1}}async rb(e,s,i,n){if(this.h.isEqual(s,this.xb))return this.Jb(e);if(this.h.isEqual(s,this.yb))return this.Kb(e);if(this.h.isEqual(s,this.vb))return e.previewResult;throw new Error(`Invalid Resource: ${s.toString()}`)}async Jb(e){const s=await this.Bb.getInstalled(void 0,this.syncResource.profile.extensionsResource),i=this.Cb.getIgnoredExtensions(s),n=e.remoteContent?JSON.parse(e.remoteContent):null,r=_a(e.localExtensions,n,n,e.skippedExtensions,i,e.builtinExtensions),{local:o,remote:a}=r;return{content:e.localContent,local:o,remote:a,localChange:o.added.length>0||o.removed.length>0||o.updated.length>0?2:0,remoteChange:a!==null?2:0}}async Kb(e){const s=await this.Bb.getInstalled(void 0,this.syncResource.profile.extensionsResource),i=this.Cb.getIgnoredExtensions(s),n=e.remoteContent?JSON.parse(e.remoteContent):null;if(n!==null){const r=_a(e.localExtensions,n,e.localExtensions,[],i,e.builtinExtensions),{local:o,remote:a}=r;return{content:e.remoteContent,local:o,remote:a,localChange:o.added.length>0||o.removed.length>0||o.updated.length>0?2:0,remoteChange:a!==null?2:0}}else return{content:e.remoteContent,local:{added:[],removed:[],updated:[]},remote:null,localChange:0,remoteChange:0}}async sb(e,s,i,n){let{skippedExtensions:r,builtinExtensions:o,localExtensions:a}=i[0][0];const{local:c,remote:l,localChange:h,remoteChange:u}=i[0][1];if(h===0&&u===0&&this.O.info(`${this.C}: No changes found during synchronizing extensions.`),h!==0&&(await this.mb(JSON.stringify(a)),r=await this.Ab.updateLocalExtensions(c.added,c.removed,c.updated,r,this.syncResource.profile)),l){this.O.trace(`${this.C}: Updating remote extensions...`);const f=JSON.stringify(l.all);e=await this.lb(f,n?null:e.ref),this.O.info(`${this.C}: Updated remote extensions.${l.added.length?` Added: ${JSON.stringify(l.added.map(p=>p.identifier.id))}.`:""}${l.updated.length?` Updated: ${JSON.stringify(l.updated.map(p=>p.identifier.id))}.`:""}${l.removed.length?` Removed: ${JSON.stringify(l.removed.map(p=>p.identifier.id))}.`:""}`)}s?.ref!==e.ref&&(this.O.trace(`${this.C}: Updating last synchronized extensions...`),o=this.Mb(a,o),await this.eb(e,{skippedExtensions:r,builtinExtensions:o}),this.O.info(`${this.C}: Updated last synchronized extensions.${r.length?` Skipped: ${JSON.stringify(r.map(f=>f.identifier.id))}.`:""}`))}Mb(e,s){const i=new Set,n=[];for(const r of e)i.add(r.identifier.id.toLowerCase()),r.installed||n.push(r.identifier);if(s)for(const r of s)i.has(r.id.toLowerCase())||n.push(r);return n}async resolveContent(e){if(this.h.isEqual(this.yb,e)||this.h.isEqual(this.wb,e)||this.h.isEqual(this.xb,e)||this.h.isEqual(this.zb,e)){const s=await this.cb(e);return s&&this.Nb(JSON.parse(s),!0)}return null}Nb(e,s){return Du(e,s)}async hasLocalData(){try{const{localExtensions:e}=await this.Ab.getLocalExtensions(this.syncResource.profile);if(e.some(s=>s.installed||s.disabled))return!0}catch{}return!1}};Pu=__decorate([__param(2,ae),__param(3,K),__param(4,re),__param(5,rt),__param(6,kt),__param(7,Gs),__param(8,Ia),__param(9,Re),__param(10,me),__param(11,mt),__param(12,ke),__param(13,nu),__param(14,he),__param(15,qr),__param(16,ns)],Pu);var Ba=class{constructor(e,s,i,n,r,o){this.a=e,this.b=s,this.c=i,this.d=n,this.f=r,this.g=o}async getLocalExtensions(e){const s=await this.a.getInstalled(void 0,e.extensionsResource),i=this.d.getIgnoredExtensions(s);return{localExtensions:await this.j(e,async(r,o)=>{const a=r.getDisabledExtensions();return s.map(c=>{const{identifier:l,isBuiltin:h,manifest:u,preRelease:f,pinned:p,isApplicationScoped:g}=c,m={identifier:l,preRelease:f,version:u.version,pinned:!!p};g&&!oh(u)&&(m.isApplicationScoped=g),a.some(v=>G(v,l))&&(m.disabled=!0),h||(m.installed=!0);try{const v=o.getKeysForSync({id:l.id,version:u.version});if(v){const b=o.getExtensionState(c,!0)||{};m.state=Object.keys(b).reduce((S,$)=>(v.includes($)&&(S[$]=b[$]),S),{})}}catch(v){this.g.info(`${Ua("extensions",e)}: Error while parsing extension state`,se(v))}return m})}),ignoredExtensions:i}}async updateLocalExtensions(e,s,i,n,r){const o=Ua("extensions",r),a=[],c=new Map,l=[],h=[],u=await this.a.getInstalled(void 0,r.extensionsResource);if((e.length||i.length)&&await this.j(r,async(g,m)=>{await Xe.settled([...e,...i].map(async v=>{const b=u.find(F=>G(F.identifier,v.identifier));if(b&&b.isBuiltin){v.state&&b.manifest.version===v.version&&this.h(v.state,b,b.manifest.version,m),g.getDisabledExtensions().some(B=>G(B,v.identifier))!==!!v.disabled&&(v.disabled?(this.g.trace(`${o}: Disabling extension...`,v.identifier.id),await g.disableExtension(v.identifier),this.g.info(`${o}: Disabled extension`,v.identifier.id)):(this.g.trace(`${o}: Enabling extension...`,v.identifier.id),await g.enableExtension(v.identifier),this.g.info(`${o}: Enabled extension`,v.identifier.id))),l.push(v.identifier);return}const S=v.pinned?v.version:void 0,$=(await this.c.getExtensions([{...v.identifier,version:S,preRelease:S?void 0:v.preRelease}],Z.None))[0];if(v.state&&(b?b.manifest.version===v.version:$)&&this.h(v.state,b||$,b?.manifest.version,m),$)try{g.getDisabledExtensions().some(B=>G(B,v.identifier))!==!!v.disabled&&(v.disabled?(this.g.trace(`${o}: Disabling extension...`,v.identifier.id,$.version),await g.disableExtension($.identifier),this.g.info(`${o}: Disabled extension`,v.identifier.id,$.version)):(this.g.trace(`${o}: Enabling extension...`,v.identifier.id,$.version),await g.enableExtension($.identifier),this.g.info(`${o}: Enabled extension`,v.identifier.id,$.version))),(!b||b.preRelease!==v.preRelease||b.pinned!==v.pinned||S&&b.manifest.version!==S)&&(await this.a.canInstall($)===!0?(a.push({extension:$,options:{isMachineScoped:!1,donotIncludePackAndDependencies:!0,installGivenVersion:v.pinned&&!!v.version,pinned:v.pinned,installPreReleaseVersion:v.preRelease,preRelease:v.preRelease,profileLocation:r.extensionsResource,isApplicationScoped:v.isApplicationScoped,context:{[k2]:!0,[Cl]:"settingsSync",[kl]:!0}}}),c.set($.identifier.id.toLowerCase(),v)):(this.g.info(`${o}: Skipped synchronizing extension because it cannot be installed.`,$.displayName||$.identifier.id),h.push(v)))}catch(F){h.push(v),this.g.error(F),this.g.info(`${o}: Skipped synchronizing extension`,$.displayName||$.identifier.id)}else h.push(v),this.g.info(`${o}: Skipped synchronizing extension because the extension is not found.`,v.identifier.id)}))}),s.length){const g=u.filter(({identifier:m,isBuiltin:v})=>!v&&s.some(b=>G(m,b)));await Xe.settled(g.map(async m=>{this.g.trace(`${o}: Uninstalling local extension...`,m.identifier.id),await this.a.uninstall(m,{donotIncludePack:!0,donotCheckDependents:!0,profileLocation:r.extensionsResource}),this.g.info(`${o}: Uninstalled local extension.`,m.identifier.id),l.push(m.identifier)}))}const f=await this.a.installGalleryExtensions(a);for(const{identifier:g,local:m,error:v,source:b}of f){const S=b;if(m)this.g.info(`${o}: Installed extension.`,g.id,S.version),l.push(g);else{const $=c.get(g.id.toLowerCase());$&&(h.push($),this.g.info(`${o}: Skipped synchronizing extension`,S.displayName||S.identifier.id)),v instanceof Me&&["Incompatible","IncompatibleApi","IncompatibleTargetPlatform"].includes(v.code)?this.g.info(`${o}: Skipped synchronizing extension because the compatible extension is not found.`,S.displayName||S.identifier.id):v&&this.g.error(v)}}const p=[];for(const g of n)l.some(m=>G(m,g.identifier))||p.push(g);for(const g of h)p.some(m=>G(m.identifier,g.identifier))||p.push(g);return p}h(e,s,i,n){const r=n.getExtensionState(s,!0)||{},o=i?n.getKeysForSync({id:s.identifier.id,version:i}):void 0;o?o.forEach(a=>{r[a]=e[a]}):Object.keys(e).forEach(a=>r[a]=e[a]),n.setExtensionState(s,r,!0)}async j(e,s){return this.b.withProfileScopedStorageService(e,async i=>{const n=new Pe,r=n.add(this.f.createChild(new Yh([re,i]))),o=n.add(r.createInstance(ca)),a=n.add(r.createInstance(jr));try{return await s(o,a)}finally{n.dispose()}})}};Ba=__decorate([__param(0,Gs),__param(1,qr),__param(2,xs),__param(3,Ia),__param(4,ns),__param(5,Re)],Ba);var $m=class extends gi{constructor(e,s,i,n,r,o,a,c){super("extensions",n,r,o,i,a,c),this.p=e,this.q=s}async t(e){return e.syncData?await Va(e.syncData,this.p):null}u(e,s){const i=[],n=[],r=[];for(const o of e){if(this.q.hasToNeverSyncExtension(o.identifier.id))continue;const a=s.find(c=>G(c.identifier,o.identifier));a?(i.push(a),o.disabled&&r.push(o.identifier)):o.installed&&(n.push({...o.identifier,preRelease:!!o.preRelease}),o.disabled&&r.push(o.identifier))}return{installedExtensions:i,newExtensions:n,disabledExtensions:r,remoteExtensions:e}}};$m=__decorate([__param(0,Gs),__param(1,Ia),__param(2,K),__param(3,Ne),__param(4,ae),__param(5,Q),__param(6,re),__param(7,he)],$m);function Jt(t,e,s,i){const n=Wl(t,e,s,i)[0];return n&&(t=t.substring(0,n.offset)+n.content+t.substring(n.offset+n.length)),t}function Wa(t,e,s,i,n){if(!e)return{remote:{added:Object.keys(t),removed:[],updated:[],all:Object.keys(t).length>0?t:null},local:{added:{},removed:[],updated:{}}};const r=Ha(t,e);if(r.added.size===0&&r.removed.size===0&&r.updated.size===0)return{remote:{added:[],removed:[],updated:[],all:null},local:{added:{},removed:[],updated:{}}};const o=s?Ha(s,e):{added:Object.keys(e).reduce((f,p)=>(f.add(p),f),new Set),removed:new Set,updated:new Set},a=s?Ha(s,t):{added:Object.keys(t).reduce((f,p)=>(f.add(p),f),new Set),removed:new Set,updated:new Set},c={added:{},removed:[],updated:{}},l=Ht(e),h=!s;for(const f of a.added.values())f!==di&&h&&o.added.has(f)||(l[f]=t[f]);for(const f of a.updated.values())l[f]=t[f];for(const f of a.removed.values())i.unregistered.includes(f)||delete l[f];for(const f of o.added.values()){const p=e[f];if(i.machine.includes(f)){n.info(`GlobalState: Skipped adding ${f} in local storage because it is declared as machine scoped.`);continue}if(s&&a.added.has(f))continue;const g=t[f];g&&g.value===p.value||f===di&&h&&a.added.has(f)||(g?c.updated[f]=p:c.added[f]=p)}for(const f of o.updated.values()){const p=e[f];if(i.machine.includes(f)){n.info(`GlobalState: Skipped updating ${f} in local storage because it is declared as machine scoped.`);continue}if(a.updated.has(f)||a.removed.has(f))continue;const g=t[f];g&&g.value===p.value||(c.updated[f]=p)}for(const f of o.removed.values()){if(i.machine.includes(f)){n.trace(`GlobalState: Skipped removing ${f} in local storage because it is declared as machine scoped.`);continue}a.updated.has(f)||a.removed.has(f)||c.removed.push(f)}const u=Ha(e,l);return{local:c,remote:{added:[...u.added],updated:[...u.updated],removed:[...u.removed],all:u.added.size===0&&u.removed.size===0&&u.updated.size===0?null:l}}}function Ha(t,e){const s=Object.keys(t),i=Object.keys(e),n=i.filter(a=>!s.includes(a)).reduce((a,c)=>(a.add(c),a),new Set),r=s.filter(a=>!i.includes(a)).reduce((a,c)=>(a.add(c),a),new Set),o=new Set;for(const a of s){if(r.has(a))continue;const c=t[a],l=e[a];bt(c,l)||o.add(a)}return{added:n,removed:r,updated:o}}var Ki="globalState.argv.",P6=["locale"];function Qi(t,e){const s=t.storage?Object.keys(t.storage).sort():[],i={};return s.forEach(n=>i[n]=t.storage[n]),t.storage=i,e?xr(t,{}):JSON.stringify(t)}var Iu=1,Au=class extends pi{constructor(e,s,i,n,r,o,a,c,l,h,u,f,p,g){super({syncResource:"globalState",profile:e},s,n,c,f,r,o,l,h,a,u,p),this.Ab=i,this.ob=Iu,this.ub=this.h.joinPath(this.g,"globalState.json"),this.vb=this.ub.with({scheme:I,authority:"base"}),this.wb=this.ub.with({scheme:I,authority:"local"}),this.xb=this.ub.with({scheme:I,authority:"remote"}),this.yb=this.ub.with({scheme:I,authority:"accepted"}),this.zb=g.createInstance(Ga),this.D(n.watch(this.h.dirname(this.H.argvResource))),this.D(O.any(O.filter(n.onDidFilesChange,m=>m.contains(this.H.argvResource)),O.filter(i.onDidChange,m=>!!(m.targetChanges.some(v=>this.syncResource.profile.id===v.id)||m.valueChanges.some(({profile:v,changes:b})=>this.syncResource.profile.id===v.id&&b.some(S=>S.target===0)))))(()=>this.Q()))}async pb(e,s,i){const n=e.syncData?JSON.parse(e.syncData.content):null;s=s===null&&i?e:s;const r=s&&s.syncData?JSON.parse(s.syncData.content):null,o=await this.zb.getLocalGlobalState(this.syncResource.profile);n?this.O.trace(`${this.C}: Merging remote ui state with local ui state...`):this.O.trace(`${this.C}: Remote ui state does not exist. Synchronizing ui state for the first time.`);const a=await this.Ib(r),{local:c,remote:l}=Wa(o.storage,n?n.storage:null,r?r.storage:null,a,this.O),h={content:null,local:c,remote:l,localChange:Object.keys(c.added).length>0||Object.keys(c.updated).length>0||c.removed.length>0?2:0,remoteChange:l.all!==null?2:0},u=Qi(o,!1);return[{baseResource:this.vb,baseContent:r?Qi(r,!1):u,localResource:this.wb,localContent:u,localUserData:o,remoteResource:this.xb,remoteContent:n?Qi(n,!1):null,previewResource:this.ub,previewResult:h,localChange:h.localChange,remoteChange:h.remoteChange,acceptedResource:this.yb,storageKeys:a}]}async tb(e){const s=e.syncData?JSON.parse(e.syncData.content):null;if(s===null)return!0;const i=await this.zb.getLocalGlobalState(this.syncResource.profile),n=await this.Ib(s),{remote:r}=Wa(i.storage,s.storage,s.storage,n,this.O);return r.all!==null}async qb(e,s){return{...e.previewResult,hasConflicts:!1}}async rb(e,s,i,n){if(this.h.isEqual(s,this.wb))return this.Fb(e);if(this.h.isEqual(s,this.xb))return this.Gb(e);if(this.h.isEqual(s,this.ub))return e.previewResult;throw new Error(`Invalid Resource: ${s.toString()}`)}async Fb(e){if(e.remoteContent!==null){const s=JSON.parse(e.remoteContent),{local:i,remote:n}=Wa(e.localUserData.storage,s.storage,s.storage,e.storageKeys,this.O);return{content:e.remoteContent,local:i,remote:n,localChange:0,remoteChange:n.all!==null?2:0}}else return{content:e.localContent,local:{added:{},removed:[],updated:{}},remote:{added:Object.keys(e.localUserData.storage),removed:[],updated:[],all:e.localUserData.storage},localChange:0,remoteChange:2}}async Gb(e){if(e.remoteContent!==null){const s=JSON.parse(e.remoteContent),{local:i,remote:n}=Wa(e.localUserData.storage,s.storage,e.localUserData.storage,e.storageKeys,this.O);return{content:e.remoteContent,local:i,remote:n,localChange:Object.keys(i.added).length>0||Object.keys(i.updated).length>0||i.removed.length>0?2:0,remoteChange:0}}else return{content:e.remoteContent,local:{added:{},removed:[],updated:{}},remote:{added:[],removed:[],updated:[],all:null},localChange:0,remoteChange:0}}async sb(e,s,i,n){const{localUserData:r}=i[0][0],{local:o,remote:a,localChange:c,remoteChange:l}=i[0][1];if(c===0&&l===0&&this.O.info(`${this.C}: No changes found during synchronizing ui state.`),c!==0&&(this.O.trace(`${this.C}: Updating local ui state...`),await this.mb(JSON.stringify(r)),await this.zb.writeLocalGlobalState(o,this.syncResource.profile),this.O.info(`${this.C}: Updated local ui state`)),l!==0){this.O.trace(`${this.C}: Updating remote ui state...`);const h=JSON.stringify({storage:a.all});e=await this.lb(h,n?null:e.ref),this.O.info(`${this.C}: Updated remote ui state.${a.added.length?` Added: ${a.added}.`:""}${a.updated.length?` Updated: ${a.updated}.`:""}${a.removed.length?` Removed: ${a.removed}.`:""}`)}s?.ref!==e.ref&&(this.O.trace(`${this.C}: Updating last synchronized ui state...`),await this.eb(e),this.O.info(`${this.C}: Updated last synchronized ui state`))}async resolveContent(e){if(this.h.isEqual(this.xb,e)||this.h.isEqual(this.vb,e)||this.h.isEqual(this.wb,e)||this.h.isEqual(this.yb,e)){const s=await this.cb(e);return s&&Qi(JSON.parse(s),!0)}return null}async hasLocalData(){try{const{storage:e}=await this.zb.getLocalGlobalState(this.syncResource.profile);if(Object.keys(e).length>1||e[`${Ki}.locale`]?.value!=="en")return!0}catch{}return!1}async Ib(e){const s=await this.Ab.readStorageData(this.syncResource.profile),i=[],n=[];for(const[a,c]of s)c.target===0?i.push(a):c.target===1&&n.push(a);const r=[...i,...n],o=e?.storage?Object.keys(e.storage).filter(a=>!a.startsWith(Ki)&&!r.includes(a)&&s.get(a)!==void 0):[];if(!at){const a=[...Mn.map(c=>Mr(c)),di];o.push(...a),n.push(...a)}return{user:i,machine:n,unregistered:o}}};Au=__decorate([__param(2,qr),__param(3,K),__param(4,rt),__param(5,kt),__param(6,Re),__param(7,ae),__param(8,mt),__param(9,ke),__param(10,me),__param(11,re),__param(12,he),__param(13,ns)],Au);var Ga=class{constructor(e,s,i,n){this.a=e,this.b=s,this.c=i,this.d=n}async getLocalGlobalState(e){const s={};if(e.isDefault){const n=await this.f(),r=Be(n);for(const o of P6)r[o]!==void 0&&(s[`${Ki}${o}`]={version:1,value:r[o]})}const i=await this.c.readStorageData(e);for(const[n,r]of i)r.value&&r.target===0&&(s[n]={version:1,value:r.value});return{storage:s}}async f(){try{this.d.debug("GlobalStateSync#getLocalArgvContent",this.b.argvResource);const e=await this.a.readFile(this.b.argvResource);return this.d.debug("GlobalStateSync#getLocalArgvContent - Resolved",this.b.argvResource),e.value.toString()}catch(e){this.d.debug(se(e))}return"{}"}async writeLocalGlobalState({added:e,removed:s,updated:i},n){const r=Ua("globalState",n),o={},a=new Map,c=await this.c.readStorageData(n),l=(h,u)=>{for(const f of h){if(f.startsWith(Ki)){o[f.substring(Ki.length)]=u?u[f].value:void 0;continue}if(u){const p=u[f];p.value!==c.get(f)?.value&&a.set(f,p.value)}else c.get(f)!==void 0&&a.set(f,void 0)}};if(l(Object.keys(e),e),l(Object.keys(i),i),l(s),Object.keys(o).length){this.d.trace(`${r}: Updating locale...`);const h=await this.f();let u=h;for(const f of Object.keys(o))u=Jt(u,[f],o[f],{});h!==u&&(this.d.trace(`${r}: Updating locale...`),await this.a.writeFile(this.b.argvResource,L.fromString(u)),this.d.info(`${r}: Updated locale.`)),this.d.info(`${r}: Updated locale`)}a.size&&(this.d.trace(`${r}: Updating global state...`),await this.c.updateStorageData(n,a,0),this.d.info(`${r}: Updated global state`,[...a.keys()]))}};Ga=__decorate([__param(0,K),__param(1,ae),__param(2,qr),__param(3,Re)],Ga);var xm=class extends gi{constructor(e,s,i,n,r,o){super("globalState",i,n,r,s,e,o)}async o(e){const s=e.syncData?JSON.parse(e.syncData.content):null;if(!s){this.j.info("Skipping initializing global state because remote global state does not exist.");return}const i={},n={};for(const r of Object.keys(s.storage))r.startsWith(Ki)?i[r.substring(Ki.length)]=s.storage[r].value:this.l.get(r,0)===void 0&&(n[r]=s.storage[r].value);if(Object.keys(i).length){let r="{}";try{r=(await this.k.readFile(this.h.argvResource)).value.toString()}catch{}for(const o of Object.keys(i))r=Jt(r,[o],i[o],{});await this.k.writeFile(this.h.argvResource,L.fromString(r))}if(Object.keys(n).length){const r=[];for(const o of Object.keys(n))r.push({key:o,value:n[o],scope:0,target:0});this.l.storeAll(r,!0)}}};xm=__decorate([__param(0,re),__param(1,K),__param(2,Ne),__param(3,ae),__param(4,Re),__param(5,he)],xm);var km=class{constructor(e,s,i,n,r){this.a=e,this.b=s,this.c=i,this.d=n,this.f=r}getSyncStoreType(e){return this.h(e)?.storage[di]?.value}async sync(e){const s=Un(tt());try{return await this.g(e,s)}catch(i){if(i instanceof Ce)switch(i.code){case"PreconditionFailed":return this.f.info("Failed to synchronize UserDataSyncStoreType as there is a new remote version available. Synchronizing again..."),this.g(e,s)}throw i}}async g(e,s){const i=await this.a.readResource("globalState",null,void 0,s),n=this.h(i)||{storage:{}};n.storage[di]={value:e,version:Iu};const r=await On(this.c,this.d,this.b),o={version:Iu,machineId:r,content:Qi(n,!1)};await this.a.writeResource("globalState",JSON.stringify(o),i.ref,void 0,s)}h({content:e}){if(!e)return null;const s=JSON.parse(e);if(Ur(s))return s?JSON.parse(s.content):null;throw new Error("Invalid remote data")}};km=__decorate([__param(1,re),__param(2,ae),__param(3,K),__param(4,Q)],km);function _r(t){return Be(t)||[]}async function Cm(t,e,s,i,n){const r=_r(t),o=_r(e),a=s?_r(s):null,c=[...r,...o,...a||[]].map($=>$.key),l=await n.resolveUserBindings(c),h=I6(r,o,a,l);if(!h.hasLocalForwarded&&!h.hasRemoteForwarded)return{mergeContent:t,hasChanges:!1,hasConflicts:!1};if(!h.hasLocalForwarded&&h.hasRemoteForwarded)return{mergeContent:e,hasChanges:!0,hasConflicts:!1};if(h.hasLocalForwarded&&!h.hasRemoteForwarded)return{mergeContent:t,hasChanges:!0,hasConflicts:!1};const u=Ou(r),f=Ou(o),p=a?Ou(a):null,g=Tu(u,f,l),m=p?Tu(p,u,l):{added:[...u.keys()].reduce(($,F)=>($.add(F),$),new Set),removed:new Set,updated:new Set},v=p?Tu(p,f,l):{added:[...f.keys()].reduce(($,F)=>($.add(F),$),new Set),removed:new Set,updated:new Set},b=Rm(g,m,v);let S=t;for(const $ of b.removed.values())b.conflicts.has($)||(S=O6(S,$,i));for(const $ of b.added.values()){if(b.conflicts.has($))continue;const F=f.get($);if(F.some(B=>B.command!==`-${$}`&&h.conflicts.has(l[B.key]))){b.conflicts.add($);continue}S=L6(S,F,i)}for(const $ of b.updated.values()){if(b.conflicts.has($))continue;const F=f.get($);if(F.some(B=>B.command!==`-${$}`&&h.conflicts.has(l[B.key]))){b.conflicts.add($);continue}S=N6(S,$,F,i)}return{mergeContent:S,hasChanges:!0,hasConflicts:b.conflicts.size>0}}function Rm(t,e,s){const i=new Set,n=new Set,r=new Set,o=new Set;for(const a of e.removed.values())s.updated.has(a)&&o.add(a);for(const a of s.removed.values())o.has(a)||(e.updated.has(a)?o.add(a):n.add(a));for(const a of e.added.values())o.has(a)||s.added.has(a)&&t.updated.has(a)&&o.add(a);for(const a of s.added.values())o.has(a)||(e.added.has(a)?t.updated.has(a)&&o.add(a):i.add(a));for(const a of e.updated.values())o.has(a)||s.updated.has(a)&&t.updated.has(a)&&o.add(a);for(const a of s.updated.values())o.has(a)||(e.updated.has(a)?t.updated.has(a)&&o.add(a):r.add(a));return{added:i,removed:n,updated:r,conflicts:o}}function I6(t,e,s,i){const n=new Set,r=Lu(t,i),o=Lu(e,i),a=s?Lu(s,i):null,c=Nu(r,o);if(c.added.size===0&&c.removed.size===0&&c.updated.size===0)return{hasLocalForwarded:!1,hasRemoteForwarded:!1,added:n,removed:n,updated:n,conflicts:n};const l=a?Nu(a,r):{added:[...r.keys()].reduce((m,v)=>(m.add(v),m),new Set),removed:new Set,updated:new Set};if(l.added.size===0&&l.removed.size===0&&l.updated.size===0)return{hasLocalForwarded:!1,hasRemoteForwarded:!0,added:n,removed:n,updated:n,conflicts:n};const h=a?Nu(a,o):{added:[...o.keys()].reduce((m,v)=>(m.add(v),m),new Set),removed:new Set,updated:new Set};if(h.added.size===0&&h.removed.size===0&&h.updated.size===0)return{hasLocalForwarded:!0,hasRemoteForwarded:!1,added:n,removed:n,updated:n,conflicts:n};const{added:u,removed:f,updated:p,conflicts:g}=Rm(c,l,h);return{hasLocalForwarded:!0,hasRemoteForwarded:!0,added:u,removed:f,updated:p,conflicts:g}}function Lu(t,e){const s=new Map;for(const i of t){const n=e[i.key];let r=s.get(n);r||(r=[],s.set(n,r)),r.push(i)}return s}function Ou(t){const e=new Map;for(const s of t){const i=s.command[0]==="-"?s.command.substring(1):s.command;let n=e.get(i);n||(n=[],e.set(i,n)),n.push(s)}return e}function Nu(t,e){const s=[...t.keys()],i=[...e.keys()],n=i.filter(a=>!s.includes(a)).reduce((a,c)=>(a.add(c),a),new Set),r=s.filter(a=>!i.includes(a)).reduce((a,c)=>(a.add(c),a),new Set),o=new Set;for(const a of s){if(r.has(a))continue;const c=t.get(a).map(h=>({...h,key:a})),l=e.get(a).map(h=>({...h,key:a}));jt(c,l,(h,u)=>ju(h,u))||o.add(a)}return{added:n,removed:r,updated:o}}function Tu(t,e,s){const i=[...t.keys()],n=[...e.keys()],r=n.filter(c=>!i.includes(c)).reduce((c,l)=>(c.add(l),c),new Set),o=i.filter(c=>!n.includes(c)).reduce((c,l)=>(c.add(l),c),new Set),a=new Set;for(const c of i){if(o.has(c))continue;const l=t.get(c).map(u=>({...u,key:s[u.key]})),h=e.get(c).map(u=>({...u,key:s[u.key]}));A6(l,h)||a.add(c)}return{added:r,removed:o,updated:a}}function A6(t,e){return!(!jt(t.filter(({command:s})=>s[0]!=="-"),e.filter(({command:s})=>s[0]!=="-"),(s,i)=>ju(s,i))||!jt(t.filter(({command:s})=>s[0]==="-"),e.filter(({command:s})=>s[0]==="-"),(s,i)=>ju(s,i)))}function ju(t,e){if(t.command!==e.command||t.key!==e.key)return!1;const s=dt.deserialize(t.when),i=dt.deserialize(e.when);return!(s&&!i||!s&&i||s&&i&&!s.equals(i)||!bt(t.args,e.args))}function L6(t,e,s){for(const i of e)t=Jt(t,[-1],i,s);return t}function O6(t,e,s){const i=_r(t);for(let n=i.length-1;n>=0;n--)(i[n].command===e||i[n].command===`-${e}`)&&(t=Jt(t,[n],void 0,s));return t}function N6(t,e,s,i){const n=_r(t),r=n.findIndex(o=>o.command===e||o.command===`-${e}`);for(let o=n.length-1;o>=0;o--)(n[o].command===e||n[o].command===`-${e}`)&&(t=Jt(t,[o],void 0,i));for(let o=s.length-1;o>=0;o--)t=Jt(t,[r],s[o],i);return t}function Ja(t,e,s){try{const i=JSON.parse(t);if(!e)return ot(i.all)?null:i.all;switch(ln){case 2:return ot(i.mac)?null:i.mac;case 3:return ot(i.linux)?null:i.linux;case 1:return ot(i.windows)?null:i.windows}}catch(i){return s.error(i),null}}var Mu=class extends qa{constructor(e,s,i,n,r,o,a,c,l,h,u,f,p){super(e.keybindingsResource,{syncResource:"keybindings",profile:e},s,c,l,h,i,n,a,f,r,u,o,p),this.ob=2,this.Db=this.h.joinPath(this.g,"keybindings.json"),this.Eb=this.Db.with({scheme:I,authority:"base"}),this.Fb=this.Db.with({scheme:I,authority:"local"}),this.Gb=this.Db.with({scheme:I,authority:"remote"}),this.Hb=this.Db.with({scheme:I,authority:"accepted"}),this.D(O.filter(o.onDidChangeConfiguration,g=>g.affectsConfiguration("settingsSync.keybindingsPerPlatform"))(()=>this.Q()))}async pb(e,s,i,n){const r=e.syncData?Ja(e.syncData.content,n.keybindingsPerPlatform??this.Pb(),this.O):null;s=s===null&&i?e:s;const o=s?this.Nb(s):null,a=await this.ub(),c=await this.Bb();let l=null,h=!1,u=!1,f=!1;if(r){let m=a?a.value.toString():"[]";if(m=m||"[]",this.zb(m,!0))throw new Ce(w(2716,null),"LocalInvalidContent",this.resource);if(!o||o!==m||o!==r){this.O.trace(`${this.C}: Merging remote keybindings with local keybindings...`);const v=await Cm(m,r,o,c,this.yb);v.hasChanges&&(l=v.mergeContent,f=v.hasConflicts,h=f||v.mergeContent!==m,u=f||v.mergeContent!==r)}}else a&&(this.O.trace(`${this.C}: Remote keybindings does not exist. Synchronizing keybindings for the first time.`),l=a.value.toString(),u=!0);const p={content:f?o:l,localChange:h?a?2:1:0,remoteChange:u?2:0,hasConflicts:f},g=a?a.value.toString():null;return[{fileContent:a,baseResource:this.Eb,baseContent:o,localResource:this.Fb,localContent:g,localChange:p.localChange,remoteResource:this.Gb,remoteContent:r,remoteChange:p.remoteChange,previewResource:this.Db,previewResult:p,acceptedResource:this.Hb}]}async tb(e){const s=this.Nb(e);if(s===null)return!0;const i=await this.ub(),n=i?i.value.toString():"",r=await this.Bb(),o=await Cm(n||"[]",s,s,r,this.yb);return o.hasConflicts||o.mergeContent!==s}async qb(e,s){return e.previewResult}async rb(e,s,i,n){if(this.h.isEqual(s,this.Fb))return{content:e.fileContent?e.fileContent.value.toString():null,localChange:0,remoteChange:2};if(this.h.isEqual(s,this.Gb))return{content:e.remoteContent,localChange:2,remoteChange:0};if(this.h.isEqual(s,this.Db))return i===void 0?{content:e.previewResult.content,localChange:e.previewResult.localChange,remoteChange:e.previewResult.remoteChange}:{content:i,localChange:2,remoteChange:2};throw new Error(`Invalid Resource: ${s.toString()}`)}async sb(e,s,i,n){const{fileContent:r}=i[0][0];let{content:o,localChange:a,remoteChange:c}=i[0][1];if(a===0&&c===0&&this.O.info(`${this.C}: No changes found during synchronizing keybindings.`),o!==null&&(o=o.trim(),o=o||"[]",this.zb(o,!0)))throw new Ce(w(2717,null),"LocalInvalidContent",this.resource);if(a!==0&&(this.O.trace(`${this.C}: Updating local keybindings...`),r&&await this.mb(this.Ob(r.value.toString())),await this.vb(o||"[]",r,n),this.O.info(`${this.C}: Updated local keybindings`)),c!==0){this.O.trace(`${this.C}: Updating remote keybindings...`);const l=this.Ob(o||"[]",e.syncData?.content);e=await this.lb(l,n?null:e.ref),this.O.info(`${this.C}: Updated remote keybindings`)}try{await this.G.del(this.Db)}catch{}s?.ref!==e.ref&&(this.O.trace(`${this.C}: Updating last synchronized keybindings...`),await this.eb(e,{platformSpecific:this.Pb()}),this.O.info(`${this.C}: Updated last synchronized keybindings`))}async hasLocalData(){try{const e=await this.ub();if(e){const s=Be(e.value.toString());if(Kn(s))return!0}}catch(e){if(e.fileOperationResult!==1)return!0}return!1}async resolveContent(e){return this.h.isEqual(this.Gb,e)||this.h.isEqual(this.Eb,e)||this.h.isEqual(this.Fb,e)||this.h.isEqual(this.Hb,e)?this.cb(e):null}Nb(e){return!e.syncData||e.platformSpecific!==void 0&&e.platformSpecific!==this.Pb()?null:Ja(e.syncData.content,this.Pb(),this.O)}Ob(e,s){let i={};try{i=JSON.parse(s||"{}")}catch(n){this.O.error(n)}switch(this.Pb()?delete i.all:i.all=e,ln){case 2:i.mac=e;break;case 3:i.linux=e;break;case 1:i.windows=e;break}return JSON.stringify(i)}Pb(){return!!this.P.getValue(au)}};Mu=__decorate([__param(2,rt),__param(3,kt),__param(4,Re),__param(5,me),__param(6,mt),__param(7,K),__param(8,ae),__param(9,re),__param(10,Oa),__param(11,ke),__param(12,he)],Mu);var Dm=class extends gi{constructor(e,s,i,n,r,o){super("keybindings",s,i,n,e,r,o)}async o(e){const s=e.syncData?this.p(e.syncData.content):null;if(!s){this.j.info("Skipping initializing keybindings because remote keybindings does not exist.");return}if(!await this.i()){this.j.info("Skipping initializing keybindings because local keybindings exist.");return}await this.k.writeFile(this.g.defaultProfile.keybindingsResource,L.fromString(s)),await this.n(e)}async i(){try{const e=await this.k.readFile(this.g.defaultProfile.settingsResource),s=Be(e.value.toString());return!Kn(s)}catch(e){return e.fileOperationResult===1}}p(e){try{return Ja(e,!0,this.j)}catch(s){return this.j.error(s),null}}};Dm=__decorate([__param(0,K),__param(1,Ne),__param(2,ae),__param(3,Re),__param(4,re),__param(5,he)],Dm);function Pm(t,e,s){const i={},n={},r=new Set;if(!e)return{local:{added:i,updated:n,removed:[...r.values()]},remote:{added:t,updated:{},removed:[]},conflicts:[]};const o=Ka(t,e);if(o.added.size===0&&o.removed.size===0&&o.updated.size===0)return{local:{added:i,updated:n,removed:[...r.values()]},remote:{added:{},updated:{},removed:[]},conflicts:[]};const a=Ka(s,t),c=Ka(s,e),l={},h={},u=new Set,f=new Set;for(const p of a.removed.values())c.updated.has(p)?i[p]=e[p]:u.add(p);for(const p of c.removed.values())f.has(p)||(a.updated.has(p)?f.add(p):r.add(p));for(const p of a.updated.values())f.has(p)||(c.updated.has(p)?o.updated.has(p)&&f.add(p):h[p]=t[p]);for(const p of c.updated.values())f.has(p)||(a.updated.has(p)?o.updated.has(p)&&f.add(p):t[p]!==void 0&&(n[p]=e[p]));for(const p of a.added.values())f.has(p)||(c.added.has(p)?o.updated.has(p)&&f.add(p):l[p]=t[p]);for(const p of c.added.values())f.has(p)||(a.added.has(p)?o.updated.has(p)&&f.add(p):i[p]=e[p]);return{local:{added:i,removed:[...r.values()],updated:n},remote:{added:l,removed:[...u.values()],updated:h},conflicts:[...f.values()]}}function Ka(t,e){const s=t?Object.keys(t):[],i=e?Object.keys(e):[],n=i.filter(a=>!s.includes(a)).reduce((a,c)=>(a.add(c),a),new Set),r=s.filter(a=>!i.includes(a)).reduce((a,c)=>(a.add(c),a),new Set),o=new Set;for(const a of s){if(r.has(a))continue;const c=t[a],l=e[a];c!==l&&o.add(a)}return{added:n,removed:r,updated:o}}function T6(t,e){const{added:s,removed:i,updated:n}=Ka(t,e);return s.size===0&&i.size===0&&n.size===0}function Uu(t){return JSON.parse(t.content)}var Fu=class extends pi{constructor(e,s,i,n,r,o,a,c,l,h,u,f){const p={syncResource:"prompts",profile:e};super(p,s,n,i,r,o,a,h,u,c,l,f),this.ob=1,this.ub=e.promptsHome,this.D(this.G.watch(i.userRoamingDataHome)),this.D(this.G.watch(this.ub)),this.D(O.filter(this.G.onDidFilesChange,g=>g.affects(this.ub))(()=>this.Q()))}async pb(e,s,i){const n=await this.Gb(),r=this.Fb(n),o=e.syncData?this.Eb(e.syncData):null;s=s===null&&i?e:s;const a=s&&s.syncData?this.Eb(s.syncData):null;o?this.O.trace(`${this.C}: Merging remote prompts with local prompts...`):this.O.trace(`${this.C}: Remote prompts does not exist. Synchronizing prompts for the first time.`);const c=Pm(r,o,a);return this.Ab(c,n,o||{},a||{})}async tb(e){const s=e.syncData?this.Eb(e.syncData):null;if(s===null)return!0;const i=await this.Gb(),n=this.Fb(i),r=Pm(n,s,s);return Object.keys(r.remote.added).length>0||Object.keys(r.remote.updated).length>0||r.remote.removed.length>0||r.conflicts.length>0}async qb(e,s){return e.previewResult}async rb(e,s,i,n){if(this.h.isEqualOrParent(s,this.g.with({scheme:I,authority:"local"})))return{content:e.fileContent?e.fileContent.value.toString():null,localChange:0,remoteChange:e.fileContent?e.remoteContent!==null?2:1:3};if(this.h.isEqualOrParent(s,this.g.with({scheme:I,authority:"remote"})))return{content:e.remoteContent,localChange:e.remoteContent!==null?e.fileContent?2:1:3,remoteChange:0};if(this.h.isEqualOrParent(s,this.g))return i===void 0?{content:e.previewResult.content,localChange:e.previewResult.localChange,remoteChange:e.previewResult.remoteChange}:{content:i,localChange:i===null?e.fileContent!==null?3:0:2,remoteChange:i===null?e.remoteContent!==null?3:0:2};throw new Error(`Invalid Resource: ${s.toString()}`)}async sb(e,s,i,n){const r=i.map(([o,a])=>({...o,acceptResult:a}));r.every(({localChange:o,remoteChange:a})=>o===0&&a===0)&&this.O.info(`${this.C}: No changes found during synchronizing prompts.`),r.some(({localChange:o})=>o!==0)&&(await this.Bb(r),await this.Cb(r,n)),r.some(({remoteChange:o})=>o!==0)&&(e=await this.Db(r,e,n)),s?.ref!==e.ref&&(this.O.trace(`${this.C}: Updating last synchronized prompts...`),await this.eb(e),this.O.info(`${this.C}: Updated last synchronized prompts`));for(const{previewResource:o}of r)try{await this.G.del(o)}catch{}}Ab(e,s,i,n){const r=new Map;for(const o of Object.keys(e.local.added)){const a={content:e.local.added[o],hasConflicts:!1,localChange:1,remoteChange:0};r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:null,fileContent:null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),localContent:null,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:i[o],previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of Object.keys(e.local.updated)){const a={content:e.local.updated[o],hasConflicts:!1,localChange:2,remoteChange:0},c=s[o]?s[o].value.toString():null;r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:s[o],localContent:c,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:i[o],previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of e.local.removed){const a={content:null,hasConflicts:!1,localChange:3,remoteChange:0},c=s[o]?s[o].value.toString():null;r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:s[o],localContent:c,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:null,previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of Object.keys(e.remote.added)){const a={content:e.remote.added[o],hasConflicts:!1,localChange:0,remoteChange:1},c=s[o]?s[o].value.toString():null;r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:s[o],localContent:c,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:null,previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of Object.keys(e.remote.updated)){const a={content:e.remote.updated[o],hasConflicts:!1,localChange:0,remoteChange:2},c=s[o]?s[o].value.toString():null;r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:s[o],localContent:c,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:i[o],previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of e.remote.removed){const a={content:null,hasConflicts:!1,localChange:0,remoteChange:3};r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:null,localContent:null,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:i[o],previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of e.conflicts){const a={content:n[o]??null,hasConflicts:!0,localChange:s[o]?2:1,remoteChange:i[o]?2:1},c=s[o]?s[o].value.toString():null;r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:s[o]||null,localContent:c,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:i[o]||null,previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of Object.keys(s))if(!r.has(o)){const a={content:s[o]?s[o].value.toString():null,hasConflicts:!1,localChange:0,remoteChange:0},c=s[o]?s[o].value.toString():null;r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:s[o]||null,localContent:c,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:i[o]||null,previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}return[...r.values()]}async resolveContent(e){return this.h.isEqualOrParent(e,this.g.with({scheme:I,authority:"remote"}))||this.h.isEqualOrParent(e,this.g.with({scheme:I,authority:"local"}))||this.h.isEqualOrParent(e,this.g.with({scheme:I,authority:"base"}))||this.h.isEqualOrParent(e,this.g.with({scheme:I,authority:"accepted"}))?this.cb(e):null}async hasLocalData(){try{const e=await this.Gb();if(Object.keys(e).length)return!0}catch{}return!1}async Bb(e){const s={};for(const i of e)i.fileContent&&(s[this.h.basename(i.localResource)]=i.fileContent);await this.mb(JSON.stringify(this.Fb(s)))}async Cb(e,s){for(const{fileContent:i,acceptResult:n,localResource:r,remoteResource:o,localChange:a}of e)if(a!==0){const c=o?this.h.basename(o):this.h.basename(r),l=this.h.joinPath(this.ub,c);a===3?(this.O.trace(`${this.C}: Deleting prompt...`,this.h.basename(l)),await this.G.del(l),this.O.info(`${this.C}: Deleted prompt`,this.h.basename(l))):a===1?(this.O.trace(`${this.C}: Creating prompt...`,this.h.basename(l)),await this.G.createFile(l,L.fromString(n.content),{overwrite:s}),this.O.info(`${this.C}: Created prompt`,this.h.basename(l))):(this.O.trace(`${this.C}: Updating prompt...`,this.h.basename(l)),await this.G.writeFile(l,L.fromString(n.content),s?void 0:i),this.O.info(`${this.C}: Updated prompt`,this.h.basename(l)))}}async Db(e,s,i){const n=s.syncData?this.Eb(s.syncData):{},r=Ht(n);for(const{acceptResult:o,localResource:a,remoteResource:c,remoteChange:l}of e)if(l!==0){const h=a?this.h.basename(a):this.h.basename(c);l===3?delete r[h]:r[h]=o.content}return T6(n,r)||(this.O.trace(`${this.C}: Updating remote prompts...`),s=await this.lb(JSON.stringify(r),i?null:s.ref),this.O.info(`${this.C}: Updated remote prompts`)),s}Eb(e){return Uu(e)}Fb(e){const s={};for(const i of Object.keys(e))s[i]=e[i].value.toString();return s}async Gb(){const e={};let s;try{s=await this.G.resolve(this.ub)}catch(i){if(i instanceof Ye&&i.fileOperationResult===1)return e;throw i}for(const i of s.children||[]){const n=i.resource,r=n.path;if([".prompt.md",".instructions.md",".chatmode.md",".agent.md"].some(o=>r.endsWith(o))){const o=this.h.relativePath(this.ub,n),a=await this.G.readFile(n);e[o]=a}}return e}};Fu=__decorate([__param(2,ae),__param(3,K),__param(4,re),__param(5,rt),__param(6,kt),__param(7,Re),__param(8,me),__param(9,mt),__param(10,ke),__param(11,he)],Fu);function j6(t,e,s){let i=[];s?i=U6(s):i=M6(e);const n=[],r=[...ou()];if(Array.isArray(i))for(const o of i)o.startsWith("-")?r.push(o.substring(1)):n.push(o);return Dt([...t,...n].filter(o=>!r.includes(o)))}function M6(t){let e=t.inspect("settingsSync.ignoredSettings").userValue;return e!==void 0||(e=t.inspect("sync.ignoredSettings").userValue,e!==void 0)?e:t.getValue("settingsSync.ignoredSettings")||[]}function U6(t){const e=Be(t);return e?e["settingsSync.ignoredSettings"]||e["sync.ignoredSettings"]||[]:[]}function Qs(t,e,s,i){if(s.length){const n=qn(e),r=Be(e)||{},o=Be(t);if(!o)return t;const a=[];for(const c of s){const l=r[c],h=o[c];l===void 0?t=Jt(t,[c],void 0,i):h!==void 0?t=Jt(t,[c],l,i):a.push(zr(c,n))}a.sort((c,l)=>c.startOffset-l.startOffset),a.forEach(c=>t=zu(c.setting.key,e,t,i))}return t}function Im(t,e,s,i,n,r){const o=Qs(t,e,i,r),a=s!==o,c=s!==e;if(!a&&!c)return{conflictsSettings:[],localContent:null,remoteContent:null,hasConflicts:!1};if(a&&!c)return{conflictsSettings:[],localContent:null,remoteContent:o,hasConflicts:!1};if(c&&!a)return{conflictsSettings:[],localContent:Qs(e,t,i,r),remoteContent:null,hasConflicts:!1};if(s===null&&qu(t)){const E=Qa(t,e,i)?null:Qs(e,t,i,r);return{conflictsSettings:[],localContent:E,remoteContent:null,hasConflicts:!1}}let l=t,h=e;const u=Be(t),f=Be(e),p=s?Be(s):null,g=i.reduce((E,C)=>(E.add(C),E),new Set),m=_u(u,f,g),v=_u(p,u,g),b=_u(p,f,g),S=new Map,$=new Set,F=E=>{$.add(E);const C=n.filter(({key:_})=>_===E)[0];C?(l=Jt(l,[E],C.value,r),h=Jt(h,[E],C.value,r)):S.set(E,{key:E,localValue:u[E],remoteValue:f[E]})};for(const E of v.removed.values())b.updated.has(E)?F(E):h=Jt(h,[E],void 0,r);for(const E of b.removed.values())$.has(E)||(v.updated.has(E)?F(E):l=Jt(l,[E],void 0,r));for(const E of v.updated.values())$.has(E)||(b.updated.has(E)?m.updated.has(E)&&F(E):h=Jt(h,[E],u[E],r));for(const E of b.updated.values())$.has(E)||(v.updated.has(E)?m.updated.has(E)&&F(E):l=Jt(l,[E],f[E],r));for(const E of v.added.values())$.has(E)||(b.added.has(E)?m.updated.has(E)&&F(E):h=zu(E,l,h,r));for(const E of b.added.values())$.has(E)||(v.added.has(E)?m.updated.has(E)&&F(E):l=zu(E,h,l,r));const B=S.size>0||!Qa(l,h,i),ve=B||!Qa(l,t,[]),N=B||!Qa(h,e,[]);return{localContent:ve?l:null,remoteContent:N?h:null,conflictsSettings:[...S.values()],hasConflicts:B}}function Qa(t,e,s){if(t===e)return!0;const i=Be(t),n=Be(e),r=s.reduce((c,l)=>(c.add(l),c),new Set),o=qn(t).filter(c=>!(c.setting&&r.has(c.setting.key))),a=qn(e).filter(c=>!(c.setting&&r.has(c.setting.key)));if(o.length!==a.length)return!1;for(let c=0;c<o.length;c++){const l=o[c],h=a[c];if(l.setting&&h.setting){if(l.setting.key!==h.setting.key||!bt(i[l.setting.key],n[l.setting.key]))return!1}else if(!l.setting&&!h.setting){if(l.value!==h.value)return!1}else return!1}return!0}function qu(t){return t?qn(t).length===0:!0}function _u(t,e,s){const i=t?Object.keys(t).filter(c=>!s.has(c)):[],n=Object.keys(e).filter(c=>!s.has(c)),r=n.filter(c=>!i.includes(c)).reduce((c,l)=>(c.add(l),c),new Set),o=i.filter(c=>!n.includes(c)).reduce((c,l)=>(c.add(l),c),new Set),a=new Set;if(t)for(const c of i){if(o.has(c))continue;const l=t[c],h=e[c];bt(l,h)||a.add(c)}return{added:r,removed:o,updated:a}}function zu(t,e,s,i){const n=Be(e),r=qn(e),o=qn(s),a=F6(t,r,o);return q6(s,t,n[t],a,o,i)}function F6(t,e,s){const i=e.findIndex(r=>r.setting?.key===t),n=e[i-1];if(n){if(n.setting){const o=zr(n.setting.key,s);if(o)return{index:s.indexOf(o),insertAfter:!0}}else{const o=Vu(i,e);if(o){const a=zr(o.setting.key,s);if(a){const c=Xa(s.indexOf(a),s),l=Fn(e,o,e[i]);if(c){const h=Fn(s,a,c),u=Za(l,h);return u?{index:s.indexOf(u),insertAfter:!0}:{index:s.indexOf(c),insertAfter:!1}}else{const h=Fn(s,a,s[s.length-1]),u=Za(l,h);return u?{index:s.indexOf(u),insertAfter:!0}:{index:s.length-1,insertAfter:!0}}}}}const r=e[i+1];if(r)if(r.setting){const o=zr(r.setting.key,s);if(o)return{index:s.indexOf(o),insertAfter:!1}}else{const o=Xa(i,e);if(o){const a=zr(o.setting.key,s);if(a){const c=Vu(s.indexOf(a),s),l=Fn(e,e[i],o);if(c){const h=Fn(s,c,a),u=Za(l.reverse(),h.reverse());return u?{index:s.indexOf(u),insertAfter:!1}:{index:s.indexOf(c),insertAfter:!0}}else{const h=Fn(s,s[0],a),u=Za(l.reverse(),h.reverse());return u?{index:s.indexOf(u),insertAfter:!1}:{index:0,insertAfter:!1}}}}}}return{index:s.length-1,insertAfter:!0}}function q6(t,e,s,i,n,r){let o;return i.index===-1?o=Wl(t,[e],s,r):o=_6(t,e,s,i,n,r).map(a=>zi(t,a,r)[0]),ug(t,o)}function _6(t,e,s,i,n,r){const o=`${JSON.stringify(e)}: ${JSON.stringify(s)}`,a=hg(r,t),c=n[i.index];if(i.insertAfter){const l=[];if(c.setting)l.push({offset:c.endOffset,length:0,content:","+o});else{const h=Xa(i.index,n),u=Vu(i.index,n),f=u?.setting?.commaOffset;u&&f===void 0&&l.push({offset:u.endOffset,length:0,content:","});const p=f!==void 0&&f>c.endOffset;l.push({offset:p?f+1:c.endOffset,length:0,content:h?a+o+",":a+o})}return l}else{if(c.setting)return[{offset:c.startOffset,length:0,content:o+","}];const l=(n[i.index-1]&&!n[i.index-1].setting?a:"")+o+(Xa(i.index,n)?",":"")+a;return[{offset:c.startOffset,length:0,content:l}]}}function zr(t,e){return e.filter(s=>s.setting?.key===t)[0]}function Vu(t,e){for(let s=t-1;s>=0;s--)if(e[s].setting)return e[s]}function Xa(t,e){for(let s=t+1;s<e.length;s++)if(e[s].setting)return e[s]}function Fn(t,e,s){const i=t.indexOf(e),n=t.indexOf(s);return t.filter((r,o)=>i<o&&o<n)}function Za(t,e){if(t.length&&e.length){let s=0;for(;s<e.length&&s<t.length;s++)if(t[s].value!==e[s].value)return e[s-1];return e[s-1]}}function qn(t){const e=[];let s=-1,i,n;return $r(t,{onObjectBegin:o=>{s++},onObjectProperty:(o,a,c)=>{s===0&&(i=a,n=o)},onObjectEnd:(o,a)=>{s--,s===0&&e.push({startOffset:i,endOffset:o+a,value:t.substring(i,o+a),setting:{key:n,commaOffset:void 0}})},onArrayBegin:(o,a)=>{s++},onArrayEnd:(o,a)=>{s--,s===0&&e.push({startOffset:i,endOffset:o+a,value:t.substring(i,o+a),setting:{key:n,commaOffset:void 0}})},onLiteralValue:(o,a,c)=>{s===0&&e.push({startOffset:i,endOffset:a+c,value:t.substring(i,a+c),setting:{key:n,commaOffset:void 0}})},onSeparator:(o,a,c)=>{if(s===0&&o===","){let l=e.length-1;for(;l>=0&&!e[l].setting;l--);const h=e[l];h&&e.splice(l,1,{startOffset:h.startOffset,endOffset:h.endOffset,value:h.value,setting:{key:h.setting.key,commaOffset:a}})}},onComment:(o,a)=>{s===0&&e.push({startOffset:o,endOffset:o+a,value:t.substring(o,o+a)})}}),e}function z6(t){return t&&t.settings&&typeof t.settings=="string"&&Object.keys(t).length===1}function Bu(t){const e=JSON.parse(t);return z6(e)?e:{settings:t}}var Ya=class extends qa{constructor(e,s,i,n,r,o,a,c,l,h,u,f,p,g){super(e.settingsResource,{syncResource:"settings",profile:e},s,i,n,r,o,a,u,f,c,l,h,g),this.Db=e,this.Eb=p,this.ob=2,this.previewResource=this.h.joinPath(this.g,"settings.json"),this.baseResource=this.previewResource.with({scheme:I,authority:"base"}),this.localResource=this.previewResource.with({scheme:I,authority:"local"}),this.remoteResource=this.previewResource.with({scheme:I,authority:"remote"}),this.acceptedResource=this.previewResource.with({scheme:I,authority:"accepted"}),this.Ob=void 0,this.Pb=void 0,this.Qb=void 0}async getRemoteUserDataSyncConfiguration(e){const s=await this.getLastSyncUserData(),i=await this.W(e,s),n=this.Lb(i),r=new Kl(Aa,this.O);return n?.settings&&r.parse(n.settings),r.configurationModel.getValue(Aa)||{}}async pb(e,s,i){const n=await this.ub(),r=await this.Bb(),o=this.Lb(e);s=s===null&&i?e:s;const a=s?this.Lb(s):null,c=await this.Rb();let l=null,h=!1,u=!1,f=!1;if(o){let v=n?n.value.toString().trim():"{}";v=v||"{}",this.Ub(v),this.O.trace(`${this.C}: Merging remote settings with local settings...`);const b=Im(v,o.settings,a?a.settings:null,c,[],r);l=b.localContent||b.remoteContent,h=b.localContent!==null,u=b.remoteContent!==null,f=b.hasConflicts}else n&&(this.O.trace(`${this.C}: Remote settings does not exist. Synchronizing settings for the first time.`),l=n.value.toString().trim()||"{}",this.Ub(l),u=!0);const p=n?n.value.toString():null,g=a?.settings??null,m={content:f?g:l,localChange:h?2:0,remoteChange:u?2:0,hasConflicts:f};return[{fileContent:n,baseResource:this.baseResource,baseContent:g,localResource:this.localResource,localContent:p,localChange:m.localChange,remoteResource:this.remoteResource,remoteContent:o?o.settings:null,remoteChange:m.remoteChange,previewResource:this.previewResource,previewResult:m,acceptedResource:this.acceptedResource}]}async tb(e){const s=this.Lb(e);if(s===null)return!0;const i=await this.ub(),n=i?i.value.toString().trim():"",r=await this.Rb(),o=await this.Bb();return Im(n||"{}",s.settings,s.settings,r,[],o).remoteContent!==null}async qb(e,s){const i=await this.Bb(),n=await this.Rb();return{...e.previewResult,content:e.previewResult.content?Qs(e.previewResult.content,"{}",n,i):null}}async rb(e,s,i,n){const r=await this.Bb(),o=await this.Rb();if(this.h.isEqual(s,this.localResource))return{content:e.fileContent?Qs(e.fileContent.value.toString(),"{}",o,r):null,localChange:0,remoteChange:2};if(this.h.isEqual(s,this.remoteResource))return{content:e.remoteContent!==null?Qs(e.remoteContent,e.fileContent?e.fileContent.value.toString():"{}",o,r):null,localChange:2,remoteChange:0};if(this.h.isEqual(s,this.previewResource))return i===void 0?{content:e.previewResult.content,localChange:e.previewResult.localChange,remoteChange:e.previewResult.remoteChange}:{content:i!==null?Qs(i,e.fileContent?e.fileContent.value.toString():"{}",o,r):null,localChange:2,remoteChange:2};throw new Error(`Invalid Resource: ${s.toString()}`)}async sb(e,s,i,n){const{fileContent:r}=i[0][0];let{content:o,localChange:a,remoteChange:c}=i[0][1];if(a===0&&c===0&&this.O.info(`${this.C}: No changes found during synchronizing settings.`),o=o?o.trim():"{}",o=o||"{}",this.Ub(o),a!==0&&(this.O.trace(`${this.C}: Updating local settings...`),r&&await this.mb(JSON.stringify(this.Nb(r.value.toString()))),await this.vb(o,r,n),await this.P.reloadConfiguration(3),this.O.info(`${this.C}: Updated local settings`)),c!==0){const l=await this.Bb(),h=this.Lb(e),u=await this.Rb(o);o=Qs(o,h?h.settings:"{}",u,l),this.O.trace(`${this.C}: Updating remote settings...`),e=await this.lb(JSON.stringify(this.Nb(o)),n?null:e.ref),this.O.info(`${this.C}: Updated remote settings`)}try{await this.G.del(this.previewResource)}catch{}s?.ref!==e.ref&&(this.O.trace(`${this.C}: Updating last synchronized settings...`),await this.eb(e),this.O.info(`${this.C}: Updated last synchronized settings`))}async hasLocalData(){try{const e=await this.ub();if(e)return!qu(e.value.toString())}catch(e){if(e.fileOperationResult!==1)return!0}return!1}async resolveContent(e){return this.h.isEqual(this.remoteResource,e)||this.h.isEqual(this.localResource,e)||this.h.isEqual(this.acceptedResource,e)||this.h.isEqual(this.baseResource,e)?this.cb(e):null}async cb(e){let s=await super.cb(e);if(s){const i=await this.Bb(),n=await this.Rb();s=Qs(s,"{}",n,i)}return s}Lb(e){return e.syncData?this.Mb(e.syncData.content):null}Mb(e){try{return Bu(e)}catch(s){this.O.error(s)}return null}Nb(e){return{settings:e}}async Rb(e){if(this.Ob||(this.Ob=this.yb.resolveDefaultCoreIgnoredSettings()),this.Pb||(this.Pb=this.Sb()),!this.Qb){this.Qb=this.Tb();const i=this.D(O.any(O.filter(this.Eb.onDidInstallExtensions,n=>n.some(({local:r})=>!!r)),O.filter(this.Eb.onDidUninstallExtension,n=>!n.error))(()=>{i.dispose(),this.Qb=void 0}))}const s=(await Promise.all([this.Ob,this.Pb,this.Qb])).flat();return j6(s,this.P,e)}async Sb(){const e=await this.Eb.getInstalled(0);return Dt(e.map(s=>am(s.manifest)).flat())}async Tb(){const e=await this.Eb.getInstalled(1,this.Db.extensionsResource);return Dt(e.map(s=>am(s.manifest)).flat())}Ub(e){if(this.zb(e,!1))throw new Ce(w(2718,null),"LocalInvalidContent",this.resource)}};Ya=__decorate([__param(2,K),__param(3,ae),__param(4,re),__param(5,rt),__param(6,kt),__param(7,Re),__param(8,Oa),__param(9,me),__param(10,mt),__param(11,ke),__param(12,Gs),__param(13,he)],Ya);var Am=class extends gi{constructor(e,s,i,n,r,o){super("settings",s,i,n,e,r,o)}async o(e){const s=e.syncData?this.p(e.syncData.content):null;if(!s){this.j.info("Skipping initializing settings because remote settings does not exist.");return}if(!await this.i()){this.j.info("Skipping initializing settings because local settings exist.");return}await this.k.writeFile(this.g.defaultProfile.settingsResource,L.fromString(s.settings)),await this.n(e)}async i(){try{const e=await this.k.readFile(this.g.defaultProfile.settingsResource);return qu(e.value.toString().trim())}catch(e){return e.fileOperationResult===1}}p(e){try{return Bu(e)}catch(s){this.j.error(s)}return null}};Am=__decorate([__param(0,K),__param(1,Ne),__param(2,ae),__param(3,Re),__param(4,re),__param(5,he)],Am);function Lm(t,e,s){const i={},n={},r=new Set;if(!e)return{local:{added:i,updated:n,removed:[...r.values()]},remote:{added:t,updated:{},removed:[]},conflicts:[]};const o=ec(t,e);if(o.added.size===0&&o.removed.size===0&&o.updated.size===0)return{local:{added:i,updated:n,removed:[...r.values()]},remote:{added:{},updated:{},removed:[]},conflicts:[]};const a=ec(s,t),c=ec(s,e),l={},h={},u=new Set,f=new Set;for(const p of a.removed.values())c.updated.has(p)?i[p]=e[p]:u.add(p);for(const p of c.removed.values())f.has(p)||(a.updated.has(p)?f.add(p):r.add(p));for(const p of a.updated.values())f.has(p)||(c.updated.has(p)?o.updated.has(p)&&f.add(p):h[p]=t[p]);for(const p of c.updated.values())f.has(p)||(a.updated.has(p)?o.updated.has(p)&&f.add(p):t[p]!==void 0&&(n[p]=e[p]));for(const p of a.added.values())f.has(p)||(c.added.has(p)?o.updated.has(p)&&f.add(p):l[p]=t[p]);for(const p of c.added.values())f.has(p)||(a.added.has(p)?o.updated.has(p)&&f.add(p):i[p]=e[p]);return{local:{added:i,removed:[...r.values()],updated:n},remote:{added:l,removed:[...u.values()],updated:h},conflicts:[...f.values()]}}function ec(t,e){const s=t?Object.keys(t):[],i=e?Object.keys(e):[],n=i.filter(a=>!s.includes(a)).reduce((a,c)=>(a.add(c),a),new Set),r=s.filter(a=>!i.includes(a)).reduce((a,c)=>(a.add(c),a),new Set),o=new Set;for(const a of s){if(r.has(a))continue;const c=t[a],l=e[a];c!==l&&o.add(a)}return{added:n,removed:r,updated:o}}function V6(t,e){const{added:s,removed:i,updated:n}=ec(t,e);return s.size===0&&i.size===0&&n.size===0}function Wu(t){return JSON.parse(t.content)}var Hu=class extends pi{constructor(e,s,i,n,r,o,a,c,l,h,u,f){super({syncResource:"snippets",profile:e},s,n,i,r,o,a,h,u,c,l,f),this.ob=1,this.ub=e.snippetsHome,this.D(this.G.watch(i.userRoamingDataHome)),this.D(this.G.watch(this.ub)),this.D(O.filter(this.G.onDidFilesChange,p=>p.affects(this.ub))(()=>this.Q()))}async pb(e,s,i){const n=await this.Gb(),r=this.Fb(n),o=e.syncData?this.Eb(e.syncData):null;s=s===null&&i?e:s;const a=s&&s.syncData?this.Eb(s.syncData):null;o?this.O.trace(`${this.C}: Merging remote snippets with local snippets...`):this.O.trace(`${this.C}: Remote snippets does not exist. Synchronizing snippets for the first time.`);const c=Lm(r,o,a);return this.Ab(c,n,o||{},a||{})}async tb(e){const s=e.syncData?this.Eb(e.syncData):null;if(s===null)return!0;const i=await this.Gb(),n=this.Fb(i),r=Lm(n,s,s);return Object.keys(r.remote.added).length>0||Object.keys(r.remote.updated).length>0||r.remote.removed.length>0||r.conflicts.length>0}async qb(e,s){return e.previewResult}async rb(e,s,i,n){if(this.h.isEqualOrParent(s,this.g.with({scheme:I,authority:"local"})))return{content:e.fileContent?e.fileContent.value.toString():null,localChange:0,remoteChange:e.fileContent?e.remoteContent!==null?2:1:3};if(this.h.isEqualOrParent(s,this.g.with({scheme:I,authority:"remote"})))return{content:e.remoteContent,localChange:e.remoteContent!==null?e.fileContent?2:1:3,remoteChange:0};if(this.h.isEqualOrParent(s,this.g))return i===void 0?{content:e.previewResult.content,localChange:e.previewResult.localChange,remoteChange:e.previewResult.remoteChange}:{content:i,localChange:i===null?e.fileContent!==null?3:0:2,remoteChange:i===null?e.remoteContent!==null?3:0:2};throw new Error(`Invalid Resource: ${s.toString()}`)}async sb(e,s,i,n){const r=i.map(([o,a])=>({...o,acceptResult:a}));r.every(({localChange:o,remoteChange:a})=>o===0&&a===0)&&this.O.info(`${this.C}: No changes found during synchronizing snippets.`),r.some(({localChange:o})=>o!==0)&&(await this.Bb(r),await this.Cb(r,n)),r.some(({remoteChange:o})=>o!==0)&&(e=await this.Db(r,e,n)),s?.ref!==e.ref&&(this.O.trace(`${this.C}: Updating last synchronized snippets...`),await this.eb(e),this.O.info(`${this.C}: Updated last synchronized snippets`));for(const{previewResource:o}of r)try{await this.G.del(o)}catch{}}Ab(e,s,i,n){const r=new Map;for(const o of Object.keys(e.local.added)){const a={content:e.local.added[o],hasConflicts:!1,localChange:1,remoteChange:0};r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:null,fileContent:null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),localContent:null,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:i[o],previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of Object.keys(e.local.updated)){const a={content:e.local.updated[o],hasConflicts:!1,localChange:2,remoteChange:0},c=s[o]?s[o].value.toString():null;r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:s[o],localContent:c,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:i[o],previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of e.local.removed){const a={content:null,hasConflicts:!1,localChange:3,remoteChange:0},c=s[o]?s[o].value.toString():null;r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:s[o],localContent:c,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:null,previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of Object.keys(e.remote.added)){const a={content:e.remote.added[o],hasConflicts:!1,localChange:0,remoteChange:1},c=s[o]?s[o].value.toString():null;r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:s[o],localContent:c,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:null,previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of Object.keys(e.remote.updated)){const a={content:e.remote.updated[o],hasConflicts:!1,localChange:0,remoteChange:2},c=s[o]?s[o].value.toString():null;r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:s[o],localContent:c,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:i[o],previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of e.remote.removed){const a={content:null,hasConflicts:!1,localChange:0,remoteChange:3};r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:null,localContent:null,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:i[o],previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of e.conflicts){const a={content:n[o]??null,hasConflicts:!0,localChange:s[o]?2:1,remoteChange:i[o]?2:1},c=s[o]?s[o].value.toString():null;r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:s[o]||null,localContent:c,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:i[o]||null,previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of Object.keys(s))if(!r.has(o)){const a={content:s[o]?s[o].value.toString():null,hasConflicts:!1,localChange:0,remoteChange:0},c=s[o]?s[o].value.toString():null;r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:s[o]||null,localContent:c,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:i[o]||null,previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}return[...r.values()]}async resolveContent(e){return this.h.isEqualOrParent(e,this.g.with({scheme:I,authority:"remote"}))||this.h.isEqualOrParent(e,this.g.with({scheme:I,authority:"local"}))||this.h.isEqualOrParent(e,this.g.with({scheme:I,authority:"base"}))||this.h.isEqualOrParent(e,this.g.with({scheme:I,authority:"accepted"}))?this.cb(e):null}async hasLocalData(){try{const e=await this.Gb();if(Object.keys(e).length)return!0}catch{}return!1}async Bb(e){const s={};for(const i of e)i.fileContent&&(s[this.h.basename(i.localResource)]=i.fileContent);await this.mb(JSON.stringify(this.Fb(s)))}async Cb(e,s){for(const{fileContent:i,acceptResult:n,localResource:r,remoteResource:o,localChange:a}of e)if(a!==0){const c=o?this.h.basename(o):this.h.basename(r),l=this.h.joinPath(this.ub,c);a===3?(this.O.trace(`${this.C}: Deleting snippet...`,this.h.basename(l)),await this.G.del(l),this.O.info(`${this.C}: Deleted snippet`,this.h.basename(l))):a===1?(this.O.trace(`${this.C}: Creating snippet...`,this.h.basename(l)),await this.G.createFile(l,L.fromString(n.content),{overwrite:s}),this.O.info(`${this.C}: Created snippet`,this.h.basename(l))):(this.O.trace(`${this.C}: Updating snippet...`,this.h.basename(l)),await this.G.writeFile(l,L.fromString(n.content),s?void 0:i),this.O.info(`${this.C}: Updated snippet`,this.h.basename(l)))}}async Db(e,s,i){const n=s.syncData?this.Eb(s.syncData):{},r=Ht(n);for(const{acceptResult:o,localResource:a,remoteResource:c,remoteChange:l}of e)if(l!==0){const h=a?this.h.basename(a):this.h.basename(c);l===3?delete r[h]:r[h]=o.content}return V6(n,r)||(this.O.trace(`${this.C}: Updating remote snippets...`),s=await this.lb(JSON.stringify(r),i?null:s.ref),this.O.info(`${this.C}: Updated remote snippets`)),s}Eb(e){return Wu(e)}Fb(e){const s={};for(const i of Object.keys(e))s[i]=e[i].value.toString();return s}async Gb(){const e={};let s;try{s=await this.G.resolve(this.ub)}catch(i){if(i instanceof Ye&&i.fileOperationResult===1)return e;throw i}for(const i of s.children||[]){const n=i.resource,r=this.h.extname(n);if(r===".json"||r===".code-snippets"){const o=this.h.relativePath(this.ub,n),a=await this.G.readFile(n);e[o]=a}}return e}};Hu=__decorate([__param(2,ae),__param(3,K),__param(4,re),__param(5,rt),__param(6,kt),__param(7,Re),__param(8,me),__param(9,mt),__param(10,ke),__param(11,he)],Hu);var Om=class extends gi{constructor(e,s,i,n,r,o){super("snippets",s,i,n,e,r,o)}async o(e){const s=e.syncData?JSON.parse(e.syncData.content):null;if(!s){this.j.info("Skipping initializing snippets because remote snippets does not exist.");return}if(!await this.i()){this.j.info("Skipping initializing snippets because local snippets exist.");return}for(const n of Object.keys(s)){const r=s[n];if(r){const o=this.d.joinPath(this.g.defaultProfile.snippetsHome,n);await this.k.createFile(o,L.fromString(r)),this.j.info("Created snippet",this.d.basename(o))}}await this.n(e)}async i(){try{return!(await this.k.resolve(this.g.defaultProfile.snippetsHome)).children?.length}catch(e){return e.fileOperationResult===1}}};Om=__decorate([__param(0,K),__param(1,Ne),__param(2,ae),__param(3,Re),__param(4,re),__param(5,he)],Om);var tc=class extends Fa{constructor(e,s,i,n,r,o,a,c,l,h,u,f,p,g){super(e,s,i,r,o,a,c,l,h,u,f,p,g),this.ob=1,this.zb=this.h.joinPath(this.g,n),this.Ab=this.zb.with({scheme:I,authority:"base"}),this.Bb=this.zb.with({scheme:I,authority:"local"}),this.Cb=this.zb.with({scheme:I,authority:"remote"}),this.Db=this.zb.with({scheme:I,authority:"accepted"})}async pb(e,s,i,n){const r=e.syncData?this.Eb(e.syncData.content):null;s=s===null&&i?e:s;const o=s?.syncData?this.Eb(s.syncData.content):null,a=await this.ub();let c=null,l=!1,h=!1,u=!1;if(e.syncData){const g=a?a.value.toString():null;if(!o||o!==g||o!==r){this.O.trace(`${this.C}: Merging remote ${this.syncResource.syncResource} with local ${this.syncResource.syncResource}...`);const m=this.Lb(g,r,o);c=m.content,u=m.hasConflicts,l=m.hasLocalChanged,h=m.hasRemoteChanged}}else a&&(this.O.trace(`${this.C}: Remote ${this.syncResource.syncResource} does not exist. Synchronizing ${this.syncResource.syncResource} for the first time.`),c=a.value.toString(),h=!0);const f={content:u?o:c,localChange:l?a?2:1:0,remoteChange:h?2:0,hasConflicts:u},p=a?a.value.toString():null;return[{fileContent:a,baseResource:this.Ab,baseContent:o,localResource:this.Bb,localContent:p,localChange:f.localChange,remoteResource:this.Cb,remoteContent:r,remoteChange:f.remoteChange,previewResource:this.zb,previewResult:f,acceptedResource:this.Db}]}async tb(e){const s=e?.syncData?this.Eb(e.syncData.content):null;if(s===null)return!0;const i=await this.ub(),n=i?i.value.toString():null,r=this.Lb(n,s,s);return r.hasLocalChanged||r.hasRemoteChanged}async qb(e,s){return e.previewResult}async rb(e,s,i,n){if(this.h.isEqual(s,this.Bb))return{content:e.fileContent?e.fileContent.value.toString():null,localChange:0,remoteChange:2};if(this.h.isEqual(s,this.Cb))return{content:e.remoteContent,localChange:2,remoteChange:0};if(this.h.isEqual(s,this.zb))return i===void 0?{content:e.previewResult.content,localChange:e.previewResult.localChange,remoteChange:e.previewResult.remoteChange}:{content:i,localChange:2,remoteChange:2};throw new Error(`Invalid Resource: ${s.toString()}`)}async sb(e,s,i,n){const{fileContent:r}=i[0][0],{content:o,localChange:a,remoteChange:c}=i[0][1];if(a===0&&c===0&&this.O.info(`${this.C}: No changes found during synchronizing ${this.syncResource.syncResource}.`),a!==0&&(this.O.trace(`${this.C}: Updating local ${this.syncResource.syncResource}...`),r&&await this.mb(JSON.stringify(this.Fb(r.value.toString()))),o?await this.vb(o,r,n):await this.wb(),this.O.info(`${this.C}: Updated local ${this.syncResource.syncResource}`)),c!==0){this.O.trace(`${this.C}: Updating remote ${this.syncResource.syncResource}...`);const l=JSON.stringify(this.Fb(o));e=await this.lb(l,n?null:e.ref),this.O.info(`${this.C}: Updated remote ${this.syncResource.syncResource}`)}try{await this.G.del(this.zb)}catch{}s?.ref!==e.ref&&(this.O.trace(`${this.C}: Updating last synchronized ${this.syncResource.syncResource}...`),await this.eb(e),this.O.info(`${this.C}: Updated last synchronized ${this.syncResource.syncResource}`))}async hasLocalData(){return this.G.exists(this.r)}async resolveContent(e){return this.h.isEqual(this.Cb,e)||this.h.isEqual(this.Ab,e)||this.h.isEqual(this.Bb,e)||this.h.isEqual(this.Db,e)?this.cb(e):null}Lb(e,s,i){if(e===null&&s===null&&i===null)return{content:null,hasLocalChanged:!1,hasRemoteChanged:!1,hasConflicts:!1};if(e===s)return{content:null,hasLocalChanged:!1,hasRemoteChanged:!1,hasConflicts:!1};const n=i!==e,r=i!==s;return!n&&!r?{content:null,hasLocalChanged:!1,hasRemoteChanged:!1,hasConflicts:!1}:n&&!r?{content:e,hasRemoteChanged:!0,hasLocalChanged:!1,hasConflicts:!1}:r&&!n?{content:s,hasLocalChanged:!0,hasRemoteChanged:!1,hasConflicts:!1}:{content:e,hasLocalChanged:!0,hasRemoteChanged:!0,hasConflicts:!0}}};tc=__decorate([__param(4,K),__param(5,ae),__param(6,re),__param(7,rt),__param(8,kt),__param(9,mt),__param(10,ke),__param(11,Re),__param(12,me),__param(13,he)],tc);function Gu(t,e){try{return JSON.parse(t).tasks??null}catch(s){return e.error(s),null}}var Ju=class extends tc{constructor(e,s,i,n,r,o,a,c,l,h,u,f){super(e.tasksResource,{syncResource:"tasks",profile:e},s,"tasks.json",c,l,h,i,n,a,u,r,o,f)}Eb(e){return Gu(e,this.O)}Fb(e){return e?{tasks:e}:{}}};Ju=__decorate([__param(2,rt),__param(3,kt),__param(4,Re),__param(5,me),__param(6,mt),__param(7,K),__param(8,ae),__param(9,re),__param(10,ke),__param(11,he)],Ju);var Nm=class extends gi{constructor(e,s,i,n,r,o){super("tasks",s,i,n,e,r,o),this.c=this.g.defaultProfile.tasksResource}async o(e){const s=e.syncData?Gu(e.syncData.content,this.j):null;if(!s){this.j.info("Skipping initializing tasks because remote tasks does not exist.");return}if(!await this.p()){this.j.info("Skipping initializing tasks because local tasks exist.");return}await this.k.writeFile(this.c,L.fromString(s)),await this.n(e)}async p(){return this.k.exists(this.c)}};Nm=__decorate([__param(0,K),__param(1,Ne),__param(2,ae),__param(3,Re),__param(4,re),__param(5,he)],Nm);function Tm(t,e){try{return JSON.parse(t).mcp??null}catch(s){return e.error(s),null}}var Ku=class extends tc{constructor(e,s,i,n,r,o,a,c,l,h,u,f){super(e.mcpResource,{syncResource:"mcp",profile:e},s,"mcp.json",c,l,h,i,n,a,u,r,o,f)}Eb(e){return Tm(e,this.O)}Fb(e){return e?{mcp:e}:{}}};Ku=__decorate([__param(2,rt),__param(3,kt),__param(4,Re),__param(5,me),__param(6,mt),__param(7,K),__param(8,ae),__param(9,re),__param(10,ke),__param(11,he)],Ku);function sc(t,e,s,i){const n={added:[],removed:[],updated:[]};let r={added:[],removed:[],updated:[]};if(!e){const a=t.filter(({id:c})=>!i.includes(c));return a.length?r.added=a:r=null,{local:n,remote:r}}const o=Qu(t,e,i);if(o.added.length>0||o.removed.length>0||o.updated.length>0){const a=Qu(s,t,i),c=Qu(s,e,i);for(const l of c.removed){const h=t.find(u=>u.id===l);h&&n.removed.push(h)}for(const l of c.added){const h=e.find(u=>u.id===l);a.added.includes(l)?o.updated.includes(l)&&n.updated.push(h):n.added.push(h)}for(const l of c.updated)n.updated.push(e.find(h=>h.id===l));for(const l of a.added)c.added.includes(l)||r.added.push(t.find(h=>h.id===l));for(const l of a.updated)c.removed.includes(l)||c.updated.includes(l)||r.updated.push(t.find(h=>h.id===l));for(const l of a.removed){const h=e.find(u=>u.id===l);h&&r.removed.push(h)}}return r.added.length===0&&r.removed.length===0&&r.updated.length===0&&(r=null),{local:n,remote:r}}function Qu(t,e,s){t=t?t.filter(({id:c})=>!s.includes(c)):[],e=e.filter(({id:c})=>!s.includes(c));const i=t.map(({id:c})=>c),n=e.map(({id:c})=>c),r=n.filter(c=>!i.includes(c)),o=i.filter(c=>!n.includes(c)),a=[];for(const{id:c,name:l,icon:h,useDefaultFlags:u}of t){if(o.includes(c))continue;const f=e.find(p=>p.id===c);(!f||f.name!==l||f.icon!==h||!bt(f.useDefaultFlags,u))&&a.push(c)}return{added:r,removed:o,updated:a}}var Vr=class extends pi{constructor(e,s,i,n,r,o,a,c,l,h,u,f,p){super({syncResource:"profiles",profile:e},s,n,r,o,a,c,u,f,l,h,p),this.ub=i,this.ob=2,this.previewResource=this.h.joinPath(this.g,"profiles.json"),this.baseResource=this.previewResource.with({scheme:I,authority:"base"}),this.localResource=this.previewResource.with({scheme:I,authority:"local"}),this.remoteResource=this.previewResource.with({scheme:I,authority:"remote"}),this.acceptedResource=this.previewResource.with({scheme:I,authority:"accepted"}),this.D(i.onDidChangeProfiles(()=>this.Q()))}async getLastSyncedProfiles(){const e=await this.getLastSyncUserData();return e?.syncData?Xi(e.syncData):null}async getRemoteSyncedProfiles(e){const s=await this.getLastSyncUserData(),i=await this.W(e,s);return i?.syncData?Xi(i.syncData):null}async pb(e,s,i){const n=e.syncData?Xi(e.syncData):null,r=s?.syncData?Xi(s.syncData):null,o=this.Cb(),{local:a,remote:c}=sc(o,n,r,[]),l={local:a,remote:c,content:r?this.Db(r):null,localChange:a.added.length>0||a.removed.length>0||a.updated.length>0?2:0,remoteChange:c!==null?2:0},h=Xu(o,!1);return[{baseResource:this.baseResource,baseContent:r?this.Db(r):null,localResource:this.localResource,localContent:h,remoteResource:this.remoteResource,remoteContent:n?this.Db(n):null,remoteProfiles:n,previewResource:this.previewResource,previewResult:l,localChange:l.localChange,remoteChange:l.remoteChange,acceptedResource:this.acceptedResource}]}async tb(e){const s=e?.syncData?Xi(e.syncData):null,i=this.Cb(),{remote:n}=sc(i,s,s,[]);return!!n?.added.length||!!n?.removed.length||!!n?.updated.length}async qb(e,s){return{...e.previewResult,hasConflicts:!1}}async rb(e,s,i,n){if(this.h.isEqual(s,this.localResource))return this.zb(e);if(this.h.isEqual(s,this.remoteResource))return this.Ab(e);if(this.h.isEqual(s,this.previewResource))return e.previewResult;throw new Error(`Invalid Resource: ${s.toString()}`)}async zb(e){const s=this.Cb(),i=sc(s,null,null,[]),{local:n,remote:r}=i;return{content:e.localContent,local:n,remote:r,localChange:n.added.length>0||n.removed.length>0||n.updated.length>0?2:0,remoteChange:r!==null?2:0}}async Ab(e){const s=e.remoteContent?JSON.parse(e.remoteContent):null,i=[],n=[];for(const r of this.Cb()){const o=s?.find(a=>a.id===r.id);o&&(i.push({id:r.id,name:r.name,collection:o.collection}),n.push(r))}if(s!==null){const r=sc(n,s,i,[]),{local:o,remote:a}=r;return{content:e.remoteContent,local:o,remote:a,localChange:o.added.length>0||o.removed.length>0||o.updated.length>0?2:0,remoteChange:a!==null?2:0}}else return{content:e.remoteContent,local:{added:[],removed:[],updated:[]},remote:null,localChange:0,remoteChange:0}}async sb(e,s,i,n){const{local:r,remote:o,localChange:a,remoteChange:c}=i[0][1];a===0&&c===0&&this.O.info(`${this.C}: No changes found during synchronizing profiles.`);const l=i[0][0].remoteProfiles||[];if(l.length+(o?.added.length??0)-(o?.removed.length??0)>20)throw new Ce("Too many profiles to sync. Please remove some profiles and try again.","LocalTooManyProfiles");if(a!==0&&(await this.mb(Xu(this.Cb(),!1)),await Promise.all(r.removed.map(async h=>{this.O.trace(`${this.C}: Removing '${h.name}' profile...`),await this.ub.removeProfile(h),this.O.info(`${this.C}: Removed profile '${h.name}'.`)})),await Promise.all(r.added.map(async h=>{this.O.trace(`${this.C}: Creating '${h.name}' profile...`),await this.ub.createProfile(h.id,h.name,{icon:h.icon,useDefaultFlags:h.useDefaultFlags}),this.O.info(`${this.C}: Created profile '${h.name}'.`)})),await Promise.all(r.updated.map(async h=>{const u=this.ub.profiles.find(f=>f.id===h.id);u?(this.O.trace(`${this.C}: Updating '${h.name}' profile...`),await this.ub.updateProfile(u,{name:h.name,icon:h.icon,useDefaultFlags:h.useDefaultFlags}),this.O.info(`${this.C}: Updated profile '${h.name}'.`)):this.O.info(`${this.C}: Could not find profile with id '${h.id}' to update.`)}))),c!==0){this.O.trace(`${this.C}: Updating remote profiles...`);const h=[],u=l.length+(o?.added.length??0)<=20;if(u)for(const f of o?.added||[]){const p=await this.J.createCollection(this.F);this.O.trace(`${this.C}: Created collection "${p}" for "${f.name}".`),h.push(p),l.push({id:f.id,name:f.name,collection:p,icon:f.icon,useDefaultFlags:f.useDefaultFlags})}else this.O.info(`${this.C}: Could not create remote profiles as there are too many profiles.`);for(const f of o?.removed||[])l.splice(l.findIndex(({id:p})=>f.id===p),1);for(const f of o?.updated||[]){const p=l.find(({id:g})=>f.id===g);p&&l.splice(l.indexOf(p),1,{...p,id:f.id,name:f.name,icon:f.icon,useDefaultFlags:f.useDefaultFlags})}try{e=await this.updateRemoteProfiles(l,n?null:e.ref),this.O.info(`${this.C}: Updated remote profiles.${u&&o?.added.length?` Added: ${JSON.stringify(o.added.map(f=>f.name))}.`:""}${o?.updated.length?` Updated: ${JSON.stringify(o.updated.map(f=>f.name))}.`:""}${o?.removed.length?` Removed: ${JSON.stringify(o.removed.map(f=>f.name))}.`:""}`)}catch(f){if(h.length){this.O.info(`${this.C}: Failed to update remote profiles. Cleaning up added collections...`);for(const p of h)await this.J.deleteCollection(p,this.F)}throw f}for(const f of o?.removed||[])await this.J.deleteCollection(f.collection,this.F)}s?.ref!==e.ref&&(this.O.trace(`${this.C}: Updating last synchronized profiles...`),await this.eb(e),this.O.info(`${this.C}: Updated last synchronized profiles.`))}async updateRemoteProfiles(e,s){return this.lb(this.Db(e),s)}async hasLocalData(){return this.Cb().length>0}async resolveContent(e){if(this.h.isEqual(this.remoteResource,e)||this.h.isEqual(this.baseResource,e)||this.h.isEqual(this.localResource,e)||this.h.isEqual(this.acceptedResource,e)){const s=await this.cb(e);return s&&xr(JSON.parse(s),{})}return null}Cb(){return this.ub.profiles.filter(e=>!e.isDefault&&!e.isTransient)}Db(e){return JSON.stringify([...e].sort((s,i)=>s.name.localeCompare(i.name)))}};Vr=__decorate([__param(2,Ne),__param(3,K),__param(4,ae),__param(5,re),__param(6,rt),__param(7,kt),__param(8,Re),__param(9,me),__param(10,mt),__param(11,ke),__param(12,he)],Vr);function Xu(t,e){const s=[...t].sort((i,n)=>i.name.localeCompare(n.name)).map(i=>({id:i.id,name:i.name}));return e?xr(s,{}):JSON.stringify(s)}function Xi(t){return JSON.parse(t.content)}var Zu="sync.lastSyncTime",Yu=class extends j{get status(){return this.f}get conflicts(){return this.j}get lastSyncTime(){return this.r}constructor(e,s,i,n,r,o,a,c,l,h,u){super(),this.z=e,this.C=s,this.F=i,this.G=n,this.H=r,this.I=o,this.J=a,this.L=c,this.M=l,this.N=h,this.O=u,this.f="uninitialized",this.g=this.D(new R),this.onDidChangeStatus=this.g.event,this.h=this.D(new R),this.onDidChangeLocal=this.h.event,this.j=[],this.m=this.D(new R),this.onDidChangeConflicts=this.m.event,this.n=[],this.q=this.D(new R),this.onSyncErrors=this.q.event,this.r=void 0,this.t=this.D(new R),this.onDidChangeLastSyncTime=this.t.event,this.u=this.D(new R),this.onDidResetLocal=this.u.event,this.w=this.D(new R),this.onDidResetRemote=this.w.event,this.y=new Map,this.f=i.userDataSyncStore?"idle":"uninitialized",this.r=this.J.getNumber(Zu,-1,void 0),this.D(pe(()=>this.cb())),this.D(new ps(()=>this.W(),5*1e3)).schedule()}async createSyncTask(e,s){this.db(),this.H.info("Sync started.");const i=new Date().getTime(),n=tt();try{const c=Un(n);s&&(c["Cache-Control"]="no-cache"),e=await this.C.manifest(e,c)}catch(c){const l=Ce.toUserDataSyncError(c);throw ic(l,n,this.F,this.I),l}const r=!1,o=this;let a;return{manifest:e,async run(){if(r)throw new Error("Can run a task only once");a=yt(c=>o.P(e,!1,n,c)),await a.finally(()=>a=void 0),o.H.info(`Sync done. Took ${new Date().getTime()-i}ms`),o.ab()},stop(){return a?.cancel(),o.U()}}}async createManualSyncTask(){if(this.db(),this.L.isEnabled())throw new Ce("Cannot start manual sync when sync is enabled","LocalError");this.H.info("Sync started.");const e=new Date().getTime(),s=tt(),i=Un(s);let n;try{n=await this.C.getLatestData(i)}catch(a){const c=Ce.toUserDataSyncError(a);this.I.publicLog2("sync.download.latest",{code:c.code,serverCode:c instanceof Ie?String(c.serverCode):void 0,url:c instanceof Ie?c.url:void 0,resource:c.resource,executionId:s,service:this.F.userDataSyncStore.url.toString()});try{n=await this.C.manifest(null,i)}catch(l){const h=Ce.toUserDataSyncError(l);throw ic(h,s,this.F,this.I),h}}await this.resetLocal();const r=this,o=new fs;return{id:s,async merge(){return r.P(n,!0,s,o.token)},async apply(){try{try{await r.R(n,s,o.token)}catch(a){if(Ce.toUserDataSyncError(a).code==="MethodNotFound")r.H.info("Client is making invalid requests. Cleaning up data..."),await r.cleanUpRemoteData(),r.H.info("Applying manual sync again..."),await r.R(n,s,o.token);else throw a}}catch(a){throw r.H.error(a),a}r.H.info(`Sync done. Took ${new Date().getTime()-e}ms`),r.ab()},async stop(){o.cancel(),await r.U(),await r.resetLocal()}}}async P(e,s,i,n){this.n=[];try{this.status!=="hasConflicts"&&this.Z("syncing");const r=this.getOrCreateActiveProfileSynchronizer(this.M.defaultProfile,void 0);this.n.push(...await this.S(r,e,s,i,n));const o=r.enabled.find(a=>a.resource==="profiles");if(o){const a=await o.getLastSyncedProfiles()||[];if(n.isCancellationRequested)return;await this.Q(a,e,s,i,n)}}finally{this.status!=="hasConflicts"&&this.Z("idle"),this.q.fire(this.n)}}async Q(e,s,i,n,r){for(const o of e){if(r.isCancellationRequested)return;const a=this.M.profiles.find(l=>l.id===o.id);if(!a){this.H.error(`Profile with id:${o.id} and name: ${o.name} does not exist locally to sync.`);continue}this.H.info("Syncing profile.",o.name);const c=this.getOrCreateActiveProfileSynchronizer(a,o);this.n.push(...await this.S(c,s,i,n,r))}for(const[o,a]of this.y.entries())this.M.profiles.some(c=>c.id===a[0].profile.id)||(await a[0].resetLocal(),a[1].dispose(),this.y.delete(o))}async R(e,s,i){try{this.Z("syncing");const n=this.bb();for(const l of n){if(i.isCancellationRequested)return;await l.apply(s,i)}const r=n.find(l=>l.profile.isDefault);if(!r)return;const o=r.enabled.find(l=>l.resource==="profiles");if(!o)return;const c=(await o.getRemoteSyncedProfiles(ef(e,void 0,"profiles")??null)||[]).filter(l=>n.every(h=>h.profile.id!==l.id));c.length&&await this.Q(c,e,!1,s,i)}finally{this.Z("idle")}}async S(e,s,i,n,r){return(await e.sync(s,i,n,r)).map(([a,c])=>({profile:e.profile,syncResource:a,error:c}))}async U(){this.status!=="idle"&&await Promise.allSettled(this.bb().map(e=>e.stop()))}async resolveContent(e){const s=await this.N.resolveContent(e);if(s)return s;for(const i of this.bb())for(const n of i.enabled){const r=await n.resolveContent(e);if(r)return r}return null}async replace(e){this.db();const s=this.N.resolveUserDataSyncResource(e);if(!s)return;const i=await this.resolveContent(e.uri);i&&await this.X(s.profile,async n=>{if(s.syncResource===n.resource)return await n.replace(i),!0})}async accept(e,s,i,n){this.db(),await this.X(e.profile,async r=>{if(e.syncResource===r.resource)return await r.accept(s,i),n&&await r.apply(ls(n)?!1:n.force,Un(tt())),!0})}async hasLocalData(){return!!await this.X(this.M.defaultProfile,async s=>{if(s.resource!=="globalState"&&await s.hasLocalData())return!0})}async hasPreviouslySynced(){return!!await this.X(this.M.defaultProfile,async s=>{if(await s.hasPreviouslySynced())return!0})}async reset(){this.db(),await this.resetRemote(),await this.resetLocal()}async resetRemote(){this.db();try{await this.C.clear(),this.H.info("Cleared data on server")}catch(e){this.H.error(e)}this.w.fire()}async resetLocal(){this.db(),this.r=void 0,this.J.remove(Zu,-1);for(const[e]of this.y.values())try{await e.resetLocal()}catch(s){this.H.error(s)}this.cb(),this.u.fire(),this.H.info("Did reset the local sync state.")}async W(){const e=this.J.keys(-1,1),s=[];for(const n of e){if(!n.endsWith(".lastSyncUserData"))continue;const r=n.split(".");r.length===3&&s.push([n,r[0]])}if(!s.length)return;const i=new Pe;try{let n=this.y.get(this.M.defaultProfile.id)?.[0];n||(n=i.add(this.G.createInstance(_n,this.M.defaultProfile,void 0)));const r=n.enabled.find(c=>c.resource==="profiles");if(!r)return;const a=(await r.getLastSyncedProfiles())?.map(c=>c.collection)??[];for(const[c,l]of s)a.includes(l)||(this.H.info(`Removing last sync state for stale profile: ${l}`),this.J.remove(c,-1))}finally{i.dispose()}}async cleanUpRemoteData(){const e=await this.N.getRemoteSyncedProfiles(),s=e.map(o=>o.collection),i=await this.C.getAllCollections(),n=i.filter(o=>!s.includes(o));n.length&&(this.H.info(`Deleting ${n.length} redundant collections on server`),await Promise.allSettled(n.map(o=>this.C.deleteCollection(o))),this.H.info("Deleted redundant collections on server"));const r=e.filter(o=>i.includes(o.collection));if(r.length!==e.length){const o=this.G.createInstance(Vr,this.M.defaultProfile,void 0);try{this.H.info("Resetting the last synced state of profiles"),await o.resetLocal(),this.H.info("Did reset the last synced state of profiles"),this.H.info("Updating remote profiles with invalid collections on server"),await o.updateRemoteProfiles(r,null),this.H.info("Updated remote profiles on server")}finally{o.dispose()}}}async saveRemoteActivityData(e){this.db();const s=await this.C.getActivityData();await this.z.writeFile(e,s)}async extractActivityData(e,s){const i=(await this.z.readFile(e)).value.toString(),n=JSON.parse(i);if(n.resources)for(const r in n.resources)for(const o of n.resources[r])await this.O.writeResource(r,o.content,new Date(o.created*1e3),void 0,s);if(n.collections)for(const r in n.collections)for(const o in n.collections[r].resources)for(const a of n.collections[r].resources?.[o]??[])await this.O.writeResource(o,a.content,new Date(a.created*1e3),r,s)}async X(e,s){const i=new Pe;try{const n=this.y.get(e.id);if(n){const l=await this.Y(n[0],s,i);return ot(l)?null:l}if(e.isDefault){const l=i.add(this.G.createInstance(_n,e,void 0)),h=await this.Y(l,s,i);return ot(h)?null:h}const r=i.add(this.G.createInstance(Vr,e,void 0)),o=await this.C.manifest(null),c=(await r.getRemoteSyncedProfiles(o?.latest?.profiles??null)||[]).find(l=>l.id===e.id);if(c){const l=i.add(this.G.createInstance(_n,e,c.collection)),h=await this.Y(l,s,i);return ot(h)?null:h}return null}finally{i.dispose()}}async Y(e,s,i){const n=[...e.enabled,...e.disabled.reduce((r,o)=>(o!=="workspaceState"&&r.push(i.add(e.createSynchronizer(o))),r),[])];for(const r of n){const o=await s(r);if(!ot(o))return o}}Z(e){const s=this.f;this.f!==e&&(this.f=e,this.g.fire(e),s==="hasConflicts"&&this.ab())}$(){const e=this.bb().map(s=>s.conflicts).flat();jt(this.j,e,(s,i)=>s.profile.id===i.profile.id&&s.syncResource===i.syncResource&&jt(s.conflicts,i.conflicts,(n,r)=>Vs(n.previewResource,r.previewResource)))||(this.j=e,this.m.fire(e))}ab(){this.status==="idle"&&(this.r=new Date().getTime(),this.J.store(Zu,this.r,-1,1),this.t.fire(this.r))}getOrCreateActiveProfileSynchronizer(e,s){let i=this.y.get(e.id);if(i&&i[0].collection!==s?.collection&&(this.H.error("Profile synchronizer collection does not match with the remote sync profile collection"),i[1].dispose(),i=void 0,this.y.delete(e.id)),!i){const n=new Pe,r=n.add(this.G.createInstance(_n,e,s?.collection));n.add(r.onDidChangeStatus(o=>this.Z(o))),n.add(r.onDidChangeConflicts(o=>this.$())),n.add(r.onDidChangeLocal(o=>this.h.fire(o))),this.y.set(e.id,i=[r,n])}return i[0]}bb(){const e=[];for(const[s]of this.y.values())e.push(s);return e}cb(){this.y.forEach(([,e])=>e.dispose()),this.y.clear()}db(){if(!this.F.userDataSyncStore)throw new Error("Not enabled")}};Yu=__decorate([__param(0,K),__param(1,rt),__param(2,ui),__param(3,ns),__param(4,Re),__param(5,ke),__param(6,re),__param(7,mt),__param(8,Ne),__param(9,cu),__param(10,kt)],Yu);var _n=class extends j{get enabled(){return this.f.sort((e,s)=>e[1]-s[1]).map(([e])=>e)}get disabled(){return Mn.filter(e=>!this.q.isResourceEnabled(e))}get status(){return this.g}get conflicts(){return this.m}constructor(e,s,i,n,r,o,a,c,l){super(),this.profile=e,this.collection=s,this.q=i,this.r=n,this.t=r,this.u=o,this.w=a,this.y=c,this.z=l,this.f=[],this.g="idle",this.h=this.D(new R),this.onDidChangeStatus=this.h.event,this.j=this.D(new R),this.onDidChangeLocal=this.j.event,this.m=[],this.n=this.D(new R),this.onDidChangeConflicts=this.n.event,this.D(i.onDidChangeResourceEnablement(([h,u])=>this.C(h,u))),this.D(pe(()=>this.f.splice(0,this.f.length).forEach(([,,h])=>h.dispose())));for(const h of Mn)i.isResourceEnabled(h)&&this.F(h)}C(e,s){s?this.F(e):this.G(e)}F(e){if(this.f.some(([r])=>r.resource===e))return;if(e==="extensions"&&!this.t.isEnabled()){this.y.info("Skipping extensions sync because gallery is not configured");return}if(e==="profiles"&&!this.profile.isDefault||e==="workspaceState")return;if(e!=="profiles"&&this.profile.useDefaultFlags?.[e]){this.y.debug(`Skipping syncing ${e} in ${this.profile.name} because it is already synced by default profile`);return}const s=new Pe,i=s.add(this.createSynchronizer(e));s.add(i.onDidChangeStatus(()=>this.L())),s.add(i.onDidChangeConflicts(()=>this.M())),s.add(i.onDidChangeLocal(()=>this.j.fire(e)));const n=this.N(e);this.f.push([i,n,s])}G(e){const s=this.f.findIndex(([i])=>i.resource===e);if(s!==-1){const[[i,,n]]=this.f.splice(s,1);n.dispose(),this.L(),i.stop().then(null,r=>this.y.error(r))}}createSynchronizer(e){switch(e){case"settings":return this.r.createInstance(Ya,this.profile,this.collection);case"keybindings":return this.r.createInstance(Mu,this.profile,this.collection);case"snippets":return this.r.createInstance(Hu,this.profile,this.collection);case"prompts":return this.r.createInstance(Fu,this.profile,this.collection);case"tasks":return this.r.createInstance(Ju,this.profile,this.collection);case"mcp":return this.r.createInstance(Ku,this.profile,this.collection);case"globalState":return this.r.createInstance(Au,this.profile,this.collection);case"extensions":return this.r.createInstance(Pu,this.profile,this.collection);case"profiles":return this.r.createInstance(Vr,this.profile,this.collection)}}async sync(e,s,i,n){if(n.isCancellationRequested)return[];const r=this.enabled;if(!r.length)return[];try{const o=[],a=Un(i),c=s?await this.H(e):this.I();for(const l of r){if(n.isCancellationRequested)return[];if(!this.q.isResourceEnabled(l.resource))return[];try{const h=ef(e,this.collection,l.resource)??null;await l.sync(h,s,c,a)}catch(h){const u=Ce.toUserDataSyncError(h);if(ic(u,i,this.u,this.w),jm(h))throw u;this.y.error(h),this.y.error(`${l.resource}: ${Xt(h)}`),o.push([l.resource,u])}}return o}finally{this.L()}}async apply(e,s){const i=Un(e);for(const n of this.enabled){if(s.isCancellationRequested)return;try{await n.apply(!1,i)}catch(r){const o=Ce.toUserDataSyncError(r);if(ic(o,e,this.u,this.w),jm(r))throw o;this.y.error(r),this.y.error(`${n.resource}: ${Xt(r)}`)}}}async stop(){for(const e of this.enabled)try{e.status!=="idle"&&await e.stop()}catch(s){this.y.error(s)}}async resetLocal(){for(const e of this.enabled)try{await e.resetLocal()}catch(s){this.y.error(`${e.resource}: ${Xt(s)}`),this.y.error(s)}}async H(e){if(!this.profile.isDefault)return{};const s=this.I(),i=this.enabled.find(n=>n instanceof Ya);if(i){const n=await i.getRemoteUserDataSyncConfiguration(ef(e,this.collection,"settings")??null);return{...s,...n}}return s}I(){return this.z.getValue(Aa)}J(e){this.g!==e&&(this.g=e,this.h.fire(e))}L(){return this.M(),this.enabled.some(e=>e.status==="hasConflicts")?this.J("hasConflicts"):this.enabled.some(e=>e.status==="syncing")?this.J("syncing"):this.J("idle")}M(){const e=this.enabled.filter(s=>s.status==="hasConflicts").filter(s=>s.conflicts.conflicts.length>0).map(s=>s.conflicts);jt(this.m,e,(s,i)=>s.syncResource===i.syncResource&&jt(s.conflicts,i.conflicts,(n,r)=>Vs(n.previewResource,r.previewResource)))||(this.m=e,this.n.fire(e))}N(e){switch(e){case"settings":return 0;case"keybindings":return 1;case"snippets":return 2;case"tasks":return 3;case"mcp":return 4;case"globalState":return 5;case"extensions":return 6;case"prompts":return 7;case"profiles":return 8;case"workspaceState":return 9}}};_n=__decorate([__param(2,mt),__param(3,ns),__param(4,xs),__param(5,ui),__param(6,ke),__param(7,Re),__param(8,me)],_n);function jm(t){if(t instanceof Ce)switch(t.code){case"MethodNotFound":case"TooLarge":case"RemoteTooManyRequests":case"TooManyRequestsAndRetryAfter":case"LocalTooManyRequests":case"LocalTooManyProfiles":case"Gone":case"UpgradeRequired":case"IncompatibleRemoteContent":case"IncompatibleLocalContent":return!0}return!1}function ic(t,e,s,i){i.publicLog2("sync/error",{code:t.code,serverCode:t instanceof Ie?String(t.serverCode):void 0,url:t instanceof Ie?t.url:void 0,resource:t.resource,executionId:e,service:s.userDataSyncStore.url.toString()})}function ef(t,e,s){return l6(t)?e?t?.collections?.[e]?.latest?.[s]:t?.latest?.[s]:e?t?.collections?.[e]?.resources?.[s]:t?.resources?.[s]}function B6(t,e){return{...t,profile:Yt(t.profile,e.profilesHome.scheme)}}function W6(t){return{created:t.created,uri:k.revive(t.uri)}}var H6=class{constructor(t,e,s){this.c=t,this.d=e,this.f=s,this.a=new Map,this.b=new R}listen(t,e){switch(e){case"onDidChangeStatus":return this.c.onDidChangeStatus;case"onDidChangeConflicts":return this.c.onDidChangeConflicts;case"onDidChangeLocal":return this.c.onDidChangeLocal;case"onDidChangeLastSyncTime":return this.c.onDidChangeLastSyncTime;case"onSyncErrors":return this.c.onSyncErrors;case"onDidResetLocal":return this.c.onDidResetLocal;case"onDidResetRemote":return this.c.onDidResetRemote;case"manualSync/onSynchronizeResources":return this.b.event}throw new Error(`[UserDataSyncServiceChannel] Event not found: ${e}`)}async call(t,e,s){try{return await this.g(t,e,s)}catch(i){throw this.f.error(i),i}}async g(t,e,s){switch(e){case"_getInitialData":return Promise.resolve([this.c.status,this.c.conflicts,this.c.lastSyncTime]);case"reset":return this.c.reset();case"resetRemote":return this.c.resetRemote();case"resetLocal":return this.c.resetLocal();case"hasPreviouslySynced":return this.c.hasPreviouslySynced();case"hasLocalData":return this.c.hasLocalData();case"resolveContent":return this.c.resolveContent(k.revive(s[0]));case"accept":return this.c.accept(B6(s[0],this.d),k.revive(s[1]),s[2],s[3]);case"replace":return this.c.replace(W6(s[0]));case"cleanUpRemoteData":return this.c.cleanUpRemoteData();case"getRemoteActivityData":return this.c.saveRemoteActivityData(k.revive(s[0]));case"extractActivityData":return this.c.extractActivityData(k.revive(s[0]),k.revive(s[1]));case"createManualSyncTask":return this.i()}if(e.startsWith("manualSync/")){const i=e.substring(11),n=s[0],r=this.h(n);switch(s=s.slice(1),i){case"merge":return r.merge();case"apply":return r.apply().then(()=>this.a.delete(this.j(r.id)));case"stop":return r.stop().finally(()=>this.a.delete(this.j(r.id)))}}throw new Error("Invalid call")}h(t){const e=this.a.get(this.j(t));if(!e)throw new Error(`Manual sync taks not found: ${t}`);return e}async i(){const t=await this.c.createManualSyncTask();return this.a.set(this.j(t.id),t),t.id}j(t){return`manualSyncTask-${t}`}},Mm=class extends j{get status(){return this.b}get onDidChangeLocal(){return this.a.listen("onDidChangeLocal")}get conflicts(){return this.f}get lastSyncTime(){return this.h}get onDidResetLocal(){return this.a.listen("onDidResetLocal")}get onDidResetRemote(){return this.a.listen("onDidResetRemote")}constructor(e,s){super(),this.n=s,this.b="uninitialized",this.c=this.D(new R),this.onDidChangeStatus=this.c.event,this.f=[],this.g=this.D(new R),this.onDidChangeConflicts=this.g.event,this.h=void 0,this.j=this.D(new R),this.onDidChangeLastSyncTime=this.j.event,this.m=this.D(new R),this.onSyncErrors=this.m.event,this.a={call(i,n,r){return e.call(i,n,r).then(null,o=>{throw Ce.toUserDataSyncError(o)})},listen(i,n){return e.listen(i,n)}},this.a.call("_getInitialData").then(([i,n,r])=>{this.q(i),this.s(n),r&&this.t(r),this.D(this.a.listen("onDidChangeStatus")(o=>this.q(o))),this.D(this.a.listen("onDidChangeLastSyncTime")(o=>this.t(o)))}),this.D(this.a.listen("onDidChangeConflicts")(i=>this.s(i))),this.D(this.a.listen("onSyncErrors")(i=>this.m.fire(i.map(n=>({...n,error:Ce.toUserDataSyncError(n.error)})))))}createSyncTask(){throw new Error("not supported")}async createManualSyncTask(){const e=await this.a.call("createManualSyncTask"),s=this;return new G6(e,{async call(n,r,o){return s.a.call(`manualSync/${n}`,[e,...Array.isArray(r)?r:[r]],o)},listen(){throw new Error("not supported")}})}reset(){return this.a.call("reset")}resetRemote(){return this.a.call("resetRemote")}resetLocal(){return this.a.call("resetLocal")}hasPreviouslySynced(){return this.a.call("hasPreviouslySynced")}hasLocalData(){return this.a.call("hasLocalData")}accept(e,s,i,n){return this.a.call("accept",[e,s,i,n])}resolveContent(e){return this.a.call("resolveContent",[e])}cleanUpRemoteData(){return this.a.call("cleanUpRemoteData")}replace(e){return this.a.call("replace",[e])}saveRemoteActivityData(e){return this.a.call("getRemoteActivityData",[e])}extractActivityData(e,s){return this.a.call("extractActivityData",[e,s])}async q(e){this.b=e,this.c.fire(e)}async s(e){this.f=e.map(s=>({syncResource:s.syncResource,profile:Yt(s.profile,this.n.profilesHome.scheme),conflicts:s.conflicts.map(i=>({...i,baseResource:k.revive(i.baseResource),localResource:k.revive(i.localResource),remoteResource:k.revive(i.remoteResource),previewResource:k.revive(i.previewResource)}))})),this.g.fire(this.f)}t(e){this.h!==e&&(this.h=e,this.j.fire(e))}};Mm=__decorate([__param(1,Ne)],Mm);var G6=class extends j{constructor(t,e){super(),this.id=t,this.a=e}async merge(){return this.a.call("merge")}async apply(){return this.a.call("apply")}stop(){return this.a.call("stop")}dispose(){this.a.call("dispose"),super.dispose()}},tf=class extends C6{constructor(e,s,i,n){super(!0,e,s,i,n)}};tf=__decorate([__param(0,Ko),__param(1,Ne),__param(2,re),__param(3,Q)],tf);var J6=class extends j{constructor({onDidOpenMainWindow:t,onDidFocusMainWindow:e,getActiveWindowId:s}){super(),this.a=this.D(new Pe),O.latch(O.any(t,e))(this.f,this,this.a),this.b=yt(()=>s()),(async()=>{try{const n=await this.b;this.c=typeof this.c=="number"?this.c:n}catch{}finally{this.b=void 0}})()}f(t){this.b&&(this.b.cancel(),this.b=void 0),this.c=t}async getActiveClientId(){return`window:${this.b?await this.b:this.c}`}},K6="signService",nc=W(K6),Q6=class kw{constructor(){this.b=new Map}static{this.a=1}async createNewMessage(e){try{const s=await this.c();if(s){const i=String(kw.a++);return this.b.set(i,s),{id:i,data:s.createNewMessage(e)}}}catch{}return{id:"",data:e}}async validate(e,s){if(!e.id)return!0;const i=this.b.get(e.id);if(!i)return!1;this.b.delete(e.id);try{return i.validate(s)==="ok"}catch{return!1}finally{i.dispose?.()}}async sign(e){try{return await this.d(e)}catch{}return e}},X6=class extends Q6{c(){return this.h().then(t=>new t.validator)}d(t){return this.h().then(e=>new e.signer().sign(t))}async h(){const t="vsda",{default:e}=await import(t);return e}},Vx=W("tunnelService"),Um=W("sharedTunnelsService"),Fm;(function(t){t.Http="http",t.Https="https"})(Fm||(Fm={}));var rc;(function(t){t.ConstantPrivate="constantPrivate",t.Private="private",t.Public="public"})(rc||(rc={}));function Z6(t){return!!t.forwardPort}var qm;(function(t){t[t.Notify=1]="Notify",t[t.OpenBrowser=2]="OpenBrowser",t[t.OpenPreview=3]="OpenPreview",t[t.Silent=4]="Silent",t[t.Ignore=5]="Ignore",t[t.OpenBrowserOnce=6]="OpenBrowserOnce"})(qm||(qm={}));function Y6(t){if(t.scheme!=="http"&&t.scheme!=="https")return;const e=/^(localhost|127\.0\.0\.1|0\.0\.0\.0):(\d+)$/.exec(t.authority);if(e)return{address:e[1],port:+e[2]}}var sf=["localhost","127.0.0.1","0:0:0:0:0:0:0:1","::1"];function nf(t){return sf.indexOf(t)>=0}var rf=["0.0.0.0","0:0:0:0:0:0:0:0","::"];function Br(t){return rf.indexOf(t)>=0}function e8(t,e,s,i){if(s===1)return!1;if(s===2&&Br(e)){const n=/(\d+)\.(\d+)\.(\d+)/g.exec(i);if(n?.length===4&&parseInt(n[1])>=18)return!1}return t<1024}var of=class extends j{constructor(e,s){super(),this.q=e,this.r=s,this.a=new R,this.onTunnelOpened=this.a.event,this.b=new R,this.onTunnelClosed=this.b.event,this.c=new R,this.onAddedTunnelProvider=this.c.event,this.f=new Map,this.h=!1,this.j=!0,this.m=[],this.n=new Set}get hasTunnelProvider(){return!!this.g}get s(){const e=this.r.getValue("remote.localPortHost");return!e||e==="localhost"?"127.0.0.1":"0.0.0.0"}setTunnelProvider(e){return this.g=e,e?(this.c.fire(),{dispose:()=>{this.g=void 0,this.h=!1,this.m=[]}}):(this.h=!1,this.m=[],this.c.fire(),{dispose:()=>{}})}setTunnelFeatures(e){this.h=e.elevation,this.m=e.privacyOptions,this.j=e.protocol}get canChangeProtocol(){return this.j}get canElevate(){return this.h}get canChangePrivacy(){return this.m.length>0}get privacyOptions(){return this.m}get tunnels(){return this.t()}async t(){const e=[],s=Array.from(this.f.values());for(const i of s){const n=Array.from(i.values());for(const r of n){const o=await r.value;o&&typeof o!="string"&&e.push(o)}}return e}async dispose(){super.dispose();for(const e of this.f.values()){for(const{value:s}of e.values())await s.then(i=>typeof i!="string"?i?.dispose():void 0);e.clear()}this.f.clear()}setEnvironmentTunnel(e,s,i,n,r){this.y(e,s,Promise.resolve({tunnelRemoteHost:e,tunnelRemotePort:s,localAddress:i,privacy:n,protocol:r,dispose:()=>Promise.resolve()}))}async getExistingTunnel(e,s){(Br(e)||nf(e))&&(e=sf[0]);const i=this.C(e,s);if(i)return++i.refcount,i.value}openTunnel(e,s,i,n,r,o=!1,a,c){this.q.trace(`ForwardedPorts: (TunnelService) openTunnel request for ${s}:${i} on local port ${r}.`);const l=this.g??e;if(!l)return;if(s||(s="localhost"),n||(n=this.s),this.g&&this.n.has(i)){this.q.debug("ForwardedPorts: (TunnelService) Another call to create a tunnel with the same address has occurred before the last one completed. This call will be ignored.");return}const h=this.F(l,s,i,n,r,o,a,c);return h?h.then(u=>{if(u){if(typeof u=="string")return this.q.trace("ForwardedPorts: (TunnelService) The tunnel provider returned an error when creating the tunnel."),this.z(s,i),u}else{this.q.trace("ForwardedPorts: (TunnelService) New tunnel is undefined."),this.z(s,i);return}this.q.trace("ForwardedPorts: (TunnelService) New tunnel established.");const f=this.u(u);return(u.tunnelRemoteHost!==s||u.tunnelRemotePort!==i)&&this.q.warn("ForwardedPorts: (TunnelService) Created tunnel does not match requirements of requested tunnel. Host or port mismatch."),a&&u.privacy!==a&&this.q.warn("ForwardedPorts: (TunnelService) Created tunnel does not match requirements of requested tunnel. Privacy mismatch."),this.a.fire(f),f}):(this.q.trace("ForwardedPorts: (TunnelService) Tunnel was not created."),h)}u(e){return{tunnelRemotePort:e.tunnelRemotePort,tunnelRemoteHost:e.tunnelRemoteHost,tunnelLocalPort:e.tunnelLocalPort,localAddress:e.localAddress,privacy:e.privacy,protocol:e.protocol,dispose:async()=>{this.q.trace(`ForwardedPorts: (TunnelService) dispose request for ${e.tunnelRemoteHost}:${e.tunnelRemotePort} `);const s=this.f.get(e.tunnelRemoteHost);if(s){const i=s.get(e.tunnelRemotePort);i&&(i.refcount--,await this.w(e.tunnelRemoteHost,e.tunnelRemotePort,i))}}}}async w(e,s,i){if(i.refcount<=0){this.q.trace(`ForwardedPorts: (TunnelService) Tunnel is being disposed ${e}:${s}.`);const n=i.value.then(async r=>{r&&typeof r!="string"&&(await r.dispose(!0),this.b.fire({host:r.tunnelRemoteHost,port:r.tunnelRemotePort}))});return this.f.has(e)&&this.f.get(e).delete(s),n}}async closeTunnel(e,s){this.q.trace(`ForwardedPorts: (TunnelService) close request for ${e}:${s} `);const i=this.f.get(e);if(i&&i.has(s)){const n=i.get(s);n.refcount=0,await this.w(e,s,n)}}y(e,s,i){this.f.has(e)||this.f.set(e,new Map),this.f.get(e).set(s,{refcount:1,value:i})}async z(e,s){const i=this.f.get(e);if(i){const n=i.get(s),r=n?await n.value:void 0;(!r||typeof r=="string")&&i.delete(s),i.size===0&&this.f.delete(e)}}C(e,s){const i=[e];nf(e)?(i.push(...sf),i.push(...rf)):Br(e)&&i.push(...rf);const n=i.map(r=>this.f.get(r));for(const r of n){const o=r?.get(s);if(o)return o}}canTunnel(e){return!!Y6(e)}G(e,s,i,n,r,o,a){this.q.trace(`ForwardedPorts: (TunnelService) Creating tunnel with provider ${s}:${i} on local port ${n}.`);const c=i;this.n.add(c);const l=n===void 0?i:n,h={elevationRequired:r?this.isPortPrivileged(l):!1},u={remoteAddress:{host:s,port:i},localAddressPort:n,privacy:o,public:o?o!==rc.Private:void 0,protocol:a},f=e.forwardPort(u,h);return f?(this.y(s,i,f),f.finally(()=>{this.q.trace("ForwardedPorts: (TunnelService) Tunnel created by provider."),this.n.delete(c)})):this.n.delete(c),f}};of=__decorate([__param(0,Q),__param(1,me)],of);import*as t8 from"net";import*as s8 from"os";import*as i8 from"net";var _m={1:!0,7:!0,9:!0,11:!0,13:!0,15:!0,17:!0,19:!0,20:!0,21:!0,22:!0,23:!0,25:!0,37:!0,42:!0,43:!0,53:!0,69:!0,77:!0,79:!0,87:!0,95:!0,101:!0,102:!0,103:!0,104:!0,109:!0,110:!0,111:!0,113:!0,115:!0,117:!0,119:!0,123:!0,135:!0,137:!0,139:!0,143:!0,161:!0,179:!0,389:!0,427:!0,465:!0,512:!0,513:!0,514:!0,515:!0,526:!0,530:!0,531:!0,532:!0,540:!0,548:!0,554:!0,556:!0,563:!0,587:!0,601:!0,636:!0,989:!0,990:!0,993:!0,995:!0,1719:!0,1720:!0,1723:!0,2049:!0,3659:!0,4045:!0,5060:!0,5061:!0,6e3:!0,6566:!0,6665:!0,6666:!0,6667:!0,6668:!0,6669:!0,6697:!0,10080:!0};function n8(t,e,s,i="127.0.0.1"){let n=!1,r,o=1;const a=i8.createServer({pauseOnConnect:!0});function c(l,h){n||(n=!0,a.removeAllListeners(),a.close(),r&&clearTimeout(r),h(l))}return new Promise(l=>{r=setTimeout(()=>{c(0,l)},s),a.on("listening",()=>{c(t,l)}),a.on("error",h=>{h&&(h.code==="EADDRINUSE"||h.code==="EACCES")&&o<e?(t++,o++,a.listen(t,i)):c(0,l)}),a.on("close",()=>{c(0,l)}),a.listen(t,i)})}import"crypto";import"net";import"os";import"zlib";var zm;(function(t){t.Created="created",t.Read="read",t.Write="write",t.Open="open",t.Error="error",t.Close="close",t.BrowserWebSocketBlobReceived="browserWebSocketBlobReceived",t.NodeEndReceived="nodeEndReceived",t.NodeEndSent="nodeEndSent",t.NodeDrainBegin="nodeDrainBegin",t.NodeDrainEnd="nodeDrainEnd",t.zlibInflateError="zlibInflateError",t.zlibInflateData="zlibInflateData",t.zlibInflateInitialWrite="zlibInflateInitialWrite",t.zlibInflateInitialFlushFired="zlibInflateInitialFlushFired",t.zlibInflateWrite="zlibInflateWrite",t.zlibInflateFlushFired="zlibInflateFlushFired",t.zlibDeflateError="zlibDeflateError",t.zlibDeflateData="zlibDeflateData",t.zlibDeflateWrite="zlibDeflateWrite",t.zlibDeflateFlushFired="zlibDeflateFlushFired",t.WebSocketNodeSocketWrite="webSocketNodeSocketWrite",t.WebSocketNodeSocketPeekedHeader="webSocketNodeSocketPeekedHeader",t.WebSocketNodeSocketReadHeader="webSocketNodeSocketReadHeader",t.WebSocketNodeSocketReadData="webSocketNodeSocketReadData",t.WebSocketNodeSocketUnmaskedData="webSocketNodeSocketUnmaskedData",t.WebSocketNodeSocketDrainBegin="webSocketNodeSocketDrainBegin",t.WebSocketNodeSocketDrainEnd="webSocketNodeSocketDrainEnd",t.ProtocolHeaderRead="protocolHeaderRead",t.ProtocolMessageRead="protocolMessageRead",t.ProtocolHeaderWrite="protocolHeaderWrite",t.ProtocolMessageWrite="protocolMessageWrite",t.ProtocolWrite="protocolWrite"})(zm||(zm={}));var af;(function(t){t.enableDiagnostics=!1,t.records=[];const e=new WeakMap;let s=0;function i(r,o){if(!e.has(r)){const a=String(++s);e.set(r,a)}return e.get(r)}function n(r,o,a,c){if(!t.enableDiagnostics)return;const l=i(r,o);if(c instanceof L||c instanceof Uint8Array||c instanceof ArrayBuffer||ArrayBuffer.isView(c)){const h=L.alloc(c.byteLength);h.set(c),t.records.push({timestamp:Date.now(),id:l,label:o,type:a,buff:h})}else t.records.push({timestamp:Date.now(),id:l,label:o,type:a,data:c})}t.traceSocketEvent=n})(af||(af={}));var Vm;(function(t){t[t.NodeSocketCloseEvent=0]="NodeSocketCloseEvent",t[t.WebSocketCloseEvent=1]="WebSocketCloseEvent"})(Vm||(Vm={}));var cf=null;function mi(){return cf||(cf=L.alloc(0)),cf}var r8=class{get byteLength(){return this.b}constructor(){this.a=[],this.b=0}acceptChunk(t){this.a.push(t),this.b+=t.byteLength}read(t){return this.c(t,!0)}peek(t){return this.c(t,!1)}c(t,e){if(t===0)return mi();if(t>this.b)throw new Error("Cannot read so many bytes!");if(this.a[0].byteLength===t){const r=this.a[0];return e&&(this.a.shift(),this.b-=t),r}if(this.a[0].byteLength>t){const r=this.a[0].slice(0,t);return e&&(this.a[0]=this.a[0].slice(t),this.b-=t),r}const s=L.alloc(t);let i=0,n=0;for(;t>0;){const r=this.a[n];if(r.byteLength>t){const o=r.slice(0,t);s.set(o,i),i+=t,e&&(this.a[n]=r.slice(t),this.b-=t),t-=t}else s.set(r,i),i+=r.byteLength,e?(this.a.shift(),this.b-=r.byteLength):n++,t-=r.byteLength}return s}},Bm;(function(t){t[t.None=0]="None",t[t.Regular=1]="Regular",t[t.Control=2]="Control",t[t.Ack=3]="Ack",t[t.Disconnect=5]="Disconnect",t[t.ReplayRequest=6]="ReplayRequest",t[t.Pause=7]="Pause",t[t.Resume=8]="Resume",t[t.KeepAlive=9]="KeepAlive"})(Bm||(Bm={}));function Wm(t){switch(t){case 0:return"None";case 1:return"Regular";case 2:return"Control";case 3:return"Ack";case 5:return"Disconnect";case 6:return"ReplayRequest";case 7:return"PauseWriting";case 8:return"ResumeWriting";case 9:return"KeepAlive"}}var Hm;(function(t){t[t.HeaderLength=13]="HeaderLength",t[t.AcknowledgeTime=2e3]="AcknowledgeTime",t[t.TimeoutTime=2e4]="TimeoutTime",t[t.ReconnectionGraceTime=108e5]="ReconnectionGraceTime",t[t.ReconnectionShortGraceTime=3e5]="ReconnectionShortGraceTime",t[t.KeepAliveSendTime=5e3]="KeepAliveSendTime"})(Hm||(Hm={}));var Os=class{constructor(t,e,s,i){this.type=t,this.id=e,this.ack=s,this.data=i,this.writtenTime=0}get size(){return this.data.byteLength}},Gm=class extends j{constructor(t){super(),this.f=this.D(new R),this.onMessage=this.f.event,this.g={readHead:!0,readLen:13,messageType:0,id:0,ack:0},this.a=t,this.b=!1,this.c=new r8,this.D(this.a.onData(e=>this.acceptChunk(e))),this.lastReadTime=Date.now()}acceptChunk(t){if(!(!t||t.byteLength===0))for(this.lastReadTime=Date.now(),this.c.acceptChunk(t);this.c.byteLength>=this.g.readLen;){const e=this.c.read(this.g.readLen);if(this.g.readHead)this.g.readHead=!1,this.g.readLen=e.readUInt32BE(9),this.g.messageType=e.readUInt8(0),this.g.id=e.readUInt32BE(1),this.g.ack=e.readUInt32BE(5),this.a.traceSocketEvent("protocolHeaderRead",{messageType:Wm(this.g.messageType),id:this.g.id,ack:this.g.ack,messageSize:this.g.readLen});else{const s=this.g.messageType,i=this.g.id,n=this.g.ack;if(this.g.readHead=!0,this.g.readLen=13,this.g.messageType=0,this.g.id=0,this.g.ack=0,this.a.traceSocketEvent("protocolMessageRead",e),this.f.fire(new Os(s,i,n,e)),this.b)break}}}readEntireBuffer(){return this.c.read(this.c.byteLength)}dispose(){this.b=!0,super.dispose()}},Jm=class{constructor(t){this.k=null,this.a=!1,this.b=!1,this.c=t,this.d=[],this.f=0,this.lastWriteTime=0}dispose(){try{this.flush()}catch{}this.a=!0}drain(){return this.flush(),this.c.drain()}flush(){this.m()}pause(){this.b=!0}resume(){this.b=!1,this.l()}write(t){if(this.a)return;t.writtenTime=Date.now(),this.lastWriteTime=Date.now();const e=L.alloc(13);e.writeUInt8(t.type,0),e.writeUInt32BE(t.id,1),e.writeUInt32BE(t.ack,5),e.writeUInt32BE(t.data.byteLength,9),this.c.traceSocketEvent("protocolHeaderWrite",{messageType:Wm(t.type),id:t.id,ack:t.ack,messageSize:t.data.byteLength}),this.c.traceSocketEvent("protocolMessageWrite",t.data),this.j(e,t.data)}g(t,e){const s=this.f===0;return this.d.push(t,e),this.f+=t.byteLength+e.byteLength,s}h(){const t=L.concat(this.d,this.f);return this.d.length=0,this.f=0,t}j(t,e){this.g(t,e)&&this.l()}l(){this.k||(this.k=setTimeout(()=>{this.k=null,this.m()}))}m(){if(this.f===0||this.b)return;const t=this.h();this.c.traceSocketEvent("protocolWrite",{byteLength:t.byteLength}),this.c.write(t)}},Wr=class{constructor(){this.b=!1,this.c=!1,this.d=[],this.a=new R({onWillAddFirstListener:()=>{this.b=!0,queueMicrotask(()=>this.f())},onDidRemoveLastListener:()=>{this.b=!1}}),this.event=this.a.event}f(){if(!this.c){for(this.c=!0;this.b&&this.d.length>0;)this.a.fire(this.d.shift());this.c=!1}}fire(t){this.b?this.d.length>0?this.d.push(t):this.a.fire(t):this.d.push(t)}flushBuffer(){this.d=[]}},o8=class{constructor(t){this.data=t,this.next=null}},a8=class{constructor(){this.a=null,this.b=null}length(){let t=0,e=this.a;for(;e;)e=e.next,t++;return t}peek(){return this.a?this.a.data:null}toArray(){const t=[];let e=0,s=this.a;for(;s;)t[e++]=s.data,s=s.next;return t}pop(){if(this.a){if(this.a===this.b){this.a=null,this.b=null;return}this.a=this.a.next}}push(t){const e=new o8(t);if(!this.a){this.a=e,this.b=e;return}this.b.next=e,this.b=e}},c8=class Ts{static{this.a=10}static{this.b=null}static getInstance(){return Ts.b||(Ts.b=new Ts),Ts.b}constructor(){this.c=[];const e=Date.now();for(let s=0;s<Ts.a;s++)this.c[s]=e-1e3*s;setInterval(()=>{for(let s=Ts.a;s>=1;s--)this.c[s]=this.c[s-1];this.c[0]=Date.now()},1e3)}d(){const e=Date.now(),s=(1+Ts.a)*1e3;let i=0;for(let n=0;n<Ts.a;n++)e-this.c[n]<=s&&i++;return 1-i/Ts.a}hasHighLoad(){return this.d()>=.5}},l8=class{get unacknowledgedCount(){return this.d-this.f}constructor(t){this.v=new Wr,this.onControlMessage=this.v.event,this.w=new Wr,this.onMessage=this.w.event,this.x=new Wr,this.onDidDispose=this.x.event,this.y=new Wr,this.onSocketClose=this.y.event,this.z=new Wr,this.onSocketTimeout=this.z.event,this.t=t.loadEstimator??c8.getInstance(),this.u=t.sendKeepAlive??!0,this.a=!1,this.c=new a8,this.d=0,this.f=0,this.g=null,this.h=0,this.j=0,this.k=0,this.l=null,this.n=0,this.o=Date.now(),this.s=new Pe,this.p=t.socket,this.q=this.s.add(new Jm(this.p)),this.r=this.s.add(new Gm(this.p)),this.s.add(this.r.onMessage(e=>this.A(e))),this.s.add(this.p.onClose(e=>this.y.fire(e))),t.initialChunk&&this.r.acceptChunk(t.initialChunk),this.u?this.m=setInterval(()=>{this.E()},5e3):this.m=null}dispose(){this.g&&(clearTimeout(this.g),this.g=null),this.l&&(clearTimeout(this.l),this.l=null),this.m&&(clearInterval(this.m),this.m=null),this.s.dispose()}drain(){return this.q.drain()}sendDisconnect(){if(!this.b){this.b=!0;const t=new Os(5,0,0,mi());this.q.write(t),this.q.flush()}}sendPause(){const t=new Os(7,0,0,mi());this.q.write(t)}sendResume(){const t=new Os(8,0,0,mi());this.q.write(t)}pauseSocketWriting(){this.q.pause()}getSocket(){return this.p}getMillisSinceLastIncomingData(){return Date.now()-this.r.lastReadTime}beginAcceptReconnection(t,e){this.a=!0,this.s.dispose(),this.s=new Pe,this.v.flushBuffer(),this.y.flushBuffer(),this.z.flushBuffer(),this.p.dispose(),this.n=0,this.o=Date.now(),this.p=t,this.q=this.s.add(new Jm(this.p)),this.r=this.s.add(new Gm(this.p)),this.s.add(this.r.onMessage(s=>this.A(s))),this.s.add(this.p.onClose(s=>this.y.fire(s))),this.r.acceptChunk(e)}endAcceptReconnection(){this.a=!1,this.j=this.h;const t=new Os(3,0,this.j,mi());this.q.write(t);const e=this.c.toArray();for(let s=0,i=e.length;s<i;s++)this.q.write(e[s]);this.C()}acceptDisconnect(){this.x.fire()}A(t){if(t.ack>this.f){this.f=t.ack;do{const e=this.c.peek();if(e&&e.id<=t.ack)this.c.pop();else break}while(!0)}switch(t.type){case 0:break;case 1:{if(t.id>this.h)if(t.id!==this.h+1){const e=Date.now();e-this.n>1e4&&(this.n=e,this.q.write(new Os(6,0,0,mi())))}else this.h=t.id,this.k=Date.now(),this.B(),this.w.fire(t.data);break}case 2:{this.v.fire(t.data);break}case 3:break;case 5:{this.x.fire();break}case 6:{const e=this.c.toArray();for(let s=0,i=e.length;s<i;s++)this.q.write(e[s]);this.C();break}case 7:{this.q.pause();break}case 8:{this.q.resume();break}case 9:break}}readEntireBuffer(){return this.r.readEntireBuffer()}flush(){this.q.flush()}send(t){const e=++this.d;this.j=this.h;const s=new Os(1,e,this.j,t);this.c.push(s),this.a||(this.q.write(s),this.C())}sendControl(t){const e=new Os(2,0,0,t);this.q.write(e)}B(){if(this.h<=this.j||this.l)return;const t=Date.now()-this.k;if(t>=2e3){this.D();return}this.l=setTimeout(()=>{this.l=null,this.B()},2e3-t+5)}C(){if(this.d<=this.f||this.g||this.a)return;const t=this.c.peek(),e=Date.now()-t.writtenTime,s=Date.now()-this.r.lastReadTime,i=Date.now()-this.o;if(e>=2e4&&s>=2e4&&i>=2e4&&!this.t.hasHighLoad()){this.o=Date.now(),this.z.fire({unacknowledgedMsgCount:this.c.length(),timeSinceOldestUnacknowledgedMsg:e,timeSinceLastReceivedSomeData:s});return}const n=Math.max(2e4-e,2e4-s,2e4-i,500);this.g=setTimeout(()=>{this.g=null,this.C()},n)}D(){if(this.h<=this.j)return;this.j=this.h;const t=new Os(3,0,this.j,mi());this.q.write(t)}E(){this.j=this.h;const t=new Os(9,0,this.j,mi());this.q.write(t)}},h8=3e4,lf=class{traceSocketEvent(t,e){af.traceSocketEvent(this.socket,this.debugLabel,t,e)}constructor(t,e=""){this.d=!0,this.debugLabel=e,this.socket=t,this.traceSocketEvent("created",{type:"NodeSocket"}),this.a=i=>{if(this.traceSocketEvent("error",{code:i?.code,message:i?.message}),i){if(i.code==="EPIPE")return;it(i)}},this.socket.on("error",this.a);let s;this.b=i=>{this.traceSocketEvent("close",{hadError:i}),this.d=!1,s&&clearTimeout(s)},this.socket.on("close",this.b),this.c=()=>{this.traceSocketEvent("nodeEndReceived"),this.d=!1,s=setTimeout(()=>t.destroy(),h8)},this.socket.on("end",this.c)}dispose(){this.socket.off("error",this.a),this.socket.off("close",this.b),this.socket.off("end",this.c),this.socket.destroy()}onData(t){const e=s=>{this.traceSocketEvent("read",s),t(L.wrap(s))};return this.socket.on("data",e),{dispose:()=>this.socket.off("data",e)}}onClose(t){const e=s=>{t({type:0,hadError:s,error:void 0})};return this.socket.on("close",e),{dispose:()=>this.socket.off("close",e)}}onEnd(t){const e=()=>{t()};return this.socket.on("end",e),{dispose:()=>this.socket.off("end",e)}}write(t){if(!(this.socket.destroyed||!this.d))try{this.traceSocketEvent("write",t),this.socket.write(t.buffer,e=>{if(e){if(e.code==="EPIPE")return;it(e)}})}catch(e){if(e.code==="EPIPE")return;it(e)}}end(){this.traceSocketEvent("nodeEndSent"),this.socket.end()}drain(){return this.traceSocketEvent("nodeDrainBegin"),new Promise((t,e)=>{if(this.socket.bufferSize===0){this.traceSocketEvent("nodeDrainEnd"),t();return}const s=()=>{this.socket.off("close",s),this.socket.off("end",s),this.socket.off("error",s),this.socket.off("timeout",s),this.socket.off("drain",s),this.traceSocketEvent("nodeDrainEnd"),t()};this.socket.on("close",s),this.socket.on("end",s),this.socket.on("error",s),this.socket.on("timeout",s),this.socket.on("drain",s)})}},Km;(function(t){t[t.MinHeaderByteSize=2]="MinHeaderByteSize",t[t.MaxWebSocketMessageLength=262144]="MaxWebSocketMessageLength"})(Km||(Km={}));var Qm;(function(t){t[t.PeekHeader=1]="PeekHeader",t[t.ReadHeader=2]="ReadHeader",t[t.ReadBody=3]="ReadBody",t[t.Fin=4]="Fin"})(Qm||(Qm={}));var tk=process.env.XDG_RUNTIME_DIR,sk=W("remoteAuthorityResolverService"),Xm;(function(t){t[t.WebSocket=0]="WebSocket",t[t.Managed=1]="Managed"})(Xm||(Xm={}));var vi;(function(t){t.Unknown="Unknown",t.NotAvailable="NotAvailable",t.TemporarilyNotAvailable="TemporarilyNotAvailable",t.NoResolverFound="NoResolverFound",t.InvalidAuthority="InvalidAuthority"})(vi||(vi={}));var hf=class tn extends ki{static isNotAvailable(e){return e instanceof tn&&e._code===vi.NotAvailable}static isTemporarilyNotAvailable(e){return e instanceof tn&&e._code===vi.TemporarilyNotAvailable}static isNoResolverFound(e){return e instanceof tn&&e._code===vi.NoResolverFound}static isInvalidAuthority(e){return e instanceof tn&&e._code===vi.InvalidAuthority}static isHandled(e){return e instanceof tn&&e.isHandled}constructor(e,s=vi.Unknown,i){super(e),this._message=e,this._code=s,this._detail=i,this.isHandled=s===vi.NotAvailable&&i===!0,Object.setPrototypeOf(this,tn.prototype)}},u8=30*1e3,Zm;(function(t){t[t.Management=1]="Management",t[t.ExtensionHost=2]="ExtensionHost",t[t.Tunnel=3]="Tunnel"})(Zm||(Zm={}));function uf(t){switch(t){case 1:return"Management";case 2:return"ExtensionHost";case 3:return"Tunnel"}}function Ym(t){const e=new fs;return setTimeout(()=>e.cancel(),t),e.token}function f8(t,e){if(t.isCancellationRequested||e.isCancellationRequested)return Z.Cancelled;const s=new fs;return t.onCancellationRequested(()=>s.cancel()),e.onCancellationRequested(()=>s.cancel()),s.token}var ff=class{get didTimeout(){return this.c==="timedout"}constructor(t){this.c="pending",this.d=new Pe,{promise:this.promise,resolve:this.f,reject:this.g}=R4(),t.isCancellationRequested?this.h():this.d.add(t.onCancellationRequested(()=>this.h()))}registerDisposable(t){this.c==="pending"?this.d.add(t):t.dispose()}h(){this.c==="pending"&&(this.d.dispose(),this.c="timedout",this.g(this.i()))}i(){const t=new Error("Time limit reached");return t.code="ETIMEDOUT",t.syscall="connect",t}resolve(t){this.c==="pending"&&(this.d.dispose(),this.c="resolved",this.f(t))}reject(t){this.c==="pending"&&(this.d.dispose(),this.c="rejected",this.g(t))}};function d8(t,e){const s=new ff(e);return s.registerDisposable(t.onControlMessage(i=>{const n=JSON.parse(i.toString()),r=$8(n);r?s.reject(r):s.resolve(n)})),s.promise}function p8(t,e,s,i,n,r,o,a){const c=new ff(a),l=hn.create(!1);return t.info(`Creating a socket (${o})...`),Vi(`code/willCreateSocket/${r}`),e.connect(s,i,n,o).then(h=>{c.didTimeout?(Vi(`code/didCreateSocketError/${r}`),t.info(`Creating a socket (${o}) finished after ${l.elapsed()} ms, but this is too late and has timed out already.`),h?.dispose()):(Vi(`code/didCreateSocketOK/${r}`),t.info(`Creating a socket (${o}) was successful after ${l.elapsed()} ms.`),c.resolve(h))},h=>{Vi(`code/didCreateSocketError/${r}`),t.info(`Creating a socket (${o}) returned an error after ${l.elapsed()} ms.`),t.error(h),c.reject(h)}),c.promise}function df(t,e){const s=new ff(e);return t.then(i=>{s.didTimeout||s.resolve(i)},i=>{s.didTimeout||s.reject(i)}),s.promise}async function g8(t,e,s,i){const n=nv(t,e);t.logService.trace(`${n} 1/6. invoking socketFactory.connect().`);let r;try{r=await p8(t.logService,t.remoteSocketFactoryService,t.connectTo,S1.getServerRootPath(),`reconnectionToken=${t.reconnectionToken}&reconnection=${t.reconnectionProtocol?"true":"false"}`,uf(e),`renderer-${uf(e)}-${t.reconnectionToken}`,i)}catch(h){throw t.logService.error(`${n} socketFactory.connect() failed or timed out. Error:`),t.logService.error(h),h}t.logService.trace(`${n} 2/6. socketFactory.connect() was successful.`);let o,a;t.reconnectionProtocol?(t.reconnectionProtocol.beginAcceptReconnection(r,null),o=t.reconnectionProtocol,a=!1):(o=new l8({socket:r}),a=!0),t.logService.trace(`${n} 3/6. sending AuthRequest control message.`);const c=await df(t.signService.createNewMessage(tt()),i),l={type:"auth",auth:t.connectionToken||"00000000000000000000",data:c.data};o.sendControl(L.fromString(JSON.stringify(l)));try{const h=await d8(o,f8(i,Ym(1e4)));if(h.type!=="sign"||typeof h.data!="string"){const g=new Error("Unexpected handshake message");throw g.code="VSCODE_CONNECTION_ERROR",g}if(t.logService.trace(`${n} 4/6. received SignRequest control message.`),!await df(t.signService.validate(c,h.signedData),i)){const g=new Error("Refused to connect to unsupported server");throw g.code="VSCODE_CONNECTION_ERROR",g}const f=await df(t.signService.sign(h.data),i),p={type:"connectionType",commit:t.commit,signedData:f,desiredConnectionType:e};return s&&(p.args=s),t.logService.trace(`${n} 5/6. sending ConnectionTypeRequest control message.`),o.sendControl(L.fromString(JSON.stringify(p))),{protocol:o,ownsProtocol:a}}catch(h){throw h&&h.code==="ETIMEDOUT"&&(t.logService.error(`${n} the handshake timed out. Error:`),t.logService.error(h)),h&&h.code==="VSCODE_CONNECTION_ERROR"&&(t.logService.error(`${n} received error control message when negotiating connection. Error:`),t.logService.error(h)),a&&iv(o),h}}async function m8(t,e,s){const i=Date.now(),n=nv(t,3),{protocol:r}=await g8(t,3,e,s);return t.logService.trace(`${n} 6/6. handshake finished, connection is up and running after ${R8(i)}!`),r}async function ev(t,e,s){const{connectTo:i,connectionToken:n}=await t.addressProvider.getAddress();return{commit:t.commit,quality:t.quality,connectTo:i,connectionToken:n,reconnectionToken:e,reconnectionProtocol:s,remoteSocketFactoryService:t.remoteSocketFactoryService,signService:t.signService,logService:t.logService}}async function v8(t,e,s){const i=await ev(t,tt(),null);return await m8(i,{host:e,port:s},Z.None)}function w8(t){return yt(e=>new Promise((s,i)=>{const n=setTimeout(s,t*1e3);e.onCancellationRequested(()=>{clearTimeout(n),s()})}))}var tv;(function(t){t[t.ConnectionLost=0]="ConnectionLost",t[t.ReconnectionWait=1]="ReconnectionWait",t[t.ReconnectionRunning=2]="ReconnectionRunning",t[t.ReconnectionPermanentFailure=3]="ReconnectionPermanentFailure",t[t.ConnectionGain=4]="ConnectionGain"})(tv||(tv={}));var y8=class{constructor(t,e){this.reconnectionToken=t,this.millisSinceLastIncomingData=e,this.type=0}},b8=class{constructor(t,e,s,i){this.reconnectionToken=t,this.millisSinceLastIncomingData=e,this.durationSeconds=s,this.c=i,this.type=1}skipWait(){this.c.cancel()}},S8=class{constructor(t,e,s){this.reconnectionToken=t,this.millisSinceLastIncomingData=e,this.attempt=s,this.type=2}},sv=class{constructor(t,e,s){this.reconnectionToken=t,this.millisSinceLastIncomingData=e,this.attempt=s,this.type=4}},E8=class{constructor(t,e,s,i){this.reconnectionToken=t,this.millisSinceLastIncomingData=e,this.attempt=s,this.handled=i,this.type=3}},ik=class Xs extends j{static triggerPermanentFailure(e,s,i){this._permanentFailure=!0,this.f=e,this.g=s,this.h=i,this.j.forEach(n=>n.F(this.f,this.g,this.h))}static debugTriggerReconnection(){this.j.forEach(e=>e.y())}static debugPauseSocketWriting(){this.j.forEach(e=>e.G())}static{this._permanentFailure=!1}static{this.f=0}static{this.g=0}static{this.h=!1}static{this.j=[]}get n(){return this.c||Xs._permanentFailure}constructor(e,s,i,n,r){super(),this.t=e,this.u=s,this.reconnectionToken=i,this.protocol=n,this.w=r,this.m=this.D(new R),this.onDidStateChange=this.m.event,this.c=!1,this.q=!1,this.r=!1,this.s=108e5,this.m.fire(new sv(this.reconnectionToken,0,0)),this.D(n.onSocketClose(o=>{const a=Hr(this.t,this.reconnectionToken,!0);o?o.type===0?(this.u.logService.info(`${a} received socket close event (hadError: ${o.hadError}).`),o.error&&this.u.logService.error(o.error)):(this.u.logService.info(`${a} received socket close event (wasClean: ${o.wasClean}, code: ${o.code}, reason: ${o.reason}).`),o.event&&this.u.logService.error(o.event)):this.u.logService.info(`${a} received socket close event.`),this.y()})),this.D(n.onSocketTimeout(o=>{const a=Hr(this.t,this.reconnectionToken,!0);this.u.logService.info(`${a} received socket timeout event (unacknowledgedMsgCount: ${o.unacknowledgedMsgCount}, timeSinceOldestUnacknowledgedMsg: ${o.timeSinceOldestUnacknowledgedMsg}, timeSinceLastReceivedSomeData: ${o.timeSinceLastReceivedSomeData}).`),this.y()})),Xs.j.push(this),this.D(pe(()=>{const o=Xs.j.indexOf(this);o>=0&&Xs.j.splice(o,1)})),this.n&&this.F(Xs.f,Xs.g,Xs.h)}updateGraceTime(e){const s=x8(e,108e5),i=Hr(this.t,this.reconnectionToken,!1);this.u.logService.trace(`${i} Applying reconnection grace time: ${s}ms (${Math.floor(s/1e3)}s)`),this.s=s}dispose(){super.dispose(),this.r=!0}async y(){if(!this.q)try{this.q=!0,await this.z()}finally{this.q=!1}}async z(){if(this.n||this.r)return;const e=Hr(this.t,this.reconnectionToken,!0);this.u.logService.info(`${e} starting reconnecting loop. You can get more information with the trace log level.`),this.m.fire(new y8(this.reconnectionToken,this.protocol.getMillisSinceLastIncomingData()));const s=[0,5,5,10,10,10,10,10,30],i=this.s;if(this.u.logService.info(`${e} starting reconnection with grace time: ${i}ms (${Math.floor(i/1e3)}s)`),i<=0){this.u.logService.error(`${e} reconnection grace time is set to 0ms, will not attempt to reconnect.`),this.C(this.protocol.getMillisSinceLastIncomingData(),0,!1);return}const n=Date.now();let r=-1;do{r++;const o=r<s.length?s[r]:s[s.length-1];try{if(o>0){const c=w8(o);this.m.fire(new b8(this.reconnectionToken,this.protocol.getMillisSinceLastIncomingData(),o,c)),this.u.logService.info(`${e} waiting for ${o} seconds before reconnecting...`);try{await c}catch{}}if(this.n){this.u.logService.error(`${e} permanent failure occurred while running the reconnecting loop.`);break}this.m.fire(new S8(this.reconnectionToken,this.protocol.getMillisSinceLastIncomingData(),r+1)),this.u.logService.info(`${e} resolving connection...`);const a=await ev(this.u,this.reconnectionToken,this.protocol);this.u.logService.info(`${e} connecting to ${a.connectTo}...`),await this.H(a,Ym(u8)),this.u.logService.info(`${e} reconnected!`),this.m.fire(new sv(this.reconnectionToken,this.protocol.getMillisSinceLastIncomingData(),r+1));break}catch(a){if(a.code==="VSCODE_CONNECTION_ERROR"){this.u.logService.error(`${e} A permanent error occurred in the reconnecting loop! Will give up now! Error:`),this.u.logService.error(a),this.C(this.protocol.getMillisSinceLastIncomingData(),r+1,!1);break}if(Date.now()-n>=i){const c=Math.round(i/1e3);this.u.logService.error(`${e} An error occurred while reconnecting, but it will be treated as a permanent error because the reconnection grace time (${c}s) has expired! Will give up now! Error:`),this.u.logService.error(a),this.C(this.protocol.getMillisSinceLastIncomingData(),r+1,!1);break}if(hf.isTemporarilyNotAvailable(a)){this.u.logService.info(`${e} A temporarily not available error occurred while trying to reconnect, will try again...`),this.u.logService.trace(a);continue}if((a.code==="ETIMEDOUT"||a.code==="ENETUNREACH"||a.code==="ECONNREFUSED"||a.code==="ECONNRESET")&&a.syscall==="connect"){this.u.logService.info(`${e} A network error occurred while trying to reconnect, will try again...`),this.u.logService.trace(a);continue}if(Ms(a)){this.u.logService.info(`${e} A promise cancelation error occurred while trying to reconnect, will try again...`),this.u.logService.trace(a);continue}if(a instanceof hf){this.u.logService.error(`${e} A RemoteAuthorityResolverError occurred while trying to reconnect. Will give up now! Error:`),this.u.logService.error(a),this.C(this.protocol.getMillisSinceLastIncomingData(),r+1,hf.isHandled(a));break}this.u.logService.error(`${e} An unknown error occurred while trying to reconnect, since this is an unknown case, it will be treated as a permanent error! Will give up now! Error:`),this.u.logService.error(a),this.C(this.protocol.getMillisSinceLastIncomingData(),r+1,!1);break}}while(!this.n&&!this.r)}C(e,s,i){this.w?Xs.triggerPermanentFailure(e,s,i):this.F(e,s,i)}F(e,s,i){this.m.fire(new E8(this.reconnectionToken,e,s,i)),iv(this.protocol)}G(){this.protocol.pauseSocketWriting()}};function iv(t){try{t.acceptDisconnect();const e=t.getSocket();t.dispose(),e.dispose()}catch(e){it(e)}}function $8(t){if(t&&t.type==="error"){const e=new Error(`Connection error: ${t.reason}`);return e.code="VSCODE_CONNECTION_ERROR",e}return null}function x8(t,e){return typeof t!="number"||!isFinite(t)||t<0?e:t>Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:Math.floor(t)}function k8(t,e){for(;t.length<e;)t+=" ";return t}function C8(t,e){return`[remote-connection][${k8(uf(t),13)}][${e.substr(0,5)}\u2026]`}function Hr(t,e,s){return`${C8(t,e)}[${s?"reconnect":"initial"}]`}function nv(t,e){return`${Hr(e,t.reconnectionToken,!!t.reconnectionProtocol)}[${t.connectTo}]`}function R8(t){return`${Date.now()-t} ms`}var oc=W("remoteSocketFactoryService"),D8=class{constructor(){this.a={}}register(t,e){return this.a[t]??=[],this.a[t].push(e),pe(()=>{const s=this.a[t]?.indexOf(e);typeof s=="number"&&s>=0&&this.a[t]?.splice(s,1)})}b(t){return(this.a[t.type]||[]).find(s=>s.supports(t))}connect(t,e,s,i){const n=this.b(t);if(!n)throw new Error(`No socket factory found for ${t}`);return n.connect(t,e,s,i)}};async function P8(t,e,s,i,n){let r;for(let o=3;o&&(r?.dispose(),r=await new I8(t,e,s,i,n).waitForReady(),!(n&&_m[n]||!_m[r.tunnelLocalPort]));o--);return r}var I8=class extends j{constructor(t,e,s,i,n){super(),this.m=e,this.n=n,this.privacy=rc.Private,this.j=new Map,this.a=t,this.b=t8.createServer(),this.c=new rr,this.f=()=>this.c.open(),this.b.on("listening",this.f),this.g=r=>this.q(r),this.b.on("connection",this.g),this.h=()=>{},this.b.on("error",this.h),this.tunnelRemotePort=i,this.tunnelRemoteHost=s}async dispose(){super.dispose(),this.b.removeListener("listening",this.f),this.b.removeListener("connection",this.g),this.b.removeListener("error",this.h),this.b.close(),Array.from(this.j.values()).forEach(e=>{e()})}async waitForReady(){const t=this.n??this.tunnelRemotePort,e=Br(this.m)?"0.0.0.0":"127.0.0.1";let s=await n8(t,2,1e3,e),i=null;return this.b.listen(s,this.m),await this.c.wait(),i=this.b.address(),i||(s=0,this.b.listen(s,this.m),await this.c.wait(),i=this.b.address()),this.tunnelLocalPort=i.port,this.localAddress=`${this.tunnelRemoteHost==="127.0.0.1"?"127.0.0.1":"localhost"}:${i.port}`,this}async q(t){t.pause();const e=nf(this.tunnelRemoteHost)||Br(this.tunnelRemoteHost)?"localhost":this.tunnelRemoteHost,s=await v8(this.a,e,this.tunnelRemotePort),i=s.getSocket(),n=s.readEntireBuffer();s.dispose(),n.byteLength>0&&t.write(n.buffer),t.on("end",()=>{t.localAddress&&this.j.delete(t.localAddress),i.end()}),t.on("close",()=>i.end()),t.on("error",()=>{t.localAddress&&this.j.delete(t.localAddress),i instanceof lf?i.socket.destroy():i.end()}),i instanceof lf?this.s(t,i):this.r(t,i),t.localAddress&&this.j.set(t.localAddress,()=>{t.end(),i.end()})}r(t,e){e.onClose(()=>t.destroy()),e.onEnd(()=>t.end()),e.onData(s=>t.write(s.buffer)),t.on("data",s=>e.write(L.wrap(s))),t.resume()}s(t,e){const s=e.socket;s.on("end",()=>t.end()),s.on("close",()=>t.end()),s.on("error",()=>{t.destroy()}),s.pipe(t),t.pipe(s)}},pf=class extends of{constructor(e,s,i,n,r){super(s,r),this.H=e,this.I=i,this.J=n}isPortPrivileged(e){return e8(e,this.s,ln,s8.release())}F(e,s,i,n,r,o,a,c){const l=this.C(s,i);if(l)return++l.refcount,l.value;if(Z6(e))return this.G(e,s,i,r,o,a,c);{this.q.trace(`ForwardedPorts: (TunnelService) Creating tunnel without provider ${s}:${i} on local port ${r}.`);const h={commit:this.J.commit,quality:this.J.quality,addressProvider:e,remoteSocketFactoryService:this.H,signService:this.I,logService:this.q,ipcLogger:null},u=P8(h,n,s,i,r);return this.q.trace("ForwardedPorts: (TunnelService) Tunnel created without provider."),this.y(s,i,u),u}}};pf=__decorate([__param(0,oc),__param(1,Q),__param(2,nc),__param(3,ge),__param(4,me)],pf);var gf=class extends pf{constructor(e,s,i,n,r){super(e,s,i,n,r)}};gf=__decorate([__param(0,oc),__param(1,Q),__param(2,nc),__param(3,ge),__param(4,me)],gf);var mf=class extends j{constructor(e,s,i,n,r){super(),this.b=e,this.c=s,this.f=i,this.g=n,this.h=r,this.a=new Map}async openTunnel(e,s,i,n,r,o,a,c,l){if(this.c.trace(`ForwardedPorts: (SharedTunnelService) openTunnel request for ${i}:${n} on local port ${o}.`),!this.a.has(e)){const h=new gf(this.b,this.c,this.g,this.f,this.h);this.D(h),this.a.set(e,h),h.onTunnelClosed(async()=>{(await h.tunnels).length===0&&(h.dispose(),this.a.delete(e))})}return this.a.get(e).openTunnel(s,i,n,r,o,a,c,l)}};mf=__decorate([__param(0,oc),__param(1,Q),__param(2,ge),__param(3,nc),__param(4,me)],mf);var rv=W("sharedProcessTunnelService"),A8="sharedProcessTunnel",vf,L8=class extends j{constructor(){super(),this.a=null,this.b=null}async getAddress(){return this.a?this.a:(this.b||(this.b=new gn),this.b.p)}setAddress(t){this.a=t,this.b&&(this.b.complete(t),this.b=null)}setTunnel(t){this.D(t)}},wf=class extends j{static{vf=this}static{this.a=0}constructor(e,s){super(),this.f=e,this.g=s,this.b=new Map,this.c=new Set}dispose(){super.dispose(),this.b.forEach(e=>e.dispose())}async createTunnel(){return{id:String(++vf.a)}}async startTunnel(e,s,i,n,r,o,a){const c=new L8,l=await Promise.resolve(this.f.openTunnel(e,c,i,n,r,o,a));if(!l||typeof l=="string")throw this.g.info(`[SharedProcessTunnelService] Could not create a tunnel to ${i}:${n} (remote).`),c.dispose(),new Error("Could not create tunnel");if(this.c.delete(s))throw c.dispose(),await l.dispose(),uo();return c.setTunnel(l),this.b.set(s,c),this.g.info(`[SharedProcessTunnelService] Created tunnel ${s}: ${l.localAddress} (local) to ${i}:${n} (remote).`),{tunnelLocalPort:l.tunnelLocalPort,localAddress:l.localAddress}}async setAddress(e,s){const i=this.b.get(e);i&&i.setAddress(s)}async destroyTunnel(e){const s=this.b.get(e);if(s){this.g.info(`[SharedProcessTunnelService] Disposing tunnel ${e}.`),this.b.delete(e),await s.dispose();return}this.c.add(e)}};wf=vf=__decorate([__param(0,Um),__param(1,Q)],wf);var O8=[],ov;(function(t){t[t.Eager=0]="Eager",t[t.Delayed=1]="Delayed"})(ov||(ov={}));function av(t,e,s){e instanceof ce||(e=new ce(e,[],!!s)),O8.push([t,e])}var cv=class ud{static{this._clock=0}constructor(e){this.uri=e,this.time=ud._clock++}touch(){return this.time=ud._clock++,this}},ac=class{constructor(e){this.g=e,this.c=new Pe,this.f=2**16;const s=new Map,i=n=>{let r=s.get(n.scheme);return r===void 0&&(r=e.hasProvider(n)&&!this.g.hasCapability(n,1024),s.set(n.scheme,r)),r};this.c.add(O.any(e.onDidChangeFileSystemProviderRegistrations,e.onDidChangeFileSystemProviderCapabilities)(n=>{if(s.get(n.scheme)===void 0)return;s.delete(n.scheme);const o=i(k.from({scheme:n.scheme}));if(o!==o)for(const[a,c]of this.d.entries())c.uri.scheme===n.scheme&&this.d.delete(a)})),this.extUri=new Po(i),this.d=new Map}dispose(){this.c.dispose(),this.d.clear()}asCanonicalUri(e){this.g.hasProvider(e)&&(e=$4(e));const s=this.extUri.getComparisonKey(e,!0),i=this.d.get(s);return i?i.touch().uri.with({fragment:e.fragment}):(this.d.set(s,new cv(e)),this.h(),e)}h(){if(this.d.size<this.f)return;cv._clock=1;const e=[...this.d.values()].map(i=>i.time),s=Lc(Math.floor(e.length/2),e,(i,n)=>i-n);for(const[i,n]of this.d.entries())n.time<=s?this.d.delete(i):n.time=0}};ac=__decorate([__param(0,K)],ac),av(he,ac,1);var N8=class extends j{constructor(t,e,s,i,n,r){super(),this.f=t,this.g=e,this.h=s,this.j=i,this.m=n,this.n=r,this.capabilities=this.g.capabilities,this.onDidChangeCapabilities=this.g.onDidChangeCapabilities,this.a=this.D(new R),this.onDidChangeFile=this.a.event,this.b=kn.forUris(()=>!(this.capabilities&1024)),this.c=new Uc(o=>this.m.extUri.getComparisonKey(this.s(o))),this.q(),this.D(i.onDidChangeProfiles(()=>this.q())),this.D(this.g.onDidChangeFile(o=>this.r(o)))}q(){this.c.clear();for(const t of this.j.profiles)this.c.add(t.settingsResource),this.c.add(t.keybindingsResource),this.c.add(t.tasksResource),this.c.add(t.extensionsResource)}open(t,e){return this.g.open(this.s(t),e)}close(t){return this.g.close(t)}read(t,e,s,i,n){return this.g.read(t,e,s,i,n)}write(t,e,s,i,n){return this.g.write(t,e,s,i,n)}watch(t,e){this.b.set(t,t);const s=this.g.watch(this.s(t),e);return pe(()=>{this.b.delete(t),s.dispose()})}stat(t){return this.g.stat(this.s(t))}mkdir(t){return this.g.mkdir(this.s(t))}rename(t,e,s){return this.g.rename(this.s(t),this.s(e),s)}readFile(t,e){return this.g.readFile(this.s(t),e)}readFileStream(t,e,s){return this.g.readFileStream(this.s(t),e,s)}readdir(t){return this.g.readdir(this.s(t))}enforceAtomicReadFile(t){return this.c.has(t)}writeFile(t,e,s){return this.g.writeFile(this.s(t),e,s)}enforceAtomicWriteFile(t){return this.c.has(t)?{postfix:".vsctmp"}:!1}delete(t,e){return this.g.delete(this.s(t),e)}copy(t,e,s){if(Tl(this.g))return this.g.copy(this.s(t),this.s(e),s);throw new Error("copy not supported")}cloneFile(t,e){if(Xp(this.g))return this.g.cloneFile(this.s(t),this.s(e));throw new Error("clone not supported")}r(t){const e=[];for(const s of t){if(s.resource.scheme!==this.f)continue;const i=this.t(s.resource);this.b.findSubstr(i)&&e.push({resource:i,type:s.type,cId:s.cId})}e.length&&(this.n.debug("User data changed"),this.a.fire(e))}s(t){return t.with({scheme:this.f})}t(t){return t.with({scheme:this.h})}},T8="localFilesystem",j8=class extends j{constructor(t,e){super(),this.a=t,this.b=e,this.onDidChangeCapabilities=O.None,this.f=this.D(new R),this.onDidChangeFile=this.f.event,this.g=this.D(new R),this.onDidWatchError=this.g.event,this.h=tt(),this.j()}get capabilities(){return this.c||(this.c=516126,this.b.pathCaseSensitive&&(this.c|=1024),this.b.trash&&(this.c|=4096)),this.c}stat(t){return this.a.call("stat",[t])}realpath(t){return this.a.call("realpath",[t])}readdir(t){return this.a.call("readdir",[t])}async readFile(t,e){const{buffer:s}=await this.a.call("readFile",[t,e]);return s}readFileStream(t,e,s){const i=or(r=>L.concat(r.map(o=>L.wrap(o))).buffer),n=new Pe;return n.add(this.a.listen("readFileStream",[t,e])(r=>{if(r instanceof L)i.write(r.buffer);else{if(r==="end")i.end();else{let o;if(r instanceof Error)o=r;else{const a=r;o=ks(a.message??Xt(a),a.code??Y.Unknown)}i.error(o),i.end()}n.dispose()}})),n.add(s.onCancellationRequested(()=>{i.error(uo()),i.end(),n.dispose()})),i}writeFile(t,e,s){return this.a.call("writeFile",[t,L.wrap(e),s])}open(t,e){return this.a.call("open",[t,e])}close(t){return this.a.call("close",[t])}async read(t,e,s,i,n){const[r,o]=await this.a.call("read",[t,e,n]);return s.set(r.buffer.slice(0,o),i),o}write(t,e,s,i,n){return this.a.call("write",[t,e,L.wrap(s),i,n])}mkdir(t){return this.a.call("mkdir",[t])}delete(t,e){return this.a.call("delete",[t,e])}rename(t,e,s){return this.a.call("rename",[t,e,s])}copy(t,e,s){return this.a.call("copy",[t,e,s])}cloneFile(t,e){return this.a.call("cloneFile",[t,e])}j(){this.D(this.a.listen("fileChange",[this.h])(t=>{if(Array.isArray(t)){const e=t;this.f.fire(Zh(e))}else{const e=t;this.g.fire(e)}}))}watch(t,e){const s=tt();return this.a.call("watch",[this.h,s,t,e]),pe(()=>this.a.call("unwatch",[this.h,s]))}},M8=class{constructor(){this.a=new Map}async startProfiling(t){const s=await(await import("v8-inspect-profiler")).startProfiling({host:t.host,port:t.port,checkForPaused:!0}),i=tt();return this.a.set(i,s),i}async stopProfiling(t){const e=this.a.get(t);if(!e)throw new Error(`UNKNOWN session '${t}'`);const s=await e.stop();return this.a.delete(t),s.profile}},lv=W("IV8InspectProfilingService"),hv;(function(t){function e(i){return!!(i.samples&&i.timeDeltas)}t.isValidProfile=e;function s(i,n="noAbsolutePaths"){for(const r of i.nodes)r.callFrame&&r.callFrame.url&&(p1(r.callFrame.url)||/^\w[\w\d+.-]*:\/\/\/?/.test(r.callFrame.url))&&(r.callFrame.url=J(n,qt(r.callFrame.url)));return i}t.rewriteAbsolutePaths=s})(hv||(hv={}));var yf=class extends Z9{constructor(e,s,i,n,r,o,a,c){super(k.file(r.builtinExtensionsPath),k.file(r.extensionsPath),r.userHome,e.defaultProfile,e,s,i,n,r,o,a,c)}};yf=__decorate([__param(0,Ne),__param(1,hi),__param(2,K),__param(3,Q),__param(4,Vt),__param(5,ge),__param(6,he),__param(7,ns)],yf);var U8=class extends i5{constructor(t,e){super(),this.a=e;for(const s in t){const{definition:i,value:n}=t[s];this.policyDefinitions[s]=i,n!==void 0&&this.f.set(s,n)}this.a.listen("onDidChange")(s=>{for(const i in s){const n=s[i];n===null?this.f.delete(i):this.f.set(i,n)}this.g.fire(Object.keys(s))})}async h(t){const e=await this.a.call("updatePolicyDefinitions",t);for(const s in e)this.f.set(s,e[s])}},F8=class extends j{get defaultProfile(){return this.profiles[0]}get profiles(){return this.a}constructor(t,e,s){super(),this.profilesHome=e,this.c=s,this.a=[],this.b=this.D(new R),this.onDidChangeProfiles=this.b.event,this.a=t.map(i=>Yt(i,this.profilesHome.scheme)),this.D(this.c.listen("onDidChangeProfiles")(i=>{const n=i.added.map(a=>Yt(a,this.profilesHome.scheme)),r=i.removed.map(a=>Yt(a,this.profilesHome.scheme)),o=i.updated.map(a=>Yt(a,this.profilesHome.scheme));this.a=i.all.map(a=>Yt(a,this.profilesHome.scheme)),this.b.fire({added:n,removed:r,updated:o,all:this.profiles})})),this.onDidResetWorkspaces=this.c.listen("onDidResetWorkspaces")}async createNamedProfile(t,e,s){const i=await this.c.call("createNamedProfile",[t,e,s]);return Yt(i,this.profilesHome.scheme)}async createProfile(t,e,s,i){const n=await this.c.call("createProfile",[t,e,s,i]);return Yt(n,this.profilesHome.scheme)}async createTransientProfile(t){const e=await this.c.call("createTransientProfile",[t]);return Yt(e,this.profilesHome.scheme)}async setProfileForWorkspace(t,e){await this.c.call("setProfileForWorkspace",[t,e])}removeProfile(t){return this.c.call("removeProfile",[t])}async updateProfile(t,e){const s=await this.c.call("updateProfile",[t,e]);return Yt(s,this.profilesHome.scheme)}resetWorkspaces(){return this.c.call("resetWorkspaces")}cleanUp(){return this.c.call("cleanUp")}cleanUpTransientProfiles(){return this.c.call("cleanUpTransientProfiles")}},q8=!1,_8=class{constructor(t,e,s){this.id=t,this.dependencies=e,this.callback=s}},Zi;(function(t){t[t.Uninitialized=1]="Uninitialized",t[t.InitializedInternal=2]="InitializedInternal",t[t.InitializedExternal=3]="InitializedExternal"})(Zi||(Zi={}));var z8=class Cw{static{this.INSTANCE=new Cw}constructor(){this.a=typeof self=="object"&&self.constructor&&self.constructor.name==="DedicatedWorkerGlobalScope",this.b=typeof document=="object",this.c=[],this.d=Zi.Uninitialized}g(){if(this.d===Zi.Uninitialized){if(globalThis.define){this.d=Zi.InitializedExternal;return}}else return;this.d=Zi.InitializedInternal,globalThis.define=(e,s,i)=>{typeof e!="string"&&(i=s,s=e,e=null),(typeof s!="object"||!Array.isArray(s))&&(i=s,s=null),this.c.push(new _8(e,s,i))},globalThis.define.amd=!0,this.b?this.f=globalThis._VSCODE_WEB_PACKAGE_TTP??window.trustedTypes?.createPolicy("amdLoader",{createScriptURL(e){if(e.startsWith(window.location.origin)||e.startsWith(`${ne.vscodeFileResource}://${E1}`))return e;throw new Error(`[trusted_script_src] Invalid script url: ${e}`)}}):this.a&&(this.f=globalThis._VSCODE_WEB_PACKAGE_TTP??globalThis.trustedTypes?.createPolicy("amdLoader",{createScriptURL(e){return e}}))}async load(e){if(this.g(),this.d===Zi.InitializedExternal)return new Promise(o=>{const a=tt();globalThis.define(a,[e],function(c){o(c)})});const s=await(this.a?this.i(e):this.b?this.h(e):this.j(e));if(!s){console.warn(`Did not receive a define call from script ${e}`);return}const i={},n=[],r=[];if(Array.isArray(s.dependencies))for(const o of s.dependencies)o==="exports"?n.push(i):r.push(o);if(r.length>0)throw new Error(`Cannot resolve dependencies for script ${e}. The dependencies are: ${r.join(", ")}`);return typeof s.callback=="function"?s.callback(...n)??i:s.callback}h(e){return new Promise((s,i)=>{const n=document.createElement("script");n.setAttribute("async","async"),n.setAttribute("type","text/javascript");const r=()=>{n.removeEventListener("load",o),n.removeEventListener("error",a)},o=c=>{r(),s(this.c.pop())},a=c=>{r(),i(c)};n.addEventListener("load",o),n.addEventListener("error",a),this.f&&(e=this.f.createScriptURL(e)),n.setAttribute("src",e),window.document.getElementsByTagName("head")[0].appendChild(n)})}async i(e){return this.f&&(e=this.f.createScriptURL(e)),await import(e),this.c.pop()}async j(e){try{const s=(await import("fs")).default,i=(await import("vm")).default,n=(await import("module")).default,r=k.parse(e).fsPath,o=s.readFileSync(r).toString(),a=n.wrap(o.replace(/^#!.*/,""));return new i.Script(a).runInThisContext().apply(),this.c.pop()}catch(s){throw s}}},bf=new Map;async function uv(t,e,s){s===void 0&&(s=!!(globalThis._VSCODE_PRODUCT_JSON??globalThis.vscode?.context?.configuration()?.product)?.commit);const i=e?`${t}/${e}`:t;if(bf.has(i))return bf.get(i);let n;if(/^\w[\w\d+.-]*:\/\//.test(i))n=i;else{const c=`${q8&&s&&!at?p4:d4}/${i}`;n=ii.asBrowserUri(c).toString(!0)}const r=z8.INSTANCE.load(n);return bf.set(i,r),r}var fv="https://mobile.events.data.microsoft.com/OneCollector/1.0",V8="https://mobile.events.data.microsoft.com/ping";async function B8(t,e,s){const i=at?await uv("@microsoft/1ds-core-js","bundle/ms.core.min.js"):await import("@microsoft/1ds-core-js"),n=at?await uv("@microsoft/1ds-post-js","bundle/ms.post.min.js"):await import("@microsoft/1ds-post-js"),r=new i.AppInsightsCore,o=new n.PostChannel,a={instrumentationKey:t,endpointUrl:fv,loggingLevelTelemetry:0,loggingLevelConsole:0,disableCookiesUsage:!0,disableDbgExt:!0,disableInstrumentationKeyValidation:!0,channels:[[o]]};if(s){a.extensionConfig={};const c={alwaysUseXhrOverride:!0,ignoreMc1Ms0CookieProcessing:!0,httpXHROverride:s};a.extensionConfig[o.identifier]=c}return r.initialize(a,[]),r.addTelemetryInitializer(c=>{c.ext=c.ext??{},c.ext.web=c.ext.web??{},c.ext.web.consentDetails='{"GPC_DataSharingOptIn":false}',e&&(c.ext.utc=c.ext.utc??{},c.ext.utc.flags=8462029)}),r}var W8=class{constructor(t,e,s,i,n){this.e=t,this.f=e,this.g=s,this.h=n,this.c=fv,this.d=V8,this.g||(this.g={}),typeof i=="function"?this.a=i():this.a=i,this.b=null}i(t){if(this.a){if(typeof this.a!="string"){t(this.a);return}this.b||(this.b=B8(this.a,this.e,this.h)),this.b.then(e=>{t(e)},e=>{it(e),console.error(e)})}}log(t,e){if(!this.a)return;e=Yo(e,this.g);const s=Fg(e),i=this.f+"/"+t;try{this.i(n=>{n.pluginVersionString=s?.properties.version??"Unknown",n.track({name:i,baseData:{name:i,properties:s?.properties,measurements:s?.measurements}})})}catch{}}flush(){return this.a?new Promise(t=>{this.i(e=>{e.unload(!0,()=>{this.a=void 0,t(void 0)})})}):Promise.resolve(void 0)}};async function H8(t,e){const s=await e.request(t,Z.None),i=(await Ni(s.stream)).toString(),n=s.res.statusCode??200;return{headers:s.res.headers,statusCode:n,responseData:i}}async function G8(t){const e=await import("https"),s={method:t.type,headers:t.headers};return new Promise((n,r)=>{const o=e.request(t.url??"",s,a=>{a.on("data",function(c){n({headers:a.headers,statusCode:a.statusCode??200,responseData:c.toString()})}),a.on("error",function(c){r(c)})});o.write(t.data,a=>{a&&r(a)}),o.end()})}async function J8(t,e,s){const i=typeof e.data=="string"?e.data:new TextDecoder().decode(e.data),n={type:"POST",headers:{...e.headers,"Content-Type":"application/json","Content-Length":Buffer.byteLength(e.data).toString()},url:e.urlString,data:i};try{const r=t?await H8(n,t):await G8(n);s(r.statusCode,r.headers,r.responseData)}catch{s(0,{})}}var K8=class extends W8{constructor(t,e,s,i,n){const r={sendPOST:(o,a)=>{J8(t,o,a)}};super(e,s,i,n,r)}},Sf=class extends j{constructor(e){super(),this.D(new ps(()=>{e.cleanUp()},10*1e3)).schedule()}};Sf=__decorate([__param(0,Ne)],Sf);var dv=W("IRemoteTunnelService"),cc={active:!1},Ct;(function(t){t.disconnected=e=>({type:"disconnected",onTokenFailed:e}),t.connected=(e,s)=>({type:"connected",info:e,serviceInstallFailed:s}),t.connecting=e=>({type:"connecting",progress:e}),t.uninitialized={type:"uninitialized"}})(Ct||(Ct={}));var pv="remote.tunnels.access",gv=pv+".hostNameOverride",mv=pv+".preventSleep",vv="remoteTunnelService",Q8=w(2284,null),Kt,Ef=class{static{Kt=this}static{this.a="not-existing-resource"}static{this.b="remote-backup"}static{this.c="local-backup"}constructor(e,s,i,n,r,o,a,c,l,h){this.e=e,this.f=s,this.g=i,this.h=r,this.i=o,this.j=a,this.k=c,this.l=l,this.n=h,this.d=n.extUri}async getRemoteSyncedProfiles(){const e=await this.e.readResource("profiles",null,void 0);if(e.content){const s=this.N(e.content,"profiles");return Xi(s)}return[]}async getLocalSyncedProfiles(e){const s=await this.f.getAllResourceRefs("profiles",void 0,e);if(s.length){const i=await this.f.resolveResourceContent("profiles",s[0].ref,void 0,e);if(i){const n=this.N(i,"profiles");return Xi(n)}}return[]}async getLocalSyncedMachines(e){const s=await this.f.getAllResourceRefs("machines",void 0,e);if(s.length){const i=await this.f.resolveResourceContent("machines",s[0].ref,void 0,e);if(i)return JSON.parse(i).machines.map(r=>({...r,isCurrent:!1}))}return[]}async getRemoteSyncResourceHandles(e,s){return(await this.e.getAllResourceRefs(e,s?.collection)).map(({created:n,ref:r})=>({created:n,uri:this.L({remote:!0,syncResource:e,profile:s?.id??this.k.defaultProfile.id,location:void 0,collection:s?.collection,ref:r,node:void 0})}))}async getLocalSyncResourceHandles(e,s,i){return(await this.f.getAllResourceRefs(e,s?.collection,i)).map(({created:r,ref:o})=>({created:r,uri:this.L({remote:!1,syncResource:e,profile:s?.id??this.k.defaultProfile.id,collection:s?.collection,ref:o,node:void 0,location:i})}))}resolveUserDataSyncResource({uri:e}){const s=this.M(e),i=s?this.k.profiles.find(n=>n.id===s.profile):void 0;return s&&i?{profile:i,syncResource:s?.syncResource}:void 0}async getAssociatedResources({uri:e}){const s=this.M(e);if(!s)return[];const i=this.k.profiles.find(n=>n.id===s.profile);switch(s.syncResource){case"settings":return this.s(e,i);case"keybindings":return this.u(e,i);case"tasks":return this.w(e,i);case"mcp":return this.P(e,i);case"snippets":return this.y(e,i);case"prompts":return this.A(e,i);case"globalState":return this.F(e,i);case"extensions":return this.C(e,i);case"profiles":return this.I(e,i);case"workspaceState":return[]}}async getMachineId({uri:e}){const s=this.M(e);if(s){if(s.remote){if(s.ref){const{content:i}=await this.O(s.syncResource,s.ref,s.collection);if(i)return this.N(i,s.syncResource)?.machineId}return}if(s.location){if(s.ref){const i=await this.f.resolveResourceContent(s.syncResource,s.ref,s.collection,s.location);if(i)return this.N(i,s.syncResource)?.machineId}return}return On(this.h,this.j,this.i)}}async resolveContent(e){const s=this.M(e);if(!s||s.node===Kt.a)return null;if(s.ref){const i=await this.o(s.remote,s.syncResource,s.collection,s.ref,s.location);return s.node&&i?this.q(s.syncResource,i,s.node):i}return!s.remote&&!s.node?this.r(s.syncResource,s.profile):null}async o(e,s,i,n,r){if(e){const{content:o}=await this.O(s,n,i);return o}return this.f.resolveResourceContent(s,n,i,r)}q(e,s,i){const n=this.N(s,e);switch(e){case"settings":return this.t(n,i);case"keybindings":return this.v(n,i);case"tasks":return this.x(n,i);case"mcp":return this.Q(n,i);case"snippets":return this.z(n,i);case"prompts":return this.B(n,i);case"globalState":return this.G(n,i);case"extensions":return this.D(n,i);case"profiles":return this.J(n,i);case"workspaceState":return null}}async r(e,s){const i=this.k.profiles.find(n=>n.id===s);if(!i)return null;switch(e){case"globalState":return this.H(i);case"extensions":return this.E(i);case"profiles":return this.K(i);case"settings":return null;case"keybindings":return null;case"tasks":return null;case"mcp":return null;case"snippets":return null;case"prompts":return null;case"workspaceState":return null}}s(e,s){const i=this.d.joinPath(e,"settings.json"),n=s?s.settingsResource:this.d.joinPath(e,Kt.a);return[{resource:i,comparableResource:n}]}t(e,s){switch(s){case"settings.json":return Bu(e.content).settings}return null}u(e,s){const i=this.d.joinPath(e,"keybindings.json"),n=s?s.keybindingsResource:this.d.joinPath(e,Kt.a);return[{resource:i,comparableResource:n}]}v(e,s){switch(s){case"keybindings.json":return Ja(e.content,!!this.l.getValue(au),this.g)}return null}w(e,s){const i=this.d.joinPath(e,"tasks.json"),n=s?s.tasksResource:this.d.joinPath(e,Kt.a);return[{resource:i,comparableResource:n}]}x(e,s){switch(s){case"tasks.json":return Gu(e.content,this.g)}return null}async y(e,s){const i=await this.resolveContent(e);if(i){const n=this.N(i,"snippets");if(n){const r=Wu(n),o=[];for(const a of Object.keys(r)){const c=this.d.joinPath(e,a),l=s?this.d.joinPath(s.snippetsHome,a):this.d.joinPath(e,Kt.a);o.push({resource:c,comparableResource:l})}return o}}return[]}z(e,s){return Wu(e)[s]||null}async A(e,s){const i=await this.resolveContent(e);if(i){const n=this.N(i,"prompts");if(n){const r=Uu(n),o=[];for(const a of Object.keys(r)){const c=this.d.joinPath(e,a),l=s?this.d.joinPath(s.promptsHome,a):this.d.joinPath(e,Kt.a);o.push({resource:c,comparableResource:l})}return o}}return[]}B(e,s){return Uu(e)[s]||null}C(e,s){const i=this.d.joinPath(e,"extensions.json"),n=s?this.L({remote:!1,syncResource:"extensions",profile:s.id,location:void 0,collection:void 0,ref:void 0,node:void 0}):this.d.joinPath(e,Kt.a);return[{resource:i,comparableResource:n}]}D(e,s){switch(s){case"extensions.json":return Du(D6(e),!0)}return null}async E(e){const{localExtensions:s}=await this.n.createInstance(Ba).getLocalExtensions(e);return Du(s,!0)}F(e,s){const i=this.d.joinPath(e,"globalState.json"),n=s?this.L({remote:!1,syncResource:"globalState",profile:s.id,location:void 0,collection:void 0,ref:void 0,node:void 0}):this.d.joinPath(e,Kt.a);return[{resource:i,comparableResource:n}]}G(e,s){switch(s){case"globalState.json":return Qi(JSON.parse(e.content),!0)}return null}async H(e){const s=await this.n.createInstance(Ga).getLocalGlobalState(e);return Qi(s,!0)}I(e,s){const i=this.d.joinPath(e,"profiles.json"),n=this.L({remote:!1,syncResource:"profiles",profile:this.k.defaultProfile.id,location:void 0,collection:void 0,ref:void 0,node:void 0});return[{resource:i,comparableResource:n}]}J(e,s){switch(s){case"profiles.json":return xr(JSON.parse(e.content),{})}return null}async K(e){return Xu(this.k.profiles.filter(s=>!s.isDefault&&!s.isTransient),!0)}L(e){const s=e.remote?Kt.b:Kt.c,i=[];return e.location&&(i.push(`scheme:${e.location.scheme}`),i.push(`authority:${e.location.authority}`),i.push(Fy(e.location.path,"/"))),i.push(`syncResource:${e.syncResource}`),i.push(`profile:${e.profile}`),e.collection&&i.push(`collection:${e.collection}`),e.ref&&i.push(`ref:${e.ref}`),e.node&&i.push(e.node),this.d.joinPath(k.from({scheme:I,authority:s,path:"/",query:e.location?.query,fragment:e.location?.fragment}),...i)}M(e){if(e.scheme!==I)return;const s=[];for(;e.path!=="/";)s.unshift(this.d.basename(e)),e=this.d.dirname(e);if(s.length<2)return;const i=e.authority===Kt.b;let n,r;const o=[];let a,c,l,h,u;for(;s.length;){const f=s.shift();f.startsWith("scheme:")?n=f.substring(7):f.startsWith("authority:")?r=f.substring(10):f.startsWith("syncResource:")?a=f.substring(13):f.startsWith("profile:")?c=f.substring(8):f.startsWith("collection:")?l=f.substring(11):f.startsWith("ref:")?h=f.substring(4):a?u=f:o.push(f)}return{remote:i,syncResource:a,profile:c,collection:l,ref:h,node:u,location:n&&r!==void 0?this.d.joinPath(k.from({scheme:n,authority:r,query:e.query,fragment:e.fragment,path:"/"}),...o):void 0}}N(e,s){try{const i=JSON.parse(e);if(Ur(i))return i}catch(i){this.g.error(i)}throw new Ce(w(2733,null),"IncompatibleRemoteContent",s)}async O(e,s,i){const n=await this.e.resolveResourceContent(e,s,i);return{ref:s,content:n}}P(e,s){const i=this.d.joinPath(e,"mcp.json"),n=s?s.mcpResource:this.d.joinPath(e,Kt.a);return[{resource:i,comparableResource:n}]}Q(e,s){switch(s){case"mcp.json":return Tm(e.content,this.g)}return null}};Ef=Kt=__decorate([__param(0,rt),__param(1,kt),__param(2,Re),__param(3,he),__param(4,ae),__param(5,re),__param(6,K),__param(7,Ne),__param(8,me),__param(9,ns)],Ef);async function X8(t,e,s,i,n){try{const r=await t.getExtensionsControlManifest();if(!r.deprecated)return;const o=await t.getInstalled(1);for(const[a,c]of Object.entries(r.deprecated)){if(!c?.extension)continue;const{id:l,autoMigrate:h,preRelease:u}=c.extension;if(!h)continue;const f=o.find(g=>G(g.identifier,{id:a}));if(!f)continue;const p=(await e.getExtensions([{id:l,preRelease:u}],{targetPlatform:await t.getTargetPlatform(),compatible:!0},Z.None))[0];if(!p){n.info(`Skipping migrating '${f.identifier.id}' extension because, the comaptible target '${l}' extension is not found`);continue}try{n.info(`Migrating '${f.identifier.id}' extension to '${l}' extension...`);const g=!i.getDisabledExtensions().some(v=>G(v,f.identifier));await t.uninstall(f),n.info(`Uninstalled the unsupported extension '${f.identifier.id}'`);let m=o.find(v=>G(v.identifier,{id:l}));(!m||!m.isPreReleaseVersion&&g)&&(m=await t.installFromGallery(p,{installPreReleaseVersion:!0,isMachineScoped:f.isMachineScoped,operation:4,context:{[kl]:!0}}),n.info(`Installed the pre-release extension '${m.identifier.id}'`),g||(await i.disableExtension(m.identifier),n.info(`Disabled the pre-release extension '${m.identifier.id}' because the unsupported extension '${f.identifier.id}' is disabled`)),h.storage&&(s.addToMigrationList(ia(f.manifest.publisher,f.manifest.name),ia(m.manifest.publisher,m.manifest.name)),n.info("Added pre-release extension to the storage migration list"))),n.info(`Migrated '${f.identifier.id}' extension to '${l}' extension.`)}catch(g){n.error(g)}}if(r.autoUpdate)for(const[a,c]of Object.entries(r.autoUpdate))try{const l=o.find(u=>G(u.identifier,{id:a})&&e9(u.manifest.version,c));if(!l)continue;const h=(await e.getExtensions([{id:a,preRelease:l.preRelease}],{targetPlatform:await t.getTargetPlatform(),compatible:!0},Z.None))[0];if(!h){n.info(`Skipping updating '${l.identifier.id}' extension because, the compatible target '${a}' extension is not found`);continue}await t.installFromGallery(h,{installPreReleaseVersion:l.preRelease,isMachineScoped:l.isMachineScoped,operation:3,context:{[kl]:!0}}),n.info(`Autoupdated '${l.identifier.id}' extension to '${h.version}' extension.`)}catch(l){n.error(l)}}catch(r){n.error(r)}}var $f=class extends j{constructor(e,s,i,n,r,o){super(),e.cleanUp(),X8(e,s,i,n,o),jr.removeOutdatedExtensionVersions(e,r)}};$f=__decorate([__param(0,zh),__param(1,xs),__param(2,nu),__param(3,jp),__param(4,re),__param(5,Q)],$f);var wv=class extends j{constructor(t,e=[]){super(),this.a=new r2([t,...e]),this.D(t.onDidChangeLogLevel(s=>this.setLevel(s)))}get onDidChangeLogLevel(){return this.a.onDidChangeLogLevel}setLevel(t){this.a.setLevel(t)}getLevel(){return this.a.getLevel()}trace(t,...e){this.a.trace(t,...e)}debug(t,...e){this.a.debug(t,...e)}info(t,...e){this.a.info(t,...e)}warn(t,...e){this.a.warn(t,...e)}error(t,...e){this.a.error(t,...e)}flush(){this.a.flush()}},yv=W("sharedProcessLifecycleService"),xf=class extends j{constructor(e){super(),this.b=e,this.a=this.D(new R),this.onWillShutdown=this.a.event}fireOnWillShutdown(){this.b.trace("Lifecycle#onWillShutdown.fire()"),this.a.fire()}};xf=__decorate([__param(0,Q)],xf);import{spawn as bv}from"child_process";import{hostname as Z8,homedir as Y8}from"os";import{Transform as e3}from"stream";var Sv=class extends e3{constructor(t){if(super(),typeof t=="number")this.b=t,this.c=1;else{const e=Buffer.isBuffer(t)?t:Buffer.from(t);this.b=e.length===1?e[0]:e,this.c=e.length}}_transform(t,e,s){this.a?this.a=Buffer.concat([this.a,t]):this.a=t;let i=0;for(;i<this.a.length;){const n=typeof this.b=="number"?this.a.indexOf(this.b,i):_1(this.a,this.b,i);if(n===-1)break;this.push(this.a.slice(i,n+this.c)),i=n+this.c}this.a=i===this.a.length?void 0:this.a.slice(i),s()}_flush(t){this.a&&this.push(this.a),t()}},t3=[gv,mv],kf="remoteTunnelSession",Cf="remoteTunnelIsService",Rf=class extends j{constructor(e,s,i,n,r,o,a){super(),this.w=e,this.y=s,this.z=i,this.C=o,this.F=a,this.f=new R,this.onDidTokenFailed=this.f.event,this.g=new R,this.onDidChangeTunnelStatus=this.g.event,this.h=new R,this.onDidChangeMode=this.h.event,this.n=cc,this.u=!1,this.I=(c,l)=>{l?this.j.error(c):this.j.info(c)},this.j=this.D(n.createLogger(V(i.logsHome,`${vv}.log`),{id:vv,name:Q8})),this.s=new el(100),this.D(this.j.onDidChangeLogLevel(c=>this.j.info("Log level changed to "+Mo(c)))),this.D(r.onWillShutdown(()=>{this.q?.cancel(),this.q=void 0,this.dispose()})),this.D(o.onDidChangeConfiguration(c=>{t3.some(l=>c.affectsConfiguration(l))&&this.s.trigger(()=>this.L())})),this.n=this.R(),this.r=Ct.uninitialized}async getTunnelStatus(){return this.r}G(e){this.r=e,this.g.fire(e)}H(e){Ev(this.n,e)||(this.n=e,this.S(e),this.h.fire(this.n),e.active?(this.j.info(`Session updated: ${e.session.accountLabel} (${e.session.providerId}) (service=${e.asService})`),e.session.token&&this.j.info(`Session token updated: ${e.session.accountLabel} (${e.session.providerId})`)):this.j.info("Session reset"))}getMode(){return Promise.resolve(this.n)}async initialize(e){if(this.u)return this.r;this.u=!0,this.H(e);try{await this.s.trigger(()=>this.L())}catch(s){this.j.error(s)}return this.r}J(){if(!this.t){let e;bs?e=this.z.appRoot:Le?this.y.quality==="insider"?e=Qe(Qe(Qe(this.z.appRoot))):e=Qe(Qe(this.z.appRoot)):e=Qe(Qe(this.z.appRoot)),this.t=J(e,"bin",`${this.y.tunnelApplicationName}${Le?".exe":""}`)}return this.t}async startTunnel(e){if(Ev(this.n,e)&&this.r.type!=="disconnected")return this.r;this.H(e);try{await this.s.trigger(()=>this.L())}catch(s){this.j.error(s)}return this.r}async stopTunnel(){if(this.q&&(this.q.cancel(),this.q=void 0),this.n.active){const e=this.n.asService;this.H(cc);try{e&&this.O("uninstallService",["service","uninstall"])}catch(s){this.j.error(s)}}try{await this.O("stop",["kill"])}catch(e){this.j.error(e)}this.G(Ct.disconnected())}async L(){this.w.publicLog2("remoteTunnel.enablement",{enabled:this.n.active,service:this.n.active&&this.n.asService}),this.q&&(this.q.cancel(),this.q=void 0);let e="",s=!1;const i=(l,h)=>{h?this.j.error(l):e+=l,!this.z.isBuilt&&l.startsWith("   Compiling")&&this.G(Ct.connecting(w(2285,null)))},n=this.O("status",["status"],i);this.q=n;try{if(await n,this.q!==n)return;let l;try{l=JSON.parse(e.trim().split(`
`).find(h=>h.startsWith("{")))}catch{this.j.error(`Could not parse status output: ${JSON.stringify(e.trim())}`),this.G(Ct.disconnected());return}if(s=l.service_installed,this.j.info(l.tunnel?"Other tunnel running, attaching...":"No other tunnel running"),!l.tunnel&&!this.n.active){this.G(Ct.disconnected());return}}catch(l){this.j.error(l),this.G(Ct.disconnected());return}finally{this.q===n&&(this.q=void 0)}const r=this.n.active?this.n.session:void 0;if(r&&r.token){const l=r.token;this.G(Ct.connecting(w(2286,null,r.accountLabel,r.providerId)));const h=(f,p)=>{f=f.replaceAll(l,"*".repeat(4)),i(f,p)},u=this.O("login",["user","login","--provider",r.providerId,"--log",Mo(this.j.getLevel())],h,{VSCODE_CLI_ACCESS_TOKEN:l});this.q=u;try{if(await u,this.q!==u)return}catch(f){this.j.error(f),this.q=void 0,this.f.fire(r),this.G(Ct.disconnected(r));return}}const o=this.Q();o?this.G(Ct.connecting(w(2287,null,o))):this.G(Ct.connecting(w(2288,null)));const a=["--accept-server-license-terms","--log",Mo(this.j.getLevel())];o?a.push("--name",o):a.push("--random-name");let c=!1;return this.n.active&&this.n.asService&&!s&&(c=await this.M(a)===!1),this.N(r,a,c)}async M(e){let s;try{s=await this.O("serviceInstall",["service","install",...e])}catch(i){this.j.error(i),s=1}if(s!==0){const i=w(2289,null);return this.j.warn(i),this.G(Ct.connecting(i)),!1}return!0}async N(e,s,i){s.push("--parent-process-id",String(process.pid)),this.P()&&s.push("--no-sleep");let n=!1;const r=this.O("tunnel",s,(o,a)=>{a?this.j.error(o):this.j.info(o),o.includes("Connected to an existing tunnel process")&&(n=!0);const c=o.match(/Open this link in your browser (https:\/\/([^\/\s]+)\/([^\/\s]+)\/([^\/\s]+))/);if(c){const l={link:c[1],domain:c[2],tunnelName:c[4],isAttached:n};this.G(Ct.connected(l,i))}else o.match(/error refreshing token/)&&(r.cancel(),this.f.fire(e),this.G(Ct.disconnected(e)))});this.q=r,r.finally(()=>{r===this.q&&(this.j.info("tunnel process terminated"),this.q=void 0,this.n=cc,this.G(Ct.disconnected()))})}O(e,s,i=this.I,n){return yt(r=>new Promise((o,a)=>{r.isCancellationRequested&&o(-1);let c;const l=["ignore","pipe","pipe"];if(r.onCancellationRequested(()=>{c&&(this.j.info(`${e} terminating(${c.pid})`),c.kill())}),!this.z.isBuilt)i(`Building tunnel CLI from sources and run
`,!1),i(`${e} Spawning: cargo run -- tunnel ${s.join(" ")}
`,!1),c=bv("cargo",["run","--","tunnel",...s],{cwd:J(this.z.appRoot,"cli"),stdio:l,env:{...process.env,RUST_BACKTRACE:"1",...n}});else{i(`Running tunnel CLI
`,!1);const h=this.J();i(`${e} Spawning: ${h} tunnel ${s.join(" ")}
`,!1),c=bv(h,["tunnel",...s],{cwd:Y8(),stdio:l,env:{...process.env,...n}})}c.stdout.pipe(new Sv(`
`)).on("data",h=>{if(c){const u=h.toString();i(u,!1)}}),c.stderr.pipe(new Sv(`
`)).on("data",h=>{if(c){const u=h.toString();i(u,!0)}}),c.on("exit",h=>{c&&(i(`${e} exit(${c.pid}): + ${h} `,!1),c=void 0,o(h||0))}),c.on("error",h=>{c&&(i(`${e} error(${c.pid}): + ${h} `,!0),c=void 0,a())})}))}async getTunnelName(){return this.Q()}P(){return!!this.C.getValue(mv)}Q(){let e=this.C.getValue(gv)||Z8();return e=e.replace(/^-+/g,"").replace(/[^\w-]/g,"").substring(0,20),e||void 0}R(){try{const e=this.F.get(kf,-1),s=this.F.getBoolean(Cf,-1,!1);if(e){const i=JSON.parse(e);if(i&&de(i.accountLabel)&&de(i.sessionId)&&de(i.providerId))return{active:!0,session:i,asService:s};this.j.error("Problems restoring session from storage, invalid format",i)}}catch(e){this.j.error("Problems restoring session from storage",e)}return cc}S(e){if(e.active){const s={providerId:e.session.providerId,sessionId:e.session.sessionId,accountLabel:e.session.accountLabel};this.F.store(kf,JSON.stringify(s),-1,1),this.F.store(Cf,e.asService,-1,1)}else this.F.remove(kf,-1),this.F.remove(Cf,-1)}};Rf=__decorate([__param(0,ke),__param(1,ge),__param(2,Vt),__param(3,gr),__param(4,yv),__param(5,me),__param(6,re)],Rf);function s3(t,e){return t&&e?t.sessionId===e.sessionId&&t.providerId===e.providerId&&t.token===e.token:t===e}var Ev=(t,e)=>t.active!==e.active?!1:t.active&&e.active?t.asService===e.asService&&s3(t.session,e.session):!0,Df=class extends Nh{constructor(e,s,i,n,r){super(k.file(e.extensionsPath),s,i,n,r)}};Df=__decorate([__param(0,Vt),__param(1,K),__param(2,Ne),__param(3,he),__param(4,Q)],Df);var i3=class{constructor(t){this.a=t}get ignoredRecommendations(){throw new Error("not supported")}promptImportantExtensionsInstallNotification(t){return this.a.call("promptImportantExtensionsInstallNotification",[t])}promptWorkspaceRecommendations(t){throw new Error("not supported")}hasToIgnoreRecommendationNotifications(){throw new Error("not supported")}},Pf=class{constructor(e,s){return this.windowId=e,xt.toService(s.getChannel("nativeHost"),{context:e,properties:(()=>{const i=new Map;return i.set("windowId",e),i})()})}};Pf=__decorate([__param(1,Ko)],Pf);var If="sync.disableMachineEventually",Af="sync.sessionId",Lf="sync.storeUrl",Of="sync.productQuality",Nf=class extends j{get n(){const e=this.H.get(Lf,-1);return e?k.parse(e):void 0}set n(e){e?this.H.store(Lf,e.toString(),-1,1):this.H.remove(Lf,-1)}get r(){return this.H.get(Of,-1)}set r(e){e?this.H.store(Of,e,-1,1):this.H.remove(Of,-1)}constructor(e,s,i,n,r,o,a,c,l,h){super(),this.s=s,this.u=i,this.w=n,this.y=r,this.z=o,this.C=a,this.F=c,this.G=l,this.H=h,this.a=this.D(new us),this.b=0,this.c=void 0,this.g=!1,this.h=this.D(new R),this.onError=this.h.event,this.S=[],this.f=this.D(new Li(this.U())),this.j=this.n,this.n=s.userDataSyncStore?.url,this.q=this.r,this.r=e.quality,this.n&&(this.z.info("[AutoSync] Using settings sync service",this.n.toString()),this.D(s.onDidChangeUserDataSyncStore(()=>{Vs(this.n,s.userDataSyncStore?.url)||(this.j=this.n,this.n=s.userDataSyncStore?.url,this.n&&this.z.info("[AutoSync] Using settings sync service",this.n.toString()))})),this.w.isEnabled()?this.z.info("[AutoSync] Enabled."):this.z.info("[AutoSync] Disabled."),this.I(),this.Q()&&this.P(),this.D(a.onDidChangeAccount(()=>this.I())),this.D(i.onDidChangeDonotMakeRequestsUntil(()=>this.I())),this.D(r.onDidChangeLocal(u=>this.triggerSync([u]))),this.D(O.filter(this.w.onDidChangeResourceEnablement,([,u])=>u)(()=>this.triggerSync(["resourceEnablement"]))),this.D(this.s.onDidChangeUserDataSyncStore(()=>this.triggerSync(["userDataSyncStoreChanged"]))))}I(){const{enabled:e,message:s}=this.L();e?this.a.value===void 0&&(this.a.value=new n3(this.j,1e3*60*5,this.s,this.u,this.y,this.G,this.z,this.F,this.H),this.a.value.register(this.a.value.onDidStartSync(()=>this.c=new Date().getTime())),this.a.value.register(this.a.value.onDidFinishSync(i=>this.O(i))),this.J()&&this.a.value.start()):(this.f.cancel(),this.a.value!==void 0?(s&&this.z.info(s),this.a.clear()):s&&this.w.isEnabled()&&this.z.info(s))}J(){return!0}L(){return this.w.isEnabled()?this.C.account?this.u.donotMakeRequestsUntil?{enabled:!1,message:`[AutoSync] Suspended until ${uu(this.u.donotMakeRequestsUntil)} because server is not accepting requests until then.`}:this.g?{enabled:!1,message:"[AutoSync] Suspended until restart."}:{enabled:!0}:{enabled:!1,message:"[AutoSync] Suspended until auth token is available."}:{enabled:!1,message:"[AutoSync] Disabled."}}async turnOn(){this.R(),this.j=this.n,this.M(!0)}async turnOff(e,s,i){try{this.C.account&&!i&&await this.G.removeCurrentMachine(),this.M(!1),this.H.remove(Af,-1),e?await this.y.reset():await this.y.resetLocal()}catch(n){if(this.z.error(n),s)this.M(!1);else throw n}}M(e){this.w.isEnabled()!==e&&(this.w.setEnablement(e),this.I())}N(){return!!this.q&&!!this.r&&this.q!==this.r}async O(e){if(this.z.debug("[AutoSync] Sync Finished"),!e){this.b=0;return}const s=Ce.toUserDataSyncError(e);s.code==="SessionExpired"?(await this.turnOff(!1,!0),this.z.info("[AutoSync] Turned off sync because current session is expired")):s.code==="TurnedOff"?(await this.turnOff(!1,!0),this.z.info("[AutoSync] Turned off sync because sync is turned off in the cloud")):s.code==="LocalTooManyRequests"?(this.g=!0,this.z.info("[AutoSync] Suspended sync because of making too many requests to server"),this.I()):s.code==="RemoteTooManyRequests"?(await this.turnOff(!1,!0,!0),this.P(),this.z.info("[AutoSync] Turned off sync because of making too many requests to server")):s.code==="MethodNotFound"?(await this.turnOff(!1,!0),this.z.info("[AutoSync] Turned off sync because current client is making requests to server that are not supported")):s.code==="UpgradeRequired"||s.code==="Gone"?(await this.turnOff(!1,!0,!0),this.P(),this.z.info("[AutoSync] Turned off sync because current client is not compatible with server. Requires client upgrade.")):s.code==="IncompatibleLocalContent"?(await this.turnOff(!1,!0),this.z.info(`[AutoSync] Turned off sync because server has ${s.resource} content with newer version than of client. Requires client upgrade.`)):s.code==="IncompatibleRemoteContent"?(await this.turnOff(!1,!0),this.z.info(`[AutoSync] Turned off sync because server has ${s.resource} content with older version than of client. Requires server reset.`)):s.code==="ServiceChanged"||s.code==="DefaultServiceChanged"?at&&s.code==="DefaultServiceChanged"&&!this.N()?(await this.turnOff(!1,!0),this.z.info("[AutoSync] Turned off sync because default sync service is changed.")):(await this.turnOff(!1,!0,!0),await this.turnOn(),this.z.info("[AutoSync] Sync Service changed. Turned off auto sync, reset local state and turned on auto sync.")):(this.z.error(s),this.b++),this.h.fire(s)}async P(){this.H.store(If,!0,-1,1),await Oi(1e3*60*10),this.Q()&&(this.R(),!this.w.isEnabled()&&this.C.account&&await this.G.removeCurrentMachine())}Q(){return this.H.getBoolean(If,-1,!1)}R(){this.H.remove(If,-1)}async triggerSync(e,s){if(this.a.value===void 0)return this.f.cancel();if(s?.skipIfSyncedRecently&&this.c&&new Date().getTime()-this.c<1e4){this.z.debug("[AutoSync] Skipping because sync was triggered recently.",e);return}return this.S.push(...e),this.f.trigger(async()=>{this.z.trace("[AutoSync] Activity sources",...this.S),this.S=[],this.a.value&&await this.a.value.sync("Activity",!!s?.disableCache)},this.b?Math.min(this.U()*this.b,6e4):s?.immediately?0:this.U())}U(){return this.c&&new Date().getTime()-this.c>1e4?(this.z.debug("[AutoSync] Sync immediately because last sync was triggered more than 10 seconds ago."),0):3e3}};Nf=__decorate([__param(0,ge),__param(1,ui),__param(2,rt),__param(3,mt),__param(4,La),__param(5,Re),__param(6,Na),__param(7,ke),__param(8,Ma),__param(9,re)],Nf);var n3=class fd extends j{static{this.a="Interval"}constructor(e,s,i,n,r,o,a,c,l){super(),this.m=e,this.n=s,this.q=i,this.r=n,this.s=r,this.u=o,this.w=a,this.y=c,this.z=l,this.b=this.D(new us),this.c=this.D(new R),this.onDidStartSync=this.c.event,this.f=this.D(new R),this.onDidFinishSync=this.f.event,this.g=null}start(){this.D(this.onDidFinishSync(()=>this.C())),this.D(pe(()=>{this.j&&(this.j.cancel(),this.w.info("[AutoSync] Cancelled sync that is in progress"),this.j=void 0),this.h?.stop(),this.w.info("[AutoSync] Stopped")})),this.sync(fd.a,!1)}C(){this.b.value=dn(()=>{this.sync(fd.a,!1),this.b.value=void 0},this.n)}sync(e,s){const i=yt(async n=>{if(this.j)try{this.w.debug("[AutoSync] Waiting until sync is finished."),await this.j}catch(r){if(Ms(r))return}return this.H(e,s,n)});return this.j=i,this.j.finally(()=>this.j=void 0),this.j}F(){return this.m!==void 0&&!Vs(this.m,this.q.userDataSyncStore?.url)}async G(){const e=await this.q.getPreviousUserDataSyncStore(),s=this.q.userDataSyncStore;return!!s&&!!e&&(!Vs(s.defaultUrl,e.defaultUrl)||!Vs(s.insidersUrl,e.insidersUrl)||!Vs(s.stableUrl,e.stableUrl))}async H(e,s,i){this.w.info(`[AutoSync] Triggered by ${e}`),this.c.fire();let n;try{await this.I(s,i)}catch(r){if(this.w.error(r),n=r,Ce.toUserDataSyncError(r).code==="MethodNotFound")try{this.w.info("[AutoSync] Client is making invalid requests. Cleaning up data..."),await this.s.cleanUpRemoteData(),this.w.info("[AutoSync] Retrying sync..."),await this.I(s,i),n=void 0}catch(o){this.w.error(o),n=o}}this.f.fire(n)}async I(e,s){if(this.h=await this.s.createSyncTask(this.g,e),s.isCancellationRequested)return;if(this.g=this.h.manifest,this.g===null&&await this.s.hasPreviouslySynced())throw this.F()?await this.G()?new fi(w(2719,null),"DefaultServiceChanged"):new fi(w(2720,null),"ServiceChanged"):new fi(w(2721,null),"TurnedOff");const i=this.z.get(Af,-1);if(i&&this.g&&i!==this.g.session)throw this.F()?await this.G()?new fi(w(2722,null),"DefaultServiceChanged"):new fi(w(2723,null),"ServiceChanged"):new fi(w(2724,null),"SessionExpired");const n=await this.u.getMachines(this.g||void 0);if(s.isCancellationRequested)return;const r=n.find(a=>a.isCurrent);if(r?.disabled)throw new fi(w(2725,null),"TurnedOff");const o=new Date().getTime();if(await this.h.run(),this.y.publicLog2("settingsSync:sync",{duration:new Date().getTime()-o}),this.g===null)try{this.g=await this.r.manifest(null)}catch(a){throw new fi(Xt(a),a instanceof Ce?a.code:"Unknown")}this.g&&this.g.session!==i&&this.z.store(Af,this.g.session,-1,1),!s.isCancellationRequested&&(r||await this.u.addCurrentMachine(this.g||void 0))}register(e){return super.D(e)}},Tf=class extends Nf{constructor(e,s,i,n,r,o,a,c,l,h,u){super(e,s,i,n,r,a,c,l,h,u),this.D(O.debounce(O.any(O.map(o.onDidFocusMainWindow,()=>"windowFocus"),O.map(o.onDidOpenMainWindow,()=>"windowOpen")),(f,p)=>f?[...f,p]:[p],1e3)(f=>this.triggerSync(f,{skipIfSyncedRecently:!0})))}};Tf=__decorate([__param(0,ge),__param(1,ui),__param(2,rt),__param(3,mt),__param(4,La),__param(5,Jo),__param(6,Re),__param(7,Na),__param(8,ke),__param(9,Ma),__param(10,re)],Tf);var jf=class extends j{constructor(e,s){super(),this.b=e,this.c=s,this.a=new Map,this.c.configBasedExtensionTips&&Object.entries(this.c.configBasedExtensionTips).forEach(([,i])=>this.a.set(i.configPath,i))}getConfigBasedTips(e){return this.f(e)}async getImportantExecutableBasedTips(){return[]}async getOtherExecutableBasedTips(){return[]}async f(e){const s=[];for(const[i,n]of this.a)if(!(n.configScheme&&n.configScheme!==e.scheme))try{const r=(await this.b.readFile(V(e,i))).value.toString();for(const[o,a]of Object.entries(n.recommendations))(!a.contentPattern||new RegExp(a.contentPattern,"mig").test(r))&&s.push({extensionId:o,extensionName:a.name,configName:n.configName,important:!!a.important,isExtensionPack:!!a.isExtensionPack,whenNotInstalled:a.whenNotInstalled})}catch{}return s}};jf=__decorate([__param(0,K),__param(1,ge)],jf);var $v="extensionTips/promptedExecutableTips",xv="extensionTips/lastPromptedMediumImpExeTime",r3=class extends jf{constructor(t,e,s,i,n,r,o,a){super(o,a),this.q=t,this.r=e,this.s=s,this.t=i,this.u=n,this.w=r,this.g=new Map,this.h=new Map,this.j=new Map,this.m=new Map,this.n=new Map,a.exeBasedExtensionTips&&Object.entries(a.exeBasedExtensionTips).forEach(([c,l])=>{const h=[],u=[],f=[];Object.entries(l.recommendations).forEach(([p,g])=>{g.important?l.important?h.push({extensionId:p,extensionName:g.name,isExtensionPack:!!g.isExtensionPack}):u.push({extensionId:p,extensionName:g.name,isExtensionPack:!!g.isExtensionPack}):f.push({extensionId:p,extensionName:g.name,isExtensionPack:!!g.isExtensionPack})}),h.length&&this.g.set(c,{exeFriendlyName:l.friendlyName,windowsPath:l.windowsPath,recommendations:h}),u.length&&this.h.set(c,{exeFriendlyName:l.friendlyName,windowsPath:l.windowsPath,recommendations:u}),f.length&&this.j.set(c,{exeFriendlyName:l.friendlyName,windowsPath:l.windowsPath,recommendations:f})}),dn(async()=>{await this.z(),this.F(),this.G()},3e3,this.B)}async getImportantExecutableBasedTips(){const t=await this.O(this.g),e=await this.O(this.h);return[...t,...e]}getOtherExecutableBasedTips(){return this.O(this.j)}async z(){const t=await this.O(this.g),e=await this.O(this.h),s=await this.t.getInstalled();this.m=this.C(t,s),this.n=this.C(e,s)}C(t,e){const s=new Map;t.forEach(a=>s.set(a.extensionId.toLowerCase(),a));const{installed:i,uninstalled:n}=this.N([...s.keys()],e);for(const a of i){const c=s.get(a);c&&this.s.publicLog2("exeExtensionRecommendations:alreadyInstalled",{extensionId:a,exeName:c.exeName})}for(const a of n){const c=s.get(a);c&&this.s.publicLog2("exeExtensionRecommendations:notInstalled",{extensionId:a,exeName:c.exeName})}const r=this.L(),o=new Map;for(const a of n){const c=s.get(a);if(c&&(!r[c.exeName]||!r[c.exeName].includes(c.extensionId))){let l=o.get(c.exeName);l||(l=[],o.set(c.exeName,l)),l.push(c)}}return o}F(){if(this.m.size===0)return;const[t,e]=[...this.m.entries()][0];this.H(e).then(s=>{switch(s){case"reacted":this.M(e[0].exeName,e);break;case"ignored":this.m.delete(t);break;case"incompatibleWindow":{const i=O.once(O.latch(O.any(this.r.onDidOpenMainWindow,this.r.onDidFocusMainWindow)));this.D(i(()=>this.F()));break}case"toomany":{const i=this.D(new us);i.value=dn(()=>{i.dispose(),this.F()},60*60*1e3);break}}})}G(){if(this.n.size===0)return;const t=this.I(),e=Date.now()-t,s=7*24*60*60*1e3;if(e<s){const r=this.D(new us);r.value=dn(()=>{r.dispose(),this.G()},s-e);return}const[i,n]=[...this.n.entries()][0];this.H(n).then(r=>{switch(r){case"reacted":{this.J(Date.now()),this.n.delete(i),this.M(n[0].exeName,n);const o=this.D(new us);o.value=dn(()=>{o.dispose(),this.G()},s);break}case"ignored":this.n.delete(i),this.G();break;case"incompatibleWindow":{const o=O.once(O.latch(O.any(this.r.onDidOpenMainWindow,this.r.onDidFocusMainWindow)));this.D(o(()=>this.G()));break}case"toomany":{const o=this.D(new us);o.value=dn(()=>{o.dispose(),this.G()},60*60*1e3);break}}})}async H(t){const e=await this.t.getInstalled(1),s=t.filter(i=>!i.whenNotInstalled||i.whenNotInstalled.every(n=>e.every(r=>!G(r.identifier,{id:n})))).map(({extensionId:i})=>i.toLowerCase());return this.w.promptImportantExtensionsInstallNotification({extensions:s,source:3,name:t[0].exeFriendlyName,searchValue:`@exe:"${t[0].exeName}"`})}I(){let t=this.u.getNumber(xv,-1);return t||(t=Date.now(),this.J(t)),t}J(t){this.u.store(xv,t,-1,1)}L(){return JSON.parse(this.u.get($v,-1,"{}"))}M(t,e){const s=this.L();s[t]=e.map(({extensionId:i})=>i.toLowerCase()),this.u.store($v,JSON.stringify(s),-1,0)}N(t,e){const s=[],i=[],n=e.reduce((r,o)=>(r.add(o.identifier.id.toLowerCase()),r),new Set);return t.forEach(r=>{n.has(r.toLowerCase())?s.push(r):i.push(r)}),{installed:s,uninstalled:i}}async O(t){const e=[],s=new Map;for(const i of t.keys()){const n=t.get(i);if(!n||!Kn(n.recommendations))continue;const r=[];Le?n.windowsPath&&r.push(n.windowsPath.replace("%USERPROFILE%",()=>je.USERPROFILE).replace("%ProgramFiles(x86)%",()=>je["ProgramFiles(x86)"]).replace("%ProgramFiles%",()=>je.ProgramFiles).replace("%APPDATA%",()=>je.APPDATA).replace("%WINDIR%",()=>je.WINDIR)):(r.push(J("/usr/local/bin",i)),r.push(J("/usr/bin",i)),r.push(J(this.q.fsPath,i)));for(const o of r){let a=s.get(o);if(a===void 0&&(a=await this.b.exists(k.file(o)),s.set(o,a)),a)for(const{extensionId:c,extensionName:l,isExtensionPack:h,whenNotInstalled:u}of n.recommendations)e.push({extensionId:c,extensionName:l,isExtensionPack:h,exeName:i,exeFriendlyName:n.exeFriendlyName,windowsPath:n.windowsPath,whenNotInstalled:u})}}return e}},Mf=class extends r3{constructor(e,s,i,n,r,o,a,c){super(e.userHome,r,s,i,n,o,a,c)}};Mf=__decorate([__param(0,Vt),__param(1,ke),__param(2,Gs),__param(3,re),__param(4,Jo),__param(5,q0),__param(6,K),__param(7,ge)],Mf);var o3=class extends Kg{constructor(t,e,s,i){super(),this.ab=s,this.bb=i,this.W=this.D(new Pe),this.Z=this.D(new Pe),this.c=e.defaultProfile,this.s=this.cb(),this.U=e.currentProfile,this.X=this.db(this.U),this.Y=t?.id,this.$=this.eb(t)}cb(){const t=this.D(new qp(this.ab.getChannel("storage"))),e=this.D(new na(t));return this.D(e.onDidChangeStorage(s=>this.t(-1,s))),e}db(t){this.W.clear(),this.U=t;let e;if(aa(t))e=this.s;else{const s=this.W.add(new _p(this.ab.getChannel("storage"),t));e=this.W.add(new na(s))}return this.W.add(e.onDidChangeStorage(s=>this.t(0,s))),e}eb(t){this.Z.clear(),this.Y=t?.id;let e;if(t){const s=this.Z.add(new N2(this.ab.getChannel("storage"),t));e=this.Z.add(new na(s)),this.Z.add(e.onDidChangeStorage(i=>this.t(1,i)))}return e}async O(){await Xe.settled([this.s.init(),this.X.init(),this.$?.init()??Promise.resolve()])}P(t){switch(t){case-1:return this.s;case 0:return this.X;default:return this.$}}Q(t){switch(t){case-1:return this.c.globalStorageHome.with({scheme:ne.file}).fsPath;case 0:return this.U?.globalStorageHome.with({scheme:ne.file}).fsPath;default:return this.Y?`${V(this.bb.workspaceStorageHome,this.Y,"state.vscdb").with({scheme:ne.file}).fsPath}`:void 0}}async close(){this.r(),this.u(Bi.SHUTDOWN),await Xe.settled([this.s.close(),this.X.close(),this.$?.close()??Promise.resolve()])}async R(t){if(!this.M(this.U,t))return;const e=this.X,s=e.items;e!==this.s&&await e.close(),this.X=this.db(t),await this.X.init(),this.N(s,this.X,0)}async S(t,e){const s=this.$,i=s?.items??new Map;await s?.close(),this.$=this.eb(t),await this.$.init(),this.N(i,this.$,1)}hasScope(t){return Wg(t)?this.U.id===t.id:this.Y===t.id}};import*as a3 from"net";var c3=(t,e,s)=>{const i=new Uint8Array(16);for(let o=0;o<16;o++)i[o]=Math.round(Math.random()*256);const n=sb(L.wrap(i));return[`GET ws://localhost${t}?${e}&skipWebSocketFrames=true HTTP/1.1`,"Connection: Upgrade","Upgrade: websocket",`Sec-WebSocket-Key: ${n}`].join(`\r
`)+`\r
\r
`},xk=L.fromString(`\r
\r
`),l3=new class{supports(t){return!0}connect({host:t,port:e},s,i,n){return new Promise((r,o)=>{const a=a3.createConnection({host:t,port:e},()=>{a.removeListener("error",o),a.write(c3(s,i,n));const c=l=>{l.toString().indexOf(`\r
\r
`)>=0&&(a.off("data",c),r(new lf(a,n)))};a.on("data",c)});a.setNoDelay(!0),a.once("error",o)})}};import{homedir as h3,tmpdir as u3}from"os";var kv=/^([^.]+\..+)[:=](.+)$/,De=class{get appRoot(){return Qe(ii.asFileUri("").fsPath)}get userHome(){return k.file(this.b.homeDir)}get userDataPath(){return this.b.userDataDir}get appSettingsHome(){return k.file(J(this.userDataPath,"User"))}get tmpDir(){return k.file(this.b.tmpDir)}get cacheHome(){return k.file(this.userDataPath)}get stateResource(){return V(this.appSettingsHome,"globalStorage","storage.json")}get userRoamingDataHome(){return this.appSettingsHome.with({scheme:ne.vscodeUserData})}get userDataSyncHome(){return V(this.appSettingsHome,"sync")}get logsHome(){if(!this.args.logsPath){const t=uu(new Date).replace(/-|:|\.\d+Z$/g,"");this.args.logsPath=J(this.userDataPath,"logs",t)}return k.file(this.args.logsPath)}get sync(){return this.args.sync}get workspaceStorageHome(){return V(this.appSettingsHome,"workspaceStorage")}get localHistoryHome(){return V(this.appSettingsHome,"History")}get keyboardLayoutResource(){return V(this.userRoamingDataHome,"keyboardLayout.json")}get argvResource(){const t=je.VSCODE_PORTABLE;return t?k.file(J(t,"argv.json")):V(this.userHome,this.c.dataFolderName,"argv.json")}get isExtensionDevelopment(){return!!this.args.extensionDevelopmentPath}get untitledWorkspacesHome(){return k.file(J(this.userDataPath,"Workspaces"))}get builtinExtensionsPath(){const t=this.args["builtin-extensions-dir"];return t?Ai(t):si(J(ii.asFileUri("").fsPath,"..","extensions"))}get extensionsDownloadLocation(){const t=this.args["extensions-download-dir"];return t?k.file(Ai(t)):k.file(J(this.userDataPath,"CachedExtensionVSIXs"))}get extensionsPath(){const t=this.args["extensions-dir"];if(t)return Ai(t);const e=je.VSCODE_EXTENSIONS;if(e)return e;const s=je.VSCODE_PORTABLE;return s?J(s,"extensions"):V(this.userHome,this.c.dataFolderName,"extensions").fsPath}get extensionDevelopmentLocationURI(){const t=this.args.extensionDevelopmentPath;if(Array.isArray(t))return t.map(e=>/^[^:/?#]+?:\/\//.test(e)?k.parse(e):k.file(si(e)))}get extensionDevelopmentKind(){return this.args.extensionDevelopmentKind?.map(t=>t==="ui"||t==="workspace"||t==="web"?t:"workspace")}get extensionTestsLocationURI(){const t=this.args.extensionTestsPath;if(t)return/^[^:/?#]+?:\/\//.test(t)?k.parse(t):k.file(si(t))}get disableExtensions(){if(this.args["disable-extensions"])return!0;const t=this.args["disable-extension"];if(t){if(typeof t=="string")return[t];if(Array.isArray(t)&&t.length>0)return t}return!1}get debugExtensionHost(){return f3(this.args,this.isBuilt)}get debugRenderer(){return!!this.args.debugRenderer}get isBuilt(){return!je.VSCODE_DEV}get verbose(){return!!this.args.verbose}get logLevel(){return this.args.log?.find(t=>!kv.test(t))}get extensionLogLevel(){const t=[];for(const e of this.args.log||[]){const s=kv.exec(e);s?.[1]&&s[2]&&t.push([s[1],s[2]])}return t.length?t:void 0}get serviceMachineIdResource(){return V(k.file(this.userDataPath),"machineid")}get crashReporterId(){return this.args["crash-reporter-id"]}get crashReporterDirectory(){return this.args["crash-reporter-directory"]}get disableTelemetry(){return!!this.args["disable-telemetry"]}get disableExperiments(){return!!this.args["disable-experiments"]}get disableWorkspaceTrust(){return!!this.args["disable-workspace-trust"]}get useInMemorySecretStorage(){return!!this.args["use-inmemory-secretstorage"]}get policyFile(){if(this.args["__enable-file-policy"]){const t=je.VSCODE_PORTABLE;return t?k.file(J(t,"policy.json")):V(this.userHome,this.c.dataFolderName,"policy.json")}}get editSessionId(){return this.args.editSessionId}get exportPolicyData(){return this.args["export-policy-data"]}get continueOn(){return this.args.continueOn}set continueOn(t){this.args.continueOn=t}get args(){return this.a}constructor(t,e,s){this.a=t,this.b=e,this.c=s}};__decorate([xe],De.prototype,"appRoot",null),__decorate([xe],De.prototype,"userHome",null),__decorate([xe],De.prototype,"userDataPath",null),__decorate([xe],De.prototype,"appSettingsHome",null),__decorate([xe],De.prototype,"tmpDir",null),__decorate([xe],De.prototype,"cacheHome",null),__decorate([xe],De.prototype,"stateResource",null),__decorate([xe],De.prototype,"userRoamingDataHome",null),__decorate([xe],De.prototype,"userDataSyncHome",null),__decorate([xe],De.prototype,"sync",null),__decorate([xe],De.prototype,"workspaceStorageHome",null),__decorate([xe],De.prototype,"localHistoryHome",null),__decorate([xe],De.prototype,"keyboardLayoutResource",null),__decorate([xe],De.prototype,"argvResource",null),__decorate([xe],De.prototype,"isExtensionDevelopment",null),__decorate([xe],De.prototype,"untitledWorkspacesHome",null),__decorate([xe],De.prototype,"builtinExtensionsPath",null),__decorate([xe],De.prototype,"extensionsPath",null),__decorate([xe],De.prototype,"extensionDevelopmentLocationURI",null),__decorate([xe],De.prototype,"extensionDevelopmentKind",null),__decorate([xe],De.prototype,"extensionTestsLocationURI",null),__decorate([xe],De.prototype,"debugExtensionHost",null),__decorate([xe],De.prototype,"logLevel",null),__decorate([xe],De.prototype,"extensionLogLevel",null),__decorate([xe],De.prototype,"serviceMachineIdResource",null),__decorate([xe],De.prototype,"disableTelemetry",null),__decorate([xe],De.prototype,"disableExperiments",null),__decorate([xe],De.prototype,"disableWorkspaceTrust",null),__decorate([xe],De.prototype,"useInMemorySecretStorage",null),__decorate([xe],De.prototype,"policyFile",null);function f3(t,e){return d3(t["inspect-extensions"],t["inspect-brk-extensions"],5870,e,t.debugId,t.extensionEnvironment)}function d3(t,e,s,i,n,r){const a=Number(e||t)||(i?null:s),c=a?!!e:!1;let l;if(r)try{l=JSON.parse(r)}catch{}return{port:a,break:c,debugId:n,env:l}}import{homedir as Cv}from"os";import{resolve as p3,isAbsolute as g3,join as zn}from"path";var m3=process.env.VSCODE_CWD||process.cwd();function v3(t,e){const s=w3(t,e),i=[s];return g3(s)||i.unshift(m3),p3(...i)}function w3(t,e){process.env.VSCODE_DEV&&(e="code-oss-dev");const s=process.env.VSCODE_PORTABLE;if(s)return zn(s,"user-data");let i=process.env.VSCODE_APPDATA;if(i)return zn(i,e);const n=t["user-data-dir"];if(n)return n;switch(process.platform){case"win32":if(i=process.env.APPDATA,!i){const r=process.env.USERPROFILE;if(typeof r!="string")throw new Error("Windows: Unexpected undefined %USERPROFILE% environment variable");i=zn(r,"AppData","Roaming")}break;case"darwin":i=zn(Cv(),"Library","Application Support");break;case"linux":i=process.env.XDG_CONFIG_HOME||zn(Cv(),".config");break;default:throw new Error("Platform not supported")}return zn(i,e)}var y3=class extends De{constructor(t,e){super(t,{homeDir:h3(),tmpDir:u3(),userDataDir:v3(t,e.nameShort)},e)}},Uf={exit:"vscode:electron-main->shared-process=exit",ipcReady:"vscode:shared-process->electron-main=ipc-ready",initDone:"vscode:shared-process->electron-main=init-done"},b3={request:"vscode:createSharedProcessRawConnection",response:"vscode:createSharedProcessRawConnectionResult"};import{constants as S3,promises as E3}from"fs";import{createInterface as $3}from"readline";async function x3(t){if(bs||Le)return;let e;for(const s of["/etc/os-release","/usr/lib/os-release","/etc/lsb-release"])try{e=await E3.open(s,S3.R_OK);break}catch{}if(!e){t("Unable to retrieve release information from known identifier paths.");return}try{const s=new Set(["ID","DISTRIB_ID","ID_LIKE","VERSION_ID","DISTRIB_RELEASE"]),i={id:"unknown"};for await(const n of $3({input:e.createReadStream(),crlfDelay:1/0})){if(!n.includes("="))continue;const r=n.split("=")[0].toUpperCase().trim();if(s.has(r)){const o=n.split("=")[1].replace(/"/g,"").toLowerCase().trim();r==="ID"||r==="DISTRIB_ID"?i.id=o:r==="ID_LIKE"?i.id_like=o:(r==="VERSION_ID"||r==="DISTRIB_RELEASE")&&(i.version_id=o)}}return i}catch(s){t(s)}}var Fe;(function(t){t.UNKNOWN="UNKNOWN",t.CINNAMON="CINNAMON",t.DEEPIN="DEEPIN",t.GNOME="GNOME",t.KDE3="KDE3",t.KDE4="KDE4",t.KDE5="KDE5",t.KDE6="KDE6",t.PANTHEON="PANTHEON",t.UNITY="UNITY",t.XFCE="XFCE",t.UKUI="UKUI",t.LXQT="LXQT"})(Fe||(Fe={}));var k3="XDG_CURRENT_DESKTOP",Ff="KDE_SESSION_VERSION";function C3(){const t=je[k3];if(t){const s=t.split(":").map(i=>i.trim()).filter(i=>i.length>0);for(const i of s)switch(i){case"Unity":{const n=je.DESKTOP_SESSION;return n&&n.includes("gnome-fallback")?Fe.GNOME:Fe.UNITY}case"Deepin":return Fe.DEEPIN;case"GNOME":return Fe.GNOME;case"X-Cinnamon":return Fe.CINNAMON;case"KDE":{const n=je[Ff];return n==="5"?Fe.KDE5:n==="6"?Fe.KDE6:Fe.KDE4}case"Pantheon":return Fe.PANTHEON;case"XFCE":return Fe.XFCE;case"UKUI":return Fe.UKUI;case"LXQt":return Fe.LXQT}}const e=je.DESKTOP_SESSION;if(e)switch(e){case"deepin":return Fe.DEEPIN;case"gnome":case"mate":return Fe.GNOME;case"kde4":case"kde-plasma":return Fe.KDE4;case"kde":return Ff in je?Fe.KDE4:Fe.KDE3;case"xfce":case"xubuntu":return Fe.XFCE;case"ukui":return Fe.UKUI}return"GNOME_DESKTOP_SESSION_ID"in je?Fe.GNOME:"KDE_FULL_SESSION"in je?Ff in je?Fe.KDE4:Fe.KDE3:Fe.UNKNOWN}import{constants as R3,promises as D3}from"fs";var P3="XDG_SESSION_TYPE",I3="WAYLAND_DISPLAY",A3="XDG_RUNTIME_DIR",Rv;(function(t){t.Wayland="wayland",t.XWayland="xwayland",t.X11="x11",t.Unknown="unknown"})(Rv||(Rv={}));async function L3(t){const e=je[P3];if(e)return e==="wayland"||e==="x11"?e:"unknown";if(je[I3]){const i=je[A3];if(i){const n=J(i,"wayland-0");try{return await D3.access(n,R3.R_OK),"wayland"}catch(r){return t(r),"unknown"}}else return"unknown"}else return"x11"}function O3(t,e){if(e)switch(e){case"auto":return t;case"x11":return t==="wayland"?"xwayland":"x11";case"wayland":return"wayland";default:return"unknown"}else return t==="wayland"?"xwayland":"x11"}import{net as N3}from"electron";import{parse as Dv}from"url";import{spawn as T3}from"child_process";import{userInfo as j3}from"os";import*as Pv from"os";var Iv=/^\d+$/,M3=/^Microsoft.PowerShell_.*/,U3=/^Microsoft.PowerShellPreview_.*/,Av;(function(t){t[t.x64=0]="x64",t[t.x86=1]="x86",t[t.ARM=2]="ARM"})(Av||(Av={}));var Gr;switch(process.arch){case"ia32":Gr=1;break;case"arm":case"arm64":Gr=2;break;default:Gr=0;break}var Vn;process.env.PROCESSOR_ARCHITEW6432?Vn=process.env.PROCESSOR_ARCHITEW6432==="ARM64"?2:0:process.env.PROCESSOR_ARCHITECTURE==="ARM64"?Vn=2:process.env.PROCESSOR_ARCHITECTURE==="X86"?Vn=1:Vn=0;var Jr=class{constructor(t,e,s){this.exePath=t,this.displayName=e,this.a=s}async exists(){return this.a===void 0&&(this.a=await _t.existsFile(this.exePath)),this.a}};function F3({useAlternateBitness:t=!1}={}){return t?Gr===0?process.env["ProgramFiles(x86)"]||null:Vn===0&&process.env.ProgramW6432||null:process.env.ProgramFiles||null}async function lc({useAlternateBitness:t=!1,findPreview:e=!1}={}){const s=F3({useAlternateBitness:t});if(!s)return null;const i=J(s,"PowerShell");if(!await _t.existsDirectory(i))return null;let n=-1,r=null;for(const c of await le.readdir(i)){let l=-1;if(e){const u=c.indexOf("-");if(u<0)continue;const f=c.substring(0,u);if(!Iv.test(f)||c.substring(u+1)!=="preview")continue;l=parseInt(f,10)}else{if(!Iv.test(c))continue;l=parseInt(c,10)}if(l<=n)continue;const h=J(i,c,"pwsh.exe");await _t.existsFile(h)&&(r=h,n=l)}if(!r)return null;const o=s.includes("x86")?" (x86)":"",a=e?" Preview":"";return new Jr(r,`PowerShell${a}${o}`,!0)}async function Lv({findPreview:t}={}){if(!process.env.LOCALAPPDATA)return null;const e=J(process.env.LOCALAPPDATA,"Microsoft","WindowsApps");if(!await _t.existsDirectory(e))return null;const{pwshMsixDirRegex:s,pwshMsixName:i}=t?{pwshMsixDirRegex:U3,pwshMsixName:"PowerShell Preview (Store)"}:{pwshMsixDirRegex:M3,pwshMsixName:"PowerShell (Store)"};for(const n of await le.readdir(e))if(s.test(n)){const r=J(e,n,"pwsh.exe");return new Jr(r,i)}return null}function q3(){const t=J(Pv.homedir(),".dotnet","tools","pwsh.exe");return new Jr(t,".NET Core PowerShell Global Tool")}function _3(){const t=J(Pv.homedir(),"scoop","apps"),e=J(t,"pwsh","current","pwsh.exe");return new Jr(e,"PowerShell (Scoop)")}function z3(){const t=J(process.env.windir,Gr===1&&Vn!==1?"SysNative":"System32","WindowsPowerShell","v1.0","powershell.exe");return new Jr(t,"Windows PowerShell",!0)}async function*V3(){let t=await lc();t&&(yield t),t=await lc({useAlternateBitness:!0}),t&&(yield t),t=await Lv(),t&&(yield t),t=q3(),t&&(yield t),t=await lc({findPreview:!0}),t&&(yield t),t=await Lv({findPreview:!0}),t&&(yield t),t=await lc({useAlternateBitness:!0,findPreview:!0}),t&&(yield t),t=await _3(),t&&(yield t),t=z3(),t&&(yield t)}async function*B3(){for await(const t of V3())await t.exists()&&(yield t)}async function W3(){for await(const t of B3())return t;return null}async function H3(t,e){return t===1?Le?J3():T7(e):G3(t,e)}var qf=null;function G3(t,e){if(ut&&t===2||bs&&t===3)return"/bin/bash";if(!qf){let s;if(Le)s="/bin/bash";else{if(s=e.SHELL,!s)try{s=j3().shell}catch{}s||(s="sh"),s==="/bin/false"&&(s="/bin/bash")}qf=s}return qf}var _f=null;async function J3(){return _f||(_f=(await W3()).exePath),_f}import"assert";var Mk=Mw(Uw(),1),Uk={o:w(1893,null),e:w(1894,null),t:w(1895,null),m:w(1896,null)},Fk={chat:{type:"subcommand",description:"Pass in a prompt to run in a chat session in the current working directory.",options:{_:{type:"string[]",description:w(1897,null)},mode:{type:"string",cat:"o",alias:"m",args:"mode",description:w(1898,null)},"add-file":{type:"string[]",cat:"o",alias:"a",args:"path",description:w(1899,null)},maximize:{type:"boolean",cat:"o",description:w(1900,null)},"reuse-window":{type:"boolean",cat:"o",alias:"r",description:w(1901,null)},"new-window":{type:"boolean",cat:"o",alias:"n",description:w(1902,null)},profile:{type:"string",cat:"o",args:"profileName",description:w(1903,null)},help:{type:"boolean",alias:"h",description:w(1904,null)}}},"serve-web":{type:"subcommand",description:"Run a server that displays the editor UI in browsers.",options:{"cli-data-dir":{type:"string",args:"dir",description:w(1905,null)},"disable-telemetry":{type:"boolean"},"telemetry-level":{type:"string"}}},tunnel:{type:"subcommand",description:"Make the current machine accessible from vscode.dev or other machines through a secure tunnel.",options:{"cli-data-dir":{type:"string",args:"dir",description:w(1906,null)},"disable-telemetry":{type:"boolean"},"telemetry-level":{type:"string"},user:{type:"subcommand",options:{login:{type:"subcommand",options:{provider:{type:"string"},"access-token":{type:"string"}}}}}}},diff:{type:"boolean",cat:"o",alias:"d",args:["file","file"],description:w(1907,null)},merge:{type:"boolean",cat:"o",alias:"m",args:["path1","path2","base","result"],description:w(1908,null)},add:{type:"boolean",cat:"o",alias:"a",args:"folder",description:w(1909,null)},remove:{type:"boolean",cat:"o",args:"folder",description:w(1910,null)},goto:{type:"boolean",cat:"o",alias:"g",args:"file:line[:character]",description:w(1911,null)},"new-window":{type:"boolean",cat:"o",alias:"n",description:w(1912,null)},"reuse-window":{type:"boolean",cat:"o",alias:"r",description:w(1913,null)},wait:{type:"boolean",cat:"o",alias:"w",description:w(1914,null)},waitMarkerFilePath:{type:"string"},locale:{type:"string",cat:"o",args:"locale",description:w(1915,null)},"user-data-dir":{type:"string",cat:"o",args:"dir",description:w(1916,null)},profile:{type:"string",cat:"o",args:"profileName",description:w(1917,null)},help:{type:"boolean",cat:"o",alias:"h",description:w(1918,null)},"extensions-dir":{type:"string",deprecates:["extensionHomePath"],cat:"e",args:"dir",description:w(1919,null)},"extensions-download-dir":{type:"string"},"builtin-extensions-dir":{type:"string"},"list-extensions":{type:"boolean",cat:"e",description:w(1920,null)},"show-versions":{type:"boolean",cat:"e",description:w(1921,null)},category:{type:"string",allowEmptyValue:!0,cat:"e",description:w(1922,null),args:"category"},"install-extension":{type:"string[]",cat:"e",args:"ext-id | path",description:w(1923,null)},"pre-release":{type:"boolean",cat:"e",description:w(1924,null)},"uninstall-extension":{type:"string[]",cat:"e",args:"ext-id",description:w(1925,null)},"update-extensions":{type:"boolean",cat:"e",description:w(1926,null)},"enable-proposed-api":{type:"string[]",allowEmptyValue:!0,cat:"e",args:"ext-id",description:w(1927,null)},"add-mcp":{type:"string[]",cat:"m",args:"json",description:w(1928,null)},version:{type:"boolean",cat:"t",alias:"v",description:w(1929,null)},verbose:{type:"boolean",cat:"t",global:!0,description:w(1930,null)},log:{type:"string[]",cat:"t",args:"level",global:!0,description:w(1931,null)},status:{type:"boolean",alias:"s",cat:"t",description:w(1932,null)},"prof-startup":{type:"boolean",cat:"t",description:w(1933,null)},"prof-append-timers":{type:"string"},"prof-duration-markers":{type:"string[]"},"prof-duration-markers-file":{type:"string"},"no-cached-data":{type:"boolean"},"prof-startup-prefix":{type:"string"},"prof-v8-extensions":{type:"boolean"},"disable-extensions":{type:"boolean",deprecates:["disableExtensions"],cat:"t",description:w(1934,null)},"disable-extension":{type:"string[]",cat:"t",args:"ext-id",description:w(1935,null)},sync:{type:"string",cat:"t",description:w(1936,null),args:["on | off"]},"inspect-extensions":{type:"string",allowEmptyValue:!0,deprecates:["debugPluginHost"],args:"port",cat:"t",description:w(1937,null)},"inspect-brk-extensions":{type:"string",allowEmptyValue:!0,deprecates:["debugBrkPluginHost"],args:"port",cat:"t",description:w(1938,null)},"disable-lcd-text":{type:"boolean",cat:"t",description:w(1939,null)},"disable-gpu":{type:"boolean",cat:"t",description:w(1940,null)},"disable-chromium-sandbox":{type:"boolean",cat:"t",description:w(1941,null)},sandbox:{type:"boolean"},"locate-shell-integration-path":{type:"string",cat:"t",args:["shell"],description:w(1942,null)},telemetry:{type:"boolean",cat:"t",description:w(1943,null)},remote:{type:"string",allowEmptyValue:!0},"folder-uri":{type:"string[]",cat:"o",args:"uri"},"file-uri":{type:"string[]",cat:"o",args:"uri"},"locate-extension":{type:"string[]"},extensionDevelopmentPath:{type:"string[]"},extensionDevelopmentKind:{type:"string[]"},extensionTestsPath:{type:"string"},extensionEnvironment:{type:"string"},debugId:{type:"string"},debugRenderer:{type:"boolean"},"inspect-ptyhost":{type:"string",allowEmptyValue:!0},"inspect-brk-ptyhost":{type:"string",allowEmptyValue:!0},"inspect-search":{type:"string",deprecates:["debugSearch"],allowEmptyValue:!0},"inspect-brk-search":{type:"string",deprecates:["debugBrkSearch"],allowEmptyValue:!0},"inspect-sharedprocess":{type:"string",allowEmptyValue:!0},"inspect-brk-sharedprocess":{type:"string",allowEmptyValue:!0},"export-default-configuration":{type:"string"},"export-policy-data":{type:"string",allowEmptyValue:!0},"install-source":{type:"string"},"enable-smoke-test-driver":{type:"boolean"},logExtensionHostCommunication:{type:"boolean"},"skip-release-notes":{type:"boolean"},"skip-welcome":{type:"boolean"},"disable-telemetry":{type:"boolean"},"disable-updates":{type:"boolean"},transient:{type:"boolean",cat:"t",description:w(1944,null)},"use-inmemory-secretstorage":{type:"boolean",deprecates:["disable-keytar"]},"password-store":{type:"string"},"disable-workspace-trust":{type:"boolean"},"disable-crash-reporter":{type:"boolean"},"crash-reporter-directory":{type:"string"},"crash-reporter-id":{type:"string"},"skip-add-to-recently-opened":{type:"boolean"},"open-url":{type:"boolean"},"file-write":{type:"boolean"},"file-chmod":{type:"boolean"},"install-builtin-extension":{type:"string[]"},force:{type:"boolean"},"do-not-sync":{type:"boolean"},"do-not-include-pack-dependencies":{type:"boolean"},trace:{type:"boolean"},"trace-memory-infra":{type:"boolean"},"trace-category-filter":{type:"string"},"trace-options":{type:"string"},"preserve-env":{type:"boolean"},"force-user-env":{type:"boolean"},"force-disable-user-env":{type:"boolean"},"open-devtools":{type:"boolean"},"disable-gpu-sandbox":{type:"boolean"},logsPath:{type:"string"},"__enable-file-policy":{type:"boolean"},editSessionId:{type:"string"},continueOn:{type:"string"},"enable-coi":{type:"boolean"},"unresponsive-sample-interval":{type:"string"},"unresponsive-sample-period":{type:"string"},"enable-rdp-display-tracking":{type:"boolean"},"disable-layout-restore":{type:"boolean"},"disable-experiments":{type:"boolean"},"no-proxy-server":{type:"boolean"},"no-sandbox":{type:"boolean",alias:"sandbox"},"proxy-server":{type:"string"},"proxy-bypass-list":{type:"string"},"proxy-pac-url":{type:"string"},"js-flags":{type:"string"},inspect:{type:"string",allowEmptyValue:!0},"inspect-brk":{type:"string",allowEmptyValue:!0},nolazy:{type:"boolean"},"force-device-scale-factor":{type:"string"},"force-renderer-accessibility":{type:"boolean"},"ignore-certificate-errors":{type:"boolean"},"allow-insecure-localhost":{type:"boolean"},"log-net-log":{type:"string"},vmodule:{type:"string"},_urls:{type:"string[]"},"disable-dev-shm-usage":{type:"boolean"},"profile-temp":{type:"boolean"},"ozone-platform":{type:"string"},"enable-tracing":{type:"string"},"trace-startup-format":{type:"string"},"trace-startup-file":{type:"string"},"trace-startup-duration":{type:"string"},"xdg-portal-required-version":{type:"string"},_:{type:"string[]"}};function Ov(t){return t.VSCODE_CLI==="1"}function K3(t,e,s){return Math.min(Math.max(t,e),s)}var zf=void 0;async function Q3(t,e,s,i){return s["force-disable-user-env"]?(e.trace("resolveShellEnv(): skipped (--force-disable-user-env)"),{}):Le?(e.trace("resolveShellEnv(): skipped (Windows)"),{}):Ov(i)&&!s["force-user-env"]?(e.trace("resolveShellEnv(): skipped (VSCODE_CLI is set)"),{}):(Ov(i)?e.trace("resolveShellEnv(): running (--force-user-env)"):e.trace("resolveShellEnv(): running (macOS/Linux)"),zf||(zf=Xe.withAsyncBody(async(n,r)=>{const o=new fs;let a=1e4;const c=t.getValue("application.shellEnvironmentResolutionTimeout");typeof c=="number"&&(a=K3(c,1,120)*1e3);const l=setTimeout(()=>{o.dispose(!0),r(new Error(w(2310,null)))},a);try{n(await X3(e,o.token))}catch(h){!Ms(h)&&!o.token.isCancellationRequested?r(new Error(w(2311,null,Xt(h)))):n({})}finally{clearTimeout(l),o.dispose()}})),zf)}async function X3(t,e){const s=process.env.ELECTRON_RUN_AS_NODE;t.trace("getUnixShellEnvironment#runAsNode",s);const i=process.env.ELECTRON_NO_ATTACH_CONSOLE;t.trace("getUnixShellEnvironment#noAttach",i);const n=tt().replace(/-/g,"").substr(0,12),r=new RegExp(n+"({.*})"+n),o={...process.env,ELECTRON_RUN_AS_NODE:"1",ELECTRON_NO_ATTACH_CONSOLE:"1",VSCODE_RESOLVING_ENVIRONMENT:"1"};t.trace("getUnixShellEnvironment#env",o);const a=await H3(ln,o);return t.trace("getUnixShellEnvironment#shell",a),new Promise((c,l)=>{if(e.isCancellationRequested)return l(new nt);const h=qt(a);let u,f;const p="";/^(?:pwsh|powershell)(?:-preview)?$/.test(h)?(u=`& '${process.execPath}' ${p} -p '''${n}'' + JSON.stringify(process.env) + ''${n}'''`,f=["-Login","-Command"]):h==="nu"?(u=`^'${process.execPath}' ${p} -p '"${n}" + JSON.stringify(process.env) + "${n}"'`,f=["-i","-l","-c"]):h==="xonsh"?(u=`import os, json; print("${n}", json.dumps(dict(os.environ)), "${n}")`,f=["-i","-l","-c"]):(u=`'${process.execPath}' ${p} -p '"${n}" + JSON.stringify(process.env) + "${n}"'`,h==="tcsh"||h==="csh"?f=["-ic"]:f=["-i","-l","-c"]),t.trace("getUnixShellEnvironment#spawn",JSON.stringify(f),u);const g=T3(a,[...f,u],{detached:!0,stdio:["ignore","pipe","pipe"],env:o});e.onCancellationRequested(()=>(g.kill(),l(new nt))),g.on("error",b=>{t.error("getUnixShellEnvironment#errorChildProcess",Xt(b)),l(b)});const m=[];g.stdout.on("data",b=>m.push(b));const v=[];g.stderr.on("data",b=>v.push(b)),g.on("close",(b,S)=>{const $=Buffer.concat(m).toString("utf8");t.trace("getUnixShellEnvironment#raw",$);const F=Buffer.concat(v).toString("utf8");if(F.trim()&&t.trace("getUnixShellEnvironment#stderr",F),b||S)return l(new Error(w(2312,null,b,S)));const B=r.exec($),ve=B?B[1]:"{}";try{const N=JSON.parse(ve);s?N.ELECTRON_RUN_AS_NODE=s:delete N.ELECTRON_RUN_AS_NODE,i?N.ELECTRON_NO_ATTACH_CONSOLE=i:delete N.ELECTRON_NO_ATTACH_CONSOLE,delete N.VSCODE_RESOLVING_ENVIRONMENT,delete N.XDG_RUNTIME_DIR,t.trace("getUnixShellEnvironment#result",N),c(N)}catch(N){t.error("getUnixShellEnvironment#errorCaught",Xt(N)),l(N)}})})}import{parse as Nv}from"url";function Z3(t,e){return t.protocol==="http:"?e.HTTP_PROXY||e.http_proxy||null:t.protocol==="https:"&&(e.HTTPS_PROXY||e.https_proxy||e.HTTP_PROXY||e.http_proxy)||null}async function Y3(t,e,s={}){const i=Nv(t),n=s.proxyUrl||Z3(i,e);if(!n)return null;const r=Nv(n);if(!/^https?:$/.test(r.protocol||""))return null;const o={host:r.hostname||"",port:(r.port?+r.port:0)||(r.protocol==="https"?443:80),auth:r.auth,rejectUnauthorized:ls(s.strictSSL)?s.strictSSL:!0};if(i.protocol==="http:"){const{default:a}=await import("http-proxy-agent");return new a.HttpProxyAgent(n,o)}else{const{default:a}=await import("https-proxy-agent");return new a.HttpsProxyAgent(n,o)}}import{createGunzip as eS}from"zlib";var Vf=class extends y5{constructor(e,s,i,n){super(n),this.m=e,this.n=s,this.q=i,this.r(),this.D(s.onDidChangeConfiguration(r=>{r.affectsConfiguration("http")&&this.r()}))}r(){this.f=this.s("http.proxy"),this.g=!!this.s("http.proxyStrictSSL"),this.h=this.s("http.proxyAuthorization")}async request(e,s){const{f:i,g:n}=this;let r;try{r=await Q3(this.n,this.b,this.q.args,process.env)}catch(c){this.j||(this.j=!0,this.b.error("resolving shell environment failed",se(c)))}const o={...process.env,...r},a=e.agent?e.agent:await Y3(e.url||"",o,{proxyUrl:i,strictSSL:n});return e.agent=a,e.strictSSL=n,this.h&&(e.headers={...e.headers||{},"Proxy-Authorization":this.h}),this.c(e,()=>Tv(e,s))}async resolveProxy(e){}async lookupAuthorization(e){}async lookupKerberosAuthorization(e){try{const s=this.s("http.proxyKerberosServicePrincipal");return"Negotiate "+await tS(e,s,this.b,"RequestService#lookupKerberosAuthorization")}catch(s){this.b.debug("RequestService#lookupKerberosAuthorization Kerberos authentication failed",s);return}}async loadCertificates(){return(await import("@vscode/proxy-agent")).loadSystemCertificates({loadSystemCertificatesFromNode:()=>this.s("http.systemCertificatesNode",Dg),log:this.b})}s(e,s){if(this.m==="remote")return this.n.getValue(e);const i=this.n.inspect(e);return i.userLocalValue??i.defaultValue??s}};Vf=__decorate([__param(1,me),__param(2,Vt),__param(3,Q)],Vf);async function tS(t,e,s,i){const n=await import("kerberos"),r=n.default||n,o=new URL(t),a=e||(process.platform==="win32"?`HTTP/${o.hostname}`:`HTTP@${o.hostname}`);return s.debug(`${i} Kerberos authentication lookup`,`proxyURL:${o}`,`spn:${a}`),(await r.initializeClient(a)).step("")}async function sS(t){return(Dv(t.url).protocol==="https:"?await import("https"):await import("http")).request}async function Tv(t,e){return Xe.withAsyncBody(async(s,i)=>{const n=Dv(t.url),r=t.getRawRequest?t.getRawRequest(t):await sS(t),o={hostname:n.hostname,port:n.port?parseInt(n.port):n.protocol==="https:"?443:80,protocol:n.protocol,path:n.path,method:t.type||"GET",headers:t.headers,agent:t.agent,rejectUnauthorized:ls(t.strictSSL)?t.strictSSL:!0};t.user&&t.password&&(o.auth=t.user+":"+t.password),t.disableCache&&(o.cache="no-store");const a=r(o,c=>{const l=fo(t.followRedirects)?t.followRedirects:3;if(c.statusCode&&c.statusCode>=300&&c.statusCode<400&&l>0&&c.headers.location)Tv({...t,url:c.headers.location,followRedirects:l-1},e).then(s,i);else{let h=c;!t.isChromiumNetwork&&c.headers["content-encoding"]==="gzip"&&(h=c.pipe(eS())),s({res:c,stream:Z4(h)})}});if(a.on("error",i),t.timeout)if(t.isChromiumNetwork){const c=setTimeout(()=>{a.abort(),i(new Error(`Request timeout after ${t.timeout}ms`))},t.timeout);a.on("response",()=>clearTimeout(c)),a.on("error",()=>clearTimeout(c)),a.on("abort",()=>clearTimeout(c))}else a.setTimeout(t.timeout);t.isChromiumNetwork&&a.removeHeader("Content-Length"),t.data&&typeof t.data=="string"&&a.write(t.data),a.end(),e.onCancellationRequested(()=>{a.abort(),i(new nt)})})}function iS(t){return N3.request}var Bf=class extends Vf{constructor(e,s,i){super("local",e,s,i)}request(e,s){return super.request({...e||{},getRawRequest:iS,isChromiumNetwork:!0},s)}};Bf=__decorate([__param(0,me),__param(1,Vt),__param(2,Q)],Bf);var Wf="initializing-default-extensions",Hf=class extends j{constructor(e,s,i,n,r,o){super(),this.a=e,this.b=s,this.c=n,this.f=r,this.g=o,Le&&i.getBoolean(Wf,-1,!0)&&(i.store(Wf,!0,-1,1),this.h().then(()=>i.store(Wf,!1,-1,1)))}async h(){const e=this.j();let s;try{if(s=await this.c.resolve(e),!s.children){this.f.debug("There are no default extensions to initialize",e.toString());return}}catch(n){if(Ue(n)===1){this.f.debug("There are no default extensions to initialize",e.toString());return}this.f.error("Error initializing extensions",n);return}const i=s.children.filter(n=>n.name.toLowerCase().endsWith(".vsix"));if(i.length===0){this.f.debug("There are no default extensions to initialize",e.toString());return}this.f.info("Initializing default extensions",e.toString()),await Promise.all(i.map(async n=>{this.f.info("Installing default extension",n.resource.toString());try{await this.b.install(n.resource,{donotIncludePackAndDependencies:!0,keepExisting:!1}),this.f.info("Default extension installed",n.resource.toString())}catch(r){this.f.error("Error installing default extension",n.resource.toString(),se(r))}})),this.f.info("Default extensions initialized",e.toString())}j(){return this.g.quality==="insider"?k.file(J(Qe(Qe(Qe(this.a.appRoot))),"bootstrap","extensions")):k.file(J(Qe(Qe(this.a.appRoot)),"bootstrap","extensions"))}};Hf=__decorate([__param(0,Vt),__param(1,zh),__param(2,re),__param(3,K),__param(4,Q),__param(5,ge)],Hf);function nS(t){return t.type==="gallery"}function rS(t){return t.type===1||t.type===0}var oS=/^(?<version>\d+\.\d+\.\d+(-.*)?)(@(?<platform>.+))?$/,Gf=class extends j{get allowedExtensionsConfigValue(){return this.b}constructor(e,s){super(),this.f=s,this.c=this.D(new R),this.onDidChangeAllowedExtensionsConfigValue=this.c.event,this.a=e.extensionPublisherOrgs?.map(i=>i.toLowerCase())??[],this.b=this.g(),this.D(this.f.onDidChangeConfiguration(i=>{i.affectsConfiguration(Ho)&&(this.b=this.g(),this.c.fire())}))}g(){const e=this.f.getValue(Ho);if(!Te(e)||Array.isArray(e))return;const s=Object.entries(e).map(([i,n])=>[i.toLowerCase(),n]);if(!(s.length===1&&s[0][0]==="*"&&s[0][1]===!0))return Object.fromEntries(s)}isAllowed(e){if(!this.b)return!0;let s,i,n,r,o,a;nS(e)?(s=e.identifier.id.toLowerCase(),i=e.version,r=e.properties.isPreReleaseVersion,o=e.publisher.toLowerCase(),a=e.publisherDisplayName.toLowerCase(),n=e.properties.targetPlatform):rS(e)?(s=e.identifier.id.toLowerCase(),i=e.manifest.version,r=e.preRelease,o=e.manifest.publisher.toLowerCase(),a=e.publisherDisplayName?.toLowerCase(),n=e.targetPlatform):(s=e.id.toLowerCase(),i=e.version??"*",n=e.targetPlatform??"universal",r=e.prerelease??!1,o=e.id.substring(0,e.id.indexOf(".")).toLowerCase(),a=e.publisherDisplayName?.toLowerCase());const c=R0("workbench.action.openSettings",{query:`@id:${Ho}`}).toString(),l=this.b[s],h=new Ps(w(1976,null,c));if(!ot(l))return ls(l)?l?!0:h:l==="stable"&&r?new Ps(w(1977,null,c)):i!=="*"&&Array.isArray(l)&&!l.some(p=>{const g=oS.exec(p);if(g&&g.groups){const{platform:m,version:v}=g.groups;return!(v!==i||n!=="universal"&&m&&n!==m)}return!1})?new Ps(w(1978,null,i,c)):!0;const u=a&&this.a.includes(a)?a:o,f=this.b[u];return ot(f)?this.b["*"]===!0?!0:h:ls(f)?f?!0:new Ps(w(1979,null,u,c)):f==="stable"&&r?new Ps(w(1980,null,u,c)):!0}};Gf=__decorate([__param(0,ge),__param(1,me)],Gf);var Jf=class extends j{get extensionGalleryManifestStatus(){return this.a.extensionsGallery?.serviceUrl?"available":"unavailable"}constructor(e){super(),this.a=e,this.onDidChangeExtensionGalleryManifest=O.None,this.onDidChangeExtensionGalleryManifestStatus=O.None}async getExtensionGalleryManifest(){const e=this.a.extensionsGallery;if(!e?.serviceUrl)return null;const s=[{id:`${e.serviceUrl}/extensionquery`,type:"ExtensionQueryService"},{id:`${e.serviceUrl}/vscode/{publisher}/{name}/latest`,type:"ExtensionLatestVersionUriTemplate"},{id:`${e.serviceUrl}/publishers/{publisher}/extensions/{name}/{version}/stats?statType={statTypeName}`,type:"ExtensionStatisticsUriTemplate"},{id:`${e.serviceUrl}/itemName/{publisher}.{name}/version/{version}/statType/{statTypeValue}/vscodewebextension`,type:"WebExtensionStatisticsUriTemplate"}];return e.publisherUrl&&s.push({id:`${e.publisherUrl}/{publisher}`,type:"PublisherViewUriTemplate"}),e.itemUrl&&(s.push({id:`${e.itemUrl}?itemName={publisher}.{name}`,type:"ExtensionDetailsViewUriTemplate"}),s.push({id:`${e.itemUrl}?itemName={publisher}.{name}&ssr=false#review-details`,type:"ExtensionRatingViewUriTemplate"})),e.resourceUrlTemplate&&s.push({id:e.resourceUrlTemplate,type:"ExtensionResourceUriTemplate"}),{version:"",resources:s,capabilities:{extensionQuery:{filtering:[{name:"Tag",value:1},{name:"ExtensionId",value:4},{name:"Category",value:5},{name:"ExtensionName",value:7},{name:"Target",value:8},{name:"Featured",value:9},{name:"SearchText",value:10},{name:"ExcludeWithFlags",value:12}],sorting:[{name:"NoneOrRelevance",value:0},{name:"LastUpdatedDate",value:1},{name:"Title",value:2},{name:"PublisherName",value:3},{name:"InstallCount",value:4},{name:"AverageRating",value:6},{name:"PublishedDate",value:10},{name:"WeightedRating",value:12}],flags:[{name:"None",value:0},{name:"IncludeVersions",value:1},{name:"IncludeFiles",value:2},{name:"IncludeCategoryAndTags",value:4},{name:"IncludeSharedAccounts",value:8},{name:"IncludeVersionProperties",value:16},{name:"ExcludeNonValidated",value:32},{name:"IncludeInstallationTargets",value:64},{name:"IncludeAssetUri",value:128},{name:"IncludeStatistics",value:256},{name:"IncludeLatestVersionOnly",value:512},{name:"Unpublished",value:4096},{name:"IncludeNameConflictInfo",value:32768},{name:"IncludeLatestPrereleaseAndStableVersionOnly",value:65536}]},signing:{allPublicRepositorySigned:!0}}}}};Jf=__decorate([__param(0,ge)],Jf);var Kf=class extends Jf{get extensionGalleryManifestStatus(){return this.f?"available":"unavailable"}constructor(e,s){super(s),this.b=this.D(new R),this.onDidChangeExtensionGalleryManifest=this.b.event,this.c=this.D(new R),this.onDidChangeExtensionGalleryManifestStatus=this.c.event,this.g=new rr,e.registerChannel("extensionGalleryManifest",{listen:()=>O.None,call:async(i,n,r)=>{switch(n){case"setExtensionGalleryManifest":return Promise.resolve(this.h(r[0]))}throw new Error("Invalid call")}})}async getExtensionGalleryManifest(){return await this.g.wait(),this.f??null}h(e){this.f=e,this.b.fire(e),this.c.fire(this.extensionGalleryManifestStatus),this.g.open()}};Kf=__decorate([__param(1,ge)],Kf);var Jk=W("IWebContentExtractorService"),jv=W("ISharedWebContentExtractorService"),aS=class{async readImage(t,e){if(!e.isCancellationRequested)try{const s=await fetch(t.toString(!0),{headers:{Accept:"image/*","User-Agent":"Mozilla/5.0"}}),i=s.headers.get("content-type");return!s.ok||!i?.startsWith("image/")||!/(webp|jpg|jpeg|gif|png|bmp)$/i.test(i)?void 0:L.wrap(await s.bytes())}catch(s){console.log(s);return}}},Mv;(function(t){t.NODE="npm",t.PYTHON="pypi",t.DOCKER="oci",t.NUGET="nuget",t.MCPB="mcpb",t.REMOTE="remote"})(Mv||(Mv={}));var Uv;(function(t){t.STDIO="stdio",t.STREAMABLE_HTTP="streamable-http",t.SSE="sse"})(Uv||(Uv={}));var Fv;(function(t){t.Active="active",t.Deprecated="deprecated"})(Fv||(Fv={}));var hc=W("IMcpGalleryService"),qv=W("IMcpManagementService"),uc=W("IAllowedMcpServersService"),Qf="chat.mcp.access",_v;(function(t){t.Never="never",t.OnlyNew="onlyNew",t.NewAndOutdated="newAndOutdated"})(_v||(_v={}));var zv;(function(t){t.None="none",t.Registry="registry",t.All="all"})(zv||(zv={}));var Kr=W("IMcpResourceScannerService"),fc=class extends j{constructor(e,s){super(),this.b=e,this.c=s,this.a=new ht}async scanMcpServers(e,s){return this.f(e,s)}async addMcpServers(e,s,i){await this.f(s,i,n=>{let r=n.inputs??[];const o=n.servers??{};for(const{name:a,config:c,inputs:l}of e)if(o[a]=c,l){const h=new Set(r.map(f=>f.id)),u=l.filter(f=>!h.has(f.id));r=[...r,...u]}return{servers:o,inputs:r}})}async removeMcpServers(e,s,i){await this.f(s,i,n=>{for(const r of e)n.servers?.[r]&&delete n.servers[r];return n})}async f(e,s,i){return this.r(e).queue(async()=>{s=s??2;let n={};try{const r=await this.b.readFile(e),o=[],a=Be(r.value.toString(),o,{allowTrailingComma:!0,allowEmptyContent:!0})||{};if(o.length>0)throw new Error("Failed to parse scanned MCP servers: "+o.join(", "));if(s===2)n=this.m(a);else if(s===6)n=this.n(a);else if(s===5){const c=a;c.settings?.mcp&&(n=this.n(c.settings?.mcp))}}catch(r){if(Ue(r)!==1)throw r}return i&&(n=i(n??{}),s===2?await this.g(e,n):s===6?await this.h(e,n):s===5?await this.j(e,n):Kw(s,`Invalid Target: ${h2(s)}`)),n})}async g(e,s){s.servers&&Object.keys(s.servers).length>0||s.inputs&&s.inputs.length>0?await this.b.writeFile(e,L.fromString(JSON.stringify(s,null,"	"))):await this.b.del(e)}async h(e,s){await this.b.writeFile(e,L.fromString(JSON.stringify(s,null,"	")))}async j(e,s){let i;try{const n=await this.b.readFile(e),r=[];if(i=Be(n.value.toString(),r,{allowTrailingComma:!0,allowEmptyContent:!0}),r.length>0)throw new Error("Failed to parse scanned MCP servers: "+r.join(", "))}catch(n){if(Ue(n)!==1)throw n;i={settings:{}}}i.settings||(i.settings={}),i.settings.mcp=s,await this.b.writeFile(e,L.fromString(JSON.stringify(i,null,"	")))}m(e){const s={inputs:e.inputs},i=Object.entries(e.servers??{});if(i.length>0){s.servers={};for(const[n,r]of i)s.servers[n]=this.q(r)}return s}n(e){const s={inputs:e.inputs},i=Object.entries(e.servers??{});if(i.length>0){s.servers={};for(const[n,r]of i)s.servers[n]=this.q(r)}return s}q(e){let s;if(e.config){const i=e;s={...i.config,version:i.version,gallery:i.gallery}}else s=e;return(s.type===void 0||s.type!=="http"&&s.type!=="stdio")&&(s.type=s.command?"stdio":"http"),s}r(e){let s=this.a.get(e);return s||(s=new pn,this.a.set(e,s)),s}};fc=__decorate([__param(0,K),__param(1,he)],fc),av(Kr,fc,1);var dc=class extends j{constructor(e){super(),this.a=e}getMcpServerConfigurationFromManifest(e,s){if(s==="remote"&&e.remotes?.length){const{inputs:c,variables:l}=this.f(e.remotes[0].headers??[]);return{mcpServerConfiguration:{config:{type:"http",url:e.remotes[0].url,headers:Object.keys(c).length?c:void 0},inputs:l.length?l:void 0},notices:[]}}const i=e.packages?.find(c=>c.registryType===s)??e.packages?.[0];if(!i)throw new Error("No server package found");const n=[],r=[],o={},a=[];if(i.registryType==="oci"&&(n.push("run"),n.push("-i"),n.push("--rm")),i.runtimeArguments?.length){const c=this.g(i.runtimeArguments??[]);n.push(...c.args),r.push(...c.variables),a.push(...c.notices)}if(i.environmentVariables?.length){const{inputs:c,variables:l,notices:h}=this.f(i.environmentVariables??[]);r.push(...l),a.push(...h);for(const[u,f]of Object.entries(c))o[u]=f,i.registryType==="oci"&&(n.push("-e"),n.push(u))}switch(i.registryType){case"npm":n.push(i.version?`${i.identifier}@${i.version}`:i.identifier);break;case"pypi":n.push(i.version?`${i.identifier}==${i.version}`:i.identifier);break;case"oci":n.push(i.version?`${i.identifier}:${i.version}`:i.identifier);break;case"nuget":n.push(i.version?`${i.identifier}@${i.version}`:i.identifier),n.push("--yes"),i.packageArguments?.length&&n.push("--");break}if(i.packageArguments?.length){const c=this.g(i.packageArguments);n.push(...c.args),r.push(...c.variables),a.push(...c.notices)}return{notices:a,mcpServerConfiguration:{config:{type:"stdio",command:this.b(i.registryType),args:n.length?n:void 0,env:Object.keys(o).length?o:void 0},inputs:r.length?r:void 0}}}b(e){switch(e){case"npm":return"npx";case"oci":return"docker";case"pypi":return"uvx";case"nuget":return"dnx"}return e}c(e){const s=[];for(const[i,n]of Object.entries(e))s.push({id:i,type:n.choices?"pickString":"promptString",description:n.description??"",password:!!n.isSecret,default:n.default,options:n.choices});return s}f(e){const s=[],i={},n=[];for(const r of e){const o=r.variables?this.c(r.variables):[];let a=r.value||"";if(o.length){for(const c of o)a=a.replace(`{${c.id}}`,`\${input:${c.id}}`);n.push(...o)}else!a&&(r.description||r.choices||r.default!==void 0)&&(n.push({id:r.name,type:r.choices?"pickString":"promptString",description:r.description??"",password:!!r.isSecret,default:r.default,options:r.choices}),a=`\${input:${r.name}}`);i[r.name]=a}return{inputs:i,variables:n,notices:s}}g(e){const s=[],i=[],n=[];for(const r of e){const o=r.variables?this.c(r.variables):[];if(r.type==="positional"){let a=r.value;if(a){for(const c of o)a=a.replace(`{${c.id}}`,`\${input:${c.id}}`);s.push(a),o.length&&i.push(...o)}else r.valueHint&&(r.description||r.default!==void 0)?(i.push({id:r.valueHint,type:"promptString",description:r.description??"",password:!1,default:r.default}),s.push(`\${input:${r.valueHint}}`)):s.push(r.valueHint??"")}else if(r.type==="named"){if(!r.name){n.push(`Named argument is missing a name. ${JSON.stringify(r)}`);continue}if(s.push(r.name),r.value){let a=r.value;for(const c of o)a=a.replace(`{${c.id}}`,`\${input:${c.id}}`);s.push(a),o.length&&i.push(...o)}else if(r.description||r.default!==void 0){const a=r.name.replace(/^--?/,"");i.push({id:a,type:"promptString",description:r.description??"",password:!1,default:r.default}),s.push(`\${input:${a}}`)}}}return{args:s,variables:i,notices:n}}};dc=__decorate([__param(0,Q)],dc);var Xf=class extends dc{get onDidInstallMcpServers(){return this.q.event}get onDidUpdateMcpServers(){return this.r.event}get onUninstallMcpServer(){return this.t.event}get onDidUninstallMcpServer(){return this.u.event}constructor(e,s,i,n,r,o,a){super(o),this.w=e,this.y=s,this.z=i,this.C=n,this.F=r,this.G=a,this.m=new Map,this.n=this.D(new R),this.onInstallMcpServer=this.n.event,this.q=this.D(new R),this.r=this.D(new R),this.t=this.D(new R),this.u=this.D(new R),this.j=this.D(new ps(()=>this.L(),50))}H(){return this.h||(this.h=(async()=>{try{this.m=await this.I()}finally{this.J()}})()),this.h}async I(){this.a.trace("AbstractMcpResourceManagementService#populateLocalServers",this.w.toString());const e=new Map;try{const s=await this.G.scanMcpServers(this.w,this.y);s.servers&&await Promise.allSettled(Object.entries(s.servers).map(async([i,n])=>{const r=await this.M(i,n);e.set(i,r)}))}catch(s){throw this.a.debug("Could not read user MCP servers:",s),s}return e}J(){this.D(this.C.watch(this.w)),this.D(this.C.onDidFilesChange(e=>{e.affects(this.w)&&this.j.schedule()}))}async L(){try{const e=await this.I(),s=[],i=[],n=[...this.m.keys()].filter(r=>!e.has(r));for(const r of n)this.m.delete(r);for(const[r,o]of e){const a=this.m.get(r);a?bt(a,o)||(i.push(o),this.m.set(r,o)):(s.push(o),this.m.set(r,o))}for(const r of n)this.m.delete(r),this.u.fire({name:r,mcpResource:this.w});i.length&&this.r.fire(i.map(r=>({name:r.name,local:r,mcpResource:this.w}))),s.length&&this.q.fire(s.map(r=>({name:r.name,local:r,mcpResource:this.w})))}catch(e){this.a.error("Failed to load installed MCP servers:",e)}}async getInstalled(){return await this.H(),Array.from(this.m.values())}async M(e,s){let i=await this.N(e,s);return i||(i={name:e,version:s.version,galleryUrl:de(s.gallery)?s.gallery:void 0}),{name:e,config:s,mcpResource:this.w,version:i.version,location:i.location,displayName:i.displayName,description:i.description,publisher:i.publisher,publisherDisplayName:i.publisherDisplayName,galleryUrl:i.galleryUrl,galleryId:i.galleryId,repositoryUrl:i.repositoryUrl,readmeUrl:i.readmeUrl,icon:i.icon,codicon:i.codicon,manifest:i.manifest,source:s.gallery?"gallery":"local"}}async install(e,s){this.a.trace("MCP Management Service: install",e.name),this.n.fire({name:e.name,mcpResource:this.w});try{await this.G.addMcpServers([e],this.w,this.y),await this.L();const i=this.m.get(e.name);if(!i)throw new Error(`Failed to install MCP server: ${e.name}`);return i}catch(i){throw this.q.fire([{name:e.name,error:i,mcpResource:this.w}]),i}}async uninstall(e,s){this.a.trace("MCP Management Service: uninstall",e.name),this.t.fire({name:e.name,mcpResource:this.w});try{if(!(await this.G.scanMcpServers(this.w,this.y)).servers)return;await this.G.removeMcpServers([e.name],this.w,this.y),e.location&&await this.C.del(k.revive(e.location),{recursive:!0}),await this.L()}catch(i){throw this.u.fire({name:e.name,error:i,mcpResource:this.w}),i}}};Xf=__decorate([__param(2,hc),__param(3,K),__param(4,he),__param(5,Q),__param(6,Kr)],Xf);var pc=class extends Xf{constructor(e,s,i,n,r,o,a){super(e,2,s,i,n,r,o),this.P=n.extUri.joinPath(a.userRoamingDataHome,"mcp")}async installFromGallery(e,s){throw new Error("Not supported")}async updateMetadata(e,s){await this.Q(s),await this.L();const i=(await this.getInstalled()).find(n=>n.name===e.name);if(!i)throw new Error(`Failed to find MCP server: ${e.name}`);return i}async Q(e){const s=e.configuration,i=this.S(e.name,e.version),n=this.F.extUri.joinPath(i,"manifest.json"),r={galleryUrl:e.galleryUrl,galleryId:e.id,name:e.name,displayName:e.displayName,description:e.description,version:e.version,publisher:e.publisher,publisherDisplayName:e.publisherDisplayName,repositoryUrl:e.repositoryUrl,licenseUrl:e.license,icon:e.icon,codicon:e.codicon,manifest:s};if(await this.C.writeFile(n,L.fromString(JSON.stringify(r))),e.readmeUrl||e.readme){const o=e.readme?e.readme:await this.z.getReadme(e,Z.None);await this.C.writeFile(this.F.extUri.joinPath(i,"README.md"),L.fromString(o))}return s}async N(e,s){let i,n,r;if(s.gallery){n=this.S(e,s.version);const o=this.F.extUri.joinPath(n,"manifest.json");try{const a=await this.C.readFile(o);i=JSON.parse(a.value.toString()),i.galleryUrl?.includes("/v0/")&&(i.galleryUrl=i.galleryUrl.substring(0,i.galleryUrl.indexOf("/v0/")),await this.C.writeFile(o,L.fromString(JSON.stringify(i)))),i.location=n,r=this.F.extUri.joinPath(n,"README.md"),await this.C.exists(r)||(r=void 0),i.readmeUrl=r}catch(a){this.a.error("MCP Management Service: failed to read manifest",n.toString(),a)}}return i}S(e,s){return e=e.replace("/","."),this.F.extUri.joinPath(this.P,s?`${e}-${s}`:e)}O(e,s){throw new Error("Method not supported.")}canInstall(){throw new Error("Not supported")}};pc=__decorate([__param(1,hc),__param(2,K),__param(3,he),__param(4,Q),__param(5,Kr),__param(6,ae)],pc);var gc=class extends dc{constructor(e,s){super(s),this.h=e}canInstall(e){const s=this.h.isAllowed(e);return s!==!0?new Ps(w(2186,null,s.value)):!0}};gc=__decorate([__param(0,uc),__param(1,Q)],gc);var Zf=class extends gc{constructor(e,s,i,n){super(e,s),this.u=i,this.w=n,this.j=this.D(new R),this.onInstallMcpServer=this.j.event,this.m=this.D(new R),this.onDidInstallMcpServers=this.m.event,this.n=this.D(new R),this.onDidUpdateMcpServers=this.n.event,this.q=this.D(new R),this.onUninstallMcpServer=this.q.event,this.r=this.D(new R),this.onDidUninstallMcpServer=this.r.event,this.t=new ht}y(e){let s=this.t.get(e);if(!s){const i=new Pe,n=i.add(this.z(e));i.add(n.onInstallMcpServer(r=>this.j.fire(r))),i.add(n.onDidInstallMcpServers(r=>this.m.fire(r))),i.add(n.onDidUpdateMcpServers(r=>this.n.fire(r))),i.add(n.onUninstallMcpServer(r=>this.q.fire(r))),i.add(n.onDidUninstallMcpServer(r=>this.r.fire(r))),this.t.set(e,s={service:n,dispose:()=>i.dispose()})}return s.service}async getInstalled(e){const s=e||this.u.defaultProfile.mcpResource;return this.y(s).getInstalled()}async install(e,s){const i=s?.mcpResource||this.u.defaultProfile.mcpResource;return this.y(i).install(e,s)}async uninstall(e,s){const i=s?.mcpResource||this.u.defaultProfile.mcpResource;return this.y(i).uninstall(e,s)}async installFromGallery(e,s){const i=s?.mcpResource||this.u.defaultProfile.mcpResource;return this.y(i).installFromGallery(e,s)}async updateMetadata(e,s,i){return this.y(i||this.u.defaultProfile.mcpResource).updateMetadata(e,s)}dispose(){this.t.forEach(e=>e.dispose()),this.t.clear(),super.dispose()}z(e){return this.w.createInstance(pc,e)}};Zf=__decorate([__param(0,uc),__param(1,Q),__param(2,Ne),__param(3,ns)],Zf);var Yf=class extends pc{constructor(e,s,i,n,r,o,a){super(e,s,i,n,r,o,a)}async installFromGallery(e,s){this.a.trace("MCP Management Service: installGallery",e.name,e.galleryUrl),this.n.fire({name:e.name,mcpResource:this.w});try{const i=await this.Q(e),n=s?.packageType??i.packages?.[0]?.registryType??"remote",{mcpServerConfiguration:r,notices:o}=this.getMcpServerConfigurationFromManifest(i,n);o.length>0&&this.a.warn(`MCP Management Service: Warnings while installing ${e.name}`,o);const a={name:e.name,config:{...r.config,gallery:e.galleryUrl??!0,version:e.version},inputs:r.inputs};await this.G.addMcpServers([a],this.w,this.y),await this.L();const c=(await this.getInstalled()).find(l=>l.name===e.name);if(!c)throw new Error(`Failed to install MCP server: ${e.name}`);return c}catch(i){throw this.q.fire([{name:e.name,source:e,error:i,mcpResource:this.w}]),i}}};Yf=__decorate([__param(1,hc),__param(2,K),__param(3,he),__param(4,Q),__param(5,Kr),__param(6,ae)],Yf);var cS=class extends Zf{z(t){return this.w.createInstance(Yf,t)}},Vv;(function(t){t.McpServersQueryService="McpServersQueryService",t.McpServerWebUri="McpServerWebUriTemplate",t.McpServerVersionUri="McpServerVersionUriTemplate",t.McpServerIdUri="McpServerIdUriTemplate",t.McpServerLatestVersionUri="McpServerLatestVersionUriTemplate",t.McpServerNamedResourceUri="McpServerNamedResourceUriTemplate",t.PublisherUriTemplate="PublisherUriTemplate",t.ContactSupportUri="ContactSupportUri",t.PrivacyPolicyUri="PrivacyPolicyUri",t.TermsOfServiceUri="TermsOfServiceUri",t.ReportUri="ReportUri"})(Vv||(Vv={}));var Bv;(function(t){t.Available="available",t.Unavailable="unavailable"})(Bv||(Bv={}));var Wv=W("IMcpGalleryManifestService");function Bn(t,e){const[s,i]=e.split("/");for(const n of t.resources){const[r,o]=n.type.split("/");if(r===s){if(!i||o===i)return n.id;break}}}var Hv;(function(t){t.PNG="image/png",t.JPEG="image/jpeg",t.JPG="image/jpg",t.SVG="image/svg+xml",t.WEBP="image/webp"})(Hv||(Hv={}));var Gv;(function(t){t.LIGHT="light",t.DARK="dark"})(Gv||(Gv={}));var ed;(function(t){t.VERSION="v0-2025-07-09",t.SCHEMA="https://static.modelcontextprotocol.io/schemas/2025-07-09/server.schema.json";class e{toRawGalleryMcpServerResult(i){if(!i||typeof i!="object"||!Array.isArray(i.servers))return;const n=i,r=[];for(const o of n.servers){const a=this.toRawGalleryMcpServer(o);if(!a)return;r.push(a)}return{metadata:{count:n.metadata.count??0,nextCursor:n.metadata?.next_cursor},servers:r}}toRawGalleryMcpServer(i){if(!i||typeof i!="object")return;const n=i;if(!n.name||!de(n.name)||!n.description||!de(n.description)||!n.version||!de(n.version)||n.$schema&&n.$schema!==t.SCHEMA)return;const r=n._meta?.["io.modelcontextprotocol.registry/official"];function o(p){return{...p,isRequired:p.is_required,isSecret:p.is_secret}}function a(p){const g={};for(const[m,v]of Object.entries(p))g[m]=o(v);return g}function c(p){return p.type==="positional"?{...p,valueHint:p.value_hint,isRepeated:p.is_repeated,isRequired:p.is_required,isSecret:p.is_secret,variables:p.variables?a(p.variables):void 0}:{...p,isRepeated:p.is_repeated,isRequired:p.is_required,isSecret:p.is_secret,variables:p.variables?a(p.variables):void 0}}function l(p){return{...p,isRequired:p.is_required,isSecret:p.is_secret,variables:p.variables?a(p.variables):void 0}}function h(p){switch(p.type){case"stdio":return{type:"stdio"};case"streamable-http":return{type:"streamable-http",url:p.url,headers:p.headers?.map(l)};case"sse":return{type:"sse",url:p.url,headers:p.headers?.map(l)};default:return{type:"stdio"}}}function u(p){switch(p){case"npm":return"npm";case"docker":case"docker-hub":case"oci":return"oci";case"pypi":return"pypi";case"nuget":return"nuget";case"mcpb":return"mcpb";default:return"npm"}}const f=n._meta["io.modelcontextprotocol.registry/publisher-provided"]?.github;return{id:r.id,name:n.name,description:n.description,repository:n.repository?{url:n.repository.url,source:n.repository.source,id:n.repository.id}:void 0,readme:n.repository?.readme,version:n.version,createdAt:n.created_at,updatedAt:n.updated_at,packages:n.packages?.map(p=>({identifier:p.identifier??p.name,registryType:u(p.registry_type??p.registry_name),version:p.version,fileSha256:p.file_sha256,registryBaseUrl:p.registry_base_url,transport:p.transport?h(p.transport):{type:"stdio"},packageArguments:p.package_arguments?.map(c),runtimeHint:p.runtime_hint,runtimeArguments:p.runtime_arguments?.map(c),environmentVariables:p.environment_variables?.map(l)})),remotes:n.remotes?.map(p=>({type:(p.type??p.transport_type??p.transport)==="sse"?"sse":"streamable-http",url:p.url,headers:p.headers?.map(l)})),registryInfo:{isLatest:r.is_latest,publishedAt:r.published_at,updatedAt:r.updated_at},githubInfo:f?{name:f.name,nameWithOwner:f.name_with_owner,displayName:f.display_name,isInOrganization:f.is_in_organization,license:f.license,opengraphImageUrl:f.opengraph_image_url,ownerAvatarUrl:f.owner_avatar_url,primaryLanguage:f.primary_language,primaryLanguageColor:f.primary_language_color,pushedAt:f.pushed_at,stargazerCount:f.stargazer_count,topics:f.topics,usesCustomOpengraphImage:f.uses_custom_opengraph_image}:void 0}}}t.SERIALIZER=new e})(ed||(ed={}));var Qr;(function(t){t.VERSION="v0.1";class e{toRawGalleryMcpServerResult(i){if(!i||typeof i!="object"||!Array.isArray(i.servers))return;const n=i,r=[];for(const o of n.servers){const a=this.toRawGalleryMcpServer(o);if(!a){if(r.length===0)return;continue}r.push(a)}return{metadata:n.metadata,servers:r}}toRawGalleryMcpServer(i){if(!i||typeof i!="object")return;const n=i;if(!n.server||!Te(n.server)||!n.server.name||!de(n.server.name)||!n.server.description||!de(n.server.description)||!n.server.version||!de(n.server.version))return;const{"io.modelcontextprotocol.registry/official":r,...o}=n._meta,a=n.server._meta?.["io.modelcontextprotocol.registry/publisher-provided"]?.github;return{name:n.server.name,description:n.server.description,version:n.server.version,title:n.server.title,repository:n.server.repository?{url:n.server.repository.url,source:n.server.repository.source,id:n.server.repository.id}:void 0,readme:a?.readme,icons:n.server.icons,websiteUrl:n.server.websiteUrl,packages:n.server.packages,remotes:n.server.remotes,status:r?.status,registryInfo:r,githubInfo:a,apicInfo:o}}}t.SERIALIZER=new e})(Qr||(Qr={}));var mc;(function(t){t.VERSION="v0";class e{constructor(){this.a=[],this.a.push(Qr.SERIALIZER),this.a.push(ed.SERIALIZER)}toRawGalleryMcpServerResult(i){for(const n of this.a){const r=n.toRawGalleryMcpServerResult(i);if(r)return r}}toRawGalleryMcpServer(i){for(const n of this.a){const r=n.toRawGalleryMcpServer(i);if(r)return r}}}t.SERIALIZER=new e})(mc||(mc={}));var lS=50,hS={pageSize:lS},uS=class dd{constructor(e=hS){this.a=e}get pageSize(){return this.a.pageSize}get searchText(){return this.a.searchText}get cursor(){return this.a.cursor}withPage(e,s=this.pageSize){return new dd({...this.a,pageSize:s,cursor:e})}withSearchText(e){return new dd({...this.a,searchText:e})}},td=class extends j{constructor(e,s,i,n){super(),this.b=e,this.c=s,this.f=i,this.g=n,this.a=new Map,this.a.set(mc.VERSION,mc.SERIALIZER),this.a.set(Qr.VERSION,Qr.SERIALIZER)}isEnabled(){return this.g.mcpGalleryManifestStatus==="available"}async query(e,s=Z.None){const i=await this.g.getMcpGalleryManifest();if(!i)return{firstPage:{items:[],hasMore:!1},getNextPage:async()=>({items:[],hasMore:!1})};let n=new uS;e?.text&&(n=n.withSearchText(e.text.trim()));const{servers:r,metadata:o}=await this.m(n,i,s);let a=o.nextCursor;return{firstPage:{items:r,hasMore:!!o.nextCursor},getNextPage:async c=>{if(c.isCancellationRequested)throw new nt;if(!a)return{items:[],hasMore:!1};const{servers:l,metadata:h}=await this.m(n.withPage(a).withSearchText(void 0),i,c);return a=h.nextCursor,{items:l,hasMore:!!h.nextCursor}}}}async getMcpServersFromGallery(e){const s=await this.g.getMcpGalleryManifest();if(!s)return[];const i=[];return await Promise.allSettled(e.map(async n=>{const r=await this.h(n,s);r&&i.push(r)})),i}async h({name:e,id:s},i){const n=this.y(e,i);if(n){const a=await this.getMcpServer(n);if(a)return a}const r=this.u(e,i);if(r){const a=await this.getMcpServer(r);if(a)return a}const o=s?this.w(s,i):void 0;if(o){const a=await this.getMcpServer(o);if(a)return a}}async getReadme(e,s){const i=e.readmeUrl;if(!i)return Promise.resolve(w(2184,null));const n=k.parse(i);if(n.scheme===ne.file)try{return(await this.c.readFile(n)).value.toString()}catch(a){this.f.error(`Failed to read file from ${n}: ${a}`)}if(n.authority!=="raw.githubusercontent.com")return new Ps(w(2185,null,i)).value;const r=await this.b.request({type:"GET",url:i},s),o=await ih(r);if(!o)throw new Error(`Failed to fetch README from ${i}`);return o}j(e,s){let i="",n=e.title;if(e.githubInfo?.name)n||(n=e.githubInfo.name.split("-").map(c=>c.toLowerCase()==="mcp"?"MCP":c.toLowerCase()==="github"?"GitHub":Jc(c)).join(" ")),i=e.githubInfo.nameWithOwner.split("/")[0];else{const c=e.name.split("/");if(c.length>0){const l=c[0].split(".");l.length>0&&(i=l[l.length-1])}n||(n=c[c.length-1].split("-").map(l=>Jc(l)).join(" "))}e.githubInfo?.displayName&&(n=e.githubInfo.displayName);let r;if(e.githubInfo?.preferredImage)r={light:e.githubInfo.preferredImage,dark:e.githubInfo.preferredImage};else if(e.githubInfo?.ownerAvatarUrl)r={light:e.githubInfo.ownerAvatarUrl,dark:e.githubInfo.ownerAvatarUrl};else if(e.apicInfo?.["x-ms-icon"])r={light:e.apicInfo["x-ms-icon"],dark:e.apicInfo["x-ms-icon"]};else if(e.icons&&e.icons.length>0){const c=e.icons.find(h=>h.theme==="light")??e.icons[0],l=e.icons.find(h=>h.theme==="dark")??c;r={light:c.src,dark:l.src}}const o=s?this.z(e.name,s):void 0,a=s?this.C(i,s):void 0;return{id:e.id,name:e.name,displayName:n,galleryUrl:s?.url,webUrl:o,description:e.description,status:e.status??"active",version:e.version,isLatest:e.registryInfo?.isLatest??!0,publishDate:e.registryInfo?.publishedAt?Date.parse(e.registryInfo.publishedAt):void 0,lastUpdated:e.githubInfo?.pushedAt?Date.parse(e.githubInfo.pushedAt):e.registryInfo?.updatedAt?Date.parse(e.registryInfo.updatedAt):void 0,repositoryUrl:e.repository?.url,readme:e.readme,icon:r,publisher:i,publisherUrl:a,license:e.githubInfo?.license,starsCount:e.githubInfo?.stargazerCount,topics:e.githubInfo?.topics,configuration:{packages:e.packages,remotes:e.remotes}}}async m(e,s,i){const{servers:n,metadata:r}=await this.n(e,s,i);return{servers:n.map(o=>this.j(o,s)),metadata:r}}async n(e,s,i){const n=this.F(s);if(!n)return{servers:[],metadata:{count:0}};const r=k.parse(n);if(r.scheme===ne.file)try{const u=(await this.c.readFile(r)).value.toString();return JSON.parse(u)}catch(h){this.f.error(`Failed to read file from ${r}: ${h}`)}let o=`${n}?limit=${e.pageSize}&version=latest`;if(e.cursor&&(o+=`&cursor=${e.cursor}`),e.searchText){const h=encodeURIComponent(e.searchText);o+=`&search=${h}`}const a=await this.b.request({type:"GET",url:o},i),c=await Js(a);if(!c)return{servers:[],metadata:{count:0}};const l=this.r(c,s);if(!l)throw new Error(`Failed to serialize MCP servers result from ${n}`,c);return l}async getMcpServer(e,s){const i=await this.b.request({type:"GET",url:e},Z.None);if(i.res.statusCode&&i.res.statusCode>=400&&i.res.statusCode<500)return;const n=await Js(i);if(!n)return;s||(s=await this.g.getMcpGalleryManifest()),s=s&&e.startsWith(s.url)?s:null;const r=this.q(n,s);if(!r)throw new Error(`Failed to serialize MCP server from ${e}`,n);return this.j(r,s)}q(e,s){return this.t(s)?.toRawGalleryMcpServer(e)}r(e,s){return this.t(s)?.toRawGalleryMcpServerResult(e)}t(e){const s=e?.version??"v0";return this.a.get(s)}u(e,s){const i=Bn(s,"McpServerNamedResourceUriTemplate");if(i)return is(i,{name:e})}w(e,s){const i=Bn(s,"McpServerIdUriTemplate");if(i)return is(i,{id:e})}y(e,s){const i=Bn(s,"McpServerLatestVersionUriTemplate");if(i)return is(i,{name:encodeURIComponent(e)})}z(e,s){const i=Bn(s,"McpServerWebUriTemplate");if(i)return is(i,{name:e})}C(e,s){const i=Bn(s,"PublisherUriTemplate");if(i)return is(i,{name:e})}F(e){return Bn(e,"McpServersQueryService")}};td=__decorate([__param(0,li),__param(1,K),__param(2,Q),__param(3,Wv)],td);function Yi(t,e){return t?k.revive(e?e.transformIncoming(t):t):void 0}function wi(t,e){e=e||ma;const s=t.manifest;return{...va({...t,manifest:void 0},e),manifest:s}}function sd(t,e){return t?.mcpResource?va(t,e??ma):t}function id(t,e){return e?Gl(t,s=>s instanceof k?e.transformOutgoingURI(s):void 0):t}function Xr(t,e){return e?e.transformOutgoingURI(t):t}var fS=class{constructor(t,e){this.a=t,this.b=e,this.onInstallMcpServer=O.buffer(t.onInstallMcpServer,!0),this.onDidInstallMcpServers=O.buffer(t.onDidInstallMcpServers,!0),this.onDidUpdateMcpServers=O.buffer(t.onDidUpdateMcpServers,!0),this.onUninstallMcpServer=O.buffer(t.onUninstallMcpServer,!0),this.onDidUninstallMcpServer=O.buffer(t.onDidUninstallMcpServer,!0)}listen(t,e){const s=this.b(t);switch(e){case"onInstallMcpServer":return O.map(this.onInstallMcpServer,i=>({...i,mcpResource:Xr(i.mcpResource,s)}));case"onDidInstallMcpServers":return O.map(this.onDidInstallMcpServers,i=>i.map(n=>({...n,local:n.local?id(n.local,s):n.local,mcpResource:Xr(n.mcpResource,s)})));case"onDidUpdateMcpServers":return O.map(this.onDidUpdateMcpServers,i=>i.map(n=>({...n,local:n.local?id(n.local,s):n.local,mcpResource:Xr(n.mcpResource,s)})));case"onUninstallMcpServer":return O.map(this.onUninstallMcpServer,i=>({...i,mcpResource:Xr(i.mcpResource,s)}));case"onDidUninstallMcpServer":return O.map(this.onDidUninstallMcpServer,i=>({...i,mcpResource:Xr(i.mcpResource,s)}))}throw new Error("Invalid listen")}async call(t,e,s){const i=this.b(t),n=Array.isArray(s)?s:[];switch(e){case"getInstalled":return(await this.a.getInstalled(Yi(n[0],i))).map(o=>id(o,i));case"install":return this.a.install(n[0],sd(n[1],i));case"installFromGallery":return this.a.installFromGallery(n[0],sd(n[1],i));case"uninstall":return this.a.uninstall(wi(n[0],i),sd(n[1],i));case"updateMetadata":return this.a.updateMetadata(wi(n[0],i),n[1],Yi(n[2],i))}throw new Error("Invalid call")}},Jv=class extends gc{get onInstallMcpServer(){return this.j.event}get onDidInstallMcpServers(){return this.m.event}get onUninstallMcpServer(){return this.n.event}get onDidUninstallMcpServer(){return this.q.event}get onDidUpdateMcpServers(){return this.r.event}constructor(e,s,i){super(s,i),this.t=e,this.j=this.D(new R),this.m=this.D(new R),this.n=this.D(new R),this.q=this.D(new R),this.r=this.D(new R),this.D(this.t.listen("onInstallMcpServer")(n=>this.j.fire({...n,mcpResource:Yi(n.mcpResource,null)}))),this.D(this.t.listen("onDidInstallMcpServers")(n=>this.m.fire(n.map(r=>({...r,local:r.local?wi(r.local,null):r.local,mcpResource:Yi(r.mcpResource,null)}))))),this.D(this.t.listen("onDidUpdateMcpServers")(n=>this.r.fire(n.map(r=>({...r,local:r.local?wi(r.local,null):r.local,mcpResource:Yi(r.mcpResource,null)}))))),this.D(this.t.listen("onUninstallMcpServer")(n=>this.n.fire({...n,mcpResource:Yi(n.mcpResource,null)}))),this.D(this.t.listen("onDidUninstallMcpServer")(n=>this.q.fire({...n,mcpResource:Yi(n.mcpResource,null)})))}install(e,s){return Promise.resolve(this.t.call("install",[e,s])).then(i=>wi(i,null))}installFromGallery(e,s){return Promise.resolve(this.t.call("installFromGallery",[e,s])).then(i=>wi(i,null))}uninstall(e,s){return Promise.resolve(this.t.call("uninstall",[e,s]))}getInstalled(e){return Promise.resolve(this.t.call("getInstalled",[e])).then(s=>s.map(i=>wi(i,null)))}updateMetadata(e,s,i){return Promise.resolve(this.t.call("updateMetadata",[e,s,i])).then(n=>wi(n,null))}};Jv=__decorate([__param(1,uc),__param(2,Q)],Jv);var nd=class extends j{constructor(e){super(),this.b=e,this.a=this.D(new R),this.onDidChangeAllowedMcpServers=this.a.event,this.D(this.b.onDidChangeConfiguration(s=>{s.affectsConfiguration(Qf)&&this.a.fire()}))}isAllowed(e){if(this.b.getValue(Qf)!=="none")return!0;const s=R0("workbench.action.openSettings",{query:`@id:${Qf}`}).toString();return new Ps(w(2183,null,s))}};nd=__decorate([__param(0,me)],nd);var dS=class extends j{get mcpGalleryManifestStatus(){return this.c?"available":"unavailable"}constructor(t){super(),this.a=this.D(new R),this.onDidChangeMcpGalleryManifest=this.a.event,this.b=this.D(new R),this.onDidChangeMcpGalleryManifestStatus=this.b.event,this.f=new rr,t.registerChannel("mcpGalleryManifest",{listen:()=>O.None,call:async(e,s,i)=>{switch(s){case"setMcpGalleryManifest":{const n=Array.isArray(i)?i[0]:null;return Promise.resolve(this.g(n))}}throw new Error("Invalid call")}})}async getMcpGalleryManifest(){return await this.f.wait(),this.c??null}g(t){this.c=t,this.a.fire(t),this.b.fire(this.mcpGalleryManifestStatus),this.f.open()}},pS=class extends j{constructor(t){super(),this.f=t,this.a=this.D(new db(this)),this.b=void 0,this.c=this.D(new R),this.g()}g(){let t=!1;const e=()=>{t||(t=!0,this.b?.fireOnWillShutdown(),this.dispose())};process.once("exit",e),pb(process.parentPort,Uf.exit,e)}async init(){const t=await this.h();a6(),t.invokeFunction(e=>{const s=e.get(Q),i=e.get(ke);s.trace("sharedProcess configuration",JSON.stringify(this.f)),this.j(e),this.m(s),this.n(i,s)}),this.D(qc(t.createInstance(yl,this.f.codeCachePath),t.createInstance(bl),t.createInstance(Nl),t.createInstance(Ol),t.createInstance(Ll),t.createInstance($f),t.createInstance(Sf),t.createInstance(Hf)))}async h(){const t=new Yh,e={_serviceBrand:void 0,...ms};t.set(ge,e);const s=new J1(T=>T==="main"),i=new V2(this.a,s);t.set(Ko,i);const n=this.f.policiesData?new U8(this.f.policiesData,i.getChannel("policy")):new mg;t.set(gg,n);const r=new y3(this.f.args,e);t.set(Vt,r);const o=new Y7(void 0,this.f.logLevel,r.logsHome,this.f.loggers.map(T=>({...T,resource:k.revive(T.resource)})),i.getChannel("logger"));t.set(gr,o);const a={id:"shared",name:w(170,null)},c=this.D(o.createLogger("sharedprocess",{name:w(171,null),group:a})),l=this.D(new i2(c.getLevel())),h=this.D(new wv(c,[l]));t.set(Q,h),this.b=this.D(new xf(h)),t.set(yv,this.b);const u=this.D(new Kh(h));t.set(K,u);const f=this.D(new H7(h));u.registerProvider(ne.file,f);const p=new ac(u);t.set(he,p);const g=this.D(new F8(this.f.profiles.all,k.revive(this.f.profiles.home).with({scheme:r.userRoamingDataHome.scheme}),i.getChannel("userDataProfiles")));t.set(Ne,g);const m=this.D(new N8(ne.file,this.D(new j8(i.getChannel(T8),{pathCaseSensitive:ut})),ne.vscodeUserData,g,p,h));u.registerProvider(ne.vscodeUserData,m);const v=this.D(new o5(g.defaultProfile.settingsResource,u,n,h));t.set(me,v);const b=new o3(void 0,{defaultProfile:g.defaultProfile,currentProfile:g.defaultProfile},i,r);t.set(re,b),this.D(pe(()=>b.flush())),await Promise.all([v.initialize(),b.initialize()]);const S=this.D(o.createLogger("network-shared",{name:w(172,null),group:a})),$=new Bf(v,r,this.D(new wv(S)));t.set(li,$),t.set(Jp,new ce(zl,void 0,!1)),t.set(lv,new ce(M8,void 0,!1));const F=new Pf(-1,i);t.set(Jo,F),t.set(Rg,new ce(rh,void 0,!0));const B=this.D(new J6(F)),ve=new J1(T=>B.getActiveClientId().then(A=>T===A));t.set(q0,new i3(this.a.getChannel("extensionRecommendationNotification",ve)));let N;const E=[],C=T5(e,v);if(jg(e,r)){const T=new Da("",!1,o,r,e);if(E.push(T),!Mg(e,r)&&e.aiConfig?.ariaKey){const A=new K8($,C,"monacoworkbench",null,e.aiConfig.ariaKey);this.D(pe(()=>A.flush())),E.push(A)}N=new Pa({appenders:E,commonProperties:P5(qw(),Fw(),process.arch,e.commit,e.version,this.f.machineId,this.f.sqmId,this.f.devDeviceId,C,e.date),sendErrorTelemetry:!0,piiPaths:j5(r)},v,e)}else{N=L5;const T=N5;E.push(T)}this.a.registerChannel("telemetryAppender",new t6(E)),t.set(ke,N);const _=new iu(v,N,o,r,e);t.set(Eg,_),t.set(hi,new ce(Df,void 0,!0)),t.set(Ea,new ce(yf,void 0,!0)),t.set(h0,new ce(Eh,void 0,!0)),t.set(Fi,new ce(Gf,void 0,!0)),t.set(zh,new ce(Bh,void 0,!0)),t.set(uc,new ce(nd,void 0,!0)),t.set(Wv,new dS(this.a)),t.set(hc,new ce(td,void 0,!0)),t.set(Kr,new ce(fc,void 0,!0)),t.set(qv,new ce(cS,void 0,!0)),t.set(Pr,new Kf(this.a,e)),t.set(xs,new ce(Sh,void 0,!0)),t.set(Mp,new ce(Mf,void 0,!1)),t.set(Il,new ce(tu,void 0,!1)),t.set(vg,new ce(th,void 0,!1)),t.set(Na,new ce(lu,void 0,!0)),t.set(Re,new ce(bu,void 0,!0)),t.set(Oa,xt.toService(this.a.getChannel("userDataSyncUtil",T=>T.ctx!=="main"))),t.set(jp,new ce(ca,void 0,!1)),t.set(Ia,new ce(ru,void 0,!0)),t.set(nu,new ce(jr)),t.set(ui,new ce(vu,void 0,!0)),t.set(rt,new ce(yu,void 0,!0)),t.set(Ma,new ce(Eu,void 0,!0)),t.set(kt,new ce(fu,void 0,!1)),t.set(mt,new ce(xu,void 0,!0)),t.set(La,new ce(Yu,void 0,!1)),t.set(qr,new ce(tf,void 0,!0)),t.set(cu,new ce(Ef,void 0,!0)),t.set(nc,new ce(X6,void 0,!1));const q=new D8;return t.set(oc,q),q.register(0,l3),t.set(Um,new ce(mf)),t.set(rv,new ce(wf)),t.set(dv,new ce(Rf)),t.set(jv,new ce(aS)),new K7(t)}j(t){const e=new F9(t.get(Gs),()=>null);this.a.registerChannel("extensions",e);const s=new fS(t.get(qv),()=>null);this.a.registerChannel("mcpManagement",s);const i=xt.fromService(t.get(Il),this.B);this.a.registerChannel("languagePacks",i);const n=xt.fromService(t.get(vg),this.B);this.a.registerChannel("diagnostics",n);const r=new q9(t.get(Mp));this.a.registerChannel("extensionTipsService",r);const o=xt.fromService(t.get(Jp),this.B);this.a.registerChannel("checksum",o);const a=xt.fromService(t.get(lv),this.B);this.a.registerChannel("v8InspectProfiling",a);const c=xt.fromService(t.get(Ma),this.B);this.a.registerChannel("userDataSyncMachines",c);const l=xt.fromService(t.get(Eg),this.B);this.a.registerChannel("customEndpointTelemetry",l);const h=new m6(t.get(Na));this.a.registerChannel("userDataSyncAccount",h);const u=new v6(t.get(ui));this.a.registerChannel("userDataSyncStoreManagement",u);const f=new H6(t.get(La),t.get(Ne),t.get(Q));this.a.registerChannel("userDataSync",f);const p=this.D(t.get(ns).createInstance(Tf));this.a.registerChannel("userDataAutoSync",xt.fromService(p,this.B)),this.a.registerChannel("IUserDataSyncResourceProviderService",xt.fromService(t.get(cu),this.B));const g=xt.fromService(t.get(rv),this.B);this.a.registerChannel(A8,g);const m=xt.fromService(t.get(dv),this.B);this.a.registerChannel("remoteTunnel",m);const v=xt.fromService(t.get(jv),this.B);this.a.registerChannel("sharedWebContentExtractor",v)}m(t){process.on("uncaughtException",e=>it(e)),process.on("unhandledRejection",e=>it(e)),Vw(e=>{const s=Xt(e,!0);s&&t.error(`[uncaught exception in sharedProcess]: ${s}`)})}async n(t,e){if(ut){const[s,i]=await Promise.all([x3(e.error.bind(e)),L3(e.error.bind(e))]),n=C3(),r=O3(i,this.f.args["ozone-platform"]);s&&t.publicLog2("clientPlatformInfo",{platformId:s.id,platformVersionId:s.version_id,platformIdLike:s.id_like,desktopEnvironment:n,displayProtocol:i,codeDisplayProtocol:r})}}handledClientConnection(t){if(t.data!==b3.response)return!1;const e=t.ports.at(0);return e?(this.c.fire(e),!0):!1}};async function Kv(t){try{const e=new pS(t);process.parentPort.postMessage(Uf.ipcReady),await e.init(),process.parentPort.postMessage(Uf.initDone)}catch(e){process.parentPort.postMessage({error:e.toString()})}}var gS=setTimeout(()=>{process.parentPort.postMessage({warning:"[SharedProcess] did not receive configuration within 30s..."})},3e4);process.parentPort.once("message",t=>{clearTimeout(gS),Kv(t.data)});export{Kv as main};

//# sourceMappingURL=https://main.vscode-cdn.net/sourcemaps/994fd12f8d3a5aa16f17d42c041e5809167e845a/core/vs/code/electron-utility/sharedProcess/sharedProcessMain.js.map
